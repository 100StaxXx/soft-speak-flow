import{dK as D,H as L,r as g,q as j,u as R,aB as U,aA as c,j as e,aZ as v,aa as C,dg as k,dn as K,aW as B,cm as _,dr as q,c5 as E,bx as Y,dN as M,o as Q,aR as A}from"./vendor-FfY6MM0Z.js";import{a6 as h,s as f,f as i,a as V,B as o,G as l}from"./index-sX_cJ3I4.js";import"./date-vendor-Bk4KiHsJ.js";import"./three-vendor-qI8GXUTd.js";const G=()=>{const[b]=D(),y=L(),[u,S]=g.useState(""),[t,x]=g.useState(null);g.useEffect(()=>{const s=b.get("code"),r=h.getItem("influencer_code");s?(x(s),h.setItem("influencer_code",s)):r&&x(r)},[b]);const{data:a,isLoading:$}=j({queryKey:["influencer-code",t],queryFn:async()=>{if(!t)return null;const{data:s,error:r}=await f.from("referral_codes").select("*").eq("code",t).eq("owner_type","influencer").maybeSingle();if(r)throw console.error("Error fetching influencer code:",r),r;if(!s)throw new Error("Invalid or expired influencer code");return s},enabled:!!t}),{data:m}=j({queryKey:["influencer-conversions",t],queryFn:async()=>{if(!t)return[];const{data:s,error:r}=await f.from("profiles").select("id, email, created_at, subscription_status").eq("referred_by_code",t).order("created_at",{ascending:!1});if(r)throw r;return s},enabled:!!t}),{data:d}=j({queryKey:["influencer-payouts",a?.id],queryFn:async()=>{if(!a?.id)return[];const{data:s,error:r}=await f.from("referral_payouts").select("*").eq("referral_code_id",a.id).order("created_at",{ascending:!1});if(r)throw r;return s},enabled:!!a?.id}),n={totalSignups:m?.length||0,activeSubscribers:m?.filter(s=>s.subscription_status==="active").length||0,totalEarnings:d?.reduce((s,r)=>s+Number(r.amount),0)||0,pendingEarnings:d?.filter(s=>s.status==="pending").reduce((s,r)=>s+Number(r.amount),0)||0,requestedEarnings:d?.filter(s=>s.status==="requested").reduce((s,r)=>s+Number(r.amount),0)||0,paidEarnings:d?.filter(s=>s.status==="paid").reduce((s,r)=>s+Number(r.amount),0)||0},P=R(),p=U({mutationFn:async()=>{const{data:s,error:r}=await f.functions.invoke("request-referral-payout",{body:{referral_code:t}});if(r)throw r;if(s?.error)throw new Error(s.error);return s},onSuccess:s=>{c.success(s.message||"Payout request submitted!"),P.invalidateQueries({queryKey:["influencer-payouts"]})},onError:s=>{c.error(s.message||"Failed to request payout")}}),N=()=>{if(!u.trim()){c.error("Please enter your referral code");return}x(u.trim().toUpperCase()),h.setItem("influencer_code",u.trim().toUpperCase())},T=()=>{t&&(navigator.clipboard.writeText(t),c.success("Code copied to clipboard!"))},F=()=>{if(t){const s=`${window.location.origin}/?ref=${t}`;navigator.clipboard.writeText(s),c.success("Link copied to clipboard!")}},I=async()=>{if(!t)return;const s=`‚ú® Transform your habits into an epic journey with Cosmiq! Use my code ${t} or click: ${window.location.origin}/?ref=${t}`;if(Q.isNativePlatform())try{await A.share({text:s,dialogTitle:"Share Your Referral Code"})}catch(r){console.error("Share failed:",r)}else navigator.clipboard.writeText(s),c.success("Promo text copied to clipboard!")},w=()=>{h.removeItem("influencer_code"),x(null),y("/creator")};return t?$?e.jsx("div",{className:"min-h-screen pb-nav-safe bg-gradient-to-b from-background via-background/95 to-primary/5 flex items-center justify-center",children:e.jsx(C,{className:"h-8 w-8 animate-spin text-primary"})}):a?e.jsx("div",{className:"min-h-screen pb-nav-safe bg-gradient-to-b from-background via-background/95 to-primary/5 py-8 px-4",children:e.jsxs("div",{className:"max-w-6xl mx-auto",children:[e.jsxs("div",{className:"mb-8 flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"font-heading text-4xl font-bold mb-2",children:["Welcome back, ",a.influencer_name,"! üëã"]}),e.jsx("p",{className:"text-muted-foreground",children:"Track your referrals and earnings"})]}),e.jsx(o,{variant:"outline",onClick:w,children:"Switch Code"})]}),e.jsx(i,{className:"p-6 mb-6 rounded-3xl shadow-soft",children:e.jsxs("div",{className:"flex flex-col md:flex-row items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:"Your Referral Code"}),e.jsx("code",{className:"text-3xl font-bold font-mono text-primary",children:a.code}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-2",children:[a.influencer_handle&&`${a.influencer_handle} ‚Ä¢ `,a.influencer_email]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(o,{onClick:T,variant:"outline",children:[e.jsx(k,{className:"h-4 w-4 mr-2"}),"Copy Code"]}),e.jsxs(o,{onClick:F,variant:"outline",children:[e.jsx(K,{className:"h-4 w-4 mr-2"}),"Copy Link"]}),e.jsxs(o,{onClick:I,children:[e.jsx(B,{className:"h-4 w-4 mr-2"}),"Share"]})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6",children:[e.jsxs(i,{className:"p-6 rounded-3xl shadow-soft",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx(_,{className:"h-8 w-8 text-blue-500"}),e.jsx(l,{variant:"secondary",children:n.totalSignups})]}),e.jsx("p",{className:"text-2xl font-bold",children:n.totalSignups}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Sign-Ups"})]}),e.jsxs(i,{className:"p-6 rounded-3xl shadow-soft",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx(v,{className:"h-8 w-8 text-green-500"}),e.jsx(l,{variant:"secondary",children:n.activeSubscribers})]}),e.jsx("p",{className:"text-2xl font-bold",children:n.activeSubscribers}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Active Subscribers"})]}),e.jsxs(i,{className:"p-6 rounded-3xl shadow-soft",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx(q,{className:"h-8 w-8 text-green-600"}),e.jsxs(l,{className:"bg-green-500",children:["$",n.totalEarnings.toFixed(2)]})]}),e.jsxs("p",{className:"text-2xl font-bold",children:["$",n.totalEarnings.toFixed(2)]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Earnings"})]}),e.jsxs(i,{className:"p-6 rounded-3xl shadow-soft",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx(E,{className:"h-8 w-8 text-yellow-500"}),e.jsxs(l,{variant:"outline",children:["$",n.pendingEarnings.toFixed(2)]})]}),e.jsxs("p",{className:"text-2xl font-bold",children:["$",n.pendingEarnings.toFixed(2)]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Pending Payout"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(i,{className:"p-6 rounded-3xl shadow-soft",children:[e.jsxs("h2",{className:"font-heading text-2xl font-semibold mb-4 flex items-center gap-2",children:[e.jsx(_,{className:"h-6 w-6 text-primary"}),"Recent Sign-Ups"]}),m&&m.length>0?e.jsx("div",{className:"space-y-3",children:m.slice(0,10).map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-secondary/20 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",children:s.email}),e.jsx("p",{className:"text-xs text-muted-foreground",children:new Date(s.created_at).toLocaleDateString()})]}),e.jsx(l,{variant:s.subscription_status==="active"?"default":"outline",children:s.subscription_status||"Free"})]},s.id))}):e.jsx("p",{className:"text-muted-foreground text-center py-8",children:"No sign-ups yet. Keep sharing your code!"})]}),e.jsxs(i,{className:"p-6 rounded-3xl shadow-soft",children:[e.jsxs("h2",{className:"font-heading text-2xl font-semibold mb-4 flex items-center gap-2",children:[e.jsx(q,{className:"h-6 w-6 text-primary"}),"Payout History"]}),d&&d.length>0?e.jsx("div",{className:"space-y-3",children:d.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-secondary/20 rounded-lg",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium",children:["$",Number(s.amount).toFixed(2)]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[new Date(s.created_at).toLocaleDateString()," ‚Ä¢"," ",s.payout_type==="first_month"?"Monthly":"Yearly"]})]}),e.jsxs(l,{variant:s.status==="paid"?"default":s.status==="pending"?"outline":"secondary",children:[s.status==="paid"&&e.jsx(Y,{className:"h-3 w-3 mr-1"}),s.status==="pending"&&e.jsx(E,{className:"h-3 w-3 mr-1"}),s.status]})]},s.id))}):e.jsx("p",{className:"text-muted-foreground text-center py-8",children:"No payouts yet. Earnings appear when users subscribe!"}),n.pendingEarnings>=50&&e.jsx("div",{className:"mt-4 p-4 bg-green-500/10 border border-green-500/20 rounded-lg",children:e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-green-600",children:"üéâ You've reached the $50 payout threshold!"}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Request your payout to be sent to ",a.payout_identifier]})]}),e.jsxs(o,{onClick:()=>p.mutate(),disabled:p.isPending,className:"shrink-0",children:[p.isPending?e.jsx(C,{className:"h-4 w-4 mr-2 animate-spin"}):e.jsx(M,{className:"h-4 w-4 mr-2"}),"Request Payout"]})]})}),n.requestedEarnings>0&&e.jsxs("div",{className:"mt-4 p-4 bg-blue-500/10 border border-blue-500/20 rounded-lg",children:[e.jsxs("p",{className:"text-sm font-medium text-blue-600",children:["‚è≥ Payout of $",n.requestedEarnings.toFixed(2)," is pending review"]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Our team will process your payout request shortly."})]}),n.pendingEarnings<50&&n.pendingEarnings>0&&e.jsx("div",{className:"mt-4 p-4 bg-yellow-500/10 border border-yellow-500/20 rounded-lg",children:e.jsxs("p",{className:"text-sm font-medium",children:["$",(50-n.pendingEarnings).toFixed(2)," away from $50 minimum payout"]})})]})]}),e.jsxs(i,{className:"p-6 mt-6 rounded-3xl shadow-soft",children:[e.jsx("h2",{className:"font-heading text-2xl font-semibold mb-4",children:"üì¢ Promo Kit"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Copy and paste this ready-made caption for your posts:"}),e.jsxs("div",{className:"bg-secondary/20 p-4 rounded-lg",children:[e.jsxs("p",{className:"text-sm mb-3",children:["‚ú® Transform your habits into an epic journey with Cosmiq! Use my code"," ",e.jsx("strong",{children:a.code})," or click:"," ",window.location.origin,"/?ref=",a.code]}),e.jsxs(o,{variant:"outline",size:"sm",onClick:()=>{const s=`‚ú® Transform your habits into an epic journey with Cosmiq! Use my code ${a.code} or click: ${window.location.origin}/?ref=${a.code}`;navigator.clipboard.writeText(s),c.success("Promo caption copied!")},children:[e.jsx(k,{className:"h-4 w-4 mr-2"}),"Copy Caption"]})]})]})]})}):e.jsx("div",{className:"min-h-screen pb-nav-safe bg-gradient-to-b from-background via-background/95 to-primary/5 py-12 px-4",children:e.jsx("div",{className:"max-w-md mx-auto",children:e.jsxs(i,{className:"p-8 rounded-3xl shadow-soft text-center",children:[e.jsx("h1",{className:"font-heading text-2xl font-bold mb-4 text-destructive",children:"Invalid Code"}),e.jsxs("p",{className:"text-muted-foreground mb-6",children:['The code "',t,'" was not found or is not an influencer code.']}),e.jsx(o,{onClick:w,children:"Try Different Code"})]})})}):e.jsx("div",{className:"min-h-screen pb-nav-safe bg-gradient-to-b from-background via-background/95 to-primary/5 py-12 px-4",children:e.jsx("div",{className:"max-w-md mx-auto",children:e.jsxs(i,{className:"p-8 rounded-3xl shadow-soft",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx(v,{className:"h-12 w-12 text-primary mx-auto mb-4"}),e.jsx("h1",{className:"font-heading text-3xl font-bold mb-2",children:"Influencer Dashboard"}),e.jsx("p",{className:"text-muted-foreground",children:"Enter your referral code to view your performance"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(V,{placeholder:"Enter your code (e.g., COSMIQ-DARRYL)",value:u,onChange:s=>S(s.target.value.toUpperCase()),onKeyPress:s=>s.key==="Enter"&&N(),className:"text-center text-lg font-mono"}),e.jsx(o,{onClick:N,className:"w-full",size:"lg",children:"View Dashboard"})]}),e.jsxs("div",{className:"mt-6 pt-6 border-t text-center",children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:"Don't have a code yet?"}),e.jsx(o,{variant:"outline",onClick:()=>y("/creator"),children:"Create Referral Code"})]})]})})})};export{G as default};
