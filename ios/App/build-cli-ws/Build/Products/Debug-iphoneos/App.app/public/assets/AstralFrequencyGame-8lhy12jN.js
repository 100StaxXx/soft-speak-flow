import{r as s,j as e,e8 as le,l as O,m as k,e9 as de,ea as g}from"./vendor-FfY6MM0Z.js";import{j as me,D as ue,k as he}from"./three-vendor-qI8GXUTd.js";import{bo as pe,bp as xe,bq as fe}from"./index-sX_cJ3I4.js";import{t as M}from"./gameUtils-G90wW1BE.js";import"./date-vendor-Bk4KiHsJ.js";const je={beginner:{startSpeed:16,spawnInterval:1.2,obstacleChance:.45,speedIncrement:.15},easy:{startSpeed:22,spawnInterval:.9,obstacleChance:.55,speedIncrement:.25},medium:{startSpeed:28,spawnInterval:.7,obstacleChance:.6,speedIncrement:.35},hard:{startSpeed:35,spawnInterval:.5,obstacleChance:.65,speedIncrement:.45},master:{startSpeed:45,spawnInterval:.35,obstacleChance:.72,speedIncrement:.6}},S=[-2.5,0,2.5],P=s.memo(({speed:o})=>{const r=s.useRef(null);return g((t,a)=>{r.current&&(r.current.rotation.z+=a*.1*(o/15))}),e.jsxs("group",{children:[e.jsxs("mesh",{ref:r,position:[0,0,-50],children:[e.jsx("cylinderGeometry",{args:[8,8,120,32,1,!0]}),e.jsx("meshBasicMaterial",{color:"#1a0a2e",side:me,transparent:!0,opacity:.9})]}),Array.from({length:12}).map((t,a)=>e.jsxs("mesh",{position:[0,0,-50],rotation:[0,0,a*Math.PI*2/12],children:[e.jsx("boxGeometry",{args:[.05,120,.05]}),e.jsx("meshBasicMaterial",{color:"#a855f7",transparent:!0,opacity:.3})]},a)),S.map((t,a)=>e.jsxs("mesh",{position:[t,-3,0],children:[e.jsx("boxGeometry",{args:[.1,.1,200]}),e.jsx("meshBasicMaterial",{color:"#6366f1",transparent:!0,opacity:.4})]},`lane-${a}`))]})});P.displayName="Tunnel";const $=s.memo(({speed:o})=>{const r=s.useRef(null),t=s.useRef(0);g((l,c)=>{r.current&&(t.current+=c*o*.5,r.current.material.map.offset.y=t.current)});const a=new ue(new Uint8Array([100,50,150,255,50,25,100,255,50,25,100,255,100,50,150,255]),2,2);return a.wrapS=a.wrapT=he,a.repeat.set(10,100),a.needsUpdate=!0,e.jsxs("mesh",{ref:r,rotation:[-Math.PI/2,0,0],position:[0,-3,-50],children:[e.jsx("planeGeometry",{args:[8,150]}),e.jsx("meshBasicMaterial",{map:a,transparent:!0,opacity:.5})]})});$.displayName="ScrollingFloor";const D=s.memo(({lane:o,hasShield:r})=>{const t=s.useRef(null),a=s.useRef(S[o]);return s.useEffect(()=>{a.current=S[o]},[o]),g((l,c)=>{t.current&&(t.current.position.x+=(a.current-t.current.position.x)*10*c,t.current.rotation.z+=c*2)}),e.jsxs("group",{ref:t,position:[S[1],-1.5,5],children:[e.jsxs("mesh",{children:[e.jsx("sphereGeometry",{args:[.5,32,32]}),e.jsx("meshBasicMaterial",{color:"#a855f7"})]}),e.jsxs("mesh",{children:[e.jsx("sphereGeometry",{args:[.7,16,16]}),e.jsx("meshBasicMaterial",{color:"#a855f7",transparent:!0,opacity:.3})]}),r&&e.jsxs("mesh",{children:[e.jsx("sphereGeometry",{args:[.9,16,16]}),e.jsx("meshBasicMaterial",{color:"#22d3ee",transparent:!0,opacity:.4,wireframe:!0})]}),e.jsxs("mesh",{position:[0,0,-1],children:[e.jsx("coneGeometry",{args:[.3,2,8]}),e.jsx("meshBasicMaterial",{color:"#a855f7",transparent:!0,opacity:.4})]})]})});D.displayName="Player";const U=s.memo(({lane:o,z:r,type:t})=>{const a=s.useRef(null);g((c,p)=>{a.current&&(a.current.rotation.x+=p*2,a.current.rotation.y+=p*1.5)});const l=t==="asteroid"?1.2:t==="crystal"?.8:.9;return e.jsxs("group",{ref:a,position:[S[o],-1.5,r],children:[t==="asteroid"&&e.jsxs(e.Fragment,{children:[e.jsxs("mesh",{children:[e.jsx("dodecahedronGeometry",{args:[l]}),e.jsx("meshBasicMaterial",{color:"#ef4444"})]}),e.jsxs("mesh",{children:[e.jsx("dodecahedronGeometry",{args:[l*1.15]}),e.jsx("meshBasicMaterial",{color:"#ff0000",transparent:!0,opacity:.3,wireframe:!0})]}),e.jsxs("mesh",{children:[e.jsx("sphereGeometry",{args:[l*1.4,8,8]}),e.jsx("meshBasicMaterial",{color:"#ef4444",transparent:!0,opacity:.15})]})]}),t==="crystal"&&e.jsxs(e.Fragment,{children:[e.jsxs("mesh",{children:[e.jsx("octahedronGeometry",{args:[l]}),e.jsx("meshBasicMaterial",{color:"#fbbf24"})]}),e.jsxs("mesh",{children:[e.jsx("octahedronGeometry",{args:[l*1.2]}),e.jsx("meshBasicMaterial",{color:"#fbbf24",transparent:!0,opacity:.4,wireframe:!0})]}),e.jsx("pointLight",{color:"#fbbf24",intensity:2,distance:5})]}),t==="shield"&&e.jsxs(e.Fragment,{children:[e.jsxs("mesh",{children:[e.jsx("icosahedronGeometry",{args:[l]}),e.jsx("meshBasicMaterial",{color:"#22d3ee"})]}),e.jsxs("mesh",{rotation:[Math.PI/2,0,0],children:[e.jsx("torusGeometry",{args:[l*1.3,.1,8,16]}),e.jsx("meshBasicMaterial",{color:"#22d3ee",transparent:!0,opacity:.6})]}),e.jsxs("mesh",{children:[e.jsx("sphereGeometry",{args:[l*1.5,8,8]}),e.jsx("meshBasicMaterial",{color:"#22d3ee",transparent:!0,opacity:.2})]}),e.jsx("pointLight",{color:"#22d3ee",intensity:2,distance:5})]})]})});U.displayName="Obstacle";const ye=({gameState:o,playerLane:r,hasShield:t,speed:a,obstacles:l,onObstaclePass:c})=>{const{camera:p}=de(),u=s.useRef(new Set);return s.useEffect(()=>{p.position.set(0,2,10),p.lookAt(0,0,-10)},[p]),g(()=>{o==="playing"&&l.forEach(i=>{i.z>4&&!u.current.has(i.id)&&Math.abs(i.lane-r)===0&&(u.current.add(i.id),c(i.id,i.type)),i.z>10&&u.current.delete(i.id)})}),e.jsxs(e.Fragment,{children:[e.jsx("ambientLight",{intensity:.3}),e.jsx("pointLight",{position:[0,5,10],intensity:1,color:"#a855f7"}),e.jsx(q,{}),e.jsx(P,{speed:a}),e.jsx($,{speed:a}),e.jsx(D,{lane:r,hasShield:t}),l.map(i=>e.jsx(X,{...i},i.id))]})},X=s.memo(({lane:o,z:r,type:t})=>e.jsx("group",{position:[0,0,r],children:e.jsx(U,{lane:o,z:0,type:t})}));X.displayName="MovingObstacle";const q=s.memo(()=>{const o=s.useRef(null),r=new Float32Array(1e3*3);for(let t=0;t<1e3;t++)r[t*3]=(Math.random()-.5)*100,r[t*3+1]=(Math.random()-.5)*50+10,r[t*3+2]=(Math.random()-.5)*200-50;return g((t,a)=>{o.current&&(o.current.rotation.z+=a*.02)}),e.jsxs("points",{ref:o,children:[e.jsx("bufferGeometry",{children:e.jsx("bufferAttribute",{attach:"attributes-position",args:[r,3]})}),e.jsx("pointsMaterial",{size:.2,color:"#ffffff",transparent:!0,opacity:.8})]})});q.displayName="Stars";const H=s.memo(({score:o,lives:r,combo:t,hasShield:a,distance:l,compact:c=!1})=>e.jsxs("div",{className:`absolute ${c?"top-1 left-1 right-1":"top-2 left-2 right-2"} flex justify-between items-start pointer-events-none z-10 safe-area-inset-top`,children:[e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsxs("div",{className:"bg-black/60 backdrop-blur-sm rounded-lg px-2 py-0.5",children:[e.jsx("span",{className:`text-yellow-400 font-bold ${c?"text-sm":"text-base"}`,children:o}),!c&&e.jsx("span",{className:"text-[10px] text-muted-foreground ml-0.5",children:"pts"})]}),e.jsxs("div",{className:"bg-black/60 backdrop-blur-sm rounded-lg px-2 py-0.5",children:[e.jsx("span",{className:`text-cyan-400 font-bold ${c?"text-sm":"text-base"}`,children:Math.round(l)}),!c&&e.jsx("span",{className:"text-[10px] text-muted-foreground ml-0.5",children:"m"})]}),t>1&&e.jsxs(k.div,{className:"bg-purple-500/60 backdrop-blur-sm rounded-lg px-2 py-0.5",initial:{scale:.8},animate:{scale:1},children:[e.jsxs("span",{className:`text-white font-bold ${c?"text-sm":"text-base"}`,children:[t,"x"]}),!c&&e.jsx("span",{className:"text-[10px] text-purple-200 ml-0.5",children:"combo"})]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[a&&e.jsx(k.div,{className:"bg-cyan-500/60 backdrop-blur-sm rounded-lg px-1.5 py-0.5",initial:{scale:0},animate:{scale:1},children:e.jsx("span",{className:c?"text-sm":"text-lg",children:"ðŸ›¡ï¸"})}),e.jsx("div",{className:"flex gap-0.5 bg-black/60 backdrop-blur-sm rounded-lg px-1.5 py-0.5",children:Array.from({length:3}).map((p,u)=>e.jsx(k.span,{className:`${c?"text-sm":"text-lg"} ${u<r?"":"grayscale opacity-30"}`,animate:u<r?{scale:[1,1.1,1]}:{},transition:{duration:.3},children:"â¤ï¸"},u))})]})]}));H.displayName="GameUI";const V=s.memo(({onLeft:o,onRight:r})=>e.jsxs("div",{className:"absolute bottom-4 left-3 right-3 flex justify-between z-10 safe-area-inset-bottom",children:[e.jsx("button",{className:"w-20 h-20 rounded-full bg-white/15 backdrop-blur-sm flex items-center justify-center active:bg-white/30 transition-colors border border-white/20",onPointerDown:o,children:e.jsx("span",{className:"text-3xl text-white",children:"â—€"})}),e.jsx("button",{className:"w-20 h-20 rounded-full bg-white/15 backdrop-blur-sm flex items-center justify-center active:bg-white/30 transition-colors border border-white/20",onPointerDown:r,children:e.jsx("span",{className:"text-3xl text-white",children:"â–¶"})})]}));V.displayName="LaneControls";const ve=({companionStats:o,onComplete:r,onDamage:t,tierAttackDamage:a=15,difficulty:l="medium",isPractice:c=!1,compact:p=!1})=>{const u=je[l],[i,y]=s.useState("countdown"),[G,K]=s.useState(0),[b,W]=s.useState(0),[I,L]=s.useState(0),[B,Y]=s.useState(0),[v,J]=s.useState(1),[w,z]=s.useState(!1),[C,Q]=s.useState(3),[Z,T]=s.useState(!1),[ee,A]=s.useState([]),[N,se]=s.useState(u.startSpeed),E=s.useRef(i),te=s.useRef(v),F=s.useRef(w),_=s.useRef(0),R=s.useRef(null);s.useEffect(()=>{E.current=i},[i]),s.useEffect(()=>{te.current=v},[v]),s.useEffect(()=>{F.current=w},[w]);const ae=s.useCallback(()=>{y("playing")},[]),f=s.useCallback(h=>{E.current==="playing"&&(J(n=>Math.max(0,Math.min(2,n+h))),M("light"))},[]),re=s.useCallback(h=>{R.current={x:h.touches[0].clientX}},[]),ne=s.useCallback(h=>{if(!R.current)return;const n=h.changedTouches[0].clientX-R.current.x;Math.abs(n)>30&&f(n>0?1:-1),R.current=null},[f]);s.useEffect(()=>{const h=n=>{E.current==="playing"&&((n.key==="ArrowLeft"||n.key==="a")&&f(-1),(n.key==="ArrowRight"||n.key==="d")&&f(1),n.key==="Escape"&&y("paused"))};return window.addEventListener("keydown",h),()=>window.removeEventListener("keydown",h)},[f]);const oe=s.useCallback((h,n)=>{if(A(m=>m.filter(d=>d.id!==h)),n==="asteroid")F.current?(z(!1),M("medium")):(T(!0),setTimeout(()=>T(!1),200),t?.({target:"player",amount:a,source:"collision"}),Q(m=>{const d=m-1;return d<=0&&y("complete"),d}),L(0),M("heavy"));else if(n==="crystal"){const m=10*(1+I*.1);K(d=>d+Math.round(m)),L(d=>{const j=d+1;return Y(x=>Math.max(x,j)),j}),M("light")}else n==="shield"&&(z(!0),M("medium"))},[I,t,a]);return s.useEffect(()=>{if(i!=="playing")return;const h=setInterval(()=>{W(n=>{const m=n+N*.1,d=Math.floor(n/100);return Math.floor(m/100)>d&&t?.({target:"adversary",amount:pe.astral_frequency.distanceMilestone,source:"distance_milestone"}),c&&m>=500&&y("complete"),m}),se(n=>n+u.speedIncrement),A(n=>{const d=n.map(x=>({...x,z:x.z+N*.15})).filter(x=>x.z<15),j=Date.now();if(j-_.current>u.spawnInterval*1e3){_.current=j;const x=Math.random(),ie=x<u.obstacleChance?"asteroid":x<.95?"crystal":"shield",ce=Math.floor(Math.random()*3);return[...d,{id:`${j}-${Math.random()}`,lane:ce,z:-80,type:ie}]}return d})},100);return()=>clearInterval(h)},[i,u,N,c,t]),s.useEffect(()=>{if(i!=="complete")return;const n={beginner:600,easy:500,medium:400,hard:300,master:250}[l],m=Math.min(100,Math.round(b/n*100)),d=m>=90?"perfect":m>=50?"good":"fail";r({success:d!=="fail",accuracy:m,result:d,highScoreValue:b,gameStats:{distance:Math.floor(b),score:G,maxCombo:B,livesRemaining:C}})},[i,G,b,l,r,B,C]),e.jsxs("div",{className:"fixed inset-0 z-50 overflow-hidden bg-slate-950",onTouchStart:re,onTouchEnd:ne,children:[e.jsx(le,{camera:{fov:75,near:.1,far:200},style:{background:"linear-gradient(to bottom, #0f0a1a, #1a0a2e)",position:"absolute",inset:0},children:e.jsx(s.Suspense,{fallback:null,children:e.jsx(ye,{gameState:i,playerLane:v,hasShield:w,speed:N,obstacles:ee,onObstaclePass:oe})})}),e.jsx(H,{score:G,lives:C,combo:I,hasShield:w,distance:b,compact:p}),e.jsx(V,{onLeft:()=>f(-1),onRight:()=>f(1)}),e.jsx(O,{children:Z&&e.jsx(k.div,{className:"absolute inset-0 bg-red-500/40 pointer-events-none z-30",initial:{opacity:.8},animate:{opacity:0},exit:{opacity:0},transition:{duration:.2}})}),e.jsxs(O,{children:[i==="countdown"&&e.jsx(xe,{count:3,onComplete:ae}),i==="paused"&&e.jsx(fe,{onResume:()=>y("playing")})]})]})};export{ve as AstralFrequencyGame};
