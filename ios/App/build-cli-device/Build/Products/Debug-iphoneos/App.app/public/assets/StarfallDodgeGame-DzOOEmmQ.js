import{r as t,j as e,m as E,l as tt,an as we,cS as st}from"./vendor-DK8VKJIv.js";import{bx as at,by as nt,bz as rt,bw as it,bu as lt,bv as ct,B as J,bt as ot}from"./index-BJ43zXLh.js";import{a as ut,u as dt,b as mt,t as x}from"./gameUtils-CBfv9FnM.js";import"./date-vendor-BRrA_NVo.js";import"./three-vendor-qI8GXUTd.js";const pt={beginner:{initialSpawnRate:1e3,debrisRatio:.35,baseSpeed:1.5,speedIncrease:.2,spawnRateDecrease:8,minSpawnRate:350,maxSpeed:7},easy:{initialSpawnRate:800,debrisRatio:.45,baseSpeed:2,speedIncrease:.3,spawnRateDecrease:14,minSpawnRate:250,maxSpeed:9.5},medium:{initialSpawnRate:650,debrisRatio:.55,baseSpeed:2.8,speedIncrease:.4,spawnRateDecrease:18,minSpawnRate:200,maxSpeed:11},hard:{initialSpawnRate:500,debrisRatio:.65,baseSpeed:3.5,speedIncrease:.28,spawnRateDecrease:22,minSpawnRate:150,maxSpeed:12},master:{initialSpawnRate:400,debrisRatio:.75,baseSpeed:4.5,speedIncrease:.35,spawnRateDecrease:28,minSpawnRate:120,maxSpeed:14}},be={magnet:5e3,slowmo:4e3},ft=1e3/30,xt=100,ve=t.memo(({stars:i})=>e.jsx("div",{className:"absolute inset-0 overflow-hidden pointer-events-none",children:i.map(n=>e.jsx("div",{className:"absolute rounded-full bg-white",style:{width:n.size,height:n.size,left:`${n.x}%`,top:`${n.y}%`,opacity:n.opacity,animation:`twinkle ${n.animationDuration}s ease-in-out infinite`}},n.id))}));ve.displayName="StarBackground";const Se=t.memo(({obj:i})=>{switch(i.type){case"crystal":return e.jsx("div",{className:"w-7 h-7 flex items-center justify-center",style:{filter:"drop-shadow(0 0 8px #22d3ee)",animation:"spin 3s linear infinite"},children:e.jsx("span",{className:"text-2xl",children:"ðŸ’Ž"})});case"powerup_shield":return e.jsx("div",{className:"w-8 h-8 flex items-center justify-center",style:{filter:"drop-shadow(0 0 12px #10b981)",animation:"pulse 1.5s ease-in-out infinite"},children:e.jsx("span",{className:"text-2xl",children:"ðŸ›¡ï¸"})});case"powerup_magnet":return e.jsx("div",{className:"w-8 h-8 flex items-center justify-center",style:{filter:"drop-shadow(0 0 12px #f59e0b)",animation:"pulse 1.2s ease-in-out infinite"},children:e.jsx("span",{className:"text-2xl",children:"ðŸ§²"})});case"powerup_slowmo":return e.jsx("div",{className:"w-8 h-8 flex items-center justify-center",style:{filter:"drop-shadow(0 0 12px #8b5cf6)",animation:"pulse 1.8s ease-in-out infinite"},children:e.jsx("span",{className:"text-2xl",children:"â³"})});case"powerup_life":return e.jsx("div",{className:"w-9 h-9 flex items-center justify-center",style:{filter:"drop-shadow(0 0 15px #ec4899)",animation:"pulse 0.8s ease-in-out infinite"},children:e.jsx("span",{className:"text-2xl",children:"ðŸ’–"})});case"bomb":return e.jsx("div",{className:"w-10 h-10 flex items-center justify-center",style:{filter:"drop-shadow(0 0 15px #ef4444)",animation:"pulse 0.5s ease-in-out infinite"},children:e.jsx("span",{className:"text-3xl",children:"ðŸ’£"})});case"homing_debris":return e.jsx("div",{className:"w-7 h-7 rounded-full bg-gradient-to-br from-orange-500 via-red-600 to-orange-500",style:{boxShadow:"0 0 16px rgba(249, 115, 22, 0.8), 0 0 8px rgba(255, 255, 255, 0.4)",animation:"spin 0.4s linear infinite"},children:e.jsx("div",{className:"absolute inset-1 rounded-full bg-yellow-400/50"})});default:return e.jsx("div",{className:"w-6 h-6 rounded-full bg-gradient-to-br from-red-500 via-orange-500 to-red-600",style:{boxShadow:"0 0 12px rgba(239, 68, 68, 0.6)",animation:"spin 0.8s linear infinite"}})}});Se.displayName="FallingObjectComponent";const Re=t.memo(({particles:i})=>e.jsx(e.Fragment,{children:i.map(n=>e.jsx("div",{className:"absolute w-2 h-2 rounded-full pointer-events-none",style:{left:`${n.x}%`,top:`${n.y}%`,backgroundColor:n.color,boxShadow:`0 0 6px ${n.color}`,opacity:n.life/n.maxLife,transform:"translate(-50%, -50%)"}},n.id))}));Re.displayName="ParticleRenderer";const Ne=t.memo(({onContinue:i})=>e.jsxs(E.div,{initial:{opacity:0},animate:{opacity:1},className:"fixed inset-0 bg-black/95 backdrop-blur-sm flex flex-col items-center justify-center p-6",style:{zIndex:100},children:[e.jsx(E.div,{animate:{rotate:[0,-90,-90,0]},transition:{duration:2,repeat:1/0,repeatDelay:1},className:"mb-6",children:e.jsx(we,{className:"w-20 h-20 text-cyan-400"})}),e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(st,{className:"w-6 h-6 text-cyan-400"}),e.jsx("h3",{className:"text-xl font-bold text-white",children:"Rotate Your Phone"})]}),e.jsx("p",{className:"text-muted-foreground text-center text-sm mb-6 max-w-xs",children:"Turn your phone sideways (landscape mode) for the best gameplay experience!"}),e.jsx(J,{onClick:i,className:"bg-cyan-500 hover:bg-cyan-600 text-white font-bold px-8 py-3",style:{zIndex:101},children:"Continue"})]}));Ne.displayName="RotatePhoneOverlay";const je=t.memo(({onRequest:i,onSkip:n})=>e.jsxs(E.div,{initial:{opacity:0},animate:{opacity:1},className:"absolute inset-0 bg-black/80 backdrop-blur-sm flex flex-col items-center justify-center z-50 p-6",children:[e.jsx(we,{className:"w-16 h-16 text-cyan-400 mb-4 animate-bounce"}),e.jsx("h3",{className:"text-xl font-bold text-white mb-2",children:"Enable Tilt Controls?"}),e.jsx("p",{className:"text-muted-foreground text-center text-sm mb-6 max-w-xs",children:"Tilt your device left and right to dodge! This requires motion sensor permission."}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(J,{onClick:i,className:"bg-cyan-500 hover:bg-cyan-600",children:"Enable Tilt"}),e.jsx(J,{variant:"ghost",onClick:n,children:"Use Touch"})]})]}));je.displayName="TiltPermissionOverlay";const Me=t.memo(({lives:i,maxLives:n=3})=>e.jsx("div",{className:"flex gap-0.5",children:Array.from({length:n}).map((j,g)=>e.jsx("span",{className:`text-lg ${g<i?"opacity-100":"opacity-30"}`,children:"â¤ï¸"},g))}));Me.displayName="LivesDisplay";const Te=t.memo(({hasShield:i,hasMagnet:n,hasSlowMo:j,magnetTimeLeft:g,slowMoTimeLeft:b})=>e.jsxs("div",{className:"flex gap-1",children:[i&&e.jsx("div",{className:"bg-emerald-500/30 backdrop-blur-sm rounded-full px-1.5 py-0.5",children:e.jsx("span",{className:"text-emerald-300 text-xs",children:"ðŸ›¡ï¸"})}),n&&e.jsxs("div",{className:"bg-amber-500/30 backdrop-blur-sm rounded-full px-1.5 py-0.5 flex items-center gap-0.5",children:[e.jsx("span",{className:"text-amber-300 text-xs",children:"ðŸ§²"}),e.jsxs("span",{className:"text-amber-300 text-[10px]",children:[Math.ceil(g/1e3),"s"]})]}),j&&e.jsxs("div",{className:"bg-purple-500/30 backdrop-blur-sm rounded-full px-1.5 py-0.5 flex items-center gap-0.5",children:[e.jsx("span",{className:"text-purple-300 text-xs",children:"â³"}),e.jsxs("span",{className:"text-purple-300 text-[10px]",children:[Math.ceil(b/1e3),"s"]})]})]}));Te.displayName="ActivePowerupsDisplay";const St=({companionStats:i,onComplete:n,onDamage:j,tierAttackDamage:g=15,difficulty:b="medium",questIntervalScale:A=0,isPractice:ke=!1,compact:K=!1})=>{const[o,p]=t.useState("rotate"),[h,Q]=t.useState(!1),[P,Z]=t.useState(50),[_,Ce]=t.useState(0),[y,z]=t.useState(3),[w,ee]=t.useState(!1),[v,te]=t.useState(!1),[M,se]=t.useState(!1),[D,Ee]=t.useState(0),[O,Pe]=t.useState(0),[L,_e]=t.useState(0),[De,ae]=t.useState(!1),[B,ne]=t.useState(0),re=t.useRef(null),X=t.useRef([]),[Oe,Le]=t.useState([]),Xe=t.useRef(0),ie=t.useRef(0),F=t.useRef(P),H=t.useRef(o),T=t.useRef(null),Ie=t.useRef(y),le=t.useRef(w),U=t.useRef(v),G=t.useRef(M),ce=t.useRef(D),oe=t.useRef(O),ue=t.useRef(!1),S=t.useRef(0),I=t.useRef(0),R=t.useRef(0),Y=t.useRef(0),q=t.useRef(0),N=t.useRef(null),de=t.useRef(50),V=t.useRef(50),{available:$,requestPermission:me,getLandscapePositionFromTilt:$e}=at();t.useEffect(()=>{F.current=P},[P]),t.useEffect(()=>{H.current=o},[o]),t.useEffect(()=>{Ie.current=y},[y]),t.useEffect(()=>{le.current=w},[w]),t.useEffect(()=>{U.current=v},[v]),t.useEffect(()=>{G.current=M},[M]),t.useEffect(()=>{ce.current=D},[D]),t.useEffect(()=>{oe.current=O},[O]),t.useEffect(()=>{R.current=L},[L]),t.useEffect(()=>{S.current=B},[B]),t.useEffect(()=>()=>{N.current&&clearTimeout(N.current),nt()},[]);const{particles:Ae,emit:f}=ut(40),ze=dt(20),Be=Math.round((i.mind+i.body)/2),pe=32+Math.floor(Be/35),m=t.useMemo(()=>{const a=pt[b];return{...a,initialSpawnRate:a.initialSpawnRate-A*30,baseSpeed:a.baseSpeed+A*.1}},[b,A]);t.useEffect(()=>{ne(m.baseSpeed),S.current=m.baseSpeed,I.current=m.initialSpawnRate,R.current=0,Y.current=0,q.current=0},[m]);const fe=Date.now(),Fe=Math.max(0,D-fe),He=Math.max(0,O-fe),Ue=t.useCallback(async()=>{await rt(),p("permission")},[]),Ge=t.useCallback(async()=>{if($){const a=await me();Q(a)}p("countdown")},[$,me]),Ye=t.useCallback(()=>{Q(!1),p("countdown")},[]),qe=t.useCallback(a=>{if(H.current!=="playing")return;const d=a.touches[0];T.current={x:d.clientX,playerX:F.current}},[]),Ve=t.useCallback(a=>{if(!T.current||H.current!=="playing"||h)return;a.preventDefault();const l=a.touches[0].clientX-T.current.x,r=re.current?.getBoundingClientRect().width||500,c=l/r*100,u=Math.max(5,Math.min(95,T.current.playerX+c));Z(u)},[h]),We=t.useCallback(()=>{T.current=null},[]),Je=t.useCallback(()=>{p("playing")},[]),Ke=t.useCallback(()=>{p(a=>a==="playing"?"paused":a==="paused"?"playing":a)},[]),xe=t.useCallback(a=>{ae(!0),N.current&&clearTimeout(N.current),N.current=setTimeout(()=>{ae(!1),N.current=null},a)},[]),Qe=t.useCallback((a,d)=>{const l=Math.random();let r,c;l<.01?(r="powerup_life",c=36):l<.03?(r="bomb",c=40):l<.06?(r="homing_debris",c=28):l<.1?(r="powerup_shield",c=32):l<.14?(r="powerup_magnet",c=32):l<.18?(r="powerup_slowmo",c=32):l<.18+m.debrisRatio*.82?(r="debris",c=24):(r="crystal",c=28);const u={id:Xe.current++,x:5+Math.random()*90,y:-5,type:r,speed:d*(.8+Math.random()*.4),size:c,targetX:r==="homing_debris"?a:void 0};X.current.push(u)},[m.debrisRatio]);return mt((a,d)=>{const l=Date.now();U.current&&l>ce.current&&te(!1),G.current&&l>oe.current&&se(!1);const r=G.current?.5:1,c=.12;let u;h?(de.current=$e(6,1.4),V.current+=(de.current-V.current)*c,u=V.current):u=F.current;const he=R.current,W=he+a;R.current=W;const Ze=Math.floor(he/10);Math.floor(W/10)>Ze&&j?.({target:"adversary",amount:ot.starfall_dodge.survivalMilestone,source:"survival_milestone"}),ke&&W>=15&&p("complete"),S.current=Math.min(m.maxSpeed,S.current+m.speedIncrease*a),I.current=Math.max(m.minSpawnRate,I.current-m.spawnRateDecrease*a),d-ie.current>I.current&&(ie.current=d,Qe(u,S.current)),X.current=X.current.filter(s=>{const et=s.speed*r;if(s.y+=et*a*60*.5,s.type==="homing_debris"&&s.y>0&&s.y<60){const k=.15*r;s.x<u?s.x=Math.min(s.x+k,u):s.x>u&&(s.x=Math.max(s.x-k,u))}if(s.type==="crystal"&&U.current&&Math.abs(s.x-u)<25&&(s.x<u?s.x+=.3:s.x-=.3),s.y>70&&s.y<92){const k=Math.abs(s.x-u),ye=s.type==="bomb"?5:s.type==="debris"||s.type==="homing_debris"?3.5:4.5;if(k<ye)switch(s.type){case"crystal":return Ce(C=>C+1),f(s.x,s.y,"#22d3ee",6),x("light"),!1;case"powerup_shield":return ee(!0),f(s.x,s.y,"#10b981",8),x("medium"),!1;case"powerup_magnet":return te(!0),Ee(l+be.magnet),f(s.x,s.y,"#f59e0b",8),x("medium"),!1;case"powerup_slowmo":return se(!0),Pe(l+be.slowmo),f(s.x,s.y,"#8b5cf6",8),x("medium"),!1;case"powerup_life":return z(C=>Math.min(C+1,3)),f(s.x,s.y,"#ec4899",12),x("heavy"),!1;case"bomb":return f(s.x,s.y,"#ef4444",15),f(s.x,s.y,"#f97316",15),x("heavy"),z(0),xe(400),p("complete"),!1;case"debris":case"homing_debris":return le.current?(ee(!1),f(s.x,s.y,"#ef4444",6),x("medium")):(j?.({target:"player",amount:g,source:"hit_by_projectile"}),z(C=>{const ge=C-1;return ge<=0&&p("complete"),ge}),xe(200),f(s.x,s.y,"#ef4444",8),x("heavy")),!1}}return s.y<110}),d-Y.current>=ft&&(Y.current=d,h&&Z(u),Le([...X.current])),d-q.current>=xt&&(q.current=d,_e(R.current),ne(S.current))},o==="playing"),t.useEffect(()=>{if(o!=="complete"||ue.current)return;ue.current=!0;const a=R.current,l={beginner:90,easy:60,medium:45,hard:30,master:20}[b],r=Math.min(100,Math.round(a/l*100)),c=r>=90?"perfect":r>=50?"good":"fail";n({success:c!=="fail",accuracy:Math.min(100,Math.max(0,r)),result:c,usedTiltControls:h,highScoreValue:Math.floor(a),gameStats:{time:Math.floor(a),itemsCollected:_,livesRemaining:y}})},[o,_,b,n,h,y]),e.jsxs("div",{ref:re,className:`relative overflow-hidden ${De?"animate-shake":""}`,style:{background:M?"linear-gradient(to bottom, #1a0a2e, #2d1052)":"linear-gradient(to bottom, #0f0a1a, #1a1033)",transition:"background 0.5s ease",width:"100vw",height:"100dvh",minHeight:"100vh",borderRadius:0,position:"fixed",top:0,left:0,zIndex:60,paddingTop:"env(safe-area-inset-top)",paddingBottom:"env(safe-area-inset-bottom)",paddingLeft:"env(safe-area-inset-left)",paddingRight:"env(safe-area-inset-right)"},onTouchStart:qe,onTouchMove:Ve,onTouchEnd:We,children:[e.jsx(ve,{stars:ze}),o!=="rotate"&&o!=="permission"&&(K?e.jsx(it,{title:"Starfall Dodge",subtitle:`${Math.floor(L)}s survived`,score:_,primaryStat:{value:y,label:"Lives",color:"hsl(0, 84%, 60%)"},isPaused:o==="paused",onPauseToggle:Ke,compact:!0}):e.jsx("div",{className:"absolute top-1 left-0 right-0 z-20 px-4",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"text-sm font-bold text-white/80",children:"Starfall Dodge"}),e.jsx("div",{className:"bg-black/40 backdrop-blur-sm rounded-lg px-2 py-0.5",children:e.jsxs("span",{className:"text-cyan-400 text-sm",children:["ðŸ’Ž ",_]})}),e.jsx("div",{className:"bg-black/40 backdrop-blur-sm rounded-lg px-2 py-0.5",children:e.jsxs("span",{className:"text-yellow-400 text-sm",children:["â±ï¸ ",Math.floor(L),"s"]})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Te,{hasShield:w,hasMagnet:v,hasSlowMo:M,magnetTimeLeft:Fe,slowMoTimeLeft:He}),e.jsx(Me,{lives:y,maxLives:3})]})]})})),o==="playing"&&!K&&e.jsxs("div",{className:"absolute top-10 left-1/2 -translate-x-1/2 flex gap-2",children:[h&&e.jsx("div",{className:"bg-cyan-500/20 backdrop-blur-sm rounded-full px-3 py-1 text-xs text-cyan-300",children:"ðŸ“± Tilt +25% XP"}),e.jsxs("div",{className:"bg-purple-500/20 backdrop-blur-sm rounded-full px-3 py-1 text-xs text-purple-300",children:["âš¡ ",(B/m.baseSpeed*100).toFixed(0),"% Speed"]})]}),Oe.map(a=>e.jsx("div",{className:"absolute",style:{left:`${a.x}%`,top:`${a.y}%`,transform:"translate(-50%, -50%)"},children:e.jsx(Se,{obj:a})},a.id)),e.jsx(Re,{particles:Ae}),e.jsx(E.div,{className:"absolute",style:{left:`${P}%`,bottom:"8%",transform:"translateX(-50%)"},animate:{x:0},transition:{type:"spring",stiffness:300,damping:25},children:e.jsxs("div",{className:"rounded-full bg-gradient-to-br from-purple-500 to-pink-500 relative",style:{width:pe,height:pe,boxShadow:w?"0 0 20px #10b981, 0 0 40px #10b98150":v?"0 0 20px #f59e0b, 0 0 40px #f59e0b50":"0 0 20px #a855f7, 0 0 40px #a855f750"},children:[w&&e.jsx("div",{className:"absolute -inset-2 rounded-full border-2 border-emerald-400 animate-pulse"}),v&&e.jsx("div",{className:"absolute -inset-3 rounded-full border-2 border-amber-400 animate-spin",style:{animationDuration:"2s"}}),e.jsx("div",{className:"absolute inset-2 rounded-full bg-white/20"})]})}),e.jsxs(tt,{children:[o==="rotate"&&e.jsx(Ne,{onContinue:Ue}),o==="permission"&&$&&e.jsx(je,{onRequest:Ge,onSkip:Ye}),o==="permission"&&!$&&e.jsx(E.div,{initial:{opacity:0},animate:{opacity:1},onAnimationComplete:()=>p("countdown")}),o==="countdown"&&e.jsx(lt,{count:3,onComplete:Je}),o==="paused"&&e.jsx(ct,{onResume:()=>p("playing")})]})]})};export{St as StarfallDodgeGame};
