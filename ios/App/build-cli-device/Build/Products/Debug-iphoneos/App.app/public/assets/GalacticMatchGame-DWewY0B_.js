import{r as a,j as e,m as l,ac as be,l as k}from"./vendor-DK8VKJIv.js";import{t as B}from"./gameUtils-CBfv9FnM.js";import{bA as je,bt as ce,bB as Me,bC as Ne}from"./index-BJ43zXLh.js";import{u as we,a as Ce,b as Se}from"./gameLifecycle-CMc-cG6H.js";import"./date-vendor-BRrA_NVo.js";import"./three-vendor-qI8GXUTd.js";const Te={beginner:{startLives:5,revealTimeMultiplier:1.8,startPairs:2},easy:{startLives:4,revealTimeMultiplier:1.5,startPairs:2},medium:{startLives:3,revealTimeMultiplier:1.2,startPairs:2},hard:{startLives:2,revealTimeMultiplier:1,startPairs:3},master:{startLives:1,revealTimeMultiplier:.75,startPairs:4}},Le={beginner:5,easy:4,medium:3,hard:2,master:1},W=[{emoji:"â­",name:"Star",color:"hsl(45, 93%, 58%)"},{emoji:"ðŸŒ™",name:"Moon",color:"hsl(210, 20%, 75%)"},{emoji:"â˜€ï¸",name:"Sun",color:"hsl(35, 100%, 55%)"},{emoji:"ðŸª",name:"Planet",color:"hsl(271, 60%, 55%)"},{emoji:"ðŸŒŠ",name:"Nebula",color:"hsl(190, 90%, 55%)"},{emoji:"ðŸ’«",name:"Comet",color:"hsl(330, 80%, 65%)"},{emoji:"ðŸ”®",name:"Crystal",color:"hsl(270, 70%, 60%)"},{emoji:"âš¡",name:"Energy",color:"hsl(50, 100%, 50%)"},{emoji:"ðŸŒŸ",name:"Supernova",color:"hsl(40, 100%, 65%)"},{emoji:"ðŸŒ€",name:"Vortex",color:"hsl(200, 80%, 55%)"},{emoji:"ðŸ”¥",name:"Flame",color:"hsl(15, 90%, 55%)"},{emoji:"â„ï¸",name:"Frost",color:"hsl(195, 80%, 70%)"},{emoji:"ðŸŒ¸",name:"Blossom",color:"hsl(330, 70%, 70%)"},{emoji:"ðŸ’Ž",name:"Diamond",color:"hsl(195, 100%, 75%)"},{emoji:"ðŸ€",name:"Clover",color:"hsl(120, 60%, 50%)"}],Ie=150,se=(C,f=1,b=2,G=1)=>{let N;b>=3?N=b+Math.floor((C-1)/2):C===1?N=b:N=3+Math.floor((C-2)/2),N=Math.min(N,15);const w=N*2;let j,p;w<=4?(j=2,p=2):w<=6?(j=3,p=2):w<=8?(j=4,p=2):w<=10?(j=5,p=2):w<=12?(j=4,p=3):w<=16?(j=4,p=4):w<=20?(j=5,p=4):w<=24?(j=6,p=4):(w<=30,j=6,p=5);const x=Math.min(3+(N-2)*.5,10)*G;return{pairs:N,cols:j,rows:p,revealTime:x,totalCards:w}},de=a.memo(()=>e.jsxs("div",{className:"absolute inset-0 rounded-xl bg-gradient-to-br from-purple-900 via-indigo-900 to-blue-900 border-2 border-purple-500/50 overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 opacity-30",children:[...Array(5)].map((C,f)=>e.jsx("div",{className:"absolute w-1 h-1 bg-white rounded-full animate-pulse",style:{left:`${20+f*15}%`,top:`${30+f%2*40}%`,animationDelay:`${f*.2}s`}},f))}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx("div",{className:"w-8 h-8 rounded-full bg-gradient-to-br from-purple-400/30 to-cyan-400/30 flex items-center justify-center",children:e.jsx("span",{className:"text-xl opacity-50",children:"âœ¦"})})}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-white/5 to-transparent animate-pulse"})]}));de.displayName="CardBack";const me=a.memo(({symbolIndex:C})=>{const f=W[C];return e.jsx("div",{className:"absolute inset-0 rounded-xl border-2 overflow-hidden flex items-center justify-center",style:{background:`radial-gradient(circle at center, ${f.color}20, hsl(var(--background)))`,borderColor:`${f.color}60`,boxShadow:`0 0 20px ${f.color}30, inset 0 0 20px ${f.color}10`},children:e.jsx("span",{className:"text-3xl sm:text-4xl filter drop-shadow-lg",children:f.emoji})})});me.displayName="CardFace";const ue=a.memo(({color:C})=>e.jsx(l.div,{className:"absolute inset-0 pointer-events-none",initial:{opacity:1},animate:{opacity:0},exit:{opacity:0},transition:{duration:.5},children:[...Array(8)].map((f,b)=>e.jsx(l.div,{className:"absolute w-2 h-2 rounded-full",style:{backgroundColor:C,left:"50%",top:"50%"},initial:{scale:0,x:"-50%",y:"-50%"},animate:{scale:[0,1,0],x:`${Math.cos(b*Math.PI/4)*40-50}%`,y:`${Math.sin(b*Math.PI/4)*40-50}%`},transition:{duration:.5,ease:"easeOut"}},b))}));ue.displayName="MatchEffect";const Fe=({companionStats:C,onComplete:f,onDamage:b,tierAttackDamage:G=15,difficulty:N="medium",questIntervalScale:w=0,maxTimer:j,isPractice:p=!1,compact:R=!1})=>{const x=we(),{completeOnce:V}=Ce(f),{registerTimeout:h,clearTimer:Y}=Se(),S=Te[N],pe=Le[N],[t,fe]=a.useState(1),[E,xe]=a.useState(1),[z,he]=a.useState(S.startLives),[n,P]=a.useState("countdown"),[F,_]=a.useState([]),[ae,A]=a.useState([]),[X,Z]=a.useState(0),[L,H]=a.useState(0),[I,ie]=a.useState(0),[J,U]=a.useState(!1),[le,re]=a.useState([]),[O,ve]=a.useState(3),[q,D]=a.useState(0),[ne,oe]=a.useState(0),T=a.useRef("countdown"),K=a.useRef(0),d=a.useMemo(()=>se(t,E,S.startPairs,S.revealTimeMultiplier),[t,E,S]);a.useEffect(()=>{T.current=n,K.current+=1},[n]);const Q=a.useCallback((s=!1)=>{const i=Array.from({length:d.pairs},(r,o)=>o%W.length),m=[...i,...i];for(let r=m.length-1;r>0;r--){const o=Math.floor(Math.random()*(r+1));[m[r],m[o]]=[m[o],m[r]]}_(m.map((r,o)=>({id:`card-${t}-${o}`,symbolIndex:r,isFlipped:s,isMatched:!1}))),A([]),Z(0),H(0)},[d.pairs,t]);a.useEffect(()=>{t===1&&Q()},[]),a.useEffect(()=>{if(n==="countdown")if(O>0){const s=h(()=>{!x.current||T.current!=="countdown"||ve(O-1)},1e3);return()=>Y(s)}else Q(!0),P("revealing"),D(Math.ceil(d.revealTime))},[O,n,d.revealTime,Q,h,Y,x]),a.useEffect(()=>{if(n==="revealing")if(q>0){const s=h(()=>{!x.current||T.current!=="revealing"||D(q-1)},1e3);return()=>Y(s)}else P("hiding"),h(()=>{!x.current||T.current!=="hiding"||(_(s=>s.map(i=>({...i,isFlipped:i.isMatched}))),h(()=>{!x.current||T.current!=="hiding"||P("playing")},400))},200)},[q,n,h,Y,x]),a.useEffect(()=>{if(n==="playing"&&X===d.pairs){je(),B("success"),P("levelComplete");const s=ne===0,i=s?ce.galactic_match.perfectLevel:ce.galactic_match.levelComplete;b?.({target:"adversary",amount:i,source:s?"perfect_level":"level_complete"});const m=15*t,r=I+m;ie(r);const o=K.current;h(()=>{if(!x.current||T.current!=="levelComplete"||o!==K.current)return;if(p&&t>=2){V({success:!0,accuracy:100,result:"good",highScoreValue:t,gameStats:{level:t,score:r,maxCombo:L}});return}const te=d.pairs>=3&&E===1;let u,y,g;te?(u=t+1,y=2,g=se(u,y,S.startPairs,S.revealTimeMultiplier)):(u=t+1,y=1,g=se(u,y,S.startPairs,S.revealTimeMultiplier));const $=Array.from({length:g.pairs},(c,v)=>v%W.length),M=[...$,...$];for(let c=M.length-1;c>0;c--){const v=Math.floor(Math.random()*(c+1));[M[c],M[v]]=[M[v],M[c]]}_(M.map((c,v)=>({id:`card-${u}-${v}`,symbolIndex:c,isFlipped:!0,isMatched:!1}))),A([]),Z(0),oe(0),H(0),fe(u),xe(y),P("revealing"),D(Math.ceil(g.revealTime))},1500)}},[X,d.pairs,n,t,E,p,ne,b,S,I,L,h,x,V]),a.useEffect(()=>{if(n!=="gameOver")return;const i=Math.min(100,Math.round(I/500*100)),m=t>=3?t>=6?"perfect":"good":"fail";m!=="fail"&&(Me(),B("success")),h(()=>{V({success:m!=="fail",accuracy:Math.min(i,100),result:m,highScoreValue:t,gameStats:{level:t,score:I,maxCombo:L}})},1500)},[n,I,t,L,h,V]);const ye=a.useCallback(s=>{if(J||n!=="playing")return;const i=F.find(r=>r.id===s);if(!i||i.isFlipped||i.isMatched)return;B("light"),_(r=>r.map(o=>o.id===s?{...o,isFlipped:!0}:o));const m=[...ae,s];if(A(m),m.length===2){U(!0);const[r,o]=m,ee=F.find(u=>u.id===r),te=F.find(u=>u.id===o);if(ee.symbolIndex===te.symbolIndex){const u=L+1,y=Math.min(3,1+u*.5),g=10+t*2,$=Math.round(g*y);Ne(),B("success"),H(u),ie(c=>c+$),Z(c=>c+1);const M=W[ee.symbolIndex].color;re(c=>[...c,{id:r,color:M},{id:o,color:M}]),h(()=>{!x.current||T.current!=="playing"||(_(c=>c.map(v=>v.id===r||v.id===o?{...v,isMatched:!0}:v)),re(c=>c.filter(v=>v.id!==r&&v.id!==o)),A([]),U(!1))},400)}else{const u=z-1;he(u),H(0),oe(y=>y+1),B("error"),b?.({target:"player",amount:G,source:"wrong_match"}),u<=0?h(()=>{!x.current||T.current!=="playing"||(_(y=>y.map(g=>g.id===r||g.id===o?{...g,isFlipped:!1}:g)),A([]),U(!1),P("gameOver"))},800):h(()=>{if(!x.current||T.current!=="playing")return;_($=>$.map(M=>({...M,isFlipped:M.isMatched||!0}))),A([]);const y=F.filter($=>!$.isMatched).length,g=Math.min(1.5+y/4*.5,3);D(Math.ceil(g)),P("revealing"),U(!1)},800)}}},[F,ae,J,n,L,z,t,b,G,h,x]),ge=a.useMemo(()=>({gridTemplateColumns:`repeat(${d.cols}, 1fr)`,gridTemplateRows:`repeat(${d.rows}, 1fr)`}),[d.cols,d.rows]);return e.jsxs("div",{className:`flex flex-col items-center flex-1 min-h-0 ${R?"gap-1 p-1":"gap-2 p-3"} select-none touch-none`,children:[e.jsxs("div",{className:"w-full flex items-center justify-between text-xs",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[!R&&e.jsx("span",{className:"text-muted-foreground text-[10px]",children:"Level"}),e.jsx(l.span,{initial:{scale:1.5,color:"hsl(var(--primary))"},animate:{scale:1,color:"hsl(var(--foreground))"},className:`font-bold ${R?"text-sm":"text-base"}`,children:R?`Lv${t}`:t},`${t}-${E}`),d.pairs>=3&&e.jsxs("span",{className:"text-muted-foreground text-[10px] ml-0.5",children:["(",E,"/2)"]})]}),e.jsx("div",{className:"flex items-center gap-0.5",children:[...Array(pe)].map((s,i)=>e.jsx(l.div,{initial:!1,animate:{scale:i<z?1:.8,opacity:i<z?1:.3},transition:{type:"spring",stiffness:300},children:e.jsx(be,{className:`w-4 h-4 ${i<z?"fill-red-500 text-red-500":"text-muted-foreground"}`})},i))}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-muted-foreground",children:"Score:"}),e.jsx(l.span,{initial:{scale:1.3,color:"hsl(var(--primary))"},animate:{scale:1,color:"hsl(var(--foreground))"},className:"font-bold",children:I},I)]})]}),e.jsx(k,{children:L>1&&n==="playing"&&e.jsxs(l.div,{initial:{scale:0,y:-10},animate:{scale:1,y:0},exit:{scale:0,opacity:0},className:"px-2 py-0.5 bg-yellow-500/20 rounded-full text-yellow-400 text-xs font-bold",children:["ðŸ”¥ ",L,"x COMBO!"]})}),e.jsxs("div",{className:"w-full flex items-center gap-1.5",children:[e.jsx("div",{className:"flex-1 h-1.5 bg-muted rounded-full overflow-hidden",children:e.jsx(l.div,{className:"h-full bg-gradient-to-r from-cyan-500 to-purple-500",initial:{width:0},animate:{width:`${X/d.pairs*100}%`},transition:{duration:.3}})}),e.jsxs("span",{className:"text-[10px] text-muted-foreground",children:[X,"/",d.pairs]})]}),e.jsxs("div",{className:"relative w-full max-w-sm mx-auto",style:{aspectRatio:`${d.cols}/${d.rows}`},children:[e.jsx(k,{children:n==="countdown"&&O>0&&e.jsx(l.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"absolute inset-0 z-20 flex items-center justify-center bg-background/80 backdrop-blur-sm rounded-xl",children:e.jsx(l.span,{initial:{scale:0,opacity:0},animate:{scale:1,opacity:1},exit:{scale:2,opacity:0},className:"text-6xl font-bold text-primary",children:O},O)})}),e.jsx(k,{children:n==="revealing"&&e.jsx(l.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"absolute inset-x-0 -top-12 z-20 flex flex-col items-center",children:e.jsxs(l.div,{className:"px-4 py-2 bg-cyan-500/90 rounded-full text-white font-bold shadow-lg",animate:{scale:[1,1.05,1]},transition:{duration:.5,repeat:1/0},children:["MEMORIZE! ",q,"s"]})})}),e.jsx(k,{children:n==="hiding"&&e.jsx(l.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"absolute inset-0 z-20 flex items-center justify-center",children:e.jsx(l.div,{initial:{scale:.5,opacity:0},animate:{scale:1,opacity:1},exit:{scale:1.5,opacity:0},className:"text-4xl font-bold text-primary",children:"GO!"})})}),e.jsx(k,{children:n==="levelComplete"&&e.jsx(l.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"absolute inset-0 z-20 flex items-center justify-center bg-background/80 backdrop-blur-sm rounded-xl",children:e.jsxs(l.div,{initial:{scale:0},animate:{scale:1},className:"text-center",children:[e.jsx(l.div,{className:"text-5xl mb-2",animate:{rotate:[0,-10,10,0]},transition:{duration:.5},children:"ðŸŽ‰"}),e.jsxs("div",{className:"text-2xl font-bold text-primary",children:["Level ",t," Complete!"]}),e.jsxs("div",{className:"text-sm text-muted-foreground mt-1",children:["+",15*t," bonus points"]})]})})}),e.jsx(k,{children:n==="gameOver"&&e.jsxs(l.div,{initial:{opacity:0},animate:{opacity:1},className:"absolute inset-0 z-20 flex items-center justify-center rounded-xl overflow-hidden",style:{background:"radial-gradient(ellipse at center, rgba(30, 20, 50, 0.95) 0%, rgba(15, 10, 30, 0.98) 100%)"},children:[e.jsx("div",{className:"absolute inset-0 overflow-hidden pointer-events-none",children:Array.from({length:8}).map((s,i)=>e.jsx(l.div,{className:"absolute w-1.5 h-1.5 rounded-full",style:{left:`${10+i*12}%`,top:"-5%",background:"radial-gradient(circle, rgba(168, 85, 247, 0.8), rgba(100, 50, 150, 0.4))",boxShadow:"0 0 4px rgba(168, 85, 247, 0.5)"},animate:{y:["0%","120%"],opacity:[0,.7,0]},transition:{duration:3+i*.3,delay:i*.4,repeat:1/0,ease:"linear"}},i))}),e.jsxs(l.div,{initial:{scale:0},animate:{scale:1},className:"text-center px-4 relative z-10",children:[e.jsxs(l.div,{className:"relative inline-block mb-3",animate:{scale:[1,1.05,1]},transition:{duration:2,repeat:1/0},children:[e.jsx("div",{className:"absolute inset-0 blur-xl bg-purple-500/30 rounded-full"}),e.jsx("div",{className:"text-4xl relative z-10",children:t>=3?"ðŸŒŸ":"ðŸ’«"})]}),e.jsx(l.h3,{className:"text-xl font-black bg-gradient-to-r from-slate-300 via-purple-300 to-slate-400 bg-clip-text text-transparent mb-1",initial:{y:10,opacity:0},animate:{y:0,opacity:1},transition:{delay:.2},children:t>=5?"Amazing Run!":t>=3?"Good Effort!":"The Void Prevails"}),e.jsx(l.p,{className:"text-sm text-purple-300/70 mb-3 italic",initial:{opacity:0},animate:{opacity:1},transition:{delay:.4},children:t>=3?"Your memory grows stronger each time":"Every attempt brings you closer to mastery"}),e.jsxs(l.div,{className:"space-y-1",initial:{opacity:0},animate:{opacity:1},transition:{delay:.3},children:[e.jsxs("div",{className:"text-lg font-bold text-purple-400",children:["Reached Level ",t]}),e.jsxs("div",{className:"text-sm text-slate-400",children:["Final Score: ",Math.min(I,Ie)," XP"]})]})]})]})}),e.jsx("div",{className:"grid gap-1 sm:gap-1.5 w-full h-full",style:ge,children:F.map(s=>e.jsxs(l.button,{onClick:()=>ye(s.id),disabled:s.isFlipped||s.isMatched||J||n!=="playing",className:"relative w-full h-full",style:{perspective:"1000px"},whileTap:n==="playing"?{scale:.95}:void 0,children:[e.jsxs(l.div,{className:"absolute inset-0 preserve-3d",initial:!1,animate:{rotateY:s.isFlipped||s.isMatched?180:0,opacity:s.isMatched?.3:1,scale:s.isMatched?.9:1},transition:{duration:.3,ease:"easeInOut"},style:{transformStyle:"preserve-3d"},children:[e.jsx("div",{className:"absolute inset-0",style:{backfaceVisibility:"hidden"},children:e.jsx(de,{})}),e.jsx("div",{className:"absolute inset-0",style:{backfaceVisibility:"hidden",transform:"rotateY(180deg)"},children:e.jsx(me,{symbolIndex:s.symbolIndex})})]}),e.jsx(k,{children:le.find(i=>i.id===s.id)&&e.jsx(ue,{color:le.find(i=>i.id===s.id).color})})]},s.id))})]}),p&&!R&&e.jsx("div",{className:"text-xs text-muted-foreground",children:"Practice Round - Get familiar with the mechanics!"})]})};export{Fe as GalacticMatchGame,Fe as default};
