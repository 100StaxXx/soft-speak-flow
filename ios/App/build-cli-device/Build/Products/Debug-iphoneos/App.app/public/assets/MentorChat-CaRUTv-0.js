import{r,j as e,m as P,dF as H,dG as B,cV as ee,b3 as te,b4 as se,X as ae,bZ as V,dH as ne,W as re,aW as oe,u as ie,H as le,q as ce,co as de,M as ue}from"./vendor-DK8VKJIv.js";import{c as O,B as d,s as C,u as me,p as he,K as fe,f as K,a as ge,m as pe,ax as xe,ay as ye,e as be,ad as ve,ai as we}from"./index-BJ43zXLh.js";import"./date-vendor-BRrA_NVo.js";import"./three-vendor-qI8GXUTd.js";const Q=["Channeling wisdom...","Consulting the stars...","Gathering insights...","Aligning thoughts...","Seeking clarity..."],je=({mentorName:s})=>{const[a,u]=r.useState(0);return r.useEffect(()=>{const t=setInterval(()=>{u(o=>(o+1)%Q.length)},1800);return()=>clearInterval(t)},[]),e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsx("div",{className:"font-semibold text-sm",children:s}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"relative w-8 h-8",children:[e.jsx(P.div,{className:"absolute inset-0 rounded-full border border-primary/30",animate:{rotate:360},transition:{duration:8,repeat:1/0,ease:"linear"}}),e.jsx(P.div,{className:"absolute inset-1 rounded-full bg-gradient-to-br from-primary/40 to-purple-500/30",animate:{scale:[1,1.15,1],opacity:[.6,1,.6]},transition:{duration:1.5,repeat:1/0,ease:"easeInOut"}}),[0,1,2].map(t=>e.jsx(P.div,{className:"absolute w-1.5 h-1.5 rounded-full bg-primary/80",style:{top:"50%",left:"50%",marginTop:-3,marginLeft:-3},animate:{x:Math.cos(t*Math.PI*2/3)*12,y:Math.sin(t*Math.PI*2/3)*12,opacity:[.5,1,.5]},transition:{duration:2,repeat:1/0,delay:t*.3,ease:"easeInOut"}},t))]}),e.jsx(P.span,{initial:{opacity:0,x:-5},animate:{opacity:1,x:0},exit:{opacity:0,x:5},className:"text-sm text-muted-foreground italic",children:Q[a]},a)]})]})},ke=(s,a,u)=>{const t=s.toLowerCase(),o=/tough|direct/i.test(u),c=/empathetic|supportive/i.test(u);return t.includes("habit")||t.includes("consistent")?{content:Ne(o,c),isFallback:!0}:t.includes("motivat")||t.includes("boost")||t.includes("encourage")?{content:Ce(o,c),isFallback:!0}:t.includes("start")||t.includes("begin")||t.includes("day")?{content:Se(o,c),isFallback:!0}:t.includes("reflect")||t.includes("think")||t.includes("today")?{content:Me(o,c),isFallback:!0}:t.includes("struggle")||t.includes("hard")||t.includes("difficult")?{content:Ie(o,c),isFallback:!0}:t.includes("goal")||t.includes("challenge")||t.includes("improve")?{content:Re(o,c),isFallback:!0}:{content:_e(o,c),isFallback:!0}};function Ne(s,a){return s?"Consistency isn't built overnight. Track your habits daily, hold yourself accountable, and don't make excuses. Small actions compound over time - but only if you show up.":a?"Building habits takes time and patience. Start with one small habit and be gentle with yourself when you miss a day. What matters is that you keep coming back. You're doing great!":"The key to building strong habits is consistency. Start small - even 5 minutes a day makes a difference. Track your progress and celebrate small wins along the way."}function Ce(s,a){return s?"You don't need motivation - you need discipline. Motivation fades, but habits and systems last. Stop waiting to feel ready and start taking action now.":a?"I know it can be tough sometimes. Remember why you started this journey. You have everything you need within you to succeed. Take a deep breath and tackle one small thing today.":"Every expert was once a beginner. Focus on progress, not perfection. Each step forward, no matter how small, is moving you closer to your goals."}function Se(s,a){return s?"Stop overthinking and start doing. Plan your top 3 priorities and execute them. No distractions, no excuses. Your future self will thank you.":a?"Good morning! Today is a fresh start full of possibilities. Take a moment to set a clear intention for what you want to accomplish. You've got this!":"Start your day with clarity. Choose your top 3 priorities and tackle them first. Build momentum with small wins and maintain that energy throughout the day."}function Me(s,a){return s?"Be honest with yourself. What actually got done today versus what you planned? Learn from it and adjust tomorrow. No sugar-coating - just honest assessment leads to real growth.":a?"Take a moment to appreciate what you accomplished today. Even small victories count. What did you learn? What are you grateful for? Rest well - you earned it.":"Reflection is powerful. Think about what worked well today and what you'd do differently. Each day is a learning opportunity. What's one insight you can carry forward?"}function Ie(s,a){return s?"Struggling means you're pushing your limits - that's good. The question is: will you push through or give up? Discomfort is where growth happens. Keep going.":a?"It's okay to struggle - it means you're challenging yourself. Be kind to yourself during difficult times. Break things down into smaller steps and ask for help when needed. You're stronger than you think.":"Challenges are part of growth. When things feel hard, break them into smaller, manageable steps. Focus on what you can control and take it one step at a time."}function Re(s,a){return s?"Goals without action are just wishes. Break your goal into concrete steps and start executing today. Track your progress ruthlessly and adjust as needed.":a?"Your goals are within reach. Start by making them specific and achievable. Celebrate each milestone along the way. Remember - progress over perfection!":"Clear goals drive focused action. Make your goals specific, measurable, and break them into weekly milestones. Review regularly and adjust your approach based on what you learn."}function _e(s,a){return s?"I hear you. Remember - you're capable of more than you think. The path forward is action, not overthinking. What's one concrete step you can take right now?":a?"Thank you for sharing with me. You're on a meaningful journey of growth. Whatever you're facing, remember that small consistent steps lead to big changes. What feels most important to focus on right now?":"I understand. Progress comes from consistent effort in the right direction. Focus on what you can control, take one step at a time, and trust the process. What's your next move?"}const Te=s=>({content:"I'm having trouble connecting right now, but I'm here for you. While we work on restoring the connection, remember: you already have the strength and wisdom within you to move forward. Trust yourself and take action on what you know you need to do.",isFallback:!0}),Ee=({messageContent:s,onFeedbackSubmitted:a})=>{const{user:u}=O(),[t,o]=r.useState(!1),[c,i]=r.useState(!1),[v,j]=r.useState(null),m=async h=>{if(!(!u||c))try{const{error:g}=await C.from("mentor_chat_feedback").insert({user_id:u.id,message_content:s.slice(0,500),feedback_type:h});if(g){console.error("Failed to submit feedback:",g);return}i(!0),j(h),a?.(),setTimeout(()=>o(!1),1500)}catch(g){console.error("Error submitting feedback:",g)}};return c?e.jsxs("div",{className:"flex items-center gap-1 text-xs text-muted-foreground mt-2",children:[e.jsx("span",{children:"Thanks for the feedback!"}),v==="positive"&&e.jsx(H,{className:"h-3 w-3 text-green-500"}),v==="negative"&&e.jsx(B,{className:"h-3 w-3 text-red-500"})]}):e.jsxs("div",{className:"mt-2",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(d,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0 hover:bg-green-500/10",onClick:()=>m("positive"),"aria-label":"Good response",children:e.jsx(H,{className:"h-3 w-3 text-muted-foreground hover:text-green-500"})}),e.jsx(d,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0 hover:bg-red-500/10",onClick:()=>m("negative"),"aria-label":"Bad response",children:e.jsx(B,{className:"h-3 w-3 text-muted-foreground hover:text-red-500"})}),e.jsxs(d,{variant:"ghost",size:"sm",className:"h-6 px-1 text-xs text-muted-foreground hover:text-foreground",onClick:()=>o(!t),children:[e.jsx(ee,{className:"h-3 w-3 mr-1"}),"More",t?e.jsx(te,{className:"h-3 w-3 ml-1"}):e.jsx(se,{className:"h-3 w-3 ml-1"})]})]}),t&&e.jsxs("div",{className:"flex flex-wrap gap-1 mt-2 animate-in slide-in-from-top-2 duration-200",children:[e.jsx(d,{variant:"outline",size:"sm",className:"h-6 text-xs px-2",onClick:()=>m("too_long"),children:"Too long"}),e.jsx(d,{variant:"outline",size:"sm",className:"h-6 text-xs px-2",onClick:()=>m("too_short"),children:"Too short"}),e.jsx(d,{variant:"outline",size:"sm",className:"h-6 text-xs px-2",onClick:()=>m("too_formal"),children:"Too formal"}),e.jsx(d,{variant:"outline",size:"sm",className:"h-6 text-xs px-2",onClick:()=>m("too_casual"),children:"Too casual"}),e.jsx(d,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0",onClick:()=>o(!1),"aria-label":"Close feedback options",children:e.jsx(ae,{className:"h-3 w-3"})})]})]})},Le=15,Fe=20,De=(s,a,u)=>{const t=new Date().getHours(),o=/tough|direct/i.test(s),c=/empathetic|supportive/i.test(s),i=[];return t>=5&&t<12?i.push("Help me start my day strong","What should I focus on today?"):t>=12&&t<17?i.push("I need an afternoon boost","Keep me on track"):i.push("Help me reflect on today","Prepare me for tomorrow"),o?i.push("Give me the hard truth"):c?i.push("I need some encouragement"):i.push("Give me a pep talk"),a||u?i.push(a?"Help me stay consistent":"Keep me motivated"):i.push("Help me build better habits"),i.sort(()=>Math.random()-.5).slice(0,3)},Pe=({mentorName:s,mentorTone:a,mentorId:u,hasActiveHabits:t=!1,hasActiveChallenges:o=!1,briefingContext:c,comprehensiveMode:i=!1})=>{const{user:v}=O(),j=V(),[m,h]=r.useState([]),[g,_]=r.useState(""),[x,S]=r.useState(!1),[W,T]=r.useState(!0),[Y,p]=r.useState([]),[k,y]=r.useState(0),[M,E]=r.useState(navigator.onLine),[b,z]=r.useState(Fe),I=r.useRef(null),{toast:R}=me(),q=r.useRef(!1),U=r.useRef([]);U.current=m;const L=r.useCallback(async n=>{const{data:{user:l},error:A}=await C.auth.getUser();if(A||!l){R({title:"Error",description:"You must be logged in",variant:"destructive"});return}if(k>=b){R({title:"Daily limit reached",description:`You've reached your daily limit of ${b} messages. It resets at 00:00 UTC.`,variant:"destructive"});return}const Z={role:"user",content:n};h(N=>[...N,Z]),S(!0);try{const N=U.current,{data:f,error:F}=await C.functions.invoke("mentor-chat",{body:{message:n,mentorName:s,mentorTone:a,conversationHistory:N.slice(-10),comprehensiveMode:i,briefingContext:c}});if(F)throw F;if(!f||!f.response)throw new Error("Invalid response from mentor");const G={role:"assistant",content:f.response};h(w=>[...w,G]),typeof f.dailyLimit=="number"&&Number.isFinite(f.dailyLimit)&&z(f.dailyLimit),f.messagesUsed!==void 0?y(f.messagesUsed):y(w=>w+1),u&&C.from("mentor_chats").insert([{user_id:l.id,mentor_id:u,role:"user",content:n},{user_id:l.id,mentor_id:u,role:"assistant",content:f.response}]).then(({error:w})=>{w&&console.error("Failed to save chat history:",w)})}catch(N){console.error("Mentor chat error:",N);const f=await he(N),F=f.responsePayload?.message??f.responsePayload?.error??f.message;if(f.status===429){R({title:"Daily limit reached",description:F||`You've reached your daily limit of ${b} messages. It resets at 00:00 UTC.`,variant:"destructive"}),h(D=>D.filter((We,J)=>J!==D.length-1));return}const w={role:"assistant",content:(M?ke(n,s,a):Te()).content,isFallback:!0};h(D=>[...D,w]),R({title:"Connection issue",description:"Live reply unavailable. Showing fallback guidance.",duration:3e3})}finally{S(!1)}},[k,b,R,s,a,u,M,i,c]);r.useEffect(()=>{(async()=>{if(!v)return;const l=new Date;l.setUTCHours(0,0,0,0);const{count:A}=await C.from("mentor_chats").select("*",{count:"exact",head:!0}).eq("user_id",v.id).eq("role","user").gte("created_at",l.toISOString());y(A||0)})()},[v]),r.useEffect(()=>{p(De(a,t,o))},[a,t,o]),r.useEffect(()=>{I.current?.scrollIntoView({behavior:"smooth"})},[m]),r.useEffect(()=>{const n=()=>E(!0),l=()=>E(!1);return window.addEventListener("online",n),window.addEventListener("offline",l),()=>{window.removeEventListener("online",n),window.removeEventListener("offline",l)}},[]),r.useEffect(()=>{const n=j.state?.initialMessage;n&&!q.current&&(q.current=!0,T(!1),L(n))},[j.state,L]);const $=async n=>{n.preventDefault();const l=g.trim();!l||x||(_(""),await L(l))},X=n=>{T(!1),L(n)};return e.jsxs("div",{className:"flex flex-col h-full",children:[!M&&e.jsxs("div",{className:"bg-destructive text-destructive-foreground px-4 py-2 text-sm flex items-center justify-center gap-2",children:[e.jsx(ne,{className:"h-4 w-4"}),e.jsx("span",{children:"You're offline. Live mentor replies are unavailable; fallback guidance is shown."})]}),e.jsx("div",{className:"px-4 pt-3 pb-2 border-b border-border/50 bg-muted/30",children:e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsxs("span",{className:"text-muted-foreground",children:["Daily messages: ",k,"/",b]}),e.jsx("div",{className:"flex gap-1",children:Array.from({length:Math.min(b,Le)}).map((n,l)=>e.jsx("div",{className:fe("h-1 w-3 rounded-full transition-colors",l<k?"bg-primary":"bg-muted")},l))})]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[m.length===0&&W&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-muted-foreground text-center",children:"Choose a prompt or type your own message"}),e.jsx("div",{className:"grid gap-2",children:Y.map((n,l)=>e.jsx(d,{variant:"outline",className:"justify-start text-left h-auto py-3 px-4 hover:bg-accent",onClick:()=>X(n),children:n},l))})]}),m.map((n,l)=>e.jsxs(K,{className:`p-4 ${n.role==="user"?"ml-8 bg-primary/10":"mr-8"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("div",{className:"font-semibold text-sm",children:n.role==="user"?"You":s}),n.isFallback&&e.jsxs("div",{className:"flex items-center gap-1 text-xs text-muted-foreground",children:[e.jsx(re,{className:"h-3 w-3"}),e.jsx("span",{children:"Offline mode"})]})]}),e.jsx("div",{className:"text-sm whitespace-pre-wrap",children:n.content}),n.role==="assistant"&&!n.isFallback&&e.jsx(Ee,{messageContent:n.content})]},l)),x&&e.jsx(K,{className:"p-4 mr-8",children:e.jsx(je,{mentorName:s})}),e.jsx("div",{ref:I})]}),e.jsx("form",{onSubmit:$,className:"p-4 border-t",children:e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx(ge,{value:g,onChange:n=>_(n.target.value),placeholder:"Type your message...",disabled:x,className:"flex-1"}),e.jsx(d,{type:"submit",disabled:x||!g.trim(),size:"icon","aria-label":"Send message",children:e.jsx(oe,{className:"h-4 w-4"})})]})})]})};function qe(){const{user:s}=O(),{profile:a,loading:u,error:t,refetch:o}=pe(),c=ie(),i=le(),v=V(),[j,m]=r.useState(!1),[h,g]=r.useState(!1),_=xe(),{effectiveMentorId:x,status:S,refreshConnection:W}=ye(),T=v.state?.briefingContext,Y=v.state?.comprehensiveMode||!1,{data:p,isLoading:k,isFetching:y,error:M,refetch:E}=ce({queryKey:["mentor",x],queryFn:async()=>{if(!x)return null;const{data:z,error:I}=await C.from("mentors").select("*").eq("id",x).maybeSingle();if(I)throw I;return z},enabled:!!x}),b=async()=>{g(!0);try{await o(),await W(),await Promise.all([c.invalidateQueries({queryKey:["mentor"]}),c.invalidateQueries({queryKey:["selected-mentor"]})]),x&&await E()}finally{g(!1)}};return!s||u||k||S==="recovering"?e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center p-4",children:e.jsxs("div",{className:"text-center space-y-3",children:[e.jsx("div",{className:"w-16 h-16 border-4 border-primary border-t-transparent rounded-full animate-spin mx-auto"}),e.jsx("p",{className:"text-muted-foreground text-sm",children:"Loading your motivator..."})]})}):t&&!a?e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center p-4",children:e.jsxs("div",{className:"text-center space-y-4 max-w-md",children:[e.jsx("p",{className:"text-lg font-semibold",children:"We couldn't load your profile"}),e.jsx("p",{className:"text-muted-foreground",children:"Connection may have dropped while the app was in the background. Try again."}),e.jsx(d,{onClick:()=>{b()},disabled:h||y,children:h||y?"Retrying...":"Retry"})]})}):S==="missing"?e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center p-4",children:e.jsxs("div",{className:"text-center space-y-4 max-w-md",children:[e.jsx("p",{className:"text-lg font-semibold",children:"No mentor selected"}),e.jsx("p",{className:"text-muted-foreground",children:"Please select a mentor to continue."}),e.jsx(d,{onClick:()=>i("/mentor-selection"),children:"Choose Your Mentor"})]})}):M&&!p?e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center p-4",children:e.jsxs("div",{className:"text-center space-y-4 max-w-md",children:[e.jsx("p",{className:"text-lg font-semibold",children:"We couldn't load your mentor"}),e.jsx("p",{className:"text-muted-foreground",children:"Connection may have dropped while the app was in the background. Try again."}),e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(d,{onClick:()=>{b()},disabled:h||y,children:h||y?"Retrying...":"Retry"}),e.jsx(d,{variant:"outline",onClick:()=>i("/mentor-selection"),children:"Choose Mentor"})]})]})}):p?e.jsxs(be,{children:[e.jsxs("div",{className:"min-h-screen bg-background pb-nav-safe pt-safe relative z-10",children:[e.jsxs("div",{className:"relative h-48 md:h-64 overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-primary/30 via-accent/20 to-background animate-gradient-shift"}),e.jsx("div",{className:"absolute inset-0 bg-[radial-gradient(circle_at_center,_var(--tw-gradient-stops))] from-primary/40 via-transparent to-transparent"}),e.jsxs("div",{className:"absolute inset-0",children:[e.jsx("div",{className:"absolute top-1/4 left-1/4 w-2 h-2 bg-primary/60 rounded-full animate-float-slow"}),e.jsx("div",{className:"absolute top-1/3 right-1/3 w-3 h-3 bg-accent/60 rounded-full animate-float-medium",style:{animationDelay:"0.5s"}}),e.jsx("div",{className:"absolute bottom-1/4 left-1/3 w-2 h-2 bg-primary/40 rounded-full animate-float-fast",style:{animationDelay:"1s"}}),e.jsx("div",{className:"absolute top-1/2 right-1/4 w-2 h-2 bg-accent/50 rounded-full animate-float-slow",style:{animationDelay:"1.5s"}})]}),p.avatar_url&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 bg-primary/30 blur-3xl rounded-full animate-pulse"}),e.jsx("img",{src:p.avatar_url,alt:p.name,className:"relative w-24 h-24 md:w-32 md:h-32 rounded-full border-4 border-background shadow-glow-lg object-cover",loading:"lazy",decoding:"async"})]})}),e.jsxs("div",{className:"absolute top-4 left-4 right-4 z-10 flex items-center justify-between safe-area-top",children:[e.jsx(d,{variant:"ghost",size:"icon",onClick:()=>i("/mentor"),className:"bg-background/80 backdrop-blur-sm hover:bg-background/90 rounded-full shadow-soft",children:e.jsx(de,{className:"w-5 h-5"})}),e.jsx(ve,{onClick:()=>{_.tap(),m(!0)}})]}),e.jsxs("div",{className:"absolute bottom-0 left-0 right-0 bg-gradient-to-t from-background via-background/95 to-transparent p-6 pb-4",children:[e.jsxs("h1",{className:"text-2xl md:text-3xl font-heading font-black text-foreground text-center",children:["Ask ",p.name]}),e.jsx("p",{className:"text-sm text-muted-foreground text-center",children:"Get guidance from your motivator"})]})]}),e.jsx("div",{className:"container max-w-4xl mx-auto p-4 md:p-6 space-y-6",children:e.jsx(Pe,{mentorName:p.name,mentorTone:p.tone_description,mentorId:p.id,briefingContext:T,comprehensiveMode:Y})})]}),e.jsx(we,{open:j,onClose:()=>m(!1),title:"About Your Mentor",icon:ue,description:"Your personal motivator is here to guide and support you on your journey.",features:["Ask questions and get personalized advice","Receive guidance tailored to your goals","Get encouragement when you need it most","Chat anytime for instant motivation"],tip:"Your mentor's tone and style match your preferences from onboarding."})]}):e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center p-4",children:e.jsxs("div",{className:"text-center space-y-4 max-w-md",children:[e.jsx("p",{className:"text-lg font-semibold",children:"Mentor unavailable"}),e.jsx("p",{className:"text-muted-foreground",children:"We couldn't find your selected mentor right now."}),e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(d,{onClick:()=>{b()},disabled:h||y,children:h||y?"Retrying...":"Retry"}),e.jsx(d,{variant:"outline",onClick:()=>i("/mentor-selection"),children:"Choose Mentor"})]})]})})}export{qe as default};
