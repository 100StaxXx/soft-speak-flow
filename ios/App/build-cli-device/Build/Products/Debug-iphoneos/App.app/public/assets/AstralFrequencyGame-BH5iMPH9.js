import{r as t,j as e,e8 as pe,l as X,m as B,e9 as xe,ea as S}from"./vendor-DK8VKJIv.js";import{j as je,D as ge,k as ye}from"./three-vendor-qI8GXUTd.js";import{bt as be,bw as we,bu as Me,bv as Se}from"./index-BJ43zXLh.js";import{t as R}from"./gameUtils-CBfv9FnM.js";import"./date-vendor-BRrA_NVo.js";const ve={beginner:{startSpeed:16,spawnInterval:1.2,obstacleChance:.45,speedIncrement:.15},easy:{startSpeed:22,spawnInterval:.9,obstacleChance:.55,speedIncrement:.25},medium:{startSpeed:28,spawnInterval:.7,obstacleChance:.6,speedIncrement:.35},hard:{startSpeed:35,spawnInterval:.5,obstacleChance:.65,speedIncrement:.45},master:{startSpeed:45,spawnInterval:.35,obstacleChance:.72,speedIncrement:.6}},N=[-2.5,0,2.5],q=t.memo(({speed:o})=>{const a=t.useRef(null);return S((s,r)=>{a.current&&(a.current.rotation.z+=r*.1*(o/15))}),e.jsxs("group",{children:[e.jsxs("mesh",{ref:a,position:[0,0,-50],children:[e.jsx("cylinderGeometry",{args:[8,8,120,32,1,!0]}),e.jsx("meshBasicMaterial",{color:"#1a0a2e",side:je,transparent:!0,opacity:.9})]}),Array.from({length:12}).map((s,r)=>e.jsxs("mesh",{position:[0,0,-50],rotation:[0,0,r*Math.PI*2/12],children:[e.jsx("boxGeometry",{args:[.05,120,.05]}),e.jsx("meshBasicMaterial",{color:"#a855f7",transparent:!0,opacity:.3})]},r)),N.map((s,r)=>e.jsxs("mesh",{position:[s,-3,0],children:[e.jsx("boxGeometry",{args:[.1,.1,200]}),e.jsx("meshBasicMaterial",{color:"#6366f1",transparent:!0,opacity:.4})]},`lane-${r}`))]})});q.displayName="Tunnel";const H=t.memo(({speed:o})=>{const a=t.useRef(null),s=t.useRef(0);S((c,i)=>{a.current&&(s.current+=i*o*.5,a.current.material.map.offset.y=s.current)});const r=new ge(new Uint8Array([100,50,150,255,50,25,100,255,50,25,100,255,100,50,150,255]),2,2);return r.wrapS=r.wrapT=ye,r.repeat.set(10,100),r.needsUpdate=!0,e.jsxs("mesh",{ref:a,rotation:[-Math.PI/2,0,0],position:[0,-3,-50],children:[e.jsx("planeGeometry",{args:[8,150]}),e.jsx("meshBasicMaterial",{map:r,transparent:!0,opacity:.5})]})});H.displayName="ScrollingFloor";const V=t.memo(({lane:o,hasShield:a})=>{const s=t.useRef(null),r=t.useRef(N[o]);return t.useEffect(()=>{r.current=N[o]},[o]),S((c,i)=>{s.current&&(s.current.position.x+=(r.current-s.current.position.x)*10*i,s.current.rotation.z+=i*2)}),e.jsxs("group",{ref:s,position:[N[1],-1.5,5],children:[e.jsxs("mesh",{children:[e.jsx("sphereGeometry",{args:[.5,32,32]}),e.jsx("meshBasicMaterial",{color:"#a855f7"})]}),e.jsxs("mesh",{children:[e.jsx("sphereGeometry",{args:[.7,16,16]}),e.jsx("meshBasicMaterial",{color:"#a855f7",transparent:!0,opacity:.3})]}),a&&e.jsxs("mesh",{children:[e.jsx("sphereGeometry",{args:[.9,16,16]}),e.jsx("meshBasicMaterial",{color:"#22d3ee",transparent:!0,opacity:.4,wireframe:!0})]}),e.jsxs("mesh",{position:[0,0,-1],children:[e.jsx("coneGeometry",{args:[.3,2,8]}),e.jsx("meshBasicMaterial",{color:"#a855f7",transparent:!0,opacity:.4})]})]})});V.displayName="Player";const K=t.memo(({lane:o,z:a,type:s})=>{const r=t.useRef(null);S((i,p)=>{r.current&&(r.current.rotation.x+=p*2,r.current.rotation.y+=p*1.5)});const c=s==="asteroid"?1.2:s==="crystal"?.8:.9;return e.jsxs("group",{ref:r,position:[N[o],-1.5,a],children:[s==="asteroid"&&e.jsxs(e.Fragment,{children:[e.jsxs("mesh",{children:[e.jsx("dodecahedronGeometry",{args:[c]}),e.jsx("meshBasicMaterial",{color:"#ef4444"})]}),e.jsxs("mesh",{children:[e.jsx("dodecahedronGeometry",{args:[c*1.15]}),e.jsx("meshBasicMaterial",{color:"#ff0000",transparent:!0,opacity:.3,wireframe:!0})]}),e.jsxs("mesh",{children:[e.jsx("sphereGeometry",{args:[c*1.4,8,8]}),e.jsx("meshBasicMaterial",{color:"#ef4444",transparent:!0,opacity:.15})]})]}),s==="crystal"&&e.jsxs(e.Fragment,{children:[e.jsxs("mesh",{children:[e.jsx("octahedronGeometry",{args:[c]}),e.jsx("meshBasicMaterial",{color:"#fbbf24"})]}),e.jsxs("mesh",{children:[e.jsx("octahedronGeometry",{args:[c*1.2]}),e.jsx("meshBasicMaterial",{color:"#fbbf24",transparent:!0,opacity:.4,wireframe:!0})]}),e.jsx("pointLight",{color:"#fbbf24",intensity:2,distance:5})]}),s==="shield"&&e.jsxs(e.Fragment,{children:[e.jsxs("mesh",{children:[e.jsx("icosahedronGeometry",{args:[c]}),e.jsx("meshBasicMaterial",{color:"#22d3ee"})]}),e.jsxs("mesh",{rotation:[Math.PI/2,0,0],children:[e.jsx("torusGeometry",{args:[c*1.3,.1,8,16]}),e.jsx("meshBasicMaterial",{color:"#22d3ee",transparent:!0,opacity:.6})]}),e.jsxs("mesh",{children:[e.jsx("sphereGeometry",{args:[c*1.5,8,8]}),e.jsx("meshBasicMaterial",{color:"#22d3ee",transparent:!0,opacity:.2})]}),e.jsx("pointLight",{color:"#22d3ee",intensity:2,distance:5})]})]})});K.displayName="Obstacle";const Re=({gameState:o,playerLane:a,hasShield:s,speed:r,obstacles:c,onObstaclePass:i})=>{const{camera:p}=xe(),h=t.useRef(new Set);return t.useEffect(()=>{p.position.set(0,2,10),p.lookAt(0,0,-10)},[p]),S(()=>{o==="playing"&&c.forEach(m=>{m.z>4&&!h.current.has(m.id)&&Math.abs(m.lane-a)===0&&(h.current.add(m.id),i(m.id,m.type)),m.z>10&&h.current.delete(m.id)})}),e.jsxs(e.Fragment,{children:[e.jsx("ambientLight",{intensity:.3}),e.jsx("pointLight",{position:[0,5,10],intensity:1,color:"#a855f7"}),e.jsx(Y,{}),e.jsx(q,{speed:r}),e.jsx(H,{speed:r}),e.jsx(V,{lane:a,hasShield:s}),c.map(m=>e.jsx(W,{...m},m.id))]})},W=t.memo(({lane:o,z:a,type:s})=>e.jsx("group",{position:[0,0,a],children:e.jsx(K,{lane:o,z:0,type:s})}));W.displayName="MovingObstacle";const Y=t.memo(()=>{const o=t.useRef(null),a=new Float32Array(1e3*3);for(let s=0;s<1e3;s++)a[s*3]=(Math.random()-.5)*100,a[s*3+1]=(Math.random()-.5)*50+10,a[s*3+2]=(Math.random()-.5)*200-50;return S((s,r)=>{o.current&&(o.current.rotation.z+=r*.02)}),e.jsxs("points",{ref:o,children:[e.jsx("bufferGeometry",{children:e.jsx("bufferAttribute",{attach:"attributes-position",args:[a,3]})}),e.jsx("pointsMaterial",{size:.2,color:"#ffffff",transparent:!0,opacity:.8})]})});Y.displayName="Stars";const J=t.memo(({score:o,lives:a,combo:s,hasShield:r,distance:c,compact:i=!1})=>e.jsxs("div",{className:`absolute ${i?"top-1 left-1 right-1":"top-2 left-2 right-2"} flex justify-between items-start pointer-events-none z-10 safe-area-inset-top`,children:[e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsxs("div",{className:"bg-black/60 backdrop-blur-sm rounded-lg px-2 py-0.5",children:[e.jsx("span",{className:`text-yellow-400 font-bold ${i?"text-sm":"text-base"}`,children:o}),!i&&e.jsx("span",{className:"text-[10px] text-muted-foreground ml-0.5",children:"pts"})]}),e.jsxs("div",{className:"bg-black/60 backdrop-blur-sm rounded-lg px-2 py-0.5",children:[e.jsx("span",{className:`text-cyan-400 font-bold ${i?"text-sm":"text-base"}`,children:Math.round(c)}),!i&&e.jsx("span",{className:"text-[10px] text-muted-foreground ml-0.5",children:"m"})]}),s>1&&e.jsxs(B.div,{className:"bg-purple-500/60 backdrop-blur-sm rounded-lg px-2 py-0.5",initial:{scale:.8},animate:{scale:1},children:[e.jsxs("span",{className:`text-white font-bold ${i?"text-sm":"text-base"}`,children:[s,"x"]}),!i&&e.jsx("span",{className:"text-[10px] text-purple-200 ml-0.5",children:"combo"})]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[r&&e.jsx(B.div,{className:"bg-cyan-500/60 backdrop-blur-sm rounded-lg px-1.5 py-0.5",initial:{scale:0},animate:{scale:1},children:e.jsx("span",{className:i?"text-sm":"text-lg",children:"ðŸ›¡ï¸"})}),e.jsx("div",{className:"flex gap-0.5 bg-black/60 backdrop-blur-sm rounded-lg px-1.5 py-0.5",children:Array.from({length:3}).map((p,h)=>e.jsx(B.span,{className:`${i?"text-sm":"text-lg"} ${h<a?"":"grayscale opacity-30"}`,animate:h<a?{scale:[1,1.1,1]}:{},transition:{duration:.3},children:"â¤ï¸"},h))})]})]}));J.displayName="GameUI";const Q=t.memo(({onLeft:o,onRight:a})=>e.jsxs("div",{className:"absolute bottom-4 left-3 right-3 flex justify-between z-10 safe-area-inset-bottom",children:[e.jsx("button",{className:"w-20 h-20 rounded-full bg-white/15 backdrop-blur-sm flex items-center justify-center active:bg-white/30 transition-colors border border-white/20",onPointerDown:o,children:e.jsx("span",{className:"text-3xl text-white",children:"â—€"})}),e.jsx("button",{className:"w-20 h-20 rounded-full bg-white/15 backdrop-blur-sm flex items-center justify-center active:bg-white/30 transition-colors border border-white/20",onPointerDown:a,children:e.jsx("span",{className:"text-3xl text-white",children:"â–¶"})})]}));Q.displayName="LaneControls";const Ee=({companionStats:o,onComplete:a,onDamage:s,tierAttackDamage:r=15,difficulty:c="medium",isPractice:i=!1,compact:p=!1})=>{const h=ve[c],m=t.useRef(!1),[f,y]=t.useState("countdown"),[k,Z]=t.useState(0),[b,ee]=t.useState(0),[C,F]=t.useState(0),[P,te]=t.useState(0),[G,se]=t.useState(1),[v,A]=t.useState(!1),[I,re]=t.useState(3),[ae,_]=t.useState(!1),[ne,O]=t.useState([]),[E,oe]=t.useState(h.startSpeed),z=t.useRef(f),ie=t.useRef(G),D=t.useRef(v),$=t.useRef(0),T=t.useRef(null),L=t.useRef(E),w=t.useRef(null);t.useEffect(()=>{z.current=f},[f]),t.useEffect(()=>{ie.current=G},[G]),t.useEffect(()=>{D.current=v},[v]),t.useEffect(()=>{L.current=E},[E]),t.useEffect(()=>()=>{w.current&&clearTimeout(w.current)},[]);const U=t.useCallback(()=>{_(!0),w.current&&clearTimeout(w.current),w.current=setTimeout(()=>{_(!1),w.current=null},200)},[]),ce=t.useCallback(()=>{y("playing")},[]),le=t.useCallback(()=>{y(l=>l==="playing"?"paused":l==="paused"?"playing":l)},[]),x=t.useCallback(l=>{z.current==="playing"&&(se(n=>Math.max(0,Math.min(2,n+l))),R("light"))},[]),ue=t.useCallback(l=>{T.current={x:l.touches[0].clientX}},[]),de=t.useCallback(l=>{if(!T.current)return;const n=l.changedTouches[0].clientX-T.current.x;Math.abs(n)>30&&x(n>0?1:-1),T.current=null},[x]);t.useEffect(()=>{const l=n=>{z.current==="playing"&&((n.key==="ArrowLeft"||n.key==="a")&&x(-1),(n.key==="ArrowRight"||n.key==="d")&&x(1),n.key==="Escape"&&y("paused"))};return window.addEventListener("keydown",l),()=>window.removeEventListener("keydown",l)},[x]);const me=t.useCallback((l,n)=>{if(O(u=>u.filter(d=>d.id!==l)),n==="asteroid")D.current?(A(!1),R("medium")):(U(),s?.({target:"player",amount:r,source:"collision"}),re(u=>{const d=u-1;return d<=0&&y("complete"),d}),F(0),R("heavy"));else if(n==="crystal"){const u=10*(1+C*.1);Z(d=>d+Math.round(u)),F(d=>{const j=d+1;return te(M=>Math.max(M,j)),j}),R("light")}else n==="shield"&&(A(!0),R("medium"))},[C,s,r,U]);return t.useEffect(()=>{if(f!=="playing")return;const l=setInterval(()=>{ee(n=>{const u=L.current,d=n+u*.1,j=Math.floor(n/100);return Math.floor(d/100)>j&&s?.({target:"adversary",amount:be.astral_frequency.distanceMilestone,source:"distance_milestone"}),i&&d>=500&&y("complete"),d}),oe(n=>{const u=n+h.speedIncrement;return L.current=u,u}),O(n=>{const u=L.current,j=n.map(g=>({...g,z:g.z+u*.15})).filter(g=>g.z<15),M=Date.now();if(M-$.current>h.spawnInterval*1e3){$.current=M;const g=Math.random(),he=g<h.obstacleChance?"asteroid":g<.95?"crystal":"shield",fe=Math.floor(Math.random()*3);return[...j,{id:`${M}-${Math.random()}`,lane:fe,z:-80,type:he}]}return j})},100);return()=>clearInterval(l)},[f,h,i,s]),t.useEffect(()=>{if(f!=="complete"||m.current)return;m.current=!0;const n={beginner:600,easy:500,medium:400,hard:300,master:250}[c],u=Math.min(100,Math.round(b/n*100)),d=u>=90?"perfect":u>=50?"good":"fail";a({success:d!=="fail",accuracy:u,result:d,highScoreValue:b,gameStats:{distance:Math.floor(b),score:k,maxCombo:P,livesRemaining:I}})},[f,k,b,c,a,P,I]),e.jsxs("div",{className:"fixed inset-0 z-50 overflow-hidden bg-slate-950",onTouchStart:ue,onTouchEnd:de,children:[e.jsx(pe,{camera:{fov:75,near:.1,far:200},style:{background:"linear-gradient(to bottom, #0f0a1a, #1a0a2e)",position:"absolute",inset:0},children:e.jsx(t.Suspense,{fallback:null,children:e.jsx(Re,{gameState:f,playerLane:G,hasShield:v,speed:E,obstacles:ne,onObstaclePass:me})})}),p?e.jsx(we,{title:"Cosmiq Dash",subtitle:`${Math.floor(b)}m traversed`,score:k,combo:C,showCombo:!0,primaryStat:{value:I,label:"Lives",color:"hsl(0, 84%, 60%)"},isPaused:f==="paused",onPauseToggle:le,compact:!0}):e.jsx(J,{score:k,lives:I,combo:C,hasShield:v,distance:b,compact:p}),e.jsx(Q,{onLeft:()=>x(-1),onRight:()=>x(1)}),e.jsx(X,{children:ae&&e.jsx(B.div,{className:"absolute inset-0 bg-red-500/40 pointer-events-none z-30",initial:{opacity:.8},animate:{opacity:0},exit:{opacity:0},transition:{duration:.2}})}),e.jsxs(X,{children:[f==="countdown"&&e.jsx(Me,{count:3,onComplete:ce}),f==="paused"&&e.jsx(Se,{onResume:()=>y("playing")})]})]})};export{Ee as AstralFrequencyGame};
