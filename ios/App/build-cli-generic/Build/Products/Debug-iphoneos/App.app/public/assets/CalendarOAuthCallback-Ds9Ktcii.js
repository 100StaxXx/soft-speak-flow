import{r as v,j as c,b0 as w}from"./vendor-DK8VKJIv.js";import{s as h,p as b,t as x}from"./index-BJ43zXLh.js";import"./date-vendor-BRrA_NVo.js";import"./three-vendor-qI8GXUTd.js";const _=e=>e==="google"||e==="outlook",u=e=>e==="google"?"Google":"Outlook",$=e=>{const r=new URLSearchParams({calendar_oauth_provider:e.provider,calendar_oauth_status:e.status});return e.message&&r.set("calendar_oauth_message",e.message),`/profile?${r.toString()}`},k=e=>{const r=new URLSearchParams({provider:e.provider,status:e.status});return e.message&&r.set("message",e.message),`cosmiq://calendar/oauth/callback?${r.toString()}`},C=(e,r)=>`${r.backendMessage??""} ${r.message??""}`.toLowerCase().includes("integration not configured")?`${u(e)} Calendar is not configured on the server yet. Please contact support.`:null;function L(){return v.useEffect(()=>{let e=!1;return(async()=>{const o=new URLSearchParams(window.location.search),t=o.get("calendar_provider"),i=o.get("calendar_source")==="native"?"native":"web",g=o.get("error"),m=o.get("error_description"),d=o.get("code"),p=o.get("state"),a=n=>{if(e)return;const s=$(n);if(i==="native"){window.location.replace(k(n)),window.setTimeout(()=>{e||window.location.replace(s)},2e3);return}window.location.replace(s)};if(!_(t)){a({provider:"google",status:"error",message:"Unsupported calendar provider."});return}if(g){a({provider:t,status:"error",message:m||"Calendar connection was cancelled."});return}if(!d){a({provider:t,status:"error",message:"Missing authorization code from calendar provider."});return}const f=`${window.location.origin}${window.location.pathname}?calendar_provider=${t}&calendar_source=${i}`,{error:l}=await h.functions.invoke(`${t}-calendar-auth`,{body:{action:"exchangeCode",code:d,redirectUri:f,state:p??void 0}});if(l){const n=await b(l),s=C(t,n);a({provider:t,status:"error",message:s??x(n,{action:"connect your calendar"})});return}a({provider:t,status:"success",message:`${u(t)} Calendar connected successfully.`})})(),()=>{e=!0}},[]),c.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center px-6",children:c.jsxs("div",{className:"flex items-center gap-3 text-sm text-muted-foreground",children:[c.jsx(w,{className:"h-4 w-4 animate-spin"}),"Completing calendar connection..."]})})}export{L as default};
