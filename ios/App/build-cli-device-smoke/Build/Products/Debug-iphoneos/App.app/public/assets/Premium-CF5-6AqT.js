import{r as x,H as E,j as e,J as N,K as M,aI as D,aa as R,c6 as L,Y as I,ba as _,dp as $,Q as z}from"./vendor-DK8VKJIv.js";import{m as B,a3 as k,u as H,a4 as O,a5 as d,B as i,f as C,K as U,g as S,N as q,O as F,Q as K}from"./index-vNUnYBjj.js";import{A as Q,b as W,a as J}from"./alert-CSmvq9VB.js";import"./date-vendor-BRrA_NVo.js";import"./three-vendor-qI8GXUTd.js";function G(){const{profile:s,loading:m}=B(),{isActive:h,isLoading:u}=k();return x.useMemo(()=>{if(m||u||!s)return{isInTrial:!1,trialDaysRemaining:0,trialExpired:!1,isSubscribed:!1,needsPaywall:!1,trialEndsAt:null,loading:!0};const n=h;let t=null;s.trial_ends_at?t=new Date(s.trial_ends_at):s.created_at&&(t=new Date(new Date(s.created_at).getTime()+10080*60*1e3));const o=new Date,l=t?o>t:!1,g=t?o<=t:!0;let f=0;if(t&&!l){const y=t.getTime()-o.getTime();f=Math.ceil(y/(1e3*60*60*24))}return{isInTrial:g,trialDaysRemaining:f,trialExpired:l,isSubscribed:n,needsPaywall:l&&!n,trialEndsAt:t,loading:!1}},[s,m,h,u])}function se(){const s=E(),{toast:m}=H(),{isActive:h}=k(),{handlePurchase:u,handleRestore:w,loading:n,isAvailable:t,products:o,productsLoading:l,productError:g,reloadProducts:f,hasLoadedProducts:P}=O(),{isInTrial:y,trialDaysRemaining:j}=G(),[a,A]=x.useState("yearly"),v=x.useMemo(()=>o.reduce((r,p)=>(r[p.identifier]=p,r),{}),[o]),T=a==="yearly"?d.YEARLY:d.MONTHLY,b=v[T],Y=x.useCallback(async()=>{if(!b){m({title:"Almost ready",description:"We're still loading Apple pricing information. Please try again in a moment.",variant:"destructive"});return}const r=a==="yearly"?d.YEARLY:d.MONTHLY;await u(r)&&s("/premium/success")},[b,a,u,s,m]),c=x.useMemo(()=>({monthly:{fallbackPrice:"$9.99",period:"/month",savings:null,description:"Billed monthly"},yearly:{fallbackPrice:"$59.99",period:"/year",savings:"Save 50%",description:"Just $4.99/month"}}),[]);return h?e.jsx("div",{className:"min-h-screen pb-nav-safe bg-background flex items-center justify-center p-4",children:e.jsxs("div",{className:"text-center max-w-md",children:[e.jsx("div",{className:"bg-gradient-to-br from-primary to-accent p-6 rounded-full w-24 h-24 mx-auto mb-6 flex items-center justify-center shadow-glow",children:e.jsx(N,{className:"h-12 w-12 text-primary-foreground"})}),e.jsx("h1",{className:"font-display text-4xl text-foreground mb-4",children:"You're Premium!"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"Enjoy unlimited access to all content"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(i,{onClick:()=>s("/"),className:"w-full bg-gradient-to-r from-primary to-accent hover:opacity-90 text-primary-foreground font-medium px-8 py-6 rounded-3xl shadow-soft",children:"Back to Home"}),e.jsx(i,{variant:"ghost",onClick:()=>s("/profile"),className:"w-full",children:"Manage Subscription"})]})]})}):e.jsx("div",{className:"min-h-screen pb-nav-safe bg-gradient-to-br from-background via-background to-primary/5 p-6",children:e.jsxs("div",{className:"max-w-4xl mx-auto space-y-8",children:[e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-20 h-20 rounded-full bg-gradient-to-br from-primary to-accent mb-4 shadow-glow animate-pulse",children:e.jsx(N,{className:"h-10 w-10 text-primary-foreground"})}),e.jsx("h1",{className:"font-display text-5xl text-foreground",children:y?"Upgrade to Premium":"Subscribe to Continue"}),y&&j>0&&e.jsx("div",{className:"inline-flex items-center gap-2 px-4 py-2 rounded-full bg-accent/10 border border-accent/20",children:e.jsx("span",{className:"text-sm font-medium text-foreground",children:j===1?"1 day left in your free trial":`${j} days left in your free trial`})}),e.jsx("p",{className:"text-xl text-muted-foreground max-w-2xl mx-auto",children:"Full access to all features. No commitment."})]}),e.jsx("div",{className:"flex gap-4 max-w-md mx-auto",children:["monthly","yearly"].map(r=>e.jsxs(C,{onClick:()=>A(r),className:U("flex-1 cursor-pointer transition-all relative overflow-hidden",a===r?"border-2 border-primary bg-primary/5 shadow-glow":"border border-border hover:border-primary/50"),children:[c[r].savings&&e.jsx("div",{className:"absolute top-0 right-0 bg-accent text-accent-foreground text-xs font-bold px-2 py-1 rounded-bl-lg",children:c[r].savings}),e.jsxs(S,{className:"p-5 text-center",children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground capitalize mb-2",children:r}),e.jsx("p",{className:"text-3xl font-bold text-foreground",children:(r==="yearly"?v[d.YEARLY]?.priceString:v[d.MONTHLY]?.priceString)??c[r].fallbackPrice}),e.jsx("p",{className:"text-sm text-muted-foreground",children:c[r].period}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:c[r].description})]})]},r))}),e.jsxs(C,{className:"border-2 border-primary/20 shadow-2xl bg-card/80 backdrop-blur",children:[e.jsxs(q,{className:"text-center pb-4",children:[e.jsx(F,{className:"text-2xl font-bold text-foreground",children:"What's included"}),e.jsx(K,{className:"text-base",children:"Everything you need for your self-improvement journey"})]}),e.jsxs(S,{className:"space-y-6",children:[e.jsx("div",{className:"space-y-4",children:[{icon:M,title:"Full Companion Evolution",description:"Watch your companion grow through all 21 evolution stages"},{icon:D,title:"Personalized Cosmiq Insight",description:"Daily horoscope with rising sign and planetary transit influences"},{icon:N,title:"Unlimited Quests & Epics",description:"Create unlimited daily quests and join shared epics with friends"},{icon:R,title:"Mentor Chat",description:"Unlimited personalized guidance from your chosen mentor"},{icon:L,title:"Smart Quest Reminders",description:"Never miss a quest with intelligent notifications"},{icon:I,title:"All Premium Features",description:"Pet Mode, Guild Stories, Weekly Challenges, and more"}].map((r,p)=>e.jsxs("div",{className:"flex items-start gap-3 group hover:bg-primary/5 p-3 rounded-lg transition-colors",children:[e.jsx("div",{className:"mt-1 p-2 rounded-lg bg-primary/10 group-hover:bg-primary/20 transition-colors",children:e.jsx(r.icon,{className:"h-5 w-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-foreground mb-1",children:r.title}),e.jsx("p",{className:"text-sm text-muted-foreground",children:r.description})]}),e.jsx(_,{className:"h-5 w-5 text-primary ml-auto opacity-0 group-hover:opacity-100 transition-opacity"})]},p))}),e.jsxs(Q,{className:"bg-primary/5 border-primary/30",children:[e.jsx($,{className:"h-4 w-4"}),e.jsx(W,{children:"Billing clarity"}),e.jsxs(J,{children:["Cosmiq uses Apple's native subscription sheet (StoreKit) when you tap Subscribe. There is no separate Apple Pay button—PassKit is only bundled because the Capgo Native Purchases plugin links it. You can manage or cancel anytime in Settings ▸ ","[Your Name]"," ▸ Subscriptions."]})]}),!t&&e.jsx("div",{className:"bg-muted/30 rounded-lg p-4",children:e.jsx("p",{className:"text-sm text-muted-foreground text-center",children:"In-App Purchases are only available on iOS devices"})}),l&&e.jsxs("div",{className:"flex items-center gap-2 rounded-lg border border-dashed border-muted-foreground/30 px-3 py-2 text-sm text-muted-foreground",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-muted-foreground"}),"Contacting the App Store..."]}),g&&e.jsxs("div",{className:"rounded-lg border border-destructive/40 bg-destructive/5 p-3 text-sm text-destructive flex flex-col gap-2",children:[e.jsx("span",{children:g}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx(i,{size:"sm",variant:"outline",onClick:()=>{f()},children:"Try Again"}),e.jsx(i,{size:"sm",variant:"ghost",onClick:()=>s("/support/report"),children:"Contact support"})]})]}),e.jsx(i,{onClick:Y,disabled:n||!t||l||!P||!b,className:"w-full py-7 text-lg font-black uppercase tracking-wider bg-gradient-to-r from-primary to-accent hover:opacity-90 text-primary-foreground shadow-glow",size:"lg",children:n?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-primary-foreground mr-2"}),"Processing..."]}):`Subscribe ${a==="yearly"?"Yearly":"Monthly"} - ${b?.priceString??c[a].fallbackPrice}${a==="yearly"?" /year":" /month"}`}),e.jsxs(i,{variant:"ghost",onClick:w,disabled:n,className:"w-full text-muted-foreground hover:text-foreground",children:[e.jsx(z,{className:"h-4 w-4 mr-2"}),"Restore Purchases"]}),e.jsxs("p",{className:"text-xs text-center text-muted-foreground leading-relaxed",children:["Payment will be charged to your Apple ID account at confirmation of purchase. Subscription automatically renews unless canceled at least 24 hours before the end of the current period. Your account will be charged for renewal within 24 hours prior to the end of the current period. You can manage and cancel your subscriptions by going to Settings ",">"," [Your Name] ",">"," Subscriptions after purchase."]}),e.jsxs("div",{className:"flex justify-center gap-4 text-xs",children:[e.jsx("a",{href:"/privacy",className:"text-muted-foreground underline hover:text-foreground",children:"Privacy Policy"}),e.jsx("a",{href:"/terms",className:"text-muted-foreground underline hover:text-foreground",children:"Terms of Use"})]})]})]}),e.jsx("div",{className:"text-center",children:e.jsx(i,{variant:"ghost",onClick:()=>s(-1),className:"text-muted-foreground hover:text-foreground",children:"Maybe later"})})]})})}export{se as default};
