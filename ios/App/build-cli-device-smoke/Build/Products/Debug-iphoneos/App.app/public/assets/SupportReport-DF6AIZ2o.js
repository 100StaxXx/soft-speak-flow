import{H as L,bZ as M,r as s,o as H,j as e,co as z,aW as W,cF as J}from"./vendor-DK8VKJIv.js";import{c as Q,u as V,ax as Z,e as G,S as K,B as x,f as X,N as Y,O as _,Q as ee,g as te,L as r,a as R,ar as g,C as se}from"./index-vNUnYBjj.js";import"./date-vendor-BRrA_NVo.js";import"./three-vendor-qI8GXUTd.js";const ae=()=>typeof crypto<"u"&&"randomUUID"in crypto?crypto.randomUUID():`support-${Date.now()}-${Math.random().toString(36).slice(2,10)}`;function ce(){const v=L(),c=M(),{user:f}=Q(),{toast:n}=V(),{state:j,backendHealth:y,isOnline:S,queueCount:b,recentErrorFingerprints:C,reportIssue:I}=Z(),[l,k]=s.useState("bug"),[o,F]=s.useState(""),[d,U]=s.useState(""),[u,q]=s.useState(""),[p,A]=s.useState(""),[h,$]=s.useState(!0),[N,w]=s.useState(void 0),[B,D]=s.useState(!1),m=s.useMemo(()=>({appVersion:"production",platform:H.getPlatform(),route:`${c.pathname}${c.search}`,authState:f?"authenticated":"unauthenticated",connectivity:{isOnline:S,resilienceState:j,backendHealth:y},queueDepth:b,recentErrorFingerprints:C,userAgent:typeof navigator<"u"?navigator.userAgent:"unknown",capturedAt:new Date().toISOString()}),[y,S,c.pathname,c.search,b,C,j,f]),E=s.useMemo(()=>{const t=[`Category: ${l}`,`Summary: ${o||"(none)"}`,"","Reproduction Steps:",d||"(none)","","Expected:",u||"(none)","","Actual:",p||"(none)","",h?`Diagnostics:
${JSON.stringify(m,null,2)}`:"Diagnostics: not attached"].join(`
`);return`mailto:admin@cosmiq.quest?subject=${encodeURIComponent("Cosmiq Support Report")}&body=${encodeURIComponent(t)}`},[p,l,h,m,u,d,o]),O=async t=>{const i=t.target.files?.[0];if(!i){w(void 0);return}if(i.size>15e5){n({title:"Screenshot too large",description:"Please choose an image under 1.5 MB.",variant:"destructive"}),t.target.value="";return}const a=new FileReader;a.onload=()=>{typeof a.result=="string"&&w(a.result)},a.readAsDataURL(i)},P=async t=>{if(t.preventDefault(),!o.trim()){n({title:"Summary required",description:"Please provide a short description of the issue.",variant:"destructive"});return}const i={correlationId:ae(),category:l,summary:o.trim(),reproductionSteps:d.trim(),expectedBehavior:u.trim(),actualBehavior:p.trim(),screenshotDataUrl:N,consentDiagnostics:h,diagnostics:m};D(!0);try{(await I(i)).queued?n({title:"Report saved locally",description:"We'll send when connected."}):n({title:"Report sent",description:"Thanks. Support has received your report."}),v(-1)}catch(a){const T=a instanceof Error?a.message:"Unable to send support report";n({title:"Submission failed",description:T,variant:"destructive"})}finally{D(!1)}};return e.jsxs(G,{children:[e.jsx(K,{}),e.jsx("div",{className:"relative z-10 min-h-screen pb-nav-safe",children:e.jsxs("div",{className:"mx-auto max-w-3xl px-4 py-8",children:[e.jsxs(x,{variant:"ghost",className:"mb-4",onClick:()=>v(-1),children:[e.jsx(z,{className:"mr-2 h-4 w-4"}),"Back"]}),e.jsxs(X,{children:[e.jsxs(Y,{children:[e.jsx(_,{children:"Report a Problem"}),e.jsx(ee,{children:"Tell us what happened. If you're offline or services are down, this report will be queued and sent later."})]}),e.jsx(te,{children:e.jsxs("form",{className:"space-y-4",onSubmit:P,children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"category",children:"Category"}),e.jsxs("select",{id:"category",value:l,onChange:t=>k(t.target.value),className:"w-full rounded-md border border-input bg-background px-3 py-2 text-sm",children:[e.jsx("option",{value:"bug",children:"Bug"}),e.jsx("option",{value:"billing",children:"Billing"}),e.jsx("option",{value:"sync",children:"Sync/Offline"}),e.jsx("option",{value:"performance",children:"Performance"}),e.jsx("option",{value:"other",children:"Other"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"summary",children:"Summary"}),e.jsx(R,{id:"summary",placeholder:"Short issue summary",value:o,onChange:t=>F(t.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"steps",children:"Reproduction steps"}),e.jsx(g,{id:"steps",placeholder:"Step-by-step reproduction",value:d,onChange:t=>U(t.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"expected",children:"Expected behavior"}),e.jsx(g,{id:"expected",value:u,onChange:t=>q(t.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"actual",children:"Actual behavior"}),e.jsx(g,{id:"actual",value:p,onChange:t=>A(t.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"screenshot",children:"Optional screenshot"}),e.jsx(R,{id:"screenshot",type:"file",accept:"image/*",onChange:O}),N&&e.jsx("p",{className:"text-xs text-muted-foreground",children:"Screenshot attached"})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(se,{id:"consent",checked:h,onCheckedChange:t=>$(!!t)}),e.jsx(r,{htmlFor:"consent",className:"text-sm font-normal leading-relaxed",children:"Include diagnostics (platform, route, connectivity state, queue depth, recent error fingerprints)"})]}),e.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row",children:[e.jsxs(x,{type:"submit",disabled:B,children:[e.jsx(W,{className:"mr-2 h-4 w-4"}),B?"Submitting...":"Submit report"]}),e.jsx(x,{type:"button",variant:"outline",asChild:!0,children:e.jsxs("a",{href:E,children:[e.jsx(J,{className:"mr-2 h-4 w-4"}),"Email support"]})})]})]})})]})]})})]})}export{ce as default};
