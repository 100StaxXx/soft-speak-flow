import{r as c,ax as K,j as e,m as D,K as re,cl as De,b6 as Ee,c5 as oe,aa as pe,b_ as qe,cS as Be,dT as Ye,dU as Ue,bt as Re,bG as We,cX as Ge,b0 as fe,W as Le,br as we,aj as Ae,aQ as Me,ah as Qe,b9 as Je,dV as Xe,X as Ce,bY as Ve,cV as Ke,ba as He,cQ as Ze,U as Pe,cq as ze,bI as et,ag as ue,af as tt,b4 as st,l as Fe,b1 as at,aW as rt,aw as nt,cg as it,cZ as ke,dE as lt,co as ct}from"./vendor-DK8VKJIv.js";import{c as ot,az as dt,s as P,B as E,K as R,a9 as ut,C as Ne,b8 as mt,b9 as ht,ba as xt,L as xe,a as ae,ar as pt,bb as ft,bc as gt,bd as yt,be as bt,bf as jt,$ as vt,a0 as Nt}from"./index-vNUnYBjj.js";import{o as wt}from"./date-vendor-BRrA_NVo.js";import"./three-vendor-qI8GXUTd.js";const Se={energyLevel:"medium",flexTimeHours:6,hardCommitments:[],protectedHabitIds:[],prioritizedEpicIds:[],selectedContactIds:[],includeRelationshipTasks:!0,dayShape:"auto"};function kt(t=new Date){const{user:s}=ot(),{success:d,medium:h}=dt(),[n,l]=c.useState("quick_start"),[r,f]=c.useState(Se),[i,b]=c.useState(null),[v,N]=c.useState(null),[L,S]=c.useState([]),[z,a]=c.useState([]),[u,p]=c.useState([]),[C,O]=c.useState([]),[_,$]=c.useState(!1),[F,y]=c.useState(!1),[k,Q]=c.useState(!1),[B,ee]=c.useState(!1),[ne,Y]=c.useState(null),M=wt(t,"yyyy-MM-dd"),ie=c.useCallback(async()=>{if(s?.id)try{const{data:o,error:x}=await P.from("habits").select("id, title, current_streak, preferred_time, category").eq("user_id",s.id).eq("is_active",!0).gte("current_streak",3).order("current_streak",{ascending:!1});if(x)throw x;S((o||[]).map(m=>({id:m.id,name:m.title,streak:m.current_streak||0,preferredTime:m.preferred_time,category:m.category})))}catch(o){console.error("Error fetching habits with streaks:",o)}},[s?.id]),le=c.useCallback(async()=>{if(s?.id)try{const{data:o,error:x}=await P.from("epic_milestones").select(`
          id,
          title,
          target_date,
          milestone_percent,
          epic_id,
          epics!inner(id, title)
        `).eq("user_id",s.id).is("completed_at",null).order("target_date",{ascending:!0}).limit(10);if(x)throw x;a((o||[]).map(m=>({id:m.id,title:m.title,epicTitle:m.epics?.title||"Unknown Epic",epicId:m.epic_id,dueDate:m.target_date,milestonePercent:m.milestone_percent})))}catch(o){console.error("Error fetching milestones:",o)}},[s?.id]),te=c.useCallback(async()=>{if(s?.id)try{const{data:o,error:x}=await P.from("daily_tasks").select("id, task_text, scheduled_time, is_anchor, epic_id").eq("user_id",s.id).eq("task_date",M).eq("completed",!1).order("scheduled_time",{ascending:!0});if(x)throw x;p((o||[]).map(m=>({id:m.id,title:m.task_text,scheduledTime:m.scheduled_time,isAnchor:m.is_anchor,epicId:m.epic_id})))}catch(o){console.error("Error fetching existing tasks:",o)}},[s?.id,M]),J=c.useCallback(async()=>{if(!s?.id)return;const o=v?.coldContactThresholdDays||14,x=new Date;x.setDate(x.getDate()-o);try{const{data:m}=await P.from("contact_reminders").select("contact_id, reason, contacts!inner(id, name, avatar_url)").eq("user_id",s.id).eq("sent",!1).lt("reminder_at",new Date().toISOString()),{data:q}=await P.from("contacts").select("id, name, avatar_url").eq("user_id",s.id),{data:G}=await P.from("contact_interactions").select("contact_id, occurred_at").eq("user_id",s.id).order("occurred_at",{ascending:!1}),T=new Map;(G||[]).forEach(A=>{T.has(A.contact_id)||T.set(A.contact_id,A.occurred_at)});const H=new Map;(m||[]).forEach(A=>{H.set(A.contact_id,A.reason||"Follow-up overdue")});const de=[];(q||[]).forEach(A=>{const ce=T.get(A.id),Te=H.has(A.id);let ve=999;if(ce){const $e=new Date(ce);ve=Math.floor((Date.now()-$e.getTime())/(1e3*60*60*24))}(Te||ve>=o)&&de.push({id:A.id,name:A.name,avatarUrl:A.avatar_url,daysSinceContact:ve,hasOverdueReminder:Te,reminderReason:H.get(A.id)||null})}),de.sort((A,ce)=>A.hasOverdueReminder&&!ce.hasOverdueReminder?-1:!A.hasOverdueReminder&&ce.hasOverdueReminder?1:ce.daysSinceContact-A.daysSinceContact),O(de)}catch(m){console.error("Error fetching contacts needing attention:",m)}},[s?.id,v?.coldContactThresholdDays]),U=c.useCallback(async()=>{y(!0);try{await Promise.all([ie(),le(),te(),J()])}finally{y(!1)}},[ie,le,te,J]);c.useEffect(()=>{n==="anchors"&&U()},[n,U]);const se=c.useCallback(async()=>{if(s?.id){$(!0);try{const{data:o,error:x}=await P.from("daily_planning_preferences").select("*").eq("user_id",s.id).maybeSingle();if(x)throw x;o?(N({defaultEnergyLevel:o.default_energy_level||"medium",defaultFlexHours:o.default_flex_hours||6,defaultDayShape:o.default_day_shape||"auto",autoProtectStreaks:o.auto_protect_streaks??!0,includeRelationshipTasks:o.include_relationship_tasks??!0,coldContactThresholdDays:o.cold_contact_threshold_days||14,relationshipTasksCount:o.relationship_tasks_count||2,timesUsed:o.times_used||0}),l("quick_start")):(l("check_in"),N(null))}catch(o){console.error("Error loading preferences:",o),l("check_in")}finally{$(!1)}}},[s?.id]),X=c.useCallback(async()=>{if(s?.id)try{const{error:o}=await P.from("daily_planning_preferences").upsert({user_id:s.id,default_energy_level:r.energyLevel,default_flex_hours:r.flexTimeHours,default_day_shape:r.dayShape,include_relationship_tasks:r.includeRelationshipTasks,times_used:(v?.timesUsed||0)+1,last_used_at:new Date().toISOString()},{onConflict:"user_id"});if(o)throw o;K.success("Settings saved for faster planning!")}catch(o){console.error("Error saving preferences:",o)}},[s?.id,r,v]),ge=c.useCallback(async()=>{if(s?.id)try{await P.from("daily_planning_preferences").delete().eq("user_id",s.id),N(null),l("check_in"),K.success("Preferences reset")}catch(o){console.error("Error resetting preferences:",o)}},[s?.id]),ye=c.useCallback(async()=>{if(v){if(f(o=>({...o,energyLevel:v.defaultEnergyLevel,flexTimeHours:v.defaultFlexHours,dayShape:v.defaultDayShape,includeRelationshipTasks:v.includeRelationshipTasks})),s?.id)try{await P.from("daily_planning_preferences").update({times_used:(v.timesUsed||0)+1,last_used_at:new Date().toISOString()}).eq("user_id",s.id)}catch(o){console.warn("Failed to update usage count:",o)}h(),l("anchors")}},[v,s?.id,h]),he=c.useCallback(o=>{f(x=>({...x,...o}))},[]),be=c.useCallback(()=>{h();const o=["quick_start","check_in","anchors","shape","customize","review"],x=o.indexOf(n);x<o.length-1&&l(o[x+1])},[n,h]),je=c.useCallback(()=>{h();const o=["quick_start","check_in","anchors","shape","customize","review"],x=o.indexOf(n);x>0&&l(o[x-1])},[n,h]),g=c.useCallback(async()=>{if(!s?.id)return null;Q(!0),Y(null);try{const o=C.filter(T=>r.selectedContactIds.includes(T.id)).map(T=>({id:T.id,name:T.name,reason:T.hasOverdueReminder?"overdue":"going_cold",daysSinceContact:T.daysSinceContact,reminderReason:T.reminderReason})),{data:x,error:m}=await P.functions.invoke("generate-smart-daily-plan",{body:{planDate:M,energyLevel:r.energyLevel,flexTimeHours:r.flexTimeHours,hardCommitments:r.hardCommitments,protectedHabitIds:r.protectedHabitIds,prioritizedEpicIds:r.prioritizedEpicIds,dayShape:r.dayShape,contactsNeedingAttention:r.includeRelationshipTasks?o:[],adjustmentRequest:r.adjustmentRequest}});if(m)throw m;const G={tasks:(x.tasks||[]).map((T,H)=>({...T,id:`temp-${H}-${Date.now()}`})),insights:x.insights||[],totalHours:x.totalHours||0,balanceScore:x.balanceScore||0,dayShape:x.dayShape||r.dayShape};return b(G),f(T=>({...T,adjustmentRequest:void 0})),d(),G}catch(o){return console.error("Error generating plan:",o),Y(o.message||"Failed to build plan"),K.error("Failed to build your day plan"),null}finally{Q(!1)}},[s?.id,M,r,d]),w=c.useCallback(async o=>{if(!s?.id||!i)return null;ee(!0),Y(null);try{const x=C.filter(H=>r.selectedContactIds.includes(H.id)).map(H=>({id:H.id,name:H.name,reason:H.hasOverdueReminder?"overdue":"going_cold"})),{data:m,error:q}=await P.functions.invoke("generate-smart-daily-plan",{body:{planDate:M,energyLevel:r.energyLevel,flexTimeHours:r.flexTimeHours,hardCommitments:r.hardCommitments,protectedHabitIds:r.protectedHabitIds,prioritizedEpicIds:r.prioritizedEpicIds,dayShape:r.dayShape,contactsNeedingAttention:r.includeRelationshipTasks?x:[],adjustmentRequest:o,previousPlan:i}});if(q)throw q;const T={tasks:(m.tasks||[]).map((H,de)=>({...H,id:`temp-${de}-${Date.now()}`})),insights:m.insights||[],totalHours:m.totalHours||0,balanceScore:m.balanceScore||0,dayShape:m.dayShape||r.dayShape};return b(T),d(),K.success("Plan adjusted!"),T}catch(x){return console.error("Error adjusting plan:",x),Y(x.message||"Failed to adjust plan"),K.error("Failed to adjust your plan"),null}finally{ee(!1)}},[s?.id,M,r,i,d]),j=c.useCallback(async()=>{if(!s?.id||!i)return!1;try{const o=i.tasks.map(m=>({user_id:s.id,task_date:M,task_text:m.title,scheduled_time:m.scheduledTime,estimated_duration:m.estimatedDuration,priority:m.priority,category:m.category,block_type:m.blockType,is_anchor:m.isAnchor||!1,epic_id:m.epicId,contact_id:m.contactId,ai_generated:!0,source:"smart_planner",xp_reward:m.priority==="high"?30:m.priority==="medium"?20:10})),{error:x}=await P.from("daily_tasks").insert(o);if(x)throw x;return await P.from("daily_plan_sessions").insert([{user_id:s.id,plan_date:M,energy_level:r.energyLevel,flex_time_hours:r.flexTimeHours,protected_habits:JSON.parse(JSON.stringify(r.protectedHabitIds)),protected_epics:JSON.parse(JSON.stringify(r.prioritizedEpicIds)),day_shape:r.dayShape,generation_context:JSON.parse(JSON.stringify(r)),tasks_generated:i.tasks.length}]),P.functions.invoke("analyze-user-patterns",{body:{type:"plan_saved",data:{energyLevel:r.energyLevel,dayShape:i.dayShape,taskCount:i.tasks.length,tasks:i.tasks.map(m=>({title:m.title,category:m.category,priority:m.priority,scheduledTime:m.scheduledTime})),hour:new Date().getHours(),dayOfWeek:new Date().getDay()}}}).catch(m=>{console.warn("Failed to send plan learning feedback:",m)}),d(),K.success("Day planned! May your quests be legendary âš”ï¸"),!0}catch(o){return console.error("Error saving plan:",o),K.error("Failed to save your plan"),!1}},[s?.id,M,i,r,d]),I=c.useCallback((o,x)=>{b(m=>{if(!m)return m;const q=[...m.tasks];q[o]={...q[o],...x};const G=q.reduce((T,H)=>T+H.estimatedDuration/60,0);return{...m,tasks:q,totalHours:G}})},[]),W=c.useCallback(o=>{b(x=>{if(!x)return x;const m=x.tasks.filter((G,T)=>T!==o),q=m.reduce((G,T)=>G+T.estimatedDuration/60,0);return{...x,tasks:m,totalHours:q}})},[]),V=c.useCallback(o=>{b(x=>x&&{...x,tasks:o})},[]),Oe=c.useCallback(()=>{l("quick_start"),f(Se),b(null),Y(null)},[]);return{step:n,context:r,generatedPlan:i,savedPreferences:v,habitsWithStreaks:L,upcomingMilestones:z,existingTasks:u,contactsNeedingAttention:C,setStep:l,updateContext:he,nextStep:be,prevStep:je,generatePlan:g,adjustPlan:w,savePlan:j,savePreferences:X,reset:Oe,loadAnchors:U,loadPreferences:se,resetPreferences:ge,applyDefaults:ye,updateTaskInPlan:I,removeTaskFromPlan:W,reorderTasksInPlan:V,isLoadingPreferences:_,isLoadingAnchors:F,isGenerating:k,isAdjusting:B,error:ne,planDate:t,dateStr:M}}function Ct({savedPreferences:t,contactsNeedingAttentionCount:s,onUseDefaults:d,onCustomize:h,onReset:n}){if(!t)return null;const l=t.defaultEnergyLevel==="high"?"High Energy":t.defaultEnergyLevel==="low"?"Low Energy":"Medium Energy",r=t.defaultDayShape==="front_load"?"Power Morning":t.defaultDayShape==="back_load"?"Late Bloomer":t.defaultDayShape==="spread"?"Steady Pace":"Smart Auto";return e.jsxs("div",{className:"space-y-4",children:[e.jsxs(D.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"text-center mb-4",children:[e.jsx("div",{className:"h-12 w-12 rounded-full bg-primary/20 flex items-center justify-center mx-auto mb-3",children:e.jsx(re,{className:"h-6 w-6 text-primary"})}),e.jsx("h3",{className:"text-lg font-semibold text-foreground",children:"Welcome Back!"}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:["Used ",t.timesUsed," time",t.timesUsed!==1?"s":""]})]}),s>0&&t.includeRelationshipTasks&&e.jsxs(D.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{delay:.05},className:"flex items-center gap-3 p-3 rounded-xl bg-amber-500/10 border border-amber-500/30",children:[e.jsx("div",{className:"h-8 w-8 rounded-full bg-amber-500/20 flex items-center justify-center",children:e.jsx(De,{className:"h-4 w-4 text-amber-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("p",{className:"text-sm font-medium text-foreground",children:[s," contact",s!==1?"s":""," need attention"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Follow-ups overdue or going cold"})]})]}),e.jsxs(D.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{delay:.1},className:"p-4 rounded-xl bg-muted/50 border border-border/50",children:[e.jsx("p",{className:"text-xs font-medium text-muted-foreground mb-3",children:"Your saved settings:"}),e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"h-8 w-8 rounded-full bg-background flex items-center justify-center mx-auto mb-1",children:e.jsx(Ee,{className:"h-4 w-4 text-primary"})}),e.jsx("span",{className:"text-xs font-medium text-foreground",children:l})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"h-8 w-8 rounded-full bg-background flex items-center justify-center mx-auto mb-1",children:e.jsx(oe,{className:"h-4 w-4 text-primary"})}),e.jsxs("span",{className:"text-xs font-medium text-foreground",children:[t.defaultFlexHours,"h flex"]})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"h-8 w-8 rounded-full bg-background flex items-center justify-center mx-auto mb-1",children:e.jsx(pe,{className:"h-4 w-4 text-primary"})}),e.jsx("span",{className:"text-xs font-medium text-foreground",children:r})]})]})]}),e.jsxs("div",{className:"space-y-2 pt-2",children:[e.jsxs(E,{onClick:d,className:"w-full",size:"lg",children:[e.jsx(pe,{className:"h-4 w-4 mr-2"}),"Use My Defaults"]}),e.jsxs(E,{onClick:h,variant:"outline",className:"w-full",size:"lg",children:[e.jsx(qe,{className:"h-4 w-4 mr-2"}),"Customize Today"]})]}),e.jsxs(D.button,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.3},onClick:n,className:"flex items-center justify-center gap-1.5 w-full text-xs text-muted-foreground hover:text-foreground transition-colors py-2",children:[e.jsx(Be,{className:"h-3 w-3"}),"Reset Preferences"]})]})}const Tt=[{value:"low",label:"Low",icon:Ye,description:"Taking it easy today"},{value:"medium",label:"Medium",icon:Ee,description:"Ready for a balanced day"},{value:"high",label:"High",icon:Ue,description:"Feeling energized!"}],St=[{value:2,label:"2h",description:"Packed day"},{value:4,label:"4h",description:"Some flexibility"},{value:6,label:"6h",description:"Good flexibility"},{value:8,label:"8h",description:"Wide open"},{value:10,label:"10h+",description:"Maximum flex"}];function _t({context:t,updateContext:s,onNext:d}){const h=r=>{s({energyLevel:r})},n=r=>{s({flexTimeHours:r[0]})},l=()=>St.find(f=>t.flexTimeHours<=f.value)?.description||"Maximum flex";return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"text-sm font-medium text-foreground flex items-center gap-2",children:[e.jsx(pe,{className:"h-4 w-4 text-primary"}),"Energy Level"]}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:Tt.map((r,f)=>{const i=r.icon,b=t.energyLevel===r.value;return e.jsxs(D.button,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:f*.05},onClick:()=>h(r.value),className:R("p-3 rounded-xl border-2 transition-all duration-200","flex flex-col items-center gap-1.5 text-center",b?"border-primary bg-primary/10 text-primary":"border-border hover:border-primary/50 text-muted-foreground hover:text-foreground"),children:[e.jsx(i,{className:R("h-6 w-6",b?"text-primary":"text-muted-foreground")}),e.jsx("span",{className:"text-sm font-medium",children:r.label}),e.jsx("span",{className:"text-[10px] opacity-70",children:r.description})]},r.value)})})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"text-sm font-medium text-foreground flex items-center gap-2",children:[e.jsx(oe,{className:"h-4 w-4 text-primary"}),"Available Flex Time"]}),e.jsxs("div",{className:"px-2",children:[e.jsx(ut,{value:[t.flexTimeHours],onValueChange:n,min:2,max:10,step:1,className:"w-full"}),e.jsxs("div",{className:"flex justify-between mt-2",children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"2h"}),e.jsxs("span",{className:"text-sm font-medium text-primary",children:[t.flexTimeHours,"h - ",l()]}),e.jsx("span",{className:"text-xs text-muted-foreground",children:"10h+"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 pt-2",children:[e.jsxs(D.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{delay:.2},className:"p-3 rounded-lg bg-muted/50 border border-border/50",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(Re,{className:"h-4 w-4 text-amber-500"}),e.jsx("span",{className:"text-xs font-medium text-foreground",children:"Today"})]}),e.jsxs("p",{className:"text-[10px] text-muted-foreground",children:["We'll optimize for your ",t.energyLevel," energy"]})]}),e.jsxs(D.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{delay:.25},className:"p-3 rounded-lg bg-muted/50 border border-border/50",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(We,{className:"h-4 w-4 text-orange-500"}),e.jsx("span",{className:"text-xs font-medium text-foreground",children:"Schedule"})]}),e.jsxs("p",{className:"text-[10px] text-muted-foreground",children:[t.flexTimeHours,"h of flexible time to plan"]})]})]}),e.jsx(E,{onClick:d,className:"w-full mt-4",size:"lg",children:"Continue"})]})}function It({context:t,updateContext:s,habitsWithStreaks:d,upcomingMilestones:h,existingTasks:n,contactsNeedingAttention:l,isLoading:r,onNext:f}){const i=a=>{const u=t.protectedHabitIds,p=u.includes(a)?u.filter(C=>C!==a):[...u,a];s({protectedHabitIds:p})},b=a=>{const u=t.prioritizedEpicIds,p=u.includes(a)?u.filter(C=>C!==a):[...u,a];s({prioritizedEpicIds:p})},v=a=>{const u=t.selectedContactIds,p=u.includes(a)?u.filter(C=>C!==a):[...u,a];s({selectedContactIds:p})},N=()=>{s({protectedHabitIds:d.map(a=>a.id)})},L=()=>{s({selectedContactIds:l.map(a=>a.id)})},S=Ge.useMemo(()=>{const a=new Map;return h.forEach(u=>{const p=a.get(u.epicId);p?p.milestoneCount++:a.set(u.epicId,{id:u.epicId,title:u.epicTitle,milestoneCount:1})}),Array.from(a.values())},[h]);if(r)return e.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[e.jsx(fe,{className:"h-8 w-8 animate-spin text-primary mb-3"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Detecting your anchors..."})]});const z=d.length===0&&S.length===0&&l.length===0;return e.jsxs("div",{className:"space-y-5",children:[z?e.jsxs(D.div,{initial:{opacity:0},animate:{opacity:1},className:"text-center py-8",children:[e.jsx(re,{className:"h-10 w-10 text-primary/50 mx-auto mb-3"}),e.jsx("h3",{className:"font-medium text-foreground mb-1",children:"Fresh Start!"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"No active streaks, milestones, or contacts needing attention. We'll create a balanced plan for you."})]}):e.jsxs(e.Fragment,{children:[l.length>0&&t.includeRelationshipTasks&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("label",{className:"text-sm font-medium text-foreground flex items-center gap-2",children:[e.jsx(De,{className:"h-4 w-4 text-amber-500"}),"Relationships"]}),l.length>1&&e.jsx("button",{onClick:L,className:"text-xs text-primary hover:underline",children:"Select all"})]}),e.jsx("div",{className:"space-y-2",children:l.slice(0,5).map((a,u)=>{const p=t.selectedContactIds.includes(a.id),C=a.name.split(" ").map(O=>O[0]).join("").toUpperCase().slice(0,2);return e.jsxs(D.div,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},transition:{delay:u*.05},onClick:()=>v(a.id),className:R("flex items-center gap-3 p-3 rounded-lg border cursor-pointer transition-all",p?"border-amber-500/50 bg-amber-500/10":"border-border hover:border-amber-500/30"),children:[e.jsx(Ne,{checked:p,onCheckedChange:()=>v(a.id),className:"border-amber-500 data-[state=checked]:bg-amber-500"}),e.jsxs(mt,{className:"h-8 w-8",children:[e.jsx(ht,{src:a.avatarUrl||void 0}),e.jsx(xt,{className:"bg-amber-500/10 text-amber-600 text-xs",children:C})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-foreground truncate",children:a.name}),e.jsx("p",{className:"text-xs text-muted-foreground flex items-center gap-1",children:a.hasOverdueReminder?e.jsxs(e.Fragment,{children:[e.jsx(Le,{className:"h-3 w-3 text-amber-500"}),a.reminderReason||"Follow-up overdue"]}):e.jsxs(e.Fragment,{children:[e.jsx(oe,{className:"h-3 w-3"}),a.daysSinceContact," days since contact"]})})]})]},a.id)})}),l.length>5&&e.jsxs("p",{className:"text-xs text-muted-foreground text-center",children:["+",l.length-5," more contacts need attention"]})]}),d.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("label",{className:"text-sm font-medium text-foreground flex items-center gap-2",children:[e.jsx(we,{className:"h-4 w-4 text-orange-500"}),"Protect These Streaks"]}),d.length>1&&e.jsx("button",{onClick:N,className:"text-xs text-primary hover:underline",children:"Select all"})]}),e.jsx("div",{className:"space-y-2",children:d.map((a,u)=>{const p=t.protectedHabitIds.includes(a.id);return e.jsxs(D.div,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},transition:{delay:u*.05},onClick:()=>i(a.id),className:R("flex items-center gap-3 p-3 rounded-lg border cursor-pointer transition-all",p?"border-orange-500/50 bg-orange-500/10":"border-border hover:border-orange-500/30"),children:[e.jsx(Ne,{checked:p,onCheckedChange:()=>i(a.id),className:"border-orange-500 data-[state=checked]:bg-orange-500"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-foreground truncate",children:a.name}),a.preferredTime&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Usually at ",a.preferredTime]})]}),e.jsxs("div",{className:"flex items-center gap-1 text-orange-500",children:[e.jsx(we,{className:"h-3.5 w-3.5"}),e.jsx("span",{className:"text-sm font-bold",children:a.streak})]})]},a.id)})})]}),S.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-sm font-medium text-foreground flex items-center gap-2",children:[e.jsx(Ae,{className:"h-4 w-4 text-primary"}),"Epic Priorities"]}),e.jsx("div",{className:"space-y-2",children:S.map((a,u)=>{const p=t.prioritizedEpicIds.includes(a.id);return e.jsxs(D.div,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},transition:{delay:.1+u*.05},onClick:()=>b(a.id),className:R("flex items-center gap-3 p-3 rounded-lg border cursor-pointer transition-all",p?"border-primary/50 bg-primary/10":"border-border hover:border-primary/30"),children:[e.jsx(Ne,{checked:p,onCheckedChange:()=>b(a.id)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-foreground truncate",children:a.title}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[a.milestoneCount," milestone",a.milestoneCount>1?"s":""," upcoming"]})]})]},a.id)})})]})]}),n.length>0&&e.jsxs(D.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.2},className:"flex items-center gap-2 p-3 rounded-lg bg-muted/50 border border-border/50",children:[e.jsx(Me,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[n.length," existing task",n.length>1?"s":""," will be preserved"]})]}),(t.protectedHabitIds.length>0||t.prioritizedEpicIds.length>0||t.selectedContactIds.length>0)&&e.jsxs(D.div,{initial:{opacity:0,y:5},animate:{opacity:1,y:0},className:"flex items-center gap-2 p-2 rounded-lg bg-primary/5 border border-primary/20",children:[e.jsx(Qe,{className:"h-4 w-4 text-primary"}),e.jsxs("p",{className:"text-xs text-primary",children:[t.protectedHabitIds.length>0&&`${t.protectedHabitIds.length} streak${t.protectedHabitIds.length!==1?"s":""}`,t.prioritizedEpicIds.length>0&&`${t.protectedHabitIds.length>0?" + ":""}${t.prioritizedEpicIds.length} epic${t.prioritizedEpicIds.length!==1?"s":""}`,t.selectedContactIds.length>0&&`${t.protectedHabitIds.length>0||t.prioritizedEpicIds.length>0?" + ":""}${t.selectedContactIds.length} contact${t.selectedContactIds.length!==1?"s":""}`]})]}),e.jsx(E,{onClick:f,className:"w-full mt-4",size:"lg",children:"Continue"})]})}const Dt=[{value:"front_load",label:"Power Morning",description:"Heavy work early, coast later",icon:Je,curve:[90,80,60,40,30,20]},{value:"spread",label:"Steady Pace",description:"Even distribution throughout",icon:Re,curve:[50,60,55,60,50,45]},{value:"back_load",label:"Late Bloomer",description:"Light start, heavy afternoon",icon:Xe,curve:[20,30,40,60,80,90]},{value:"auto",label:"Smart Auto",description:"Chooses based on your data",icon:re,curve:[40,70,50,60,75,35]}];function Et({heights:t,isSelected:s}){const n=t.map((f,i)=>({x:i/(t.length-1)*100,y:40-f/100*40})),l=n.reduce((f,i,b)=>{if(b===0)return`M ${i.x} ${i.y}`;const v=n[b-1],N=(v.x+i.x)/2;return`${f} Q ${N} ${v.y} ${N} ${(v.y+i.y)/2} Q ${N} ${i.y} ${i.x} ${i.y}`},""),r=`${l} L 100 40 L 0 40 Z`;return e.jsxs("svg",{viewBox:"0 0 100 40",className:"w-full h-10",children:[e.jsx("path",{d:r,className:R("transition-all duration-300",s?"fill-primary/20":"fill-muted/30")}),e.jsx("path",{d:l,fill:"none",strokeWidth:2,strokeLinecap:"round",className:R("transition-all duration-300",s?"stroke-primary":"stroke-muted-foreground/50")}),n.map((f,i)=>e.jsx("circle",{cx:f.x,cy:f.y,r:2,className:R("transition-all duration-300",s?"fill-primary":"fill-muted-foreground/50")},i))]})}function Rt({context:t,updateContext:s,onNext:d,isGenerating:h}){const n=l=>{s({dayShape:l})};return e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground text-center mb-4",children:"How should we distribute your tasks throughout the day?"}),e.jsx("div",{className:"grid grid-cols-2 gap-3",children:Dt.map((l,r)=>{const f=l.icon,i=t.dayShape===l.value;return e.jsxs(D.button,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:r*.05},onClick:()=>n(l.value),className:R("p-3 rounded-xl border-2 transition-all duration-200 text-left",i?"border-primary bg-primary/5":"border-border hover:border-primary/50"),children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:R("h-7 w-7 rounded-full flex items-center justify-center",i?"bg-primary/20":"bg-muted"),children:e.jsx(f,{className:R("h-4 w-4",i?"text-primary":"text-muted-foreground")})}),e.jsx("span",{className:R("text-sm font-medium",i?"text-foreground":"text-muted-foreground"),children:l.label})]}),e.jsx(Et,{heights:l.curve,isSelected:i}),e.jsx("p",{className:"text-[10px] text-muted-foreground mt-2",children:l.description})]},l.value)})}),e.jsxs("div",{className:"flex justify-between px-2 mt-1",children:[e.jsx("span",{className:"text-[10px] text-muted-foreground",children:"Morning"}),e.jsx("span",{className:"text-[10px] text-muted-foreground",children:"Midday"}),e.jsx("span",{className:"text-[10px] text-muted-foreground",children:"Evening"})]}),e.jsx(D.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.2},className:"p-3 rounded-lg bg-muted/50 border border-border/50 mt-4",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(re,{className:"h-4 w-4 text-primary mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-foreground",children:"What happens next"}),e.jsx("p",{className:"text-[10px] text-muted-foreground mt-0.5",children:"Next, you can add blocked time slots and special requests before we build your plan."})]})]})}),e.jsx(E,{onClick:d,className:"w-full mt-4",size:"lg",children:"Continue"})]})}function Lt({context:t,updateContext:s,onNext:d,isGenerating:h}){const[n,l]=c.useState(!1),[r,f]=c.useState({title:"",startTime:"14:00",endTime:"15:00"}),i=a=>{const[u,p]=a.split(":").map(Number);return u*60+(p||0)},b=()=>{if(!r.title||!r.startTime||!r.endTime)return;const a=i(r.startTime);if(i(r.endTime)<=a){K.error("End time must be after start time");return}const p={id:`custom-${Date.now()}`,title:r.title,startTime:r.startTime,endTime:r.endTime};s({hardCommitments:[...t.hardCommitments,p]}),f({title:"",startTime:"14:00",endTime:"15:00"}),l(!1)},v=a=>{s({hardCommitments:t.hardCommitments.filter(u=>u.id!==a)})},N=a=>{s({adjustmentRequest:a})},L=a=>{if(!a||!a.includes(":"))return a;const[u,p]=a.split(":").map(Number);if(isNaN(u)||isNaN(p))return a;const C=u>=12?"PM":"AM";return`${u%12||12}:${p.toString().padStart(2,"0")} ${C}`},S=[{label:"30 min",minutes:30},{label:"1 hour",minutes:60},{label:"2 hours",minutes:120}],z=a=>{const[u,p]=r.startTime.split(":").map(Number),O=u*60+p+a,_=Math.floor(O/60),$=O%60;f(F=>({...F,endTime:`${_.toString().padStart(2,"0")}:${$.toString().padStart(2,"0")}`}))};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(oe,{className:"h-4 w-4 text-primary"}),e.jsx(xe,{className:"text-sm font-medium",children:"Block Time"})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Block off times for meetings, appointments, or focus time"}),t.hardCommitments.length>0&&e.jsx("div",{className:"space-y-2",children:t.hardCommitments.map(a=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-muted/50 rounded-lg border border-border/50",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Me,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:a.title}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[L(a.startTime)," â€“ ",L(a.endTime)]})]})]}),!a.isImported&&e.jsx(E,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:()=>v(a.id),children:e.jsx(Ce,{className:"h-4 w-4"})})]},a.id))}),n?e.jsxs("div",{className:"p-4 bg-muted/30 rounded-lg border border-border/50 space-y-4",children:[e.jsx(ae,{placeholder:"Event title (e.g., Doctor appointment)",value:r.title,onChange:a=>f(u=>({...u,title:a.target.value})),className:"bg-background"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(xe,{className:"text-xs text-muted-foreground",children:"Start"}),e.jsx(ae,{type:"time",value:r.startTime,onChange:a=>f(u=>({...u,startTime:a.target.value})),className:"bg-background"})]}),e.jsx("span",{className:"text-muted-foreground mt-5",children:"â€“"}),e.jsxs("div",{className:"flex-1",children:[e.jsx(xe,{className:"text-xs text-muted-foreground",children:"End"}),e.jsx(ae,{type:"time",value:r.endTime,onChange:a=>f(u=>({...u,endTime:a.target.value})),className:"bg-background"})]})]}),e.jsx("div",{className:"flex gap-2",children:S.map(({label:a,minutes:u})=>e.jsx(E,{type:"button",variant:"outline",size:"sm",className:"flex-1 text-xs",onClick:()=>z(u),children:a},u))}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(E,{variant:"outline",size:"sm",className:"flex-1",onClick:()=>l(!1),children:"Cancel"}),e.jsx(E,{size:"sm",className:"flex-1",onClick:b,disabled:!r.title,children:"Add Block"})]})]}):e.jsxs(E,{variant:"outline",className:"w-full justify-start gap-2",onClick:()=>l(!0),children:[e.jsx(Ve,{className:"h-4 w-4"}),"Add blocked time"]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ke,{className:"h-4 w-4 text-primary"}),e.jsx(xe,{className:"text-sm font-medium",children:"Special Requests"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:"(optional)"})]}),e.jsx(pt,{placeholder:"e.g., Make sure to call mom, need time for the gym, important email to send...",value:t.adjustmentRequest||"",onChange:a=>N(a.target.value),className:"min-h-[80px] resize-none",maxLength:500}),e.jsxs("div",{className:"flex justify-between text-xs text-muted-foreground",children:[e.jsx("span",{children:"Tell us anything we should know about your day"}),e.jsxs("span",{children:[(t.adjustmentRequest||"").length,"/500"]})]})]}),e.jsxs("div",{className:"pt-4",children:[e.jsx(E,{onClick:d,className:"w-full gap-2",disabled:h,children:h?e.jsxs(e.Fragment,{children:[e.jsx(re,{className:"h-4 w-4 animate-pulse"}),"Building your plan..."]}):e.jsxs(e.Fragment,{children:[e.jsx(re,{className:"h-4 w-4"}),"Build My Plan"]})}),t.hardCommitments.length===0&&!t.adjustmentRequest&&e.jsx("p",{className:"text-xs text-center text-muted-foreground mt-2",children:"You can skip this step if you don't have any constraints"})]})]})}function _e({task:t,index:s,isEditMode:d,onUpdate:h,onRemove:n,dragHandleProps:l,hasConflict:r,conflictDetails:f}){const[i,b]=c.useState(!1),[v,N]=c.useState(t.title),[L,S]=c.useState(t.scheduledTime),[z,a]=c.useState(t.estimatedDuration.toString()),u={high:"border-l-red-500",medium:"border-l-amber-500",low:"border-l-green-500"},p=()=>{h(s,{title:v,scheduledTime:L,estimatedDuration:parseInt(z)||t.estimatedDuration}),b(!1)},C=()=>{N(t.title),S(t.scheduledTime),a(t.estimatedDuration.toString()),b(!1)},O=l?.isDragging??!1;return i?e.jsxs(D.div,{initial:{opacity:0},animate:{opacity:1},className:"p-3 rounded-lg bg-card border border-primary/50 space-y-2",children:[e.jsx(ae,{value:v,onChange:_=>N(_.target.value),className:"text-sm font-medium",autoFocus:!0}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"text-[10px] text-muted-foreground mb-1 block",children:"Time"}),e.jsx(ae,{type:"time",value:L,onChange:_=>S(_.target.value),className:"text-xs h-8"})]}),e.jsxs("div",{className:"w-20",children:[e.jsx("label",{className:"text-[10px] text-muted-foreground mb-1 block",children:"Mins"}),e.jsx(ae,{type:"number",value:z,onChange:_=>a(_.target.value),className:"text-xs h-8",min:"5",max:"240"})]})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsxs(E,{size:"sm",variant:"ghost",onClick:C,children:[e.jsx(Ce,{className:"h-3.5 w-3.5 mr-1"}),"Cancel"]}),e.jsxs(E,{size:"sm",onClick:p,children:[e.jsx(He,{className:"h-3.5 w-3.5 mr-1"}),"Save"]})]})]}):e.jsx(D.div,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},transition:{delay:s*.03},className:R("p-3 rounded-lg bg-card border border-border/50 border-l-4",r?"border-l-amber-500 bg-amber-500/5 ring-1 ring-amber-500/30":u[t.priority],O&&"shadow-lg scale-[1.02]"),children:e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[d&&e.jsx("div",{ref:l?.dragHandleRef,className:R("flex items-center gap-1 mr-1 touch-none cursor-grab active:cursor-grabbing",l?.isActivated&&"scale-110"),children:e.jsx(Ze,{className:"h-4 w-4 text-muted-foreground/50"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-foreground truncate",children:t.title}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsxs("span",{className:"text-[10px] text-muted-foreground flex items-center gap-1",children:[e.jsx(oe,{className:"h-3 w-3"}),t.scheduledTime," Â· ",t.estimatedDuration,"m"]}),r&&e.jsx(ft,{children:e.jsxs(gt,{children:[e.jsx(yt,{asChild:!0,children:e.jsxs("span",{className:"flex items-center gap-0.5 text-[10px] text-amber-600 dark:text-amber-400",children:[e.jsx(Pe,{className:"h-3 w-3"}),"Overlap"]})}),e.jsx(bt,{side:"top",className:"max-w-[200px] text-xs",children:f||"This task overlaps with another"})]})}),t.category&&e.jsx("span",{className:"text-[10px] px-1.5 py-0.5 rounded bg-muted text-muted-foreground",children:t.category})]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[t.isAnchor&&e.jsx(we,{className:"h-4 w-4 text-orange-500 flex-shrink-0"}),d&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>b(!0),className:"p-1.5 rounded-md hover:bg-muted transition-colors",children:e.jsx(ze,{className:"h-3.5 w-3.5 text-muted-foreground"})}),e.jsx("button",{onClick:()=>n(s),className:"p-1.5 rounded-md hover:bg-destructive/10 transition-colors",children:e.jsx(et,{className:"h-3.5 w-3.5 text-destructive"})})]})]})]})})}function Z(t){const[s,d]=t.split(":").map(Number);return s*60+(d||0)}function At(t){if(t.length<2)return 60;const s=[...t].sort((n,l)=>Z(n.scheduledTime)-Z(l.scheduledTime));let d=0,h=0;for(let n=0;n<s.length-1;n++){const l=Z(s[n].scheduledTime)+s[n].estimatedDuration,f=Z(s[n+1].scheduledTime)-l;f>0&&(d+=f,h++)}return h>0?d/h:60}function Mt(t){if(t.length<2)return[];const s=[...t].sort((h,n)=>Z(h.scheduledTime)-Z(n.scheduledTime)),d=[];for(let h=0;h<s.length-1;h++){const n=s[h],l=s[h+1],r=Z(n.scheduledTime)+n.estimatedDuration,f=Z(l.scheduledTime);if(r>f){const i=r-f;d.push({taskAId:n.id,taskBId:l.id,taskATitle:n.title,taskBTitle:l.title,overlapMinutes:i,suggestedFix:i<30?`Push "${l.title}" back by ${i} minutes`:`Shorten "${n.title}" or reschedule "${l.title}"`})}}return d}function Ht(t){const s=new Set;return t.forEach(d=>{s.add(d.taskAId),s.add(d.taskBId)}),s}function Pt(t){const s=t.some(i=>i.blockType==="health"||i.category?.toLowerCase().includes("workout")||i.category?.toLowerCase().includes("exercise")||i.title.toLowerCase().match(/workout|exercise|gym|run|yoga|stretch|fitness/)),d=t.some(i=>{const b=parseInt(i.scheduledTime.split(":")[0]);return b>=11&&b<=14&&(i.title.toLowerCase().includes("lunch")||i.title.toLowerCase().includes("eat")||i.blockType==="break")}),h=t.some(i=>i.estimatedDuration>=90&&(i.blockType==="focus"||i.priority==="high")),n=t.some(i=>i.blockType==="relationship"||i.category?.toLowerCase().includes("relationship")||i.title.toLowerCase().match(/call|meet|chat|catch up|coffee with|dinner with/)),l=t.filter(i=>i.priority==="high").length,r=At(t),f=Mt(t);return{hasWorkout:s,hasLunchBreak:d,hasDeepFocus:h,hasRelationshipTask:n,isOverloaded:l>4||t.length>10,needsMoreBreaks:r<15,totalTasks:t.length,averageGapMinutes:r,highPriorityCount:l,conflicts:f,hasConflicts:f.length>0}}function zt(t,s=!1){const d=[];return t.hasConflicts&&d.push({label:"Fix conflicts",prompt:"Fix all time conflicts - adjust task times so nothing overlaps. Maintain task order but add gaps between overlapping tasks.",priority:"high",icon:"âš ï¸"}),t.isOverloaded&&d.push({label:"Lighten load",prompt:"Reduce the number of tasks - move lower priority items to tomorrow or remove them. Focus on what truly matters today.",priority:"high",icon:"ðŸŽ¯"}),!t.hasLunchBreak&&t.totalTasks>3&&d.push({label:"Add lunch break",prompt:"Add a 45-minute lunch break around noon or 1pm",priority:"high",icon:"ðŸ½ï¸"}),t.needsMoreBreaks&&d.push({label:"More breaks",prompt:"Add more buffer time between tasks - at least 15-20 minutes between each",priority:"medium",icon:"â˜•"}),t.hasWorkout||d.push({label:"Add workout",prompt:"Add a 30-minute workout or exercise block",icon:"ðŸ’ª"}),!t.hasDeepFocus&&t.highPriorityCount>0&&d.push({label:"Add focus time",prompt:"Add a 90-minute deep focus block for important work without interruptions",icon:"ðŸŽ¯"}),!t.hasRelationshipTask&&s&&d.push({label:"Add catch-up",prompt:"Add a quick 15-minute catch-up call with a friend or family member",icon:"ðŸ‘‹"}),d.length<3&&d.push({label:"Shuffle times",prompt:"Rearrange the schedule to optimize energy levels - put high-priority tasks during peak hours",icon:"ðŸ”„"}),d.length<4&&d.push({label:"Push 1 hour",prompt:"Push all tasks back by 1 hour to give more morning flexibility",icon:"â°"}),d.slice(0,4)}const me=async t=>{try{await tt.impact({style:t})}catch{}},Ft=56,Ie=500,Ot=.6;function $t({tasks:t,onReorder:s,renderItem:d,disabled:h=!1,onDragStart:n,onDragEnd:l}){const r=c.useRef(null),f=c.useRef(new Map),[i,b]=c.useState(null),[v,N]=c.useState(t),[L,S]=c.useState({x:0,y:0}),[z,a]=c.useState(null),u=c.useRef(null),p=c.useRef(0),C=c.useRef(0),O=c.useRef(0),_=c.useRef(0),$=c.useRef(null),F=c.useRef(!1),y=c.useRef(null),k=c.useRef(t),Q=c.useRef(null),B=c.useRef(null),ee=c.useRef({x:0,y:0}),{updatePosition:ne,stopScroll:Y}=jt({containerRef:r,enabled:i!==null,edgeThreshold:80,scrollSpeed:8});c.useEffect(()=>{i||(N(t),k.current=t)},[t,i]);const M=c.useCallback(g=>{const w=g-p.current,j=Ft*Ot;let I=_.current;return w>j?I=_.current+1:w<-j&&(I=_.current-1),Math.max(0,Math.min(I,k.current.length-1))},[]),ie=c.useCallback(g=>{if(!u.current)return;C.current=g.clientY,ee.current={x:0,y:g.clientY-p.current},B.current||(B.current=requestAnimationFrame(()=>{S(ee.current),B.current=null})),ne(g.clientY);const w=M(g.clientY);if(w!==_.current){me(ue.Light);const j=[...k.current],[I]=j.splice(_.current,1);j.splice(w,0,I),k.current=j,_.current=w,Q.current=w,p.current=C.current,N(j)}},[M,ne]),le=c.useCallback(g=>{if(!u.current)return;g.preventDefault();const w=g.touches[0];if(!w)return;C.current=w.clientY,ee.current={x:0,y:w.clientY-p.current},B.current||(B.current=requestAnimationFrame(()=>{S(ee.current),B.current=null})),ne(w.clientY);const j=M(w.clientY);if(j!==_.current){me(ue.Light);const I=[...k.current],[W]=I.splice(_.current,1);I.splice(j,0,W),k.current=I,_.current=j,p.current=C.current,N(I)}},[M,ne]),te=c.useCallback(()=>{window.removeEventListener("pointermove",ie),window.removeEventListener("pointerup",U),window.removeEventListener("pointercancel",U),window.removeEventListener("touchmove",le),window.removeEventListener("touchend",J),window.removeEventListener("touchcancel",J)},[]),J=c.useCallback(()=>{const g=u.current;g&&(me(ue.Medium),s(k.current),l?.(),a(g),setTimeout(()=>a(null),300)),u.current=null,b(null),S({x:0,y:0}),F.current=!1,Q.current=null,Y(),te()},[s,l,Y,te]),U=c.useCallback(()=>{const g=u.current;g&&(me(ue.Medium),s(k.current),l?.(),a(g),setTimeout(()=>a(null),300)),u.current=null,b(null),S({x:0,y:0}),F.current=!1,Q.current=null,Y(),te()},[s,l,Y,te]),se=c.useCallback((g,w,j)=>{u.current=g,b(g),p.current=j,C.current=j,O.current=w,_.current=w,k.current=[...t],N([...t]),me(ue.Medium),n?.(g),window.addEventListener("pointermove",ie),window.addEventListener("pointerup",U),window.addEventListener("pointercancel",U),window.addEventListener("touchmove",le,{passive:!1}),window.addEventListener("touchend",J),window.addEventListener("touchcancel",J)},[t,n,ie,U,le,J]),X=c.useCallback(()=>{$.current&&(clearTimeout($.current),$.current=null),y.current=null},[]),ge=c.useCallback((g,w,j)=>{if(h||i)return;const I=g.target;if(I.closest("button")||I.closest('[role="checkbox"]')||I.closest("[data-interactive]"))return;const W=g.touches[0];y.current={x:W.clientX,y:W.clientY},$.current=setTimeout(()=>{F.current=!0,se(w,j,W.clientY)},Ie)},[h,i,se]),ye=c.useCallback(g=>{if(F.current||i||!y.current)return;const w=g.touches[0];Math.abs(w.clientY-y.current.y)>10&&X()},[i,X]),he=c.useCallback(()=>{X(),F.current=!1},[X]),be=c.useCallback((g,w,j)=>{if(h||i||g.pointerType==="touch")return;const I=g.target;I.closest("button")||I.closest('[role="checkbox"]')||I.closest("[data-interactive]")||(y.current={x:g.clientX,y:g.clientY},$.current=setTimeout(()=>{F.current=!0,se(w,j,g.clientY)},Ie))},[h,i,se]);if(h||t.length<=1)return e.jsx("div",{className:"space-y-0",children:t.map(g=>e.jsx("div",{children:d(g,{isDragging:!1,isPressed:!1,isActivated:!1,dragHandleRef:{current:null},onDragStart:()=>{},onDragEnd:()=>{}})},g.id))});const je=i!==null;return e.jsx("div",{ref:r,className:"space-y-0 relative",children:v.map((g,w)=>{const j=i===g.id,I=je,W=z===g.id;return e.jsx(D.div,{layout:!1,ref:V=>{V&&f.current.set(g.id,V)},className:R("relative",j&&"z-50"),animate:W?{scale:[1,1.02,.98,1],y:[0,-2,1,0]}:{scale:1,y:0},transition:W?{duration:.25,ease:[.25,.1,.25,1]}:{duration:0},style:{WebkitUserSelect:"none",userSelect:"none",WebkitTouchCallout:"none",touchAction:j?"none":"pan-y",pointerEvents:I&&!j?"none":"auto",transform:j?`translateY(${L.y}px) scale(1.03)`:void 0,opacity:I&&!j?.7:1,boxShadow:j?"0 15px 30px -5px rgba(0, 0, 0, 0.3), 0 8px 10px -4px rgba(0, 0, 0, 0.15)":"none",backgroundColor:j?"hsl(var(--background))":"transparent",borderRadius:j?12:0,transition:"none"},onTouchStart:V=>ge(V,g.id,w),onTouchMove:ye,onTouchEnd:he,onTouchCancel:he,onPointerDown:V=>be(V,g.id,w),onPointerUp:()=>{F.current||X()},onPointerCancel:()=>{X()},children:d(g,{isDragging:j,isPressed:!1,isActivated:j,dragHandleRef:{current:null},onDragStart:()=>se(g.id,w,C.current),onDragEnd:U})},g.id)})})}const qt=c.memo($t);function Bt({conflicts:t,onAutoFix:s,isFixing:d}){const[h,n]=c.useState(!1);return t.length===0?null:e.jsxs(D.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"rounded-lg border border-amber-500/50 bg-amber-500/10 overflow-hidden",children:[e.jsxs("button",{onClick:()=>n(!h),className:"w-full flex items-center justify-between p-3 text-left",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Pe,{className:"h-4 w-4 text-amber-500"}),e.jsxs("span",{className:"text-sm font-medium text-amber-700 dark:text-amber-300",children:[t.length," time conflict",t.length>1?"s":""," detected"]})]}),e.jsx(st,{className:R("h-4 w-4 text-amber-500 transition-transform",h&&"rotate-180")})]}),e.jsx(Fe,{children:h&&e.jsx(D.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"overflow-hidden",children:e.jsxs("div",{className:"px-3 pb-3 space-y-2",children:[t.map((l,r)=>e.jsxs("div",{className:"text-xs text-muted-foreground bg-background/50 rounded p-2",children:[e.jsx("span",{className:"font-medium text-foreground",children:l.taskATitle})," overlaps with ",e.jsx("span",{className:"font-medium text-foreground",children:l.taskBTitle})," by ",e.jsxs("span",{className:"text-amber-600 dark:text-amber-400 font-medium",children:[l.overlapMinutes,"m"]})]},r)),e.jsx(E,{size:"sm",variant:"outline",onClick:s,disabled:d,className:"w-full mt-2 border-amber-500/50 text-amber-700 dark:text-amber-300 hover:bg-amber-500/10",children:d?e.jsxs(e.Fragment,{children:[e.jsx(fe,{className:"h-3.5 w-3.5 mr-1.5 animate-spin"}),"Fixing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(at,{className:"h-3.5 w-3.5 mr-1.5"}),"Auto-fix all conflicts"]})})]})})})]})}function Yt({generatedPlan:t,onAdjust:s,onSave:d,isAdjusting:h,error:n,hasContacts:l=!1,onUpdateTask:r,onRemoveTask:f,onReorderTasks:i}){const[b,v]=c.useState(""),[N,L]=c.useState(!1),S=c.useMemo(()=>t?Pt(t.tasks):null,[t]),z=c.useMemo(()=>S?zt(S,l):[],[S,l]),a=S?.conflicts??[],u=c.useMemo(()=>Ht(a),[a]),p=y=>{const k=a.find(B=>B.taskAId===y||B.taskBId===y);return k?`Overlaps with "${k.taskAId===y?k.taskBTitle:k.taskATitle}" by ${k.overlapMinutes}m`:void 0},C=()=>{s("Fix all time conflicts - adjust task times so nothing overlaps. Maintain task order but add gaps between overlapping tasks.")},O=y=>{s(y)},_=()=>{b.trim()&&(s(b.trim()),v(""))},$=(y,k)=>{r?.(y,k)},F=y=>{f?.(y)};return n&&!t?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[e.jsx(Le,{className:"h-10 w-10 text-destructive mb-3"}),e.jsx("h3",{className:"font-medium text-foreground mb-1",children:"Couldn't build plan"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:n}),e.jsx(E,{variant:"outline",onClick:()=>window.location.reload(),children:"Start Over"})]}):t?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg bg-muted/50 border border-border/50",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(Ae,{className:"h-4 w-4 text-primary"}),e.jsx("span",{className:"text-sm font-medium",children:t.tasks.length}),e.jsx("span",{className:"text-xs text-muted-foreground",children:"tasks"})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(oe,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("span",{className:"text-sm font-medium",children:[t.totalHours.toFixed(1),"h"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(pe,{className:"h-4 w-4 text-amber-500"}),e.jsxs("span",{className:"text-sm font-medium",children:[t.balanceScore,"%"]})]}),r&&f&&e.jsx("button",{onClick:()=>L(!N),className:R("p-1.5 rounded-md transition-colors",N?"bg-primary text-primary-foreground":"hover:bg-muted"),children:N?e.jsx(He,{className:"h-4 w-4"}):e.jsx(ze,{className:"h-4 w-4 text-muted-foreground"})})]})]}),a.length>0&&e.jsx(Bt,{conflicts:a,onAutoFix:C,isFixing:h}),t.insights.length>0&&!N&&e.jsx("div",{className:"space-y-1",children:t.insights.slice(0,2).map((y,k)=>e.jsxs(D.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:k*.1},className:"flex items-start gap-2 text-xs text-muted-foreground",children:[e.jsx(re,{className:"h-3 w-3 text-primary mt-0.5 flex-shrink-0"}),e.jsx("span",{children:y})]},k))}),e.jsx("div",{className:"space-y-2 max-h-[280px] overflow-y-auto pr-1",children:N&&i?e.jsx(qt,{tasks:t.tasks,onReorder:i,renderItem:(y,k)=>e.jsx(_e,{task:y,index:t.tasks.findIndex(Q=>Q.id===y.id),isEditMode:N,onUpdate:$,onRemove:F,dragHandleProps:k,hasConflict:u.has(y.id),conflictDetails:p(y.id)},y.id)}):t.tasks.map((y,k)=>e.jsx(_e,{task:y,index:k,isEditMode:N,onUpdate:$,onRemove:F,hasConflict:u.has(y.id),conflictDetails:p(y.id)},y.id||k))}),!N&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Suggested adjustments:"}),e.jsx("div",{className:"flex flex-wrap gap-1.5",children:z.map(y=>e.jsxs("button",{onClick:()=>O(y.prompt),disabled:h,className:R("px-2.5 py-1 text-xs rounded-full border transition-colors flex items-center gap-1",y.priority==="high"?"border-primary/50 text-primary hover:bg-primary/10":"border-border hover:border-primary hover:text-primary","disabled:opacity-50 disabled:cursor-not-allowed"),children:[y.icon&&e.jsx("span",{children:y.icon}),y.label]},y.label))})]}),!N&&e.jsxs("div",{className:"flex gap-2",children:[e.jsx(ae,{value:b,onChange:y=>v(y.target.value),placeholder:"Tell the Guide what to change...",className:"flex-1 text-sm",onKeyDown:y=>y.key==="Enter"&&_(),disabled:h}),e.jsx(E,{size:"icon",variant:"ghost",onClick:_,disabled:!b.trim()||h,children:h?e.jsx(fe,{className:"h-4 w-4 animate-spin"}):e.jsx(rt,{className:"h-4 w-4"})})]}),e.jsxs(E,{onClick:d,disabled:h,className:"w-full",size:"lg",children:["Begin Adventure",e.jsx(nt,{className:"h-4 w-4 ml-1"})]})]}):e.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[e.jsx(fe,{className:"h-8 w-8 animate-spin text-primary mb-3"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Building your plan..."})]})}const Ut={quick_start:{title:"Plan Your Day",subtitle:"Your smart daily planning companion",number:0},check_in:{title:"How are you feeling?",subtitle:"Let's understand your energy and availability",number:1},anchors:{title:"Protect Your Streaks",subtitle:"Identify what matters most today",number:2},shape:{title:"Shape Your Quest",subtitle:"Design how your day flows",number:3},customize:{title:"Customize Your Day",subtitle:"Add time blocks and special requests",number:4},review:{title:"Your Day Awaits",subtitle:"Review and customize your plan",number:5}};function Wt({open:t,onOpenChange:s,planDate:d=new Date,onComplete:h}){const n=kt(d),{step:l,prevStep:r,reset:f,savedPreferences:i,loadPreferences:b,resetPreferences:v,applyDefaults:N}=n,L=Ut[l];c.useEffect(()=>{t&&(f(),b())},[t,f,b]);const S=()=>{s(!1),f()},z=async()=>{await n.savePlan()&&(h?.(),S())},a=l!=="quick_start"&&l!=="check_in",u=l!=="quick_start";return e.jsx(vt,{open:t,onOpenChange:s,children:e.jsxs(Nt,{className:"max-w-lg p-0 gap-0 overflow-hidden bg-background border-border/50",hideCloseButton:!0,children:[e.jsxs("div",{className:"relative p-4 pb-2 border-b border-border/30",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[a?e.jsx(E,{variant:"ghost",size:"icon",onClick:r,className:"h-8 w-8",children:e.jsx(it,{className:"h-4 w-4"})}):e.jsx("div",{className:"h-8 w-8 rounded-full bg-primary/10 flex items-center justify-center",children:e.jsx(ke,{className:"h-4 w-4 text-primary"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"font-semibold text-foreground",children:L.title}),e.jsx("p",{className:"text-xs text-muted-foreground",children:L.subtitle})]})]}),e.jsx(E,{variant:"ghost",size:"icon",onClick:S,className:"h-8 w-8",children:e.jsx(Ce,{className:"h-4 w-4"})})]}),u&&e.jsx("div",{className:"flex justify-center gap-1.5 mt-3",children:[1,2,3,4,5].map(p=>e.jsx("div",{className:R("h-1.5 rounded-full transition-all duration-300",p===L.number?"w-6 bg-primary":p<L.number?"w-1.5 bg-primary/50":"w-1.5 bg-muted")},p))})]}),e.jsx("div",{className:"p-4 min-h-[400px] max-h-[60vh] overflow-y-auto",children:e.jsx(Fe,{mode:"wait",children:e.jsxs(D.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},transition:{duration:.2},children:[l==="quick_start"&&i&&e.jsx(Ct,{savedPreferences:i,contactsNeedingAttentionCount:n.contactsNeedingAttention.length,onUseDefaults:N,onCustomize:()=>n.setStep("check_in"),onReset:v}),l==="check_in"&&e.jsx(_t,{context:n.context,updateContext:n.updateContext,onNext:n.nextStep}),l==="anchors"&&e.jsx(It,{context:n.context,updateContext:n.updateContext,habitsWithStreaks:n.habitsWithStreaks,upcomingMilestones:n.upcomingMilestones,existingTasks:n.existingTasks,contactsNeedingAttention:n.contactsNeedingAttention,isLoading:n.isLoadingAnchors,onNext:n.nextStep}),l==="shape"&&e.jsx(Rt,{context:n.context,updateContext:n.updateContext,onNext:n.nextStep}),l==="customize"&&e.jsx(Lt,{context:n.context,updateContext:n.updateContext,onNext:async()=>{await n.generatePlan()&&n.nextStep()},isGenerating:n.isGenerating}),l==="review"&&e.jsx(Yt,{generatedPlan:n.generatedPlan,onAdjust:n.adjustPlan,onSave:z,isAdjusting:n.isAdjusting,error:n.error,hasContacts:n.contactsNeedingAttention.length>0,onUpdateTask:n.updateTaskInPlan,onRemoveTask:n.removeTaskFromPlan,onReorderTasks:n.reorderTasksInPlan})]},l)})})]})})}function Vt(){const[t,s]=c.useState(!1);return e.jsxs("div",{className:"min-h-screen bg-background p-6",children:[e.jsxs("div",{className:"max-w-md mx-auto space-y-6",children:[e.jsxs(lt,{to:"/",className:"inline-flex items-center gap-2 text-muted-foreground hover:text-foreground",children:[e.jsx(ct,{className:"h-4 w-4"}),"Back"]}),e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("div",{className:"h-16 w-16 rounded-full bg-primary/10 flex items-center justify-center mx-auto",children:e.jsx(ke,{className:"h-8 w-8 text-primary"})}),e.jsx("h1",{className:"text-2xl font-bold",children:"Smart Day Planner Test"}),e.jsx("p",{className:"text-muted-foreground",children:"Test the 5-step wizard flow without authentication."})]}),e.jsxs(E,{onClick:()=>s(!0),className:"w-full",size:"lg",children:[e.jsx(ke,{className:"h-5 w-5 mr-2"}),"Open Smart Day Planner"]}),e.jsxs("div",{className:"text-sm text-muted-foreground space-y-2 p-4 bg-muted/50 rounded-lg",children:[e.jsx("p",{className:"font-medium",children:"Wizard Steps:"}),e.jsxs("ol",{className:"list-decimal list-inside space-y-1",children:[e.jsx("li",{children:"Quick Start - Use defaults or customize"}),e.jsx("li",{children:"Check In - Energy level & availability"}),e.jsx("li",{children:"Anchors - Protect habits & milestones"}),e.jsx("li",{children:"Shape - Design day flow"}),e.jsx("li",{children:"Review - Finalize & save plan"})]})]})]}),e.jsx(Wt,{open:t,onOpenChange:s,planDate:new Date,onComplete:()=>{console.log("Plan completed!")}})]})}export{Vt as default};
