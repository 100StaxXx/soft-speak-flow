import{r as t,j as e,ah as De,aa as Ue,c5 as Te,e7 as ze,l as T,m as b,cg as pt,aw as ht,ac as Xe,n as xt}from"./vendor-DK8VKJIv.js";import{bt as Le,bu as mt,bv as yt}from"./index-BJ43zXLh.js";import{t as Z}from"./gameUtils-CBfv9FnM.js";import{u as bt,a as vt,b as gt}from"./gameLifecycle-CMc-cG6H.js";import"./date-vendor-BRrA_NVo.js";import"./three-vendor-qI8GXUTd.js";const wt={beginner:{startLives:5,baseEnemiesPerWave:6,enemyFireRate:0,enemySpeed:.2,diveChance:.01,powerUpChance:.25,enemyIncreasePerWave:1,speedIncreasePerWave:.03,diveIncreasePerWave:.003},easy:{startLives:4,baseEnemiesPerWave:8,enemyFireRate:0,enemySpeed:.3,diveChance:.02,powerUpChance:.2,enemyIncreasePerWave:2,speedIncreasePerWave:.05,diveIncreasePerWave:.005},medium:{startLives:3,baseEnemiesPerWave:10,enemyFireRate:.003,enemySpeed:.4,diveChance:.03,powerUpChance:.15,enemyIncreasePerWave:2,speedIncreasePerWave:.06,diveIncreasePerWave:.006},hard:{startLives:2,baseEnemiesPerWave:12,enemyFireRate:.006,enemySpeed:.5,diveChance:.04,powerUpChance:.12,enemyIncreasePerWave:3,speedIncreasePerWave:.08,diveIncreasePerWave:.008},master:{startLives:2,baseEnemiesPerWave:15,enemyFireRate:.01,enemySpeed:.65,diveChance:.06,powerUpChance:.08,enemyIncreasePerWave:4,speedIncreasePerWave:.1,diveIncreasePerWave:.01}},xe={scout:{hp:1,points:10,color:"#22c55e",size:24},fighter:{hp:1,points:25,color:"#3b82f6",size:28},cruiser:{hp:2,points:50,color:"#a855f7",size:32},boss:{hp:5,points:200,color:"#ef4444",size:40}},Ae=t.memo(()=>{const s=t.useMemo(()=>Array.from({length:60},(n,o)=>({id:o,x:Math.random()*100,y:Math.random()*100,size:Math.random()*2+1,speed:Math.random()*2+1,opacity:Math.random()*.5+.3})),[]);return e.jsx("div",{className:"absolute inset-0 overflow-hidden bg-gradient-to-b from-slate-950 via-indigo-950 to-slate-950",children:s.map(n=>e.jsx(b.div,{className:"absolute rounded-full bg-white",style:{left:`${n.x}%`,width:n.size,height:n.size,opacity:n.opacity},animate:{top:["0%","100%"]},transition:{duration:8/n.speed,repeat:1/0,ease:"linear",delay:n.y/100*(8/n.speed)}},n.id))})});Ae.displayName="StarfieldBackground";const _e=t.memo(({x:s,hasShield:n,isInvulnerable:o})=>e.jsxs("div",{className:"absolute bottom-16 transition-transform duration-75",style:{left:`${s}%`,transform:"translateX(-50%)"},children:[n&&e.jsx(b.div,{className:"absolute -inset-4 rounded-full",style:{background:"radial-gradient(circle, rgba(59,130,246,0.3) 0%, transparent 70%)",border:"2px solid rgba(59,130,246,0.5)"},animate:{scale:[1,1.1,1],opacity:[.5,.8,.5]},transition:{duration:1,repeat:1/0}}),e.jsx(b.div,{animate:o?{opacity:[1,.3,1]}:{opacity:1},transition:{duration:.2,repeat:o?1/0:0},children:e.jsxs("svg",{width:"36",height:"40",viewBox:"0 0 36 40",className:"drop-shadow-lg",children:[e.jsx("ellipse",{cx:"18",cy:"38",rx:"6",ry:"4",fill:"#f59e0b",opacity:"0.8",children:e.jsx("animate",{attributeName:"ry",values:"3;5;3",dur:"0.2s",repeatCount:"indefinite"})}),e.jsx("ellipse",{cx:"18",cy:"38",rx:"3",ry:"2",fill:"#fef3c7",children:e.jsx("animate",{attributeName:"ry",values:"2;3;2",dur:"0.15s",repeatCount:"indefinite"})}),e.jsx("path",{d:"M18 2 L4 36 L18 30 L32 36 Z",fill:"url(#shipGradient)",stroke:"#60a5fa",strokeWidth:"1.5"}),e.jsx("ellipse",{cx:"18",cy:"16",rx:"4",ry:"6",fill:"#0ea5e9",opacity:"0.8"}),e.jsx("ellipse",{cx:"18",cy:"14",rx:"2",ry:"3",fill:"#7dd3fc"}),e.jsx("line",{x1:"8",y1:"28",x2:"14",y2:"24",stroke:"#3b82f6",strokeWidth:"2"}),e.jsx("line",{x1:"28",y1:"28",x2:"22",y2:"24",stroke:"#3b82f6",strokeWidth:"2"}),e.jsx("defs",{children:e.jsxs("linearGradient",{id:"shipGradient",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[e.jsx("stop",{offset:"0%",stopColor:"#1e40af"}),e.jsx("stop",{offset:"50%",stopColor:"#3b82f6"}),e.jsx("stop",{offset:"100%",stopColor:"#1e3a8a"})]})})]})})]}));_e.displayName="PlayerShip";const He=t.memo(({enemy:s})=>{const n=xe[s.type];return e.jsxs(b.div,{className:"absolute",style:{left:`${s.x}%`,top:`${s.y}%`,transform:"translate(-50%, -50%)"},animate:s.isDiving?{rotate:[0,10,-10,0]}:{},transition:{duration:.3,repeat:s.isDiving?1/0:0},children:[e.jsxs("svg",{width:n.size,height:n.size,viewBox:"0 0 32 32",children:[s.type==="scout"&&e.jsxs(e.Fragment,{children:[e.jsx("path",{d:"M16 4 L4 28 L16 22 L28 28 Z",fill:n.color,stroke:"#fff",strokeWidth:"1"}),e.jsx("circle",{cx:"16",cy:"14",r:"4",fill:"#1a1a2e",stroke:"#fff",strokeWidth:"1"})]}),s.type==="fighter"&&e.jsxs(e.Fragment,{children:[e.jsx("path",{d:"M16 2 L2 30 L16 24 L30 30 Z",fill:n.color,stroke:"#fff",strokeWidth:"1"}),e.jsx("path",{d:"M8 20 L2 26 L8 24 Z",fill:n.color}),e.jsx("path",{d:"M24 20 L30 26 L24 24 Z",fill:n.color}),e.jsx("circle",{cx:"16",cy:"12",r:"5",fill:"#1a1a2e",stroke:"#fff",strokeWidth:"1"}),e.jsx("circle",{cx:"16",cy:"12",r:"2",fill:"#ef4444"})]}),s.type==="cruiser"&&e.jsxs(e.Fragment,{children:[e.jsx("rect",{x:"6",y:"4",width:"20",height:"24",rx:"4",fill:n.color,stroke:"#fff",strokeWidth:"1"}),e.jsx("rect",{x:"2",y:"12",width:"6",height:"12",rx:"2",fill:n.color}),e.jsx("rect",{x:"24",y:"12",width:"6",height:"12",rx:"2",fill:n.color}),e.jsx("circle",{cx:"16",cy:"12",r:"4",fill:"#1a1a2e",stroke:"#fff",strokeWidth:"1"}),e.jsx("circle",{cx:"12",cy:"22",r:"2",fill:"#ef4444"}),e.jsx("circle",{cx:"20",cy:"22",r:"2",fill:"#ef4444"})]}),s.type==="boss"&&e.jsxs(e.Fragment,{children:[e.jsx("ellipse",{cx:"16",cy:"16",rx:"14",ry:"12",fill:n.color,stroke:"#fbbf24",strokeWidth:"2"}),e.jsx("ellipse",{cx:"10",cy:"12",rx:"4",ry:"5",fill:"#1a1a2e",stroke:"#fff",strokeWidth:"1"}),e.jsx("ellipse",{cx:"22",cy:"12",rx:"4",ry:"5",fill:"#1a1a2e",stroke:"#fff",strokeWidth:"1"}),e.jsx("circle",{cx:"10",cy:"12",r:"2",fill:"#22c55e"}),e.jsx("circle",{cx:"22",cy:"12",r:"2",fill:"#22c55e"}),e.jsx("path",{d:"M8 22 Q16 28 24 22",stroke:"#fff",strokeWidth:"2",fill:"none"})]})]}),s.maxHp>1&&e.jsx("div",{className:"absolute -bottom-2 left-1/2 -translate-x-1/2 w-8 h-1 bg-slate-800 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-green-500 transition-all",style:{width:`${s.hp/s.maxHp*100}%`}})})]})});He.displayName="EnemySprite";const Oe=t.memo(({projectile:s})=>e.jsx(b.div,{className:"absolute w-1 h-4 rounded-full",style:{left:`${s.x}%`,top:`${s.y}%`,transform:"translate(-50%, -50%)",background:s.isEnemy?"linear-gradient(180deg, #ef4444, #fca5a5)":"linear-gradient(0deg, #3b82f6, #93c5fd)",boxShadow:s.isEnemy?"0 0 8px #ef4444":"0 0 8px #3b82f6"}}));Oe.displayName="ProjectileSprite";const Ge=t.memo(({powerUp:s})=>{const n={shield:{icon:De,color:"#3b82f6",bg:"rgba(59,130,246,0.3)"},rapid:{icon:Ue,color:"#f59e0b",bg:"rgba(245,158,11,0.3)"},repair:{icon:Xe,color:"#22c55e",bg:"rgba(34,197,94,0.3)"},slowmo:{icon:Te,color:"#a855f7",bg:"rgba(168,85,247,0.3)"},spread:{icon:ze,color:"#ec4899",bg:"rgba(236,72,153,0.3)"},bonus:{icon:xt,color:"#fbbf24",bg:"rgba(251,191,36,0.3)"}}[s.type],o=n.icon;return e.jsx(b.div,{className:"absolute",style:{left:`${s.x}%`,top:`${s.y}%`,transform:"translate(-50%, -50%)"},animate:{rotate:360,scale:[1,1.1,1]},transition:{rotate:{duration:2,repeat:1/0,ease:"linear"},scale:{duration:.5,repeat:1/0}},children:e.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center",style:{background:n.bg,border:`2px solid ${n.color}`,boxShadow:`0 0 15px ${n.color}`},children:e.jsx(o,{className:"w-4 h-4",style:{color:n.color}})})})});Ge.displayName="PowerUpSprite";const Ye=t.memo(({explosion:s})=>e.jsx(b.div,{className:"absolute pointer-events-none",style:{left:`${s.x}%`,top:`${s.y}%`,transform:"translate(-50%, -50%)"},initial:{scale:0,opacity:1},animate:{scale:s.size==="large"?3:1.5,opacity:0},transition:{duration:.4},children:e.jsx("div",{className:"w-8 h-8 rounded-full",style:{background:"radial-gradient(circle, #fbbf24 0%, #f59e0b 30%, #ef4444 60%, transparent 100%)"}})}));Ye.displayName="ExplosionEffect";const Be=t.memo(({popup:s})=>e.jsx(b.div,{className:`absolute pointer-events-none font-bold text-sm z-30 ${s.type==="repair"?"text-green-400":s.score<0?"text-red-400":s.type==="bonus"?"text-yellow-400":"text-green-400"}`,style:{left:`${s.x}%`,top:`${s.y}%`,transform:"translate(-50%, -50%)"},initial:{opacity:1,y:0,scale:1.2},animate:{opacity:0,y:-20,scale:1},transition:{duration:.6},children:s.type==="repair"?"+1 ❤️":s.score>0?`+${s.score}`:s.score}));Be.displayName="ScorePopupComponent";const Ze=t.memo(({wave:s})=>e.jsx(b.div,{className:"absolute inset-0 z-40 flex items-center justify-center bg-background/80 backdrop-blur-sm",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:e.jsxs(b.div,{className:"text-center",initial:{scale:0},animate:{scale:1},transition:{type:"spring",stiffness:200},children:[e.jsxs("p",{className:"text-4xl font-black text-transparent bg-clip-text bg-gradient-to-r from-cyan-400 to-blue-500",children:["WAVE ",s]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"Enemies incoming!"})]})}));Ze.displayName="WaveTransition";const qe=t.memo(({lives:s,maxLives:n})=>e.jsx("div",{className:"flex items-center gap-0.5",children:Array.from({length:n}).map((o,j)=>e.jsx(Xe,{className:`w-4 h-4 ${j<s?"text-red-500 fill-red-500":"text-slate-600"}`},j))}));qe.displayName="LivesDisplay";const Ve=t.memo(({effect:s})=>e.jsxs(b.div,{className:"absolute pointer-events-none z-40",style:{left:`${s.x}%`,top:`${s.y}%`,transform:"translate(-50%, -50%)"},initial:{scale:0,opacity:1},animate:{scale:2.5,opacity:0},transition:{duration:.4,ease:"easeOut"},children:[e.jsx("div",{className:"w-12 h-12 rounded-full",style:{border:`3px solid ${s.color}`,boxShadow:`0 0 20px ${s.color}, inset 0 0 15px ${s.color}40`}}),Array.from({length:8}).map((n,o)=>e.jsx(b.div,{className:"absolute w-2 h-2 rounded-full",style:{background:s.color,boxShadow:`0 0 6px ${s.color}`,left:"50%",top:"50%",marginLeft:-4,marginTop:-4},initial:{x:0,y:0,opacity:1},animate:{x:Math.cos(o/8*Math.PI*2)*50,y:Math.sin(o/8*Math.PI*2)*50,opacity:0},transition:{duration:.35,ease:"easeOut"}},o))]}));Ve.displayName="PowerUpCollectEffect";const Ke=t.memo(({effect:s})=>e.jsxs(b.div,{className:"absolute pointer-events-none z-40",style:{left:`${s.x}%`,top:`${s.y}%`,transform:"translate(-50%, -50%)"},initial:{scale:.3,opacity:1},animate:{scale:2,opacity:0},transition:{duration:.35,ease:"easeOut"},children:[e.jsx("div",{className:"w-16 h-16 rounded-full",style:{background:s.type==="shield-break"?"radial-gradient(circle, rgba(59,130,246,0.9) 0%, rgba(59,130,246,0.4) 40%, transparent 70%)":"radial-gradient(circle, rgba(239,68,68,0.9) 0%, rgba(239,68,68,0.4) 40%, transparent 70%)",boxShadow:s.type==="shield-break"?"0 0 30px rgba(59,130,246,0.6)":"0 0 30px rgba(239,68,68,0.6)"}}),s.type==="shield-break"&&Array.from({length:6}).map((n,o)=>e.jsx(b.div,{className:"absolute w-3 h-3",style:{background:"linear-gradient(135deg, #60a5fa, #3b82f6)",left:"50%",top:"50%",marginLeft:-6,marginTop:-6,clipPath:"polygon(50% 0%, 100% 100%, 0% 100%)"},initial:{x:0,y:0,opacity:1,rotate:o*60},animate:{x:Math.cos(o/6*Math.PI*2)*40,y:Math.sin(o/6*Math.PI*2)*40,opacity:0,rotate:o*60+180},transition:{duration:.4,ease:"easeOut"}},o))]}));Ke.displayName="PlayerHitEffect";const Fe=(s,n)=>{const o=[],j=n.baseEnemiesPerWave+(s-1)*n.enemyIncreasePerWave,W=Math.min(3+Math.floor(s/3),5),q=Math.ceil(j/W);let I=0;for(let v=0;v<W&&I<j;v++)for(let u=0;u<q&&I<j;u++){const L=15+u*70/(q-1||1),p=8+v*10;let S="scout";s>=3&&v===0?S="cruiser":s>=2&&v<=1&&(S="fighter"),s%5===0&&v===0&&u===Math.floor(q/2)&&(S="boss");const E=xe[S];o.push({id:`enemy-${s}-${v}-${u}`,type:S,x:L,y:p,hp:E.hp,maxHp:E.hp,points:E.points,isDiving:!1,diveStartX:L,divePhase:0,formationX:L,formationY:p}),I++}return o};function Mt({companionStats:s,onComplete:n,onDamage:o,tierAttackDamage:j=15,difficulty:W="medium",questIntervalScale:q=1,isPractice:I=!1,compact:v=!1}){const u=bt(),{completeOnce:L}=vt(n),{registerTimeout:p,registerInterval:S,clearTimer:E}=gt(),h=wt[W],[f,P]=t.useState("countdown"),[Qe,Je]=t.useState(3),[le,ce]=t.useState(0),[k,et]=t.useState(1),[me,de]=t.useState(h.startLives),[V,z]=t.useState(50),[X,ue]=t.useState(!1),[K,ye]=t.useState(!1),[A,be]=t.useState(!1),[Q,ve]=t.useState(!1),[J,ee]=t.useState(!1),[_,H]=t.useState([]),[tt,te]=t.useState([]),[st,ge]=t.useState([]),[rt,we]=t.useState([]),[at,se]=t.useState([]),[nt,je]=t.useState([]),[it,O]=t.useState([]),[Se,N]=t.useState(null),fe=t.useRef(null),Ee=t.useRef(0),ke=t.useRef(1),re=t.useRef(0),Ne=t.useRef(null),G=t.useRef(),Ce=t.useRef(0),Y=t.useRef(!1),pe=t.useRef(f),he=t.useRef(V),ae=t.useRef(K),ne=t.useRef(Q),F=t.useRef(X),ie=t.useRef(A),$=t.useRef(J),Me=t.useRef({enemySpeed:h.enemySpeed,diveChance:h.diveChance,enemyFireRate:h.enemyFireRate,powerUpChance:h.powerUpChance}),D=t.useRef({enemiesDestroyed:0,shotsHit:0,shotsFired:0,wavesCompleted:0,powerUpsCollected:0}),Pe=t.useMemo(()=>({enemySpeed:h.enemySpeed+(k-1)*h.speedIncreasePerWave,diveChance:h.diveChance+(k-1)*h.diveIncreasePerWave,enemyFireRate:h.enemyFireRate+(k-1)*.001,powerUpChance:h.powerUpChance}),[h,k]);t.useEffect(()=>{pe.current=f},[f]),t.useEffect(()=>{he.current=V},[V]),t.useEffect(()=>{ae.current=K},[K]),t.useEffect(()=>{ne.current=Q},[Q]),t.useEffect(()=>{F.current=X},[X]),t.useEffect(()=>{ie.current=A},[A]),t.useEffect(()=>{$.current=J},[J]),t.useEffect(()=>{Me.current=Pe},[Pe]),t.useEffect(()=>{f==="playing"&&_.length===0&&!Y.current&&H(Fe(k,h))},[f,k,h,_.length]),t.useEffect(()=>{if(f!=="countdown")return;const r=S(()=>{Je(d=>d<=1?(P("playing"),0):d-1)},1e3);return()=>E(r)},[f,S,E]);const B=t.useCallback(()=>{const r=Date.now(),d=ae.current?100:180;if(r-Ee.current<d)return;Ee.current=r,D.current.shotsFired++;const w=he.current;ne.current?te(m=>[...m,{id:`p-${r}-l`,x:w-4,y:82,isEnemy:!1,speed:3},{id:`p-${r}-c`,x:w,y:82,isEnemy:!1,speed:3},{id:`p-${r}-r`,x:w+4,y:82,isEnemy:!1,speed:3}]):te(m=>[...m,{id:`p-${r}`,x:w,y:82,isEnemy:!1,speed:3}])},[]);t.useEffect(()=>{if(f!=="playing")return;const r=new Set,d=c=>{r.add(c.key.toLowerCase()),(c.key===" "||c.key==="ArrowUp")&&(c.preventDefault(),B()),c.key==="Escape"&&P("paused")},w=c=>{r.delete(c.key.toLowerCase())},m=()=>{(r.has("arrowleft")||r.has("a"))&&z(c=>Math.max(5,c-2)),(r.has("arrowright")||r.has("d"))&&z(c=>Math.min(95,c+2))};window.addEventListener("keydown",d),window.addEventListener("keyup",w);const C=S(m,16);return()=>{window.removeEventListener("keydown",d),window.removeEventListener("keyup",w),E(C)}},[f,B,S,E]);const ot=t.useCallback(r=>{Ne.current=r.touches[0].clientX},[]),lt=t.useCallback(r=>{if(!fe.current||Ne.current===null)return;const d=fe.current.getBoundingClientRect(),m=(r.touches[0].clientX-d.left)/d.width*100;z(Math.max(5,Math.min(95,m)))},[]),ct=t.useCallback(()=>{z(r=>Math.max(5,r-8))},[]),dt=t.useCallback(()=>{z(r=>Math.min(95,r+8))},[]);t.useEffect(()=>{if(f!=="playing")return;const r=d=>{if(!u.current||pe.current!=="playing")return;if(d-Ce.current<16){G.current=requestAnimationFrame(r);return}Ce.current=d;const m=ie.current?.5:1,C=Me.current,c=he.current;B(),re.current+=C.enemySpeed*ke.current*.3*m,Math.abs(re.current)>12&&(ke.current*=-1),H(x=>x.map(l=>{if(l.isDiving){l.divePhase+=.05*m;const g=l.formationY+Math.sin(l.divePhase)*50+l.divePhase*15,y=l.diveStartX+Math.sin(l.divePhase*2)*20;return g>90?{...l,isDiving:!1,divePhase:0,x:l.formationX+re.current,y:l.formationY}:{...l,x:Math.max(5,Math.min(95,y)),y:g}}const i=l.formationX+re.current;return Math.random()<C.diveChance*.1&&!l.isDiving?{...l,isDiving:!0,diveStartX:i,divePhase:0}:(C.enemyFireRate>0&&Math.random()<C.enemyFireRate*m&&te(g=>[...g,{id:`ep-${Date.now()}-${l.id}`,x:i,y:l.y+3,isEnemy:!0,speed:1.5*m}]),{...l,x:i})})),te(x=>{const l=[];return x.forEach(i=>{const g=i.isEnemy?i.speed*m:i.speed,y=i.y+(i.isEnemy?g:-g);if(!(y<0||y>100)){if(!i.isEnemy){let M=!1;if(H(U=>U.map(a=>{if(M)return a;const oe=Math.abs(i.x-a.x),ut=Math.abs(y-a.y),$e=xe[a.type].size/8;if(oe<$e&&ut<$e){M=!0,D.current.shotsHit++;const We=a.hp-1;if(We<=0){D.current.enemiesDestroyed++;const Ie=a.isDiving?a.points*2:a.points;if(ce(R=>R+Ie),Z("light"),a.type==="boss"&&o?.({target:"adversary",amount:Le.energy_beam.bossKill,source:"boss_kill"}),we(R=>[...R,{id:`exp-${Date.now()}-${a.id}`,x:a.x,y:a.y,size:a.type==="boss"?"large":"small"}]),se(R=>[...R,{id:`sp-${Date.now()}`,x:a.x,y:a.y,score:Ie,type:"normal"}]),Math.random()<C.powerUpChance){const R=["shield","rapid","repair","slowmo","spread","bonus"];ge(ft=>[...ft,{id:`pu-${Date.now()}`,type:R[Math.floor(Math.random()*R.length)],x:a.x,y:a.y}])}return{...a,hp:0}}return{...a,hp:We}}return a}).filter(a=>a.hp>0)),M)return}if(i.isEnemy&&!$.current){const M=Math.abs(i.x-c),U=Math.abs(y-85);if(M<4&&U<4){F.current?(ue(!1),F.current=!1,Z("medium"),O(a=>[...a,{id:`shield-${Date.now()}`,x:c,y:85,type:"shield-break"}]),N("rgba(59,130,246,0.4)"),p(()=>{u.current&&N(null)},150)):(o?.({target:"player",amount:j,source:"player_hit"}),O(a=>[...a,{id:`hit-${Date.now()}`,x:c,y:85,type:"damage"}]),N("rgba(239,68,68,0.5)"),p(()=>{u.current&&N(null)},200),de(a=>{const oe=a-1;return oe<=0&&P("complete"),oe}),ee(!0),$.current=!0,p(()=>{u.current&&(ee(!1),$.current=!1)},2e3),Z("heavy"));return}}l.push({...i,y})}}),l}),ge(x=>{const l=[];return x.forEach(i=>{const g=i.y+.5;if(g>100)return;const y=Math.abs(i.x-c),M=Math.abs(g-85);if(y<6&&M<6){D.current.powerUpsCollected++,Z("medium");const U={shield:"#3b82f6",rapid:"#f59e0b",repair:"#22c55e",slowmo:"#a855f7",spread:"#ec4899",bonus:"#fbbf24"};switch(je(a=>[...a,{id:`collect-${Date.now()}`,x:i.x,y:g,color:U[i.type]}]),N(`${U[i.type]}40`),p(()=>{u.current&&N(null)},120),i.type){case"shield":ue(!0),F.current=!0;break;case"rapid":ye(!0),ae.current=!0,p(()=>{u.current&&(ye(!1),ae.current=!1)},5e3);break;case"repair":de(a=>Math.min(a+1,h.startLives)),se(a=>[...a,{id:`sp-repair-${Date.now()}`,x:i.x,y:i.y,score:0,type:"repair"}]);break;case"slowmo":be(!0),ie.current=!0,p(()=>{u.current&&(be(!1),ie.current=!1)},5e3);break;case"spread":ve(!0),ne.current=!0,p(()=>{u.current&&(ve(!1),ne.current=!1)},5e3);break;case"bonus":ce(a=>a+200),se(a=>[...a,{id:`sp-bonus-${Date.now()}`,x:i.x,y:i.y,score:200,type:"bonus"}]);break}return}l.push({...i,y:g})}),l}),$.current||H(x=>(x.forEach(l=>{const i=Math.abs(l.x-c),g=Math.abs(l.y-85);i<5&&g<5&&(F.current?(ue(!1),F.current=!1,O(y=>[...y,{id:`shield-enemy-${Date.now()}`,x:c,y:85,type:"shield-break"}]),N("rgba(59,130,246,0.4)"),p(()=>{u.current&&N(null)},150)):(o?.({target:"player",amount:j,source:"enemy_collision"}),O(y=>[...y,{id:`hit-enemy-${Date.now()}`,x:c,y:85,type:"damage"}]),N("rgba(239,68,68,0.5)"),p(()=>{u.current&&N(null)},200),de(y=>{const M=y-1;return M<=0&&P("complete"),M}),ee(!0),$.current=!0,p(()=>{u.current&&(ee(!1),$.current=!1)},2e3)),Z("heavy"))}),x)),we(x=>x.slice(-10)),se(x=>x.slice(-10)),je(x=>x.slice(-8)),O(x=>x.slice(-6)),G.current=requestAnimationFrame(r)};return G.current=requestAnimationFrame(r),()=>{G.current&&cancelAnimationFrame(G.current)}},[f,B,o,j,p,u]),t.useEffect(()=>{if(f!=="playing"||_.length>0||Y.current)return;Y.current=!0;const r=D.current;if(r.wavesCompleted++,I&&r.wavesCompleted>=2){Y.current=!1,P("complete");return}ce(d=>d+100+k*50),o?.({target:"adversary",amount:Le.energy_beam.waveComplete,source:"wave_complete"}),P("wave-transition"),p(()=>{!u.current||pe.current!=="wave-transition"||(et(d=>{const w=d+1;return H(Fe(w,h)),w}),P("playing"),Y.current=!1)},2e3)},[_.length,k,h,f,I,o,p,u]);const Re=t.useCallback(r=>r>=90?"perfect":r>=50?"good":"fail",[]);return t.useEffect(()=>{if(f!=="complete")return;const d=D.current.wavesCompleted,m={beginner:5,easy:4,medium:3,hard:2,master:2}[W],C=Math.min(100,Math.round(d/m*100)),c=Re(C),x=p(()=>{L({success:c!=="fail",accuracy:C,result:c,highScoreValue:d,gameStats:{wavesCleared:d,score:le}})},1500);return()=>E(x)},[f,me,W,Re,le,p,E,L]),e.jsxs("div",{className:"relative w-full h-full flex-1 min-h-0 flex flex-col items-center overflow-hidden select-none",children:[e.jsx(Ae,{}),e.jsxs("div",{className:`absolute top-0 left-0 right-0 z-30 ${v?"px-2 pb-2 pt-[calc(env(safe-area-inset-top,0px)+0.5rem)]":"px-3 pb-3 pt-[calc(env(safe-area-inset-top,0px)+0.75rem)]"}`,children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("div",{className:`font-black text-white ${v?"text-lg":"text-2xl"}`,style:{textShadow:"0 0 10px rgba(59,130,246,0.5)"},children:le.toLocaleString()}),!v&&e.jsx("div",{className:"text-xs text-muted-foreground",children:"SCORE"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:`font-bold text-cyan-400 ${v?"text-sm":"text-lg"}`,children:["WAVE ",k]}),!v&&e.jsx("div",{className:"text-xs text-muted-foreground",children:"Endless Mode"})]}),e.jsx(qe,{lives:me,maxLives:h.startLives})]}),!v&&e.jsxs("div",{className:"flex gap-2 mt-2",children:[X&&e.jsxs("div",{className:"px-2 py-1 bg-blue-500/30 rounded text-xs text-blue-400 flex items-center gap-1",children:[e.jsx(De,{className:"w-3 h-3"})," SHIELD"]}),K&&e.jsxs("div",{className:"px-2 py-1 bg-amber-500/30 rounded text-xs text-amber-400 flex items-center gap-1",children:[e.jsx(Ue,{className:"w-3 h-3"})," RAPID"]}),A&&e.jsxs("div",{className:"px-2 py-1 bg-purple-500/30 rounded text-xs text-purple-400 flex items-center gap-1",children:[e.jsx(Te,{className:"w-3 h-3"})," SLOW-MO"]}),Q&&e.jsxs("div",{className:"px-2 py-1 bg-pink-500/30 rounded text-xs text-pink-400 flex items-center gap-1",children:[e.jsx(ze,{className:"w-3 h-3"})," SPREAD"]})]})]}),A&&e.jsx("div",{className:"absolute inset-0 bg-purple-500/10 pointer-events-none z-10"}),e.jsx(T,{children:Se&&e.jsx(b.div,{className:"absolute inset-0 z-50 pointer-events-none",style:{backgroundColor:Se},initial:{opacity:1},animate:{opacity:0},exit:{opacity:0},transition:{duration:.15}})}),e.jsxs("div",{ref:fe,className:"relative w-full h-full",onTouchStart:ot,onTouchMove:lt,onClick:B,children:[_.map(r=>e.jsx(He,{enemy:r},r.id)),tt.map(r=>e.jsx(Oe,{projectile:r},r.id)),st.map(r=>e.jsx(Ge,{powerUp:r},r.id)),e.jsx(T,{children:rt.map(r=>e.jsx(Ye,{explosion:r},r.id))}),e.jsx(T,{children:at.map(r=>e.jsx(Be,{popup:r},r.id))}),e.jsx(T,{children:nt.map(r=>e.jsx(Ve,{effect:r},r.id))}),e.jsx(T,{children:it.map(r=>e.jsx(Ke,{effect:r},r.id))}),f==="playing"&&e.jsx(_e,{x:V,hasShield:X,isInvulnerable:J})]}),f==="playing"&&e.jsxs("div",{className:"absolute bottom-2 left-0 right-0 flex justify-between px-4 z-20",children:[e.jsx("button",{className:"w-16 h-16 rounded-full bg-slate-800/80 border border-slate-600 flex items-center justify-center active:bg-slate-700",onTouchStart:ct,children:e.jsx(pt,{className:"w-8 h-8 text-white"})}),e.jsx("button",{className:"w-16 h-16 rounded-full bg-slate-800/80 border border-slate-600 flex items-center justify-center active:bg-slate-700",onTouchStart:dt,children:e.jsx(ht,{className:"w-8 h-8 text-white"})})]}),e.jsxs(T,{children:[f==="countdown"&&e.jsx(mt,{count:Qe,onComplete:()=>{}}),f==="wave-transition"&&e.jsx(Ze,{wave:k+1}),f==="paused"&&e.jsx(yt,{onResume:()=>P("playing")})]})]})}export{Mt as EnergyBeamGame};
