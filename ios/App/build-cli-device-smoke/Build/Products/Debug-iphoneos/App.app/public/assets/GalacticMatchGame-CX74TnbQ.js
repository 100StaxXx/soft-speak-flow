import{r as s,j as e,m as l,ac as Ne,l as _}from"./vendor-DK8VKJIv.js";import{t as B}from"./gameUtils-CBfv9FnM.js";import{bD as we,bw as de,bE as Ce,bF as Se}from"./index-vNUnYBjj.js";import{u as Te,a as Le,b as Ie}from"./gameLifecycle-CMc-cG6H.js";import{u as Re}from"./useMaxAspectRect-BoDFlwNt.js";import"./date-vendor-BRrA_NVo.js";import"./three-vendor-qI8GXUTd.js";const Fe={beginner:{startLives:5,revealTimeMultiplier:1.8,startPairs:2},easy:{startLives:4,revealTimeMultiplier:1.5,startPairs:2},medium:{startLives:3,revealTimeMultiplier:1.2,startPairs:2},hard:{startLives:2,revealTimeMultiplier:1,startPairs:3},master:{startLives:1,revealTimeMultiplier:.75,startPairs:4}},Pe={beginner:5,easy:4,medium:3,hard:2,master:1},Z=[{emoji:"â­",name:"Star",color:"hsl(45, 93%, 58%)"},{emoji:"ðŸŒ™",name:"Moon",color:"hsl(210, 20%, 75%)"},{emoji:"â˜€ï¸",name:"Sun",color:"hsl(35, 100%, 55%)"},{emoji:"ðŸª",name:"Planet",color:"hsl(271, 60%, 55%)"},{emoji:"ðŸŒŠ",name:"Nebula",color:"hsl(190, 90%, 55%)"},{emoji:"ðŸ’«",name:"Comet",color:"hsl(330, 80%, 65%)"},{emoji:"ðŸ”®",name:"Crystal",color:"hsl(270, 70%, 60%)"},{emoji:"âš¡",name:"Energy",color:"hsl(50, 100%, 50%)"},{emoji:"ðŸŒŸ",name:"Supernova",color:"hsl(40, 100%, 65%)"},{emoji:"ðŸŒ€",name:"Vortex",color:"hsl(200, 80%, 55%)"},{emoji:"ðŸ”¥",name:"Flame",color:"hsl(15, 90%, 55%)"},{emoji:"â„ï¸",name:"Frost",color:"hsl(195, 80%, 70%)"},{emoji:"ðŸŒ¸",name:"Blossom",color:"hsl(330, 70%, 70%)"},{emoji:"ðŸ’Ž",name:"Diamond",color:"hsl(195, 100%, 75%)"},{emoji:"ðŸ€",name:"Clover",color:"hsl(120, 60%, 50%)"}],_e=150,ae=(C,w=1,c=2,V=1)=>{let M;c>=3?M=c+Math.floor((C-1)/2):C===1?M=c:M=3+Math.floor((C-2)/2),M=Math.min(M,15);const N=M*2;let b,f;N<=4?(b=2,f=2):N<=6?(b=3,f=2):N<=8?(b=4,f=2):N<=10?(b=5,f=2):N<=12?(b=4,f=3):N<=16?(b=4,f=4):N<=20?(b=5,f=4):N<=24?(b=6,f=4):(N<=30,b=6,f=5);const h=Math.min(3+(M-2)*.5,10)*V;return{pairs:M,cols:b,rows:f,revealTime:h,totalCards:N}},me=s.memo(()=>e.jsxs("div",{className:"absolute inset-0 rounded-xl bg-gradient-to-br from-purple-900 via-indigo-900 to-blue-900 border-2 border-purple-500/50 overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 opacity-30",children:[...Array(5)].map((C,w)=>e.jsx("div",{className:"absolute w-1 h-1 bg-white rounded-full animate-pulse",style:{left:`${20+w*15}%`,top:`${30+w%2*40}%`,animationDelay:`${w*.2}s`}},w))}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx("div",{className:"w-8 h-8 rounded-full bg-gradient-to-br from-purple-400/30 to-cyan-400/30 flex items-center justify-center",children:e.jsx("span",{className:"text-xl opacity-50",children:"âœ¦"})})}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-white/5 to-transparent animate-pulse"})]}));me.displayName="CardBack";const ue=s.memo(({symbolIndex:C,symbolFontSize:w})=>{const c=Z[C];return e.jsx("div",{className:"absolute inset-0 rounded-xl border-2 overflow-hidden flex items-center justify-center",style:{background:`radial-gradient(circle at center, ${c.color}20, hsl(var(--background)))`,borderColor:`${c.color}60`,boxShadow:`0 0 20px ${c.color}30, inset 0 0 20px ${c.color}10`},children:e.jsx("span",{className:"filter drop-shadow-lg leading-none",style:{fontSize:w},children:c.emoji})})});ue.displayName="CardFace";const pe=s.memo(({color:C})=>e.jsx(l.div,{className:"absolute inset-0 pointer-events-none",initial:{opacity:1},animate:{opacity:0},exit:{opacity:0},transition:{duration:.5},children:[...Array(8)].map((w,c)=>e.jsx(l.div,{className:"absolute w-2 h-2 rounded-full",style:{backgroundColor:C,left:"50%",top:"50%"},initial:{scale:0,x:"-50%",y:"-50%"},animate:{scale:[0,1,0],x:`${Math.cos(c*Math.PI/4)*40-50}%`,y:`${Math.sin(c*Math.PI/4)*40-50}%`},transition:{duration:.5,ease:"easeOut"}},c))}));pe.displayName="MatchEffect";const Be=({companionStats:C,onComplete:w,onDamage:c,tierAttackDamage:V=15,difficulty:M="medium",questIntervalScale:N=0,maxTimer:b,isPractice:f=!1,compact:$=!1})=>{const h=Te(),{completeOnce:Y}=Le(w),{registerTimeout:x,clearTimer:H}=Ie(),S=Fe[M],fe=Pe[M],[a,he]=s.useState(1),[k,xe]=s.useState(1),[G,ye]=s.useState(S.startLives),[n,F]=s.useState("countdown"),[E,P]=s.useState([]),[ie,A]=s.useState([]),[X,J]=s.useState(0),[L,U]=s.useState(0),[I,le]=s.useState(0),[K,q]=s.useState(!1),[re,ne]=s.useState([]),[O,ve]=s.useState(3),[D,W]=s.useState(0),[oe,ce]=s.useState(0),T=s.useRef("countdown"),Q=s.useRef(0),o=s.useMemo(()=>ae(a,k,S.startPairs,S.revealTimeMultiplier),[a,k,S]),{hostRef:ge,rect:z}=Re(o.cols,o.rows),be=s.useMemo(()=>{const t=z.width/o.cols,i=z.height/o.rows,d=Math.min(t,i);return Math.max(22,Math.min(56,d*.5))},[z.height,z.width,o.cols,o.rows]);s.useEffect(()=>{T.current=n,Q.current+=1},[n]);const ee=s.useCallback((t=!1)=>{const i=Array.from({length:o.pairs},(r,m)=>m%Z.length),d=[...i,...i];for(let r=d.length-1;r>0;r--){const m=Math.floor(Math.random()*(r+1));[d[r],d[m]]=[d[m],d[r]]}P(d.map((r,m)=>({id:`card-${a}-${m}`,symbolIndex:r,isFlipped:t,isMatched:!1}))),A([]),J(0),U(0)},[o.pairs,a]);s.useEffect(()=>{a===1&&ee()},[]),s.useEffect(()=>{if(n==="countdown")if(O>0){const t=x(()=>{!h.current||T.current!=="countdown"||ve(O-1)},1e3);return()=>H(t)}else ee(!0),F("revealing"),W(Math.ceil(o.revealTime))},[O,n,o.revealTime,ee,x,H,h]),s.useEffect(()=>{if(n==="revealing")if(D>0){const t=x(()=>{!h.current||T.current!=="revealing"||W(D-1)},1e3);return()=>H(t)}else F("hiding"),x(()=>{!h.current||T.current!=="hiding"||(P(t=>t.map(i=>({...i,isFlipped:i.isMatched}))),x(()=>{!h.current||T.current!=="hiding"||F("playing")},400))},200)},[D,n,x,H,h]),s.useEffect(()=>{if(n==="playing"&&X===o.pairs){we(),B("success"),F("levelComplete");const t=oe===0,i=t?de.galactic_match.perfectLevel:de.galactic_match.levelComplete;c?.({target:"adversary",amount:i,source:t?"perfect_level":"level_complete"});const d=15*a,r=I+d;le(r);const m=Q.current;x(()=>{if(!h.current||T.current!=="levelComplete"||m!==Q.current)return;if(f&&a>=2){Y({success:!0,accuracy:100,result:"good",highScoreValue:a,gameStats:{level:a,score:r,maxCombo:L}});return}const se=o.pairs>=3&&k===1;let p,v,g;se?(p=a+1,v=2,g=ae(p,v,S.startPairs,S.revealTimeMultiplier)):(p=a+1,v=1,g=ae(p,v,S.startPairs,S.revealTimeMultiplier));const R=Array.from({length:g.pairs},(u,y)=>y%Z.length),j=[...R,...R];for(let u=j.length-1;u>0;u--){const y=Math.floor(Math.random()*(u+1));[j[u],j[y]]=[j[y],j[u]]}P(j.map((u,y)=>({id:`card-${p}-${y}`,symbolIndex:u,isFlipped:!0,isMatched:!1}))),A([]),J(0),ce(0),U(0),he(p),xe(v),F("revealing"),W(Math.ceil(g.revealTime))},1500)}},[X,o.pairs,n,a,k,f,oe,c,S,I,L,x,h,Y]),s.useEffect(()=>{if(n!=="gameOver")return;const i=Math.min(100,Math.round(I/500*100)),d=a>=3?a>=6?"perfect":"good":"fail";d!=="fail"&&(Ce(),B("success")),x(()=>{Y({success:d!=="fail",accuracy:Math.min(i,100),result:d,highScoreValue:a,gameStats:{level:a,score:I,maxCombo:L}})},1500)},[n,I,a,L,x,Y]);const je=s.useCallback(t=>{if(K||n!=="playing")return;const i=E.find(r=>r.id===t);if(!i||i.isFlipped||i.isMatched)return;B("light"),P(r=>r.map(m=>m.id===t?{...m,isFlipped:!0}:m));const d=[...ie,t];if(A(d),d.length===2){q(!0);const[r,m]=d,te=E.find(p=>p.id===r),se=E.find(p=>p.id===m);if(te.symbolIndex===se.symbolIndex){const p=L+1,v=Math.min(3,1+p*.5),g=10+a*2,R=Math.round(g*v);Se(),B("success"),U(p),le(u=>u+R),J(u=>u+1);const j=Z[te.symbolIndex].color;ne(u=>[...u,{id:r,color:j},{id:m,color:j}]),x(()=>{!h.current||T.current!=="playing"||(P(u=>u.map(y=>y.id===r||y.id===m?{...y,isMatched:!0}:y)),ne(u=>u.filter(y=>y.id!==r&&y.id!==m)),A([]),q(!1))},400)}else{const p=G-1;ye(p),U(0),ce(v=>v+1),B("error"),c?.({target:"player",amount:V,source:"wrong_match"}),p<=0?x(()=>{!h.current||T.current!=="playing"||(P(v=>v.map(g=>g.id===r||g.id===m?{...g,isFlipped:!1}:g)),A([]),q(!1),F("gameOver"))},800):x(()=>{if(!h.current||T.current!=="playing")return;P(R=>R.map(j=>({...j,isFlipped:j.isMatched||!0}))),A([]);const v=E.filter(R=>!R.isMatched).length,g=Math.min(1.5+v/4*.5,3);W(Math.ceil(g)),F("revealing"),q(!1)},800)}}},[E,ie,K,n,L,G,a,c,V,x,h]),Me=s.useMemo(()=>({gridTemplateColumns:`repeat(${o.cols}, 1fr)`,gridTemplateRows:`repeat(${o.rows}, 1fr)`}),[o.cols,o.rows]);return e.jsxs("div",{className:`flex flex-col items-center flex-1 min-h-0 ${$?"gap-1 p-1":"gap-2 p-3"} select-none touch-none`,children:[e.jsxs("div",{className:"w-full flex items-center justify-between text-xs",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[!$&&e.jsx("span",{className:"text-muted-foreground text-[10px]",children:"Level"}),e.jsx(l.span,{initial:{scale:1.5,color:"hsl(var(--primary))"},animate:{scale:1,color:"hsl(var(--foreground))"},className:`font-bold ${$?"text-sm":"text-base"}`,children:$?`Lv${a}`:a},`${a}-${k}`),o.pairs>=3&&e.jsxs("span",{className:"text-muted-foreground text-[10px] ml-0.5",children:["(",k,"/2)"]})]}),e.jsx("div",{className:"flex items-center gap-0.5",children:[...Array(fe)].map((t,i)=>e.jsx(l.div,{initial:!1,animate:{scale:i<G?1:.8,opacity:i<G?1:.3},transition:{type:"spring",stiffness:300},children:e.jsx(Ne,{className:`w-4 h-4 ${i<G?"fill-red-500 text-red-500":"text-muted-foreground"}`})},i))}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-muted-foreground",children:"Score:"}),e.jsx(l.span,{initial:{scale:1.3,color:"hsl(var(--primary))"},animate:{scale:1,color:"hsl(var(--foreground))"},className:"font-bold",children:I},I)]})]}),e.jsx(_,{children:L>1&&n==="playing"&&e.jsxs(l.div,{initial:{scale:0,y:-10},animate:{scale:1,y:0},exit:{scale:0,opacity:0},className:"px-2 py-0.5 bg-yellow-500/20 rounded-full text-yellow-400 text-xs font-bold",children:["ðŸ”¥ ",L,"x COMBO!"]})}),e.jsxs("div",{className:"w-full flex items-center gap-1.5",children:[e.jsx("div",{className:"flex-1 h-1.5 bg-muted rounded-full overflow-hidden",children:e.jsx(l.div,{className:"h-full bg-gradient-to-r from-cyan-500 to-purple-500",initial:{width:0},animate:{width:`${X/o.pairs*100}%`},transition:{duration:.3}})}),e.jsxs("span",{className:"text-[10px] text-muted-foreground",children:[X,"/",o.pairs]})]}),e.jsx("div",{ref:ge,className:"w-full flex-1 min-h-0 flex items-center justify-center px-2 pb-2",children:e.jsxs("div",{className:"relative w-full mx-auto",style:{width:z.width,height:z.height},children:[e.jsx(_,{children:n==="countdown"&&O>0&&e.jsx(l.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"absolute inset-0 z-20 flex items-center justify-center bg-background/80 backdrop-blur-sm rounded-xl",children:e.jsx(l.span,{initial:{scale:0,opacity:0},animate:{scale:1,opacity:1},exit:{scale:2,opacity:0},className:"text-6xl font-bold text-primary",children:O},O)})}),e.jsx(_,{children:n==="revealing"&&e.jsx(l.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"absolute inset-x-0 -top-12 z-20 flex flex-col items-center",children:e.jsxs(l.div,{className:"px-4 py-2 bg-cyan-500/90 rounded-full text-white font-bold shadow-lg",animate:{scale:[1,1.05,1]},transition:{duration:.5,repeat:1/0},children:["MEMORIZE! ",D,"s"]})})}),e.jsx(_,{children:n==="hiding"&&e.jsx(l.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"absolute inset-0 z-20 flex items-center justify-center",children:e.jsx(l.div,{initial:{scale:.5,opacity:0},animate:{scale:1,opacity:1},exit:{scale:1.5,opacity:0},className:"text-4xl font-bold text-primary",children:"GO!"})})}),e.jsx(_,{children:n==="levelComplete"&&e.jsx(l.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"absolute inset-0 z-20 flex items-center justify-center bg-background/80 backdrop-blur-sm rounded-xl",children:e.jsxs(l.div,{initial:{scale:0},animate:{scale:1},className:"text-center",children:[e.jsx(l.div,{className:"text-5xl mb-2",animate:{rotate:[0,-10,10,0]},transition:{duration:.5},children:"ðŸŽ‰"}),e.jsxs("div",{className:"text-2xl font-bold text-primary",children:["Level ",a," Complete!"]}),e.jsxs("div",{className:"text-sm text-muted-foreground mt-1",children:["+",15*a," bonus points"]})]})})}),e.jsx(_,{children:n==="gameOver"&&e.jsxs(l.div,{initial:{opacity:0},animate:{opacity:1},className:"absolute inset-0 z-20 flex items-center justify-center rounded-xl overflow-hidden",style:{background:"radial-gradient(ellipse at center, rgba(30, 20, 50, 0.95) 0%, rgba(15, 10, 30, 0.98) 100%)"},children:[e.jsx("div",{className:"absolute inset-0 overflow-hidden pointer-events-none",children:Array.from({length:8}).map((t,i)=>e.jsx(l.div,{className:"absolute w-1.5 h-1.5 rounded-full",style:{left:`${10+i*12}%`,top:"-5%",background:"radial-gradient(circle, rgba(168, 85, 247, 0.8), rgba(100, 50, 150, 0.4))",boxShadow:"0 0 4px rgba(168, 85, 247, 0.5)"},animate:{y:["0%","120%"],opacity:[0,.7,0]},transition:{duration:3+i*.3,delay:i*.4,repeat:1/0,ease:"linear"}},i))}),e.jsxs(l.div,{initial:{scale:0},animate:{scale:1},className:"text-center px-4 relative z-10",children:[e.jsxs(l.div,{className:"relative inline-block mb-3",animate:{scale:[1,1.05,1]},transition:{duration:2,repeat:1/0},children:[e.jsx("div",{className:"absolute inset-0 blur-xl bg-purple-500/30 rounded-full"}),e.jsx("div",{className:"text-4xl relative z-10",children:a>=3?"ðŸŒŸ":"ðŸ’«"})]}),e.jsx(l.h3,{className:"text-xl font-black bg-gradient-to-r from-slate-300 via-purple-300 to-slate-400 bg-clip-text text-transparent mb-1",initial:{y:10,opacity:0},animate:{y:0,opacity:1},transition:{delay:.2},children:a>=5?"Amazing Run!":a>=3?"Good Effort!":"The Void Prevails"}),e.jsx(l.p,{className:"text-sm text-purple-300/70 mb-3 italic",initial:{opacity:0},animate:{opacity:1},transition:{delay:.4},children:a>=3?"Your memory grows stronger each time":"Every attempt brings you closer to mastery"}),e.jsxs(l.div,{className:"space-y-1",initial:{opacity:0},animate:{opacity:1},transition:{delay:.3},children:[e.jsxs("div",{className:"text-lg font-bold text-purple-400",children:["Reached Level ",a]}),e.jsxs("div",{className:"text-sm text-slate-400",children:["Final Score: ",Math.min(I,_e)," XP"]})]})]})]})}),e.jsx("div",{className:"grid gap-1 sm:gap-1.5 w-full h-full",style:Me,children:E.map(t=>e.jsxs(l.button,{onClick:()=>je(t.id),disabled:t.isFlipped||t.isMatched||K||n!=="playing",className:"relative w-full h-full",style:{perspective:"1000px"},whileTap:n==="playing"?{scale:.95}:void 0,children:[e.jsxs(l.div,{className:"absolute inset-0 preserve-3d",initial:!1,animate:{rotateY:t.isFlipped||t.isMatched?180:0,opacity:t.isMatched?.3:1,scale:t.isMatched?.9:1},transition:{duration:.3,ease:"easeInOut"},style:{transformStyle:"preserve-3d"},children:[e.jsx("div",{className:"absolute inset-0",style:{backfaceVisibility:"hidden"},children:e.jsx(me,{})}),e.jsx("div",{className:"absolute inset-0",style:{backfaceVisibility:"hidden",transform:"rotateY(180deg)"},children:e.jsx(ue,{symbolIndex:t.symbolIndex,symbolFontSize:be})})]}),e.jsx(_,{children:re.find(i=>i.id===t.id)&&e.jsx(pe,{color:re.find(i=>i.id===t.id).color})})]},t.id))})]})}),f&&!$&&e.jsx("div",{className:"text-xs text-muted-foreground",children:"Practice Round - Get familiar with the mechanics!"})]})};export{Be as GalacticMatchGame,Be as default};
