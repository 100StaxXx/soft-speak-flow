import{r as s,j as e,l as P,m as p,ac as xe}from"./vendor-DK8VKJIv.js";import{bt as K,bu as he,bv as ge,bw as fe}from"./index-BJ43zXLh.js";import{u as be,g as ye,t as q}from"./gameUtils-CBfv9FnM.js";import{u as we,a as ve,b as je}from"./gameLifecycle-CMc-cG6H.js";import"./date-vendor-BRrA_NVo.js";import"./three-vendor-qI8GXUTd.js";const Ne={beginner:{orbModifier:-2,showTimeBonus:200,startLives:5},easy:{orbModifier:-1,showTimeBonus:100,startLives:4},medium:{orbModifier:0,showTimeBonus:0,startLives:3},hard:{orbModifier:1,showTimeBonus:-50,startLives:3},master:{orbModifier:2,showTimeBonus:-100,startLives:2}},Te=n=>{if(n<=2)return{orbs:4,showTimePerOrb:600};if(n<=4)return{orbs:5,showTimePerOrb:500};if(n<=6)return{orbs:6,showTimePerOrb:450};if(n<=8)return{orbs:7,showTimePerOrb:400};const i=Math.floor((n-8)/2),u=8+i,c=Math.max(300,350-i*10);return{orbs:u,showTimePerOrb:c}},Q=s.memo(({stars:n})=>e.jsx("div",{className:"absolute inset-0 overflow-hidden pointer-events-none",children:n.map(i=>e.jsx("div",{className:"absolute w-1 h-1 bg-white/40 rounded-full gpu-accelerated",style:{left:`${i.x}%`,top:`${i.y}%`,animation:`twinkle ${i.animationDuration}s ease-in-out infinite`,animationDelay:`${i.animationDelay}s`}},i.id))}));Q.displayName="StarBackground";const ee=s.memo(({orb:n,isHighlighted:i,isPast:u,isNext:c,showNumber:m,tapResult:S,onClick:f,disabled:h})=>{const N=s.useMemo(()=>n.tapped?{bg:"linear-gradient(135deg, #22c55e, #16a34a)",border:"rgba(34,197,94,0.6)",shadow:"0 0 25px rgba(34,197,94,0.5), inset 0 2px 4px rgba(255,255,255,0.2)"}:i?{bg:"linear-gradient(135deg, hsl(var(--primary)), hsl(var(--accent)))",border:"rgba(255,255,255,0.4)",shadow:"0 0 35px hsl(var(--primary)), 0 0 60px hsl(var(--primary)/0.4), inset 0 2px 4px rgba(255,255,255,0.3)"}:u?{bg:"linear-gradient(135deg, hsl(var(--primary)/0.5), hsl(var(--accent)/0.5))",border:"rgba(255,255,255,0.2)",shadow:"0 4px 15px rgba(0,0,0,0.3)"}:c?{bg:"linear-gradient(135deg, hsl(var(--primary)/0.4), hsl(var(--accent)/0.4))",border:"hsl(var(--primary)/0.6)",shadow:"0 0 20px hsl(var(--primary)/0.4), inset 0 2px 4px rgba(255,255,255,0.15)"}:{bg:"linear-gradient(135deg, rgba(255,255,255,0.06), rgba(255,255,255,0.02))",border:"rgba(255,255,255,0.1)",shadow:"0 4px 12px rgba(0,0,0,0.2), inset 0 1px 0 rgba(255,255,255,0.05)"},[n.tapped,i,u,c]);return e.jsxs(p.button,{className:"absolute rounded-full flex items-center justify-center font-bold gpu-accelerated touch-target w-14 h-14",style:{left:`${n.x}%`,top:`${n.y}%`,transform:"translate(-50%, -50%)",background:N.bg,border:`2px solid ${N.border}`,boxShadow:N.shadow},initial:{scale:0,opacity:0},animate:{scale:i?1.25:1,opacity:1},exit:{scale:0,opacity:0},onClick:f,disabled:h,whileTap:{scale:.92},transition:{type:"spring",stiffness:400,damping:25},children:[e.jsx("span",{className:`text-lg ${i||n.tapped?"text-white":"text-white/70"}`,style:{textShadow:i?"0 0 10px white":"none",fontWeight:i?800:600},children:m?n.order:"?"}),c&&e.jsx(p.div,{className:"absolute inset-[-3px] rounded-full",style:{border:"2px solid hsl(var(--primary))"},animate:{scale:[1,1.3,1],opacity:[.8,0,.8]},transition:{duration:1.2,repeat:1/0}}),i&&e.jsx(p.div,{className:"absolute inset-0 rounded-full border-2 border-white",initial:{scale:1,opacity:.8},animate:{scale:2,opacity:0},transition:{duration:.8,repeat:1/0}}),S&&e.jsx(p.div,{className:"absolute inset-0 rounded-full flex items-center justify-center",initial:{scale:.5,opacity:1},animate:{scale:2.5,opacity:0},transition:{duration:.5},children:e.jsx("span",{className:"text-2xl",children:S.success?"âœ¨":"âŒ"})})]})});ee.displayName="OrbComponent";const te=s.memo(({orbs:n,highlightIndex:i})=>i<=0?null:e.jsx("svg",{className:"absolute inset-0 pointer-events-none z-0",width:"100%",height:"100%",children:n.slice(0,i).map((u,c)=>{if(c===0)return null;const m=n[c-1];return e.jsx(p.line,{x1:`${m.x}%`,y1:`${m.y}%`,x2:`${u.x}%`,y2:`${u.y}%`,stroke:"hsl(var(--primary))",strokeWidth:"2",strokeOpacity:"0.4",strokeDasharray:"5,5",initial:{pathLength:0},animate:{pathLength:1},transition:{duration:.3}},`line-${c}`)})}));te.displayName="ConnectionLines";const D=s.memo(({lives:n,maxLives:i=3})=>e.jsx("div",{className:"flex items-center gap-0.5",children:Array.from({length:i}).map((u,c)=>e.jsx(p.div,{initial:!1,animate:{scale:c<n?1:.8,opacity:c<n?1:.3},transition:{type:"spring",stiffness:400},children:e.jsx(xe,{className:`w-4 h-4 ${c<n?"fill-red-500 text-red-500":"fill-gray-600 text-gray-600"}`})},c))}));D.displayName="LivesDisplay";const $e=({companionStats:n,onComplete:i,onDamage:u,tierAttackDamage:c=15,difficulty:m="medium",isPractice:S=!1,compact:f=!1})=>{const h=we(),{completeOnce:N}=ve(i),{registerTimeout:b,clearTimer:I}=je(),C=Ne[m],[t,w]=s.useState("countdown"),[v,E]=s.useState([]),[k,R]=s.useState(1),[j,L]=s.useState(0),[d,se]=s.useState(1),[_,re]=s.useState(0),[A,ae]=s.useState(C.startLives),[ne,F]=s.useState(!1),[W,O]=s.useState(null),[z,U]=s.useState(0),[X,ie]=s.useState(0),[B,oe]=s.useState(0),[V,M]=s.useState(null),[Y,Z]=s.useState(0),T=s.useRef(t);s.useEffect(()=>{T.current=t},[t]);const H=Te(d),g=Math.max(3,H.orbs+C.orbModifier),J=H.showTimePerOrb+C.showTimeBonus+n.mind/100*150,le=be(10),$=s.useCallback(()=>{const r=[...ye(g,12,75)].sort(()=>Math.random()-.5).map((x,y)=>({id:y,x:x.x,y:x.y,order:y+1,tapped:!1})),l=Array.from({length:g},(x,y)=>y+1).sort(()=>Math.random()-.5);r.forEach((x,y)=>{x.order=l[y]}),E(r)},[g]);s.useEffect(()=>{$()},[$]);const ce=s.useCallback(()=>{w("showing"),L(0)},[]);s.useEffect(()=>{if(t!=="showing"&&t!=="reshowing"||v.length===0)return;const a=[...v].sort((r,l)=>r.order-l.order),o=b(()=>{!h.current||T.current!=="showing"&&T.current!=="reshowing"||(j<a.length?(q("light"),L(r=>r+1)):(w("playing"),L(0)))},J);return()=>I(o)},[t,j,v,J,b,I,h]);const G=s.useCallback(a=>{if(T.current==="complete")return;w("complete");const o=B>0?Math.round(X/B*100):0,r=Math.min(d*5,50),l=Math.min(100,o+r);N({success:a,accuracy:Math.min(l,100),result:a?l>=90?"perfect":"good":"fail",highScoreValue:d,gameStats:{level:d,score:_}})},[d,X,B,_,N]),de=s.useCallback(a=>{if(!(t!=="playing"||a.tapped))if(oe(o=>o+1),a.order===k){q("success"),E(r=>r.map(l=>l.id===a.id?{...l,tapped:!0}:l)),R(r=>r+1),ie(r=>r+1);const o=z===0?2:1;if(re(r=>r+10*d*o),O({id:a.id,success:!0}),b(()=>{h.current&&O(null)},400),k===g){const r=Y===0;M(r?"â­ Perfect!":"âœ“ Level Complete!");const l=r?K.tap_sequence.perfectLevel:K.tap_sequence.levelComplete;u?.({target:"adversary",amount:l,source:r?"perfect_level":"level_complete"}),b(()=>{if(!(!h.current||T.current!=="playing")){if(M(null),S&&d>=2){G(!0);return}se(x=>x+1),R(1),U(0),Z(0),w("showing"),L(0),$()}},1e3)}}else q("error"),Z(o=>o+1),u?.({target:"player",amount:c,source:"wrong_tap"}),ae(o=>{const r=o-1;return r<=0?b(()=>{h.current&&G(!1)},500):(U(l=>l+1),R(1),E(l=>l.map(x=>({...x,tapped:!1}))),M("âŒ Wrong! Watch again..."),b(()=>{!h.current||T.current!=="playing"||(M(null),w("reshowing"),L(0))},1e3)),r}),F(!0),O({id:a.id,success:!1}),b(()=>{h.current&&(F(!1),O(null))},400)},[t,k,g,d,z,Y,$,G,u,c,S,b,h]),ue=s.useCallback(()=>{const a=[...v].sort((o,r)=>o.order-r.order);return j>0&&j<=a.length?a[j-1].order:0},[v,j]),pe=s.useCallback(()=>t==="showing"||t==="reshowing"?"Watch the sequence...":t==="playing"?`Tap orb ${k} of ${g}`:"",[t,k,g]);return e.jsxs("div",{className:`flex flex-col items-center relative flex-1 min-h-0 ${ne?"animate-shake":""}`,children:[t==="countdown"&&e.jsx(he,{count:3,onComplete:ce}),e.jsx(P,{children:t==="paused"&&e.jsx(ge,{onResume:()=>w("playing")})}),e.jsx(fe,{title:"Memory Sequence",subtitle:pe(),score:_,maxScore:d*200,showCombo:!1,phase:d-1,totalPhases:10,isPaused:t==="paused",onPauseToggle:()=>w(t==="paused"?"playing":"paused"),compact:f}),!f&&e.jsxs("div",{className:"w-full max-w-[280px] mb-1 flex items-center justify-between",children:[e.jsx(D,{lives:A}),e.jsx(p.div,{initial:{scale:1.2,opacity:0},animate:{scale:1,opacity:1},className:"px-2 py-0.5 bg-primary/20 rounded-full border border-primary/40",children:e.jsxs("span",{className:"text-xs font-bold text-primary",children:["Level ",d]})},d)]}),f&&e.jsxs("div",{className:"w-full max-w-[280px] mb-0.5 flex items-center justify-between text-xs",children:[e.jsx(D,{lives:A}),e.jsxs("span",{className:"font-bold text-primary text-[10px]",children:["Lv",d]}),e.jsxs("span",{className:"text-muted-foreground text-[10px]",children:[g," orbs"]})]}),!f&&e.jsxs("div",{className:"mb-0.5 flex items-center gap-1.5",children:[e.jsx("span",{className:`text-[10px] px-1.5 py-0.5 rounded-full ${m==="beginner"?"bg-blue-500/20 text-blue-400":m==="easy"?"bg-green-500/20 text-green-400":m==="medium"?"bg-yellow-500/20 text-yellow-400":m==="hard"?"bg-orange-500/20 text-orange-400":"bg-red-500/20 text-red-400"}`,children:m.toUpperCase()}),e.jsxs("span",{className:"text-[10px] text-muted-foreground",children:[g," orbs"]})]}),e.jsxs("div",{className:"relative w-full aspect-square max-w-[280px] rounded-2xl overflow-hidden",style:{background:"linear-gradient(145deg, rgba(0,0,0,0.85) 0%, rgba(15,15,35,0.95) 50%, rgba(25,15,45,0.9) 100%)",border:"1px solid rgba(255,255,255,0.08)",boxShadow:"0 25px 50px -12px rgba(0,0,0,0.6), inset 0 1px 0 rgba(255,255,255,0.05)"},children:[e.jsxs("div",{className:"absolute inset-0 pointer-events-none",children:[e.jsx("div",{className:"absolute top-0 left-0 w-32 h-32 bg-purple-500/8 rounded-full blur-3xl"}),e.jsx("div",{className:"absolute bottom-0 right-0 w-40 h-40 bg-cyan-500/6 rounded-full blur-3xl"})]}),e.jsx(Q,{stars:le}),(t==="showing"||t==="reshowing")&&e.jsx(te,{orbs:[...v].sort((a,o)=>a.order-o.order),highlightIndex:j}),e.jsx(P,{children:v.map(a=>{const o=ue(),r=(t==="showing"||t==="reshowing")&&a.order===o,l=(t==="showing"||t==="reshowing")&&a.order<o,x=!1,y=W?.id===a.id?W:null,me=t==="showing"||t==="reshowing"||a.tapped;return e.jsx(ee,{orb:a,isHighlighted:r,isPast:l,isNext:x,showNumber:me,tapResult:y,onClick:()=>de(a),disabled:t!=="playing"||a.tapped},a.id)})}),e.jsx(P,{children:V&&e.jsx(p.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.8},className:"absolute inset-0 flex items-center justify-center z-30",style:{background:"rgba(0,0,0,0.85)",backdropFilter:"blur(8px)"},children:e.jsx(p.div,{initial:{scale:0},animate:{scale:1},className:"text-center",children:e.jsx("p",{className:"text-2xl font-bold text-white",children:V})})})}),e.jsx(P,{children:A<=0&&t!=="complete"&&e.jsx(p.div,{initial:{opacity:0},animate:{opacity:1},className:"absolute inset-0 flex items-center justify-center z-30",style:{background:"rgba(0,0,0,0.9)",backdropFilter:"blur(8px)"},children:e.jsxs(p.div,{initial:{scale:0},animate:{scale:1},className:"text-center",children:[e.jsx("span",{className:"text-5xl",children:"ðŸ’”"}),e.jsx("p",{className:"text-xl font-bold text-white mt-3",children:"Game Over!"}),e.jsxs("p",{className:"text-lg text-primary mt-1",children:["Reached Level ",d]})]})})})]}),!f&&e.jsx(p.p,{className:"mt-2 text-xs text-muted-foreground text-center",initial:{opacity:0},animate:{opacity:1},children:t==="showing"||t==="reshowing"?"ðŸ‘€ Memorize the sequence...":t==="playing"?"ðŸ‘† Tap the orbs in order!":""}),!f&&e.jsxs("div",{className:"mt-1 flex items-center gap-3 text-[10px] text-muted-foreground",children:[e.jsxs("span",{children:[C.startLives," lives â€¢ Endless"]}),e.jsx("span",{className:"text-primary",children:"No time limit"})]}),e.jsx("style",{children:`
        @keyframes shake {
          0%, 100% { transform: translateX(0); }
          10%, 30%, 50%, 70%, 90% { transform: translateX(-3px); }
          20%, 40%, 60%, 80% { transform: translateX(3px); }
        }
        .animate-shake { animation: shake 0.3s ease-in-out; }
        @keyframes twinkle {
          0%, 100% { opacity: 0.15; transform: scale(0.6); }
          50% { opacity: 0.7; transform: scale(1); }
        }
        .gpu-accelerated {
          transform: translateZ(0);
          backface-visibility: hidden;
          will-change: transform, opacity;
        }
        .touch-target {
          min-height: 44px;
          min-width: 44px;
          touch-action: manipulation;
          -webkit-tap-highlight-color: transparent;
        }
      `})]})};export{$e as TapSequenceGame};
