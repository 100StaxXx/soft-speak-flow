import{r as t,j as e,l as A,m as h,ac as fe}from"./vendor-DK8VKJIv.js";import{bw as Q,bx as be,by as ye,bz as we}from"./index-vNUnYBjj.js";import{u as ve,g as je,t as q}from"./gameUtils-CBfv9FnM.js";import{u as Ne,a as Se,b as Te}from"./gameLifecycle-CMc-cG6H.js";import{u as Me}from"./useMaxAspectRect-BoDFlwNt.js";import"./date-vendor-BRrA_NVo.js";import"./three-vendor-qI8GXUTd.js";const ke={beginner:{orbModifier:-2,showTimeBonus:200,startLives:5},easy:{orbModifier:-1,showTimeBonus:100,startLives:4},medium:{orbModifier:0,showTimeBonus:0,startLives:3},hard:{orbModifier:1,showTimeBonus:-50,startLives:3},master:{orbModifier:2,showTimeBonus:-100,startLives:2}},Le=n=>{if(n<=2)return{orbs:4,showTimePerOrb:600};if(n<=4)return{orbs:5,showTimePerOrb:500};if(n<=6)return{orbs:6,showTimePerOrb:450};if(n<=8)return{orbs:7,showTimePerOrb:400};const i=Math.floor((n-8)/2),u=8+i,c=Math.max(300,350-i*10);return{orbs:u,showTimePerOrb:c}},ee=t.memo(({stars:n})=>e.jsx("div",{className:"absolute inset-0 overflow-hidden pointer-events-none",children:n.map(i=>e.jsx("div",{className:"absolute w-1 h-1 bg-white/40 rounded-full gpu-accelerated",style:{left:`${i.x}%`,top:`${i.y}%`,animation:`twinkle ${i.animationDuration}s ease-in-out infinite`,animationDelay:`${i.animationDelay}s`}},i.id))}));ee.displayName="StarBackground";const te=t.memo(({orb:n,isHighlighted:i,isPast:u,isNext:c,showNumber:x,tapResult:M,onClick:y,disabled:f,orbDiameter:S})=>{const m=t.useMemo(()=>n.tapped?{bg:"linear-gradient(135deg, #22c55e, #16a34a)",border:"rgba(34,197,94,0.6)",shadow:"0 0 25px rgba(34,197,94,0.5), inset 0 2px 4px rgba(255,255,255,0.2)"}:i?{bg:"linear-gradient(135deg, hsl(var(--primary)), hsl(var(--accent)))",border:"rgba(255,255,255,0.4)",shadow:"0 0 35px hsl(var(--primary)), 0 0 60px hsl(var(--primary)/0.4), inset 0 2px 4px rgba(255,255,255,0.3)"}:u?{bg:"linear-gradient(135deg, hsl(var(--primary)/0.5), hsl(var(--accent)/0.5))",border:"rgba(255,255,255,0.2)",shadow:"0 4px 15px rgba(0,0,0,0.3)"}:c?{bg:"linear-gradient(135deg, hsl(var(--primary)/0.4), hsl(var(--accent)/0.4))",border:"hsl(var(--primary)/0.6)",shadow:"0 0 20px hsl(var(--primary)/0.4), inset 0 2px 4px rgba(255,255,255,0.15)"}:{bg:"linear-gradient(135deg, rgba(255,255,255,0.06), rgba(255,255,255,0.02))",border:"rgba(255,255,255,0.1)",shadow:"0 4px 12px rgba(0,0,0,0.2), inset 0 1px 0 rgba(255,255,255,0.05)"},[n.tapped,i,u,c]),C=Math.max(16,Math.min(36,S*.38));return e.jsxs(h.button,{className:"absolute rounded-full flex items-center justify-center font-bold gpu-accelerated touch-target",style:{left:`${n.x}%`,top:`${n.y}%`,transform:"translate(-50%, -50%)",width:S,height:S,background:m.bg,border:`2px solid ${m.border}`,boxShadow:m.shadow},initial:{scale:0,opacity:0},animate:{scale:i?1.25:1,opacity:1},exit:{scale:0,opacity:0},onClick:y,disabled:f,whileTap:{scale:.92},transition:{type:"spring",stiffness:400,damping:25},children:[e.jsx("span",{className:`${i||n.tapped?"text-white":"text-white/70"}`,style:{textShadow:i?"0 0 10px white":"none",fontWeight:i?800:600,fontSize:C},children:x?n.order:"?"}),c&&e.jsx(h.div,{className:"absolute inset-[-3px] rounded-full",style:{border:"2px solid hsl(var(--primary))"},animate:{scale:[1,1.3,1],opacity:[.8,0,.8]},transition:{duration:1.2,repeat:1/0}}),i&&e.jsx(h.div,{className:"absolute inset-0 rounded-full border-2 border-white",initial:{scale:1,opacity:.8},animate:{scale:2,opacity:0},transition:{duration:.8,repeat:1/0}}),M&&e.jsx(h.div,{className:"absolute inset-0 rounded-full flex items-center justify-center",initial:{scale:.5,opacity:1},animate:{scale:2.5,opacity:0},transition:{duration:.5},children:e.jsx("span",{className:"text-2xl",children:M.success?"âœ¨":"âŒ"})})]})});te.displayName="OrbComponent";const se=t.memo(({orbs:n,highlightIndex:i})=>i<=0?null:e.jsx("svg",{className:"absolute inset-0 pointer-events-none z-0",width:"100%",height:"100%",children:n.slice(0,i).map((u,c)=>{if(c===0)return null;const x=n[c-1];return e.jsx(h.line,{x1:`${x.x}%`,y1:`${x.y}%`,x2:`${u.x}%`,y2:`${u.y}%`,stroke:"hsl(var(--primary))",strokeWidth:"2",strokeOpacity:"0.4",strokeDasharray:"5,5",initial:{pathLength:0},animate:{pathLength:1},transition:{duration:.3}},`line-${c}`)})}));se.displayName="ConnectionLines";const I=t.memo(({lives:n,maxLives:i=3})=>e.jsx("div",{className:"flex items-center gap-0.5",children:Array.from({length:i}).map((u,c)=>e.jsx(h.div,{initial:!1,animate:{scale:c<n?1:.8,opacity:c<n?1:.3},transition:{type:"spring",stiffness:400},children:e.jsx(fe,{className:`w-4 h-4 ${c<n?"fill-red-500 text-red-500":"fill-gray-600 text-gray-600"}`})},c))}));I.displayName="LivesDisplay";const _e=({companionStats:n,onComplete:i,onDamage:u,tierAttackDamage:c=15,difficulty:x="medium",isPractice:M=!1,compact:y=!1})=>{const f=Ne(),{completeOnce:S}=Se(i),{registerTimeout:m,clearTimer:C}=Te(),O=ke[x],[s,v]=t.useState("countdown"),[j,E]=t.useState([]),[k,_]=t.useState(1),[N,L]=t.useState(0),[d,ae]=t.useState(1),[B,re]=t.useState(0),[G,ne]=t.useState(O.startLives),[ie,D]=t.useState(!1),[F,$]=t.useState(null),[U,X]=t.useState(0),[V,oe]=t.useState(0),[z,le]=t.useState(0),[H,P]=t.useState(null),[Y,Z]=t.useState(0),T=t.useRef(s);t.useEffect(()=>{T.current=s},[s]);const J=Le(d),p=Math.max(3,J.orbs+O.orbModifier),K=J.showTimePerOrb+O.showTimeBonus+n.mind/100*150,ce=ve(10),{hostRef:de,rect:b}=Me(1,1),ue=t.useMemo(()=>{const r=Math.ceil(Math.sqrt(p)),o=Math.ceil(p/r),a=Math.min(b.width/r,b.height/o);return Math.max(44,Math.min(92,a*.72))},[b.height,b.width,p]),R=t.useCallback(()=>{const a=[...je(p,12,75)].sort(()=>Math.random()-.5).map((g,w)=>({id:w,x:g.x,y:g.y,order:w+1,tapped:!1})),l=Array.from({length:p},(g,w)=>w+1).sort(()=>Math.random()-.5);a.forEach((g,w)=>{g.order=l[w]}),E(a)},[p]);t.useEffect(()=>{R()},[R]);const me=t.useCallback(()=>{v("showing"),L(0)},[]);t.useEffect(()=>{if(s!=="showing"&&s!=="reshowing"||j.length===0)return;const r=[...j].sort((a,l)=>a.order-l.order),o=m(()=>{!f.current||T.current!=="showing"&&T.current!=="reshowing"||(N<r.length?(q("light"),L(a=>a+1)):(v("playing"),L(0)))},K);return()=>C(o)},[s,N,j,K,m,C,f]);const W=t.useCallback(r=>{if(T.current==="complete")return;v("complete");const o=z>0?Math.round(V/z*100):0,a=Math.min(d*5,50),l=Math.min(100,o+a);S({success:r,accuracy:Math.min(l,100),result:r?l>=90?"perfect":"good":"fail",highScoreValue:d,gameStats:{level:d,score:B}})},[d,V,z,B,S]),pe=t.useCallback(r=>{if(!(s!=="playing"||r.tapped))if(le(o=>o+1),r.order===k){q("success"),E(a=>a.map(l=>l.id===r.id?{...l,tapped:!0}:l)),_(a=>a+1),oe(a=>a+1);const o=U===0?2:1;if(re(a=>a+10*d*o),$({id:r.id,success:!0}),m(()=>{f.current&&$(null)},400),k===p){const a=Y===0;P(a?"â­ Perfect!":"âœ“ Level Complete!");const l=a?Q.tap_sequence.perfectLevel:Q.tap_sequence.levelComplete;u?.({target:"adversary",amount:l,source:a?"perfect_level":"level_complete"}),m(()=>{if(!(!f.current||T.current!=="playing")){if(P(null),M&&d>=2){W(!0);return}ae(g=>g+1),_(1),X(0),Z(0),v("showing"),L(0),R()}},1e3)}}else q("error"),Z(o=>o+1),u?.({target:"player",amount:c,source:"wrong_tap"}),ne(o=>{const a=o-1;return a<=0?m(()=>{f.current&&W(!1)},500):(X(l=>l+1),_(1),E(l=>l.map(g=>({...g,tapped:!1}))),P("âŒ Wrong! Watch again..."),m(()=>{!f.current||T.current!=="playing"||(P(null),v("reshowing"),L(0))},1e3)),a}),D(!0),$({id:r.id,success:!1}),m(()=>{f.current&&(D(!1),$(null))},400)},[s,k,p,d,U,Y,R,W,u,c,M,m,f]),he=t.useCallback(()=>{const r=[...j].sort((o,a)=>o.order-a.order);return N>0&&N<=r.length?r[N-1].order:0},[j,N]),xe=t.useCallback(()=>s==="showing"||s==="reshowing"?"Watch the sequence...":s==="playing"?`Tap orb ${k} of ${p}`:"",[s,k,p]);return e.jsxs("div",{className:`flex flex-col items-center relative flex-1 min-h-0 ${ie?"animate-shake":""}`,children:[s==="countdown"&&e.jsx(be,{count:3,onComplete:me}),e.jsx(A,{children:s==="paused"&&e.jsx(ye,{onResume:()=>v("playing")})}),e.jsx(we,{title:"Memory Sequence",subtitle:xe(),score:B,maxScore:d*200,showCombo:!1,phase:d-1,totalPhases:10,isPaused:s==="paused",onPauseToggle:()=>v(s==="paused"?"playing":"paused"),compact:y}),!y&&e.jsxs("div",{className:"w-full mb-1 flex items-center justify-between",style:{width:b.width,maxWidth:"100%"},children:[e.jsx(I,{lives:G}),e.jsx(h.div,{initial:{scale:1.2,opacity:0},animate:{scale:1,opacity:1},className:"px-2 py-0.5 bg-primary/20 rounded-full border border-primary/40",children:e.jsxs("span",{className:"text-xs font-bold text-primary",children:["Level ",d]})},d)]}),y&&e.jsxs("div",{className:"w-full mb-0.5 flex items-center justify-between text-xs",style:{width:b.width,maxWidth:"100%"},children:[e.jsx(I,{lives:G}),e.jsxs("span",{className:"font-bold text-primary text-[10px]",children:["Lv",d]}),e.jsxs("span",{className:"text-muted-foreground text-[10px]",children:[p," orbs"]})]}),!y&&e.jsxs("div",{className:"mb-0.5 flex items-center gap-1.5",style:{width:b.width,maxWidth:"100%"},children:[e.jsx("span",{className:`text-[10px] px-1.5 py-0.5 rounded-full ${x==="beginner"?"bg-blue-500/20 text-blue-400":x==="easy"?"bg-green-500/20 text-green-400":x==="medium"?"bg-yellow-500/20 text-yellow-400":x==="hard"?"bg-orange-500/20 text-orange-400":"bg-red-500/20 text-red-400"}`,children:x.toUpperCase()}),e.jsxs("span",{className:"text-[10px] text-muted-foreground",children:[p," orbs"]})]}),e.jsx("div",{ref:de,className:"w-full flex-1 min-h-0 flex items-center justify-center px-2 pb-2",children:e.jsxs("div",{className:"relative rounded-2xl overflow-hidden",style:{width:b.width,height:b.height,background:"linear-gradient(145deg, rgba(0,0,0,0.85) 0%, rgba(15,15,35,0.95) 50%, rgba(25,15,45,0.9) 100%)",border:"1px solid rgba(255,255,255,0.08)",boxShadow:"0 25px 50px -12px rgba(0,0,0,0.6), inset 0 1px 0 rgba(255,255,255,0.05)"},children:[e.jsxs("div",{className:"absolute inset-0 pointer-events-none",children:[e.jsx("div",{className:"absolute top-0 left-0 w-32 h-32 bg-purple-500/8 rounded-full blur-3xl"}),e.jsx("div",{className:"absolute bottom-0 right-0 w-40 h-40 bg-cyan-500/6 rounded-full blur-3xl"})]}),e.jsx(ee,{stars:ce}),(s==="showing"||s==="reshowing")&&e.jsx(se,{orbs:[...j].sort((r,o)=>r.order-o.order),highlightIndex:N}),e.jsx(A,{children:j.map(r=>{const o=he(),a=(s==="showing"||s==="reshowing")&&r.order===o,l=(s==="showing"||s==="reshowing")&&r.order<o,g=!1,w=F?.id===r.id?F:null,ge=s==="showing"||s==="reshowing"||r.tapped;return e.jsx(te,{orb:r,isHighlighted:a,isPast:l,isNext:g,showNumber:ge,tapResult:w,onClick:()=>pe(r),disabled:s!=="playing"||r.tapped,orbDiameter:ue},r.id)})}),e.jsx(A,{children:H&&e.jsx(h.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.8},className:"absolute inset-0 flex items-center justify-center z-30",style:{background:"rgba(0,0,0,0.85)",backdropFilter:"blur(8px)"},children:e.jsx(h.div,{initial:{scale:0},animate:{scale:1},className:"text-center",children:e.jsx("p",{className:"text-2xl font-bold text-white",children:H})})})}),e.jsx(A,{children:G<=0&&s!=="complete"&&e.jsx(h.div,{initial:{opacity:0},animate:{opacity:1},className:"absolute inset-0 flex items-center justify-center z-30",style:{background:"rgba(0,0,0,0.9)",backdropFilter:"blur(8px)"},children:e.jsxs(h.div,{initial:{scale:0},animate:{scale:1},className:"text-center",children:[e.jsx("span",{className:"text-5xl",children:"ðŸ’”"}),e.jsx("p",{className:"text-xl font-bold text-white mt-3",children:"Game Over!"}),e.jsxs("p",{className:"text-lg text-primary mt-1",children:["Reached Level ",d]})]})})})]})}),!y&&e.jsx(h.p,{className:"mt-2 text-xs text-muted-foreground text-center",initial:{opacity:0},animate:{opacity:1},children:s==="showing"||s==="reshowing"?"ðŸ‘€ Memorize the sequence...":s==="playing"?"ðŸ‘† Tap the orbs in order!":""}),!y&&e.jsxs("div",{className:"mt-1 flex items-center gap-3 text-[10px] text-muted-foreground",children:[e.jsxs("span",{children:[O.startLives," lives â€¢ Endless"]}),e.jsx("span",{className:"text-primary",children:"No time limit"})]}),e.jsx("style",{children:`
        @keyframes shake {
          0%, 100% { transform: translateX(0); }
          10%, 30%, 50%, 70%, 90% { transform: translateX(-3px); }
          20%, 40%, 60%, 80% { transform: translateX(3px); }
        }
        .animate-shake { animation: shake 0.3s ease-in-out; }
        @keyframes twinkle {
          0%, 100% { opacity: 0.15; transform: scale(0.6); }
          50% { opacity: 0.7; transform: scale(1); }
        }
        .gpu-accelerated {
          transform: translateZ(0);
          backface-visibility: hidden;
          will-change: transform, opacity;
        }
        .touch-target {
          min-height: 44px;
          min-width: 44px;
          touch-action: manipulation;
          -webkit-tap-highlight-color: transparent;
        }
      `})]})};export{_e as TapSequenceGame};
