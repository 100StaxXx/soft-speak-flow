import{j as e,m as pe,ao as Ce,dF as We,dG as Ve,a9 as Xe,r,bt as Ke,n as Ze,aI as Je,K as Qe}from"./vendor-DK8VKJIv.js";import{B as fe,c as et,s as Y,bx as tt,by as st,bz as rt,bw as Te}from"./index-vNUnYBjj.js";import{t as ie,u as nt}from"./gameUtils-CBfv9FnM.js";import{b as ot,a as at}from"./gameLifecycle-CMc-cG6H.js";import"./date-vendor-BRrA_NVo.js";import"./three-vendor-qI8GXUTd.js";const lt=({trackName:c,onRate:x,onSkip:m,isSubmitting:a=!1,currentRating:o})=>{const u=b=>{ie("medium"),x(b)};return e.jsxs(pe.div,{className:"flex flex-col items-center gap-4 p-6 rounded-2xl",style:{background:"linear-gradient(135deg, hsl(var(--card)) 0%, hsl(var(--card) / 0.8) 100%)",border:"1px solid hsl(var(--border) / 0.5)",boxShadow:"0 8px 32px hsl(var(--primary) / 0.15)"},initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3},children:[e.jsxs("div",{className:"flex items-center gap-2 text-primary",children:[e.jsx(Ce,{className:"w-5 h-5"}),e.jsx("span",{className:"text-lg font-semibold",children:"Rate this track!"})]}),c&&e.jsx("p",{className:"text-sm text-muted-foreground text-center max-w-[200px] truncate",children:c}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(pe.div,{whileHover:{scale:1.05},whileTap:{scale:.95},children:e.jsxs(fe,{variant:o==="up"?"default":"outline",size:"lg",onClick:()=>u("up"),disabled:a,className:"flex items-center gap-2 min-w-[100px]",style:{background:o==="up"?"linear-gradient(135deg, hsl(142, 71%, 45%), hsl(142, 71%, 35%))":void 0,borderColor:"hsl(142, 71%, 45%)"},children:[e.jsx(We,{className:`w-5 h-5 ${o==="up"?"fill-current":""}`}),e.jsx("span",{children:"Like"})]})}),e.jsx(pe.div,{whileHover:{scale:1.05},whileTap:{scale:.95},children:e.jsxs(fe,{variant:o==="down"?"default":"outline",size:"lg",onClick:()=>u("down"),disabled:a,className:"flex items-center gap-2 min-w-[100px]",style:{background:o==="down"?"linear-gradient(135deg, hsl(0, 84%, 60%), hsl(0, 84%, 50%))":void 0,borderColor:"hsl(0, 84%, 60%)"},children:[e.jsx(Ve,{className:`w-5 h-5 ${o==="down"?"fill-current":""}`}),e.jsx("span",{children:"Dislike"})]})})]}),e.jsxs(fe,{variant:"ghost",size:"sm",onClick:m,disabled:a,className:"text-muted-foreground hover:text-foreground",children:[e.jsx(Xe,{className:"w-4 h-4 mr-1"}),"Skip"]}),e.jsx("p",{className:"text-xs text-muted-foreground text-center",children:"Your feedback helps improve future tracks!"})]})},ct=()=>{const{user:c}=et(),[x,m]=r.useState(null),[a,o]=r.useState(!1),[u,b]=r.useState(!1),[w,j]=r.useState(null),[i,f]=r.useState(null),g=r.useRef(!1),_=r.useCallback(async S=>{if(g.current)return null;g.current=!0,b(!0);try{console.log("Generating new rhythm track...");const{data:d,error:v}=await Y.functions.invoke("generate-rhythm-track",{body:{genre:"stellar_beats",difficulty:S||"all"}});return v?(console.error("Error generating track:",v),null):d?.track?(console.log("Track generated successfully:",d.track),{...d.track,upvotes:0,downvotes:0,score:0,play_count:0}):null}catch(d){return console.error("Error generating track:",d),null}finally{b(!1),g.current=!1}},[]),X=r.useCallback(async S=>{o(!0),j(null),f(null);try{let d=Y.from("rhythm_tracks").select("*").eq("is_active",!0);S&&S!=="all"&&(d=d.or(`difficulty_tier.eq.${S},difficulty_tier.eq.all`));const{data:v,error:L}=await d;if(L)return console.error("Error fetching rhythm tracks:",L),j("Failed to load tracks"),o(!1),null;if(!v||v.length===0){console.log("No rhythm tracks available, generating new track...");const l=await _(S);return l?(m(l),o(!1),l):(j("No tracks available"),o(!1),null)}const R=v.map(l=>l.id),{data:de}=await Y.from("rhythm_track_ratings").select("track_id, rating").in("track_id",R),J=v.map(l=>{const G=de?.filter(N=>N.track_id===l.id)||[],V=G.filter(N=>N.rating==="up").length,q=G.filter(N=>N.rating==="down").length,M=V-q;return{...l,upvotes:V,downvotes:q,score:M}}),U=J.filter(l=>l.score>=-5);if(U.length===0){const l=J[Math.floor(Math.random()*J.length)];return m(l),await K(l.id),o(!1),l}const D=U.map(l=>Math.max(1,l.score+10)),se=D.reduce((l,G)=>l+G,0);let re=Math.random()*se,W=U[0];for(let l=0;l<U.length;l++)if(re-=D[l],re<=0){W=U[l];break}return m(W),await K(W.id),o(!1),W}catch(d){return console.error("Error in fetchRandomTrack:",d),j("Failed to load track"),o(!1),null}},[_]),K=async S=>{if(!c?.id)return;const{data:d}=await Y.from("rhythm_track_ratings").select("rating").eq("track_id",S).eq("user_id",c.id).maybeSingle();d&&f(d.rating)},ue=r.useCallback(async(S,d)=>{if(!c?.id)return console.error("User not authenticated"),!1;try{const{error:v}=await Y.from("rhythm_track_ratings").upsert({track_id:S,user_id:c.id,rating:d},{onConflict:"track_id,user_id"});if(v)return console.error("Error rating track:",v),!1;if(f(d),x&&x.id===S){const L=d==="up"?1:-1;m(R=>R?{...R,upvotes:d==="up"?R.upvotes+1:R.upvotes,downvotes:d==="down"?R.downvotes+1:R.downvotes,score:R.score+L}:null)}return!0}catch(v){return console.error("Error rating track:",v),!1}},[c?.id,x]),Z=r.useCallback(async S=>{try{const{data:d}=await Y.from("rhythm_tracks").select("play_count").eq("id",S).maybeSingle();d&&await Y.from("rhythm_tracks").update({play_count:(d.play_count||0)+1}).eq("id",S)}catch(d){console.error("Error incrementing play count:",d)}},[]);return{track:x,isLoading:a,isGenerating:u,error:w,userRating:i,fetchRandomTrack:X,rateTrack:ue,incrementPlayCount:Z}},Me={moon:0,star:1,sun:2},xe=1500,it={beginner:{notesPerBeat:.25,patterns:["single"]},easy:{notesPerBeat:.5,patterns:["single"]},medium:{notesPerBeat:1,patterns:["single","double"]},hard:{notesPerBeat:2,patterns:["single","double","triple"]},master:{notesPerBeat:3,patterns:["single","double","triple"]}},le={perfect:60,great:120,good:180},ut=30,dt={beginner:12,easy:10,medium:8,hard:5,master:3},P=85,mt=16,Ee={perfect:{label:"PERFECT!",points:100,color:"hsl(45, 100%, 60%)"},great:{label:"GREAT!",points:75,color:"hsl(271, 91%, 65%)"},good:{label:"GOOD",points:50,color:"hsl(142, 71%, 45%)"},miss:{label:"MISS",points:0,color:"hsl(0, 84%, 60%)"}},F={moon:{icon:Je,color:"hsl(271, 91%, 65%)",glowColor:"hsl(271, 91%, 75%)"},star:{icon:Ze,color:"hsl(45, 100%, 60%)",glowColor:"hsl(45, 100%, 70%)"},sun:{icon:Ke,color:"hsl(25, 95%, 55%)",glowColor:"hsl(25, 95%, 65%)"}},O=["moon","star","sun"],je=1500,$e=500,_e=c=>c>=50?4:c>=25?3:c>=10?2:1,ce={score:0,combo:0,maxCombo:0,notesHit:0,notesMissed:0},Re=r.memo(({stars:c})=>e.jsxs("div",{className:"absolute inset-0 overflow-hidden pointer-events-none",children:[c.map((x,m)=>e.jsx("div",{className:"absolute rounded-full",style:{left:`${x.x}%`,top:`${x.y}%`,width:`${m%3===0?3:2}px`,height:`${m%3===0?3:2}px`,background:m%5===0?"hsl(45, 100%, 80%)":"hsl(210, 100%, 90%)",boxShadow:`0 0 ${2+m%3}px rgba(255,255,255,0.4)`,opacity:.4+m%4*.08}},x.id)),e.jsx("div",{className:"absolute inset-0 opacity-25",style:{background:"radial-gradient(ellipse at 20% 20%, hsl(271, 50%, 25%) 0%, transparent 50%), radial-gradient(ellipse at 80% 80%, hsl(45, 50%, 15%) 0%, transparent 50%)"}})]}));Re.displayName="StaticStarBackground";const Ie=r.memo(({note:c,laneIndex:x,gameTimeMs:m})=>{const a=F[c.lane],o=c.expectedHitTime-m,u=Math.max(0,Math.min(1,1-o/xe)),b=.4+u*.6,w=30+u*50;return e.jsxs("div",{className:"absolute pointer-events-none",style:{left:`calc(${(x+.5)*33.33}% - 45px)`,top:`${c.y}%`,transform:"translateY(-50%) translateZ(0)",willChange:"transform",zIndex:15},children:[e.jsx("div",{className:"absolute left-1/2 -translate-x-1/2",style:{width:"60px",height:`${w}px`,bottom:"100%",background:`linear-gradient(to bottom, transparent 0%, ${a.color}40 50%, ${a.color}80 100%)`,filter:`blur(${4+u*4}px)`,opacity:b*.7}}),e.jsx("div",{style:{width:"90px",height:"18px",borderRadius:"9px",background:`linear-gradient(180deg, ${a.glowColor} 0%, ${a.color} 50%, ${a.color}cc 100%)`,boxShadow:`
            0 0 ${10+u*15}px ${a.color}${Math.round(b*99).toString(16).padStart(2,"0")},
            0 0 ${20+u*20}px ${a.color}60,
            inset 0 2px 4px rgba(255,255,255,0.4),
            inset 0 -2px 4px rgba(0,0,0,0.3)
          `,border:`2px solid ${a.glowColor}`,transform:`scaleY(${1+u*.2})`,transition:"transform 0.05s ease-out"},children:e.jsx("div",{className:"absolute top-1 left-2 right-2 h-1 rounded-full",style:{background:"rgba(255,255,255,0.5)"}})})]})});Ie.displayName="NoteBar";const Ae=r.memo(({lane:c,result:x})=>{const m=Me[c],a=Ee[x],o=F[c];return e.jsxs("div",{className:"absolute flex flex-col items-center justify-center pointer-events-none",style:{left:`calc(${(m+.5)*33.33}%)`,top:`${P}%`,transform:"translate(-50%, -50%)"},children:[e.jsx("div",{className:"absolute animate-ping",style:{width:"80px",height:"80px",borderRadius:"50%",border:`3px solid ${x==="perfect"?a.color:o.color}`,opacity:.6}}),e.jsx("span",{className:"text-xl font-black whitespace-nowrap animate-stellar-hit-text",style:{color:a.color,textShadow:`0 0 15px ${a.color}, 0 0 30px ${a.color}80`},children:a.label})]})});Ae.displayName="HitEffect";const Le=r.memo(({lane:c,laneIndex:x,onTap:m,isPressed:a,hasApproachingNote:o})=>{const u=F[c],b=u.icon,w=r.useRef(!1),j=r.useCallback(g=>{if(g.preventDefault(),g.stopPropagation(),w.current)return;w.current=!0;const _=performance.now();ie("light"),m(_)},[m]),i=r.useCallback(g=>{g.preventDefault(),w.current=!1},[]),f=r.useCallback(g=>{if(g.pointerType==="touch")return;g.preventDefault(),g.stopPropagation();const _=performance.now();ie("light"),m(_)},[m]);return e.jsx("button",{className:"flex-1 h-full flex items-center justify-center relative overflow-hidden select-none",onTouchStart:j,onTouchEnd:i,onTouchCancel:i,onPointerDown:f,onContextMenu:g=>g.preventDefault(),style:{background:a?`linear-gradient(to top, ${u.color}80, ${u.color}30)`:o?`linear-gradient(to top, ${u.color}40, transparent)`:"transparent",touchAction:"none",WebkitTapHighlightColor:"transparent",WebkitUserSelect:"none",userSelect:"none"},children:e.jsx("div",{className:"w-20 h-20 rounded-full flex items-center justify-center transition-all duration-50",style:{background:a?`radial-gradient(circle, ${u.color}, ${u.color}90)`:`radial-gradient(circle, ${u.color}50, ${u.color}20)`,border:`4px solid ${u.color}${a?"":"90"}`,boxShadow:a?`0 0 30px ${u.color}, 0 0 60px ${u.color}60`:o?`0 0 20px ${u.color}60`:`0 0 10px ${u.color}40`,transform:a?"scale(0.85)":"scale(1)"},children:e.jsx(b,{className:"w-8 h-8 pointer-events-none",style:{color:a?"white":u.color}})})})});Le.displayName="LaneButton";const ge=(c,x,m)=>{const a=it[m],u=6e4/c/a.notesPerBeat,b=[];let w=2e3;const j=(x-2)*1e3;for(;w<j;){const i=a.patterns[Math.floor(Math.random()*a.patterns.length)],f=w-xe;if(i==="single"){const g=O[Math.floor(Math.random()*3)];b.push({id:b.length,lane:g,spawnTime:f,expectedHitTime:w,y:-10,hit:!1,missed:!1})}else i==="double"?[...O].sort(()=>Math.random()-.5).slice(0,2).forEach(_=>{b.push({id:b.length,lane:_,spawnTime:f,expectedHitTime:w,y:-10,hit:!1,missed:!1})}):i==="triple"&&O.forEach(g=>{b.push({id:b.length,lane:g,spawnTime:f,expectedHitTime:w,y:-10,hit:!1,missed:!1})});w+=u}return b},te=c=>ge(120,30,c),De=r.memo(({isGenerating:c})=>e.jsxs("div",{className:"flex flex-col items-center justify-center h-full min-h-[300px] gap-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"animate-spin",children:e.jsx(Ce,{className:"w-12 h-12 text-primary"})}),e.jsx(Qe,{className:"absolute -top-1 -right-1 w-5 h-5 text-yellow-400 animate-pulse"})]}),e.jsx("p",{className:"text-base font-medium text-foreground",children:c?"Preparing music...":"Loading music..."})]}));De.displayName="TrackLoadingScreen";const yt=({companionStats:c,onComplete:x,onDamage:m,tierAttackDamage:a=15,difficulty:o="medium",questIntervalScale:u=0,maxTimer:b,isPractice:w=!1,compact:j=!1})=>{const[i,f]=r.useState(j?"countdown":"loading"),[g,_]=r.useState(ce),[X,K]=r.useState([]),[ue,Z]=r.useState([]),[S,d]=r.useState({moon:!1,star:!1,sun:!1}),[v,L]=r.useState(null),[R,de]=r.useState(!1),[J,U]=r.useState(!1),[D,se]=r.useState(!1),[re,W]=r.useState(0),l=dt[o],G=r.useRef(0),V=r.useRef(0),q=r.useRef(),M=r.useRef([]),N=r.useRef(ce),$=r.useRef(null),C=r.useRef(null),ne=r.useRef(0),He=nt(20),{registerTimeout:I,registerInterval:be,clearTimer:ye}=ot(),{completeOnce:we}=at(x),{isGenerating:Fe,userRating:Ge,fetchRandomTrack:oe,rateTrack:ve}=ct();r.useEffect(()=>((async()=>{if(j){M.current=te(o),C.current=null,f("countdown");return}ne.current=Date.now();const s=await oe(o),n=()=>{const T=Date.now()-ne.current,k=Math.max(0,je-T);I(()=>f("countdown"),k+$e)};if(s){C.current=s,M.current=ge(s.bpm,s.duration_seconds,o);const T=new Audio(s.audio_url);T.preload="auto",$.current=T,T.addEventListener("canplaythrough",n,{once:!0}),T.addEventListener("error",()=>{M.current=te(o),n()},{once:!0}),T.load()}else M.current=te(o),n()})(),()=>{$.current&&($.current.pause(),$.current=null)}),[j,o,oe,I]);const Be=r.useCallback(()=>{f("playing"),G.current=performance.now(),V.current=performance.now(),$.current&&($.current.currentTime=0,$.current.play().catch(t=>{t.name!=="NotAllowedError"&&console.warn("Audio play failed:",t.message)}))},[]);r.useEffect(()=>{if(i!=="playing")return;const t=le.good+50,s=n=>{const T=n-G.current,k=M.current;let B=0;for(let h=0;h<k.length;h++){const p=k[h];if(p.hit||p.missed)continue;const y=1-(p.expectedHitTime-T)/xe;p.y=-10+y*(P+10),T>p.expectedHitTime+t&&(p.missed=!0,B++)}if(B>0){const h=N.current,p=h.notesMissed+B;if(N.current={...h,notesMissed:p,combo:0},p>=l){$.current?.pause(),m?.({target:"player",amount:Te.eclipse_timing.tooManyMisses,source:"too_many_misses"});const E=k.length,y=N.current,ae=E>0?Math.round(y.notesHit/E*100):0;L({success:!1,accuracy:ae,result:"fail",highScoreValue:y.score,gameStats:{score:y.score,maxCombo:y.maxCombo,notesHit:y.notesHit,misses:y.notesMissed}}),_({...y}),f("complete");return}}if(n-V.current>=mt){V.current=n;const h=[];for(let E=0;E<k.length;E++){const y=k[E];!y.hit&&!y.missed&&y.y>=-15&&y.y<=100&&h.push({...y})}K(h),_({...N.current}),W(T);const p=N.current;de(p.notesMissed>=l-2&&p.notesMissed<l),U(p.combo>=10)}let H=!0;for(let h=0;h<k.length;h++)if(!k[h].hit&&!k[h].missed&&k[h].y<=100){H=!1;break}if(H&&k.length>0){$.current?.pause(),m?.({target:"adversary",amount:Te.eclipse_timing.songComplete,source:"song_complete"});const h=k.length,p=N.current,E=h>0?Math.round(p.notesHit/h*100):0;L({success:!0,accuracy:E,result:E>=90?"perfect":"good",highScoreValue:p.score,gameStats:{score:p.score,maxCombo:p.maxCombo,notesHit:p.notesHit,misses:p.notesMissed}}),_({...p}),C.current&&!w&&!j?f("rating"):f("complete");return}q.current=requestAnimationFrame(s)};return q.current=requestAnimationFrame(s),()=>{q.current&&cancelAnimationFrame(q.current)}},[j,i,w,m,l]);const Q=r.useCallback((t,s)=>{if(i!=="playing")return;d(A=>({...A,[t]:!0})),I(()=>d(A=>({...A,[t]:!1})),80);const n=s-G.current+ut,T=M.current;let k=null,B=1/0;for(let A=0;A<T.length;A++){const z=T[A];if(z.lane!==t||z.hit||z.missed)continue;const he=Math.abs(n-z.expectedHitTime);he<B&&he<=le.good&&(B=he,k=z)}if(!k)return;let H;B<=le.perfect?H="perfect":B<=le.great?H="great":H="good",k.hit=!0;const h=N.current,p=_e(h.combo),E=Ee[H].points*p,y=h.combo+1;N.current={score:h.score+E,combo:y,maxCombo:Math.max(h.maxCombo,y),notesHit:h.notesHit+1,notesMissed:h.notesMissed},_({...N.current});const ae=Date.now();Z(A=>[...A.slice(-3),{id:ae,lane:t,result:H}]),I(()=>Z(A=>A.filter(z=>z.id!==ae)),400),ie(H==="perfect"?"success":"light")},[i,I]);r.useEffect(()=>{const t=s=>{if(i!=="playing")return;const n=performance.now();s.key==="a"||s.key==="ArrowLeft"?Q("moon",n):s.key==="s"||s.key==="ArrowDown"?Q("star",n):(s.key==="d"||s.key==="ArrowRight")&&Q("sun",n)};return window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)},[i,Q]);const Pe=r.useCallback(async t=>{C.current&&await ve(C.current.id,t)},[ve]),Oe=r.useCallback(async()=>{$.current?.pause(),$.current=null,N.current=ce,_(ce),K([]),Z([]),L(null),f("loading"),ne.current=Date.now();const t=()=>{const n=Date.now()-ne.current,T=Math.max(0,je-n);I(()=>f("countdown"),T+$e)},s=await oe(o);if(s){C.current=s,M.current=ge(s.bpm,s.duration_seconds,o);const n=new Audio(s.audio_url);n.preload="auto",$.current=n,n.addEventListener("canplaythrough",t,{once:!0}),n.addEventListener("error",()=>{M.current=te(o),t()},{once:!0}),n.load()}else M.current=te(o),C.current=null,t()},[o,oe,I]),Ue=r.useCallback(()=>f("complete"),[]);r.useEffect(()=>{i==="complete"&&v&&I(()=>{we(v)},300)},[i,v,I,we]),r.useEffect(()=>{$.current&&(i==="paused"?$.current.pause():i==="playing"&&$.current.play().catch(t=>{t.name!=="NotAllowedError"&&console.warn("Audio play failed:",t.message)}))},[i]),r.useEffect(()=>{if(i!=="playing"||!C.current)return;const s=6e4/(C.current.bpm||120),n=be(()=>{se(!0),I(()=>se(!1),80)},s);return()=>ye(n)},[i,be,I,ye]);const me=r.useMemo(()=>{const t={moon:!1,star:!1,sun:!1};for(const s of X)s.y>P-20&&s.y<P+5&&(t[s.lane]=!0);return t},[X]),{score:ke,combo:Se,notesHit:qe,notesMissed:ee}=g,ze=_e(Se),Ne=M.current.length,Ye=qe+ee;return i==="loading"?e.jsx("div",{className:"flex flex-col items-center relative w-full h-full min-h-[500px] overflow-hidden",style:{touchAction:"none"},children:e.jsx(De,{isGenerating:Fe})}):i==="rating"?e.jsxs("div",{className:"flex flex-col items-center justify-center relative w-full h-full min-h-[500px] gap-6 p-4 overflow-hidden",style:{touchAction:"none"},children:[e.jsxs("div",{className:"text-center mb-4",children:[e.jsx("h2",{className:"text-2xl font-bold text-foreground mb-2",children:"Song Complete!"}),e.jsxs("p",{className:"text-lg text-muted-foreground",children:["Score: ",e.jsx("span",{className:"text-primary font-bold",children:ke})," ‚Ä¢ Accuracy: ",e.jsxs("span",{className:"text-primary font-bold",children:[v?.accuracy,"%"]})]})]}),C.current&&e.jsx(lt,{trackName:C.current.genre,onRate:Pe,onSkip:()=>{},currentRating:Ge}),e.jsxs("div",{className:"flex gap-4 mt-4",children:[e.jsx("button",{onClick:Oe,className:"px-6 py-3 rounded-lg bg-primary text-primary-foreground font-semibold hover:bg-primary/90 transition-colors",children:"Next Song ‚Üí"}),e.jsx("button",{onClick:Ue,className:"px-6 py-3 rounded-lg bg-secondary text-secondary-foreground font-semibold hover:bg-secondary/90 transition-colors",children:"Finish"})]})]}):e.jsxs("div",{className:"flex flex-col items-center relative w-full h-full min-h-[500px] overflow-hidden",style:{touchAction:"none"},children:[i==="countdown"&&e.jsx(tt,{count:3,onComplete:Be}),i==="paused"&&e.jsx(st,{onResume:()=>f("playing")}),e.jsx(rt,{title:"Stellar Beats",subtitle:`${Ye}/${Ne} notes${C.current?` ‚Ä¢ ${C.current.bpm} BPM`:""}`,score:ke,maxScore:Ne*100*4,combo:Se,showCombo:!0,primaryStat:{value:ee,label:`Misses (max ${l})`,color:ee>=l-2?"hsl(0, 84%, 60%)":"hsl(45, 100%, 60%)"},isPaused:i==="paused",onPauseToggle:()=>f(i==="paused"?"playing":"paused"),compact:j}),R&&i==="playing"&&e.jsxs("div",{className:"absolute top-20 right-4 z-30 px-3 py-1 rounded-full text-sm font-bold animate-pulse",style:{background:"linear-gradient(135deg, hsl(0, 70%, 50%), hsl(0, 84%, 40%))",color:"white"},children:["‚ö†Ô∏è ",l-ee," MISS",l-ee>1?"ES":""," LEFT!"]}),J&&e.jsxs("div",{className:"absolute top-20 left-1/2 -translate-x-1/2 z-30 px-4 py-2 rounded-full text-base font-bold",style:{background:"linear-gradient(135deg, hsl(45, 100%, 50%), hsl(25, 95%, 50%))",color:"white",boxShadow:"0 0 15px hsl(45, 100%, 50% / 0.4)"},children:["üî• ",ze,"x MULTIPLIER"]}),e.jsxs("div",{className:"relative w-full rounded-xl overflow-hidden",style:{background:"linear-gradient(to bottom, hsl(240, 35%, 5%), hsl(260, 40%, 8%), hsl(270, 45%, 10%))",height:"calc(100% - 100px)",minHeight:"350px",touchAction:"none",perspective:"800px",perspectiveOrigin:"center 30%"},children:[e.jsx(Re,{stars:He}),e.jsxs("div",{className:"absolute inset-0",style:{transformStyle:"preserve-3d",transform:"rotateX(35deg)",transformOrigin:"center bottom"},children:[e.jsx("div",{className:"absolute inset-0 flex pointer-events-none",children:O.map((t,s)=>e.jsx("div",{className:"flex-1 relative",style:{borderRight:s<2?"2px solid hsl(var(--border) / 0.4)":"none"},children:e.jsx("div",{className:"absolute left-1/2 top-0 bottom-0 w-0.5 -translate-x-1/2",style:{background:`linear-gradient(to bottom, ${F[t].color}10 0%, ${F[t].color}30 50%, ${F[t].color}50 100%)`}})},t))}),e.jsx("div",{className:"absolute inset-0 flex pointer-events-none",children:O.map(t=>{const s=F[t],n=me[t];return e.jsx("div",{className:"flex-1 transition-all duration-100",style:{background:`linear-gradient(to bottom, 
                      transparent 0%, 
                      ${s.color}${n?"18":"08"} 40%, 
                      ${s.color}${n?"40":"20"} 70%, 
                      ${s.color}${n?"60":"30"} 100%)`}},t)})})]}),e.jsx("div",{className:"absolute left-0 right-0 pointer-events-none z-8",style:{top:`${P-4}%`,height:"10%",background:`linear-gradient(to bottom, transparent, hsl(45, 100%, 60% / ${D?.3:.15}), transparent)`,transition:"background 0.08s ease-out"}}),e.jsx("div",{className:"absolute left-1/2 -translate-x-1/2 pointer-events-none z-6 transition-all duration-60",style:{top:`${P}%`,transform:"translate(-50%, -50%)",width:D?"180px":"120px",height:D?"180px":"120px",borderRadius:"50%",background:`radial-gradient(circle, hsl(45, 100%, 80% / ${D?.4:.1}), transparent 70%)`,boxShadow:D?"0 0 80px hsl(45, 100%, 60% / 0.6)":"none"}}),e.jsx("div",{className:"absolute left-0 right-0 pointer-events-none z-10",style:{top:`${P}%`,height:"6px",background:"linear-gradient(90deg, hsl(271, 91%, 65%), hsl(45, 100%, 60%), hsl(25, 95%, 55%))",boxShadow:`0 0 25px hsl(45, 100%, 60% / 0.8), 0 0 50px hsl(45, 100%, 60% / ${D?.6:.4})`,transition:"box-shadow 0.08s ease-out"}}),e.jsx("div",{className:"absolute left-0 right-0 flex justify-around pointer-events-none z-5",style:{top:`${P}%`,transform:"translateY(-50%)"},children:O.map(t=>{const s=F[t],n=me[t];return e.jsx("div",{className:"w-24 h-6 rounded-full transition-all duration-100",style:{background:n?`linear-gradient(180deg, ${s.color}60, ${s.color}30)`:`linear-gradient(180deg, ${s.color}30, ${s.color}10)`,border:`3px solid ${n?s.color:`${s.color}60`}`,boxShadow:n?`0 0 25px ${s.color}, inset 0 0 10px ${s.color}40`:`0 0 12px ${s.color}40`,transform:n?"scaleX(1.1)":"scaleX(1)"}},t)})}),e.jsx("div",{className:"absolute top-4 left-0 right-0 flex justify-around pointer-events-none z-20",children:O.map(t=>{const s=F[t],n=s.icon;return e.jsx("div",{className:"p-2 rounded-full",style:{background:`${s.color}25`},children:e.jsx(n,{className:"w-6 h-6",style:{color:s.color,opacity:.9}})},t)})}),X.map(t=>e.jsx(Ie,{note:t,laneIndex:Me[t.lane],gameTimeMs:re},t.id)),ue.map(t=>e.jsx(Ae,{lane:t.lane,result:t.result},t.id)),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 flex",style:{height:"14%"},children:O.map((t,s)=>e.jsx(Le,{lane:t,laneIndex:s,onTap:n=>Q(t,n),isPressed:S[t],hasApproachingNote:me[t]},t))})]}),i==="playing"&&e.jsx("div",{className:"text-center py-2 text-xs text-muted-foreground",children:"Tap lanes when bars reach the line ‚Ä¢ Keys: A/S/D or ‚Üê/‚Üì/‚Üí"})]})};export{yt as EclipseTimingGame};
