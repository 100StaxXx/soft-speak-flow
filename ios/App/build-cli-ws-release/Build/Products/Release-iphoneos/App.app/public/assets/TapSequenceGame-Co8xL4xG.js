import{r as a,j as e,l as O,m,af as ce}from"./vendor-FfY6MM0Z.js";import{bo as V,bp as de,bq as pe,br as me}from"./index-sX_cJ3I4.js";import{u as ue,g as xe,t as B}from"./gameUtils-G90wW1BE.js";import"./date-vendor-Bk4KiHsJ.js";import"./three-vendor-qI8GXUTd.js";const he={beginner:{orbModifier:-2,showTimeBonus:200,startLives:5},easy:{orbModifier:-1,showTimeBonus:100,startLives:4},medium:{orbModifier:0,showTimeBonus:0,startLives:3},hard:{orbModifier:1,showTimeBonus:-50,startLives:3},master:{orbModifier:2,showTimeBonus:-100,startLives:2}},ge=i=>{if(i<=2)return{orbs:4,showTimePerOrb:600};if(i<=4)return{orbs:5,showTimePerOrb:500};if(i<=6)return{orbs:6,showTimePerOrb:450};if(i<=8)return{orbs:7,showTimePerOrb:400};const n=Math.floor((i-8)/2),p=8+n,c=Math.max(300,350-n*10);return{orbs:p,showTimePerOrb:c}},Y=a.memo(({stars:i})=>e.jsx("div",{className:"absolute inset-0 overflow-hidden pointer-events-none",children:i.map(n=>e.jsx("div",{className:"absolute w-1 h-1 bg-white/40 rounded-full gpu-accelerated",style:{left:`${n.x}%`,top:`${n.y}%`,animation:`twinkle ${n.animationDuration}s ease-in-out infinite`,animationDelay:`${n.animationDelay}s`}},n.id))}));Y.displayName="StarBackground";const Z=a.memo(({orb:i,isHighlighted:n,isPast:p,isNext:c,showNumber:u,tapResult:j,onClick:g,disabled:v})=>{const t=a.useMemo(()=>i.tapped?{bg:"linear-gradient(135deg, #22c55e, #16a34a)",border:"rgba(34,197,94,0.6)",shadow:"0 0 25px rgba(34,197,94,0.5), inset 0 2px 4px rgba(255,255,255,0.2)"}:n?{bg:"linear-gradient(135deg, hsl(var(--primary)), hsl(var(--accent)))",border:"rgba(255,255,255,0.4)",shadow:"0 0 35px hsl(var(--primary)), 0 0 60px hsl(var(--primary)/0.4), inset 0 2px 4px rgba(255,255,255,0.3)"}:p?{bg:"linear-gradient(135deg, hsl(var(--primary)/0.5), hsl(var(--accent)/0.5))",border:"rgba(255,255,255,0.2)",shadow:"0 4px 15px rgba(0,0,0,0.3)"}:c?{bg:"linear-gradient(135deg, hsl(var(--primary)/0.4), hsl(var(--accent)/0.4))",border:"hsl(var(--primary)/0.6)",shadow:"0 0 20px hsl(var(--primary)/0.4), inset 0 2px 4px rgba(255,255,255,0.15)"}:{bg:"linear-gradient(135deg, rgba(255,255,255,0.06), rgba(255,255,255,0.02))",border:"rgba(255,255,255,0.1)",shadow:"0 4px 12px rgba(0,0,0,0.2), inset 0 1px 0 rgba(255,255,255,0.05)"},[i.tapped,n,p,c]);return e.jsxs(m.button,{className:"absolute rounded-full flex items-center justify-center font-bold gpu-accelerated touch-target w-14 h-14",style:{left:`${i.x}%`,top:`${i.y}%`,transform:"translate(-50%, -50%)",background:t.bg,border:`2px solid ${t.border}`,boxShadow:t.shadow},initial:{scale:0,opacity:0},animate:{scale:n?1.25:1,opacity:1},exit:{scale:0,opacity:0},onClick:g,disabled:v,whileTap:{scale:.92},transition:{type:"spring",stiffness:400,damping:25},children:[e.jsx("span",{className:`text-lg ${n||i.tapped?"text-white":"text-white/70"}`,style:{textShadow:n?"0 0 10px white":"none",fontWeight:n?800:600},children:u?i.order:"?"}),c&&e.jsx(m.div,{className:"absolute inset-[-3px] rounded-full",style:{border:"2px solid hsl(var(--primary))"},animate:{scale:[1,1.3,1],opacity:[.8,0,.8]},transition:{duration:1.2,repeat:1/0}}),n&&e.jsx(m.div,{className:"absolute inset-0 rounded-full border-2 border-white",initial:{scale:1,opacity:.8},animate:{scale:2,opacity:0},transition:{duration:.8,repeat:1/0}}),j&&e.jsx(m.div,{className:"absolute inset-0 rounded-full flex items-center justify-center",initial:{scale:.5,opacity:1},animate:{scale:2.5,opacity:0},transition:{duration:.5},children:e.jsx("span",{className:"text-2xl",children:j.success?"âœ¨":"âŒ"})})]})});Z.displayName="OrbComponent";const H=a.memo(({orbs:i,highlightIndex:n})=>n<=0?null:e.jsx("svg",{className:"absolute inset-0 pointer-events-none z-0",width:"100%",height:"100%",children:i.slice(0,n).map((p,c)=>{if(c===0)return null;const u=i[c-1];return e.jsx(m.line,{x1:`${u.x}%`,y1:`${u.y}%`,x2:`${p.x}%`,y2:`${p.y}%`,stroke:"hsl(var(--primary))",strokeWidth:"2",strokeOpacity:"0.4",strokeDasharray:"5,5",initial:{pathLength:0},animate:{pathLength:1},transition:{duration:.3}},`line-${c}`)})}));H.displayName="ConnectionLines";const E=a.memo(({lives:i,maxLives:n=3})=>e.jsx("div",{className:"flex items-center gap-0.5",children:Array.from({length:n}).map((p,c)=>e.jsx(m.div,{initial:!1,animate:{scale:c<i?1:.8,opacity:c<i?1:.3},transition:{type:"spring",stiffness:400},children:e.jsx(ce,{className:`w-4 h-4 ${c<i?"fill-red-500 text-red-500":"fill-gray-600 text-gray-600"}`})},c))}));E.displayName="LivesDisplay";const je=({companionStats:i,onComplete:n,onDamage:p,tierAttackDamage:c=15,difficulty:u="medium",isPractice:j=!1,compact:g=!1})=>{const v=he[u],[t,f]=a.useState("countdown"),[y,C]=a.useState([]),[N,M]=a.useState(1),[w,T]=a.useState(0),[d,J]=a.useState(1),[$,K]=a.useState(0),[P,Q]=a.useState(v.startLives),[ee,G]=a.useState(!1),[q,S]=a.useState(null),[D,I]=a.useState(0),[F,te]=a.useState(0),[_,se]=a.useState(0),[R,k]=a.useState(null),[W,z]=a.useState(0),U=ge(d),h=Math.max(3,U.orbs+v.orbModifier),X=U.showTimePerOrb+v.showTimeBonus+i.mind/100*150,ae=ue(10),L=a.useCallback(()=>{const s=[...xe(h,12,75)].sort(()=>Math.random()-.5).map((x,b)=>({id:b,x:x.x,y:x.y,order:b+1,tapped:!1})),l=Array.from({length:h},(x,b)=>b+1).sort(()=>Math.random()-.5);s.forEach((x,b)=>{x.order=l[b]}),C(s)},[h]);a.useEffect(()=>{L()},[L]);const re=a.useCallback(()=>{f("showing"),T(0)},[]);a.useEffect(()=>{if(t!=="showing"&&t!=="reshowing"||y.length===0)return;const r=[...y].sort((s,l)=>s.order-l.order),o=setTimeout(()=>{w<r.length?(B("light"),T(s=>s+1)):(f("playing"),T(0))},X);return()=>clearTimeout(o)},[t,w,y,X]);const A=a.useCallback(r=>{f("complete");const o=_>0?Math.round(F/_*100):0,s=Math.min(d*5,50),l=Math.min(100,o+s);n({success:r,accuracy:Math.min(l,100),result:r?l>=90?"perfect":"good":"fail",highScoreValue:d,gameStats:{level:d,score:$}})},[d,F,_,n,$]),ne=a.useCallback(r=>{if(!(t!=="playing"||r.tapped))if(se(o=>o+1),r.order===N){B("success"),C(s=>s.map(l=>l.id===r.id?{...l,tapped:!0}:l)),M(s=>s+1),te(s=>s+1);const o=D===0?2:1;if(K(s=>s+10*d*o),S({id:r.id,success:!0}),setTimeout(()=>S(null),400),N===h){const s=W===0;k(s?"â­ Perfect!":"âœ“ Level Complete!");const l=s?V.tap_sequence.perfectLevel:V.tap_sequence.levelComplete;p?.({target:"adversary",amount:l,source:s?"perfect_level":"level_complete"}),setTimeout(()=>{if(k(null),j&&d>=2){A(!0);return}J(x=>x+1),M(1),I(0),z(0),f("showing"),T(0),L()},1e3)}}else B("error"),z(o=>o+1),p?.({target:"player",amount:c,source:"wrong_tap"}),Q(o=>{const s=o-1;return s<=0?setTimeout(()=>A(!1),500):(I(l=>l+1),M(1),C(l=>l.map(x=>({...x,tapped:!1}))),k("âŒ Wrong! Watch again..."),setTimeout(()=>{k(null),f("reshowing"),T(0)},1e3)),s}),G(!0),S({id:r.id,success:!1}),setTimeout(()=>{G(!1),S(null)},400)},[t,N,h,d,D,W,L,A,p,c,j]),ie=a.useCallback(()=>{const r=[...y].sort((o,s)=>o.order-s.order);return w>0&&w<=r.length?r[w-1].order:0},[y,w]),oe=a.useCallback(()=>t==="showing"||t==="reshowing"?"Watch the sequence...":t==="playing"?`Tap orb ${N} of ${h}`:"",[t,N,h]);return e.jsxs("div",{className:`flex flex-col items-center relative flex-1 min-h-0 ${ee?"animate-shake":""}`,children:[t==="countdown"&&e.jsx(de,{count:3,onComplete:re}),e.jsx(O,{children:t==="paused"&&e.jsx(pe,{onResume:()=>f("playing")})}),e.jsx(me,{title:"Memory Sequence",subtitle:oe(),score:$,maxScore:d*200,showCombo:!1,phase:d-1,totalPhases:10,isPaused:t==="paused",onPauseToggle:()=>f(t==="paused"?"playing":"paused"),compact:g}),!g&&e.jsxs("div",{className:"w-full max-w-[280px] mb-1 flex items-center justify-between",children:[e.jsx(E,{lives:P}),e.jsx(m.div,{initial:{scale:1.2,opacity:0},animate:{scale:1,opacity:1},className:"px-2 py-0.5 bg-primary/20 rounded-full border border-primary/40",children:e.jsxs("span",{className:"text-xs font-bold text-primary",children:["Level ",d]})},d)]}),g&&e.jsxs("div",{className:"w-full max-w-[280px] mb-0.5 flex items-center justify-between text-xs",children:[e.jsx(E,{lives:P}),e.jsxs("span",{className:"font-bold text-primary text-[10px]",children:["Lv",d]}),e.jsxs("span",{className:"text-muted-foreground text-[10px]",children:[h," orbs"]})]}),!g&&e.jsxs("div",{className:"mb-0.5 flex items-center gap-1.5",children:[e.jsx("span",{className:`text-[10px] px-1.5 py-0.5 rounded-full ${u==="beginner"?"bg-blue-500/20 text-blue-400":u==="easy"?"bg-green-500/20 text-green-400":u==="medium"?"bg-yellow-500/20 text-yellow-400":u==="hard"?"bg-orange-500/20 text-orange-400":"bg-red-500/20 text-red-400"}`,children:u.toUpperCase()}),e.jsxs("span",{className:"text-[10px] text-muted-foreground",children:[h," orbs"]})]}),e.jsxs("div",{className:"relative w-full aspect-square max-w-[280px] rounded-2xl overflow-hidden",style:{background:"linear-gradient(145deg, rgba(0,0,0,0.85) 0%, rgba(15,15,35,0.95) 50%, rgba(25,15,45,0.9) 100%)",border:"1px solid rgba(255,255,255,0.08)",boxShadow:"0 25px 50px -12px rgba(0,0,0,0.6), inset 0 1px 0 rgba(255,255,255,0.05)"},children:[e.jsxs("div",{className:"absolute inset-0 pointer-events-none",children:[e.jsx("div",{className:"absolute top-0 left-0 w-32 h-32 bg-purple-500/8 rounded-full blur-3xl"}),e.jsx("div",{className:"absolute bottom-0 right-0 w-40 h-40 bg-cyan-500/6 rounded-full blur-3xl"})]}),e.jsx(Y,{stars:ae}),(t==="showing"||t==="reshowing")&&e.jsx(H,{orbs:[...y].sort((r,o)=>r.order-o.order),highlightIndex:w}),e.jsx(O,{children:y.map(r=>{const o=ie(),s=(t==="showing"||t==="reshowing")&&r.order===o,l=(t==="showing"||t==="reshowing")&&r.order<o,x=!1,b=q?.id===r.id?q:null,le=t==="showing"||t==="reshowing"||r.tapped;return e.jsx(Z,{orb:r,isHighlighted:s,isPast:l,isNext:x,showNumber:le,tapResult:b,onClick:()=>ne(r),disabled:t!=="playing"||r.tapped},r.id)})}),e.jsx(O,{children:R&&e.jsx(m.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.8},className:"absolute inset-0 flex items-center justify-center z-30",style:{background:"rgba(0,0,0,0.85)",backdropFilter:"blur(8px)"},children:e.jsx(m.div,{initial:{scale:0},animate:{scale:1},className:"text-center",children:e.jsx("p",{className:"text-2xl font-bold text-white",children:R})})})}),e.jsx(O,{children:P<=0&&t!=="complete"&&e.jsx(m.div,{initial:{opacity:0},animate:{opacity:1},className:"absolute inset-0 flex items-center justify-center z-30",style:{background:"rgba(0,0,0,0.9)",backdropFilter:"blur(8px)"},children:e.jsxs(m.div,{initial:{scale:0},animate:{scale:1},className:"text-center",children:[e.jsx("span",{className:"text-5xl",children:"ðŸ’”"}),e.jsx("p",{className:"text-xl font-bold text-white mt-3",children:"Game Over!"}),e.jsxs("p",{className:"text-lg text-primary mt-1",children:["Reached Level ",d]})]})})})]}),!g&&e.jsx(m.p,{className:"mt-2 text-xs text-muted-foreground text-center",initial:{opacity:0},animate:{opacity:1},children:t==="showing"||t==="reshowing"?"ðŸ‘€ Memorize the sequence...":t==="playing"?"ðŸ‘† Tap the orbs in order!":""}),!g&&e.jsxs("div",{className:"mt-1 flex items-center gap-3 text-[10px] text-muted-foreground",children:[e.jsxs("span",{children:[v.startLives," lives â€¢ Endless"]}),e.jsx("span",{className:"text-primary",children:"No time limit"})]}),e.jsx("style",{children:`
        @keyframes shake {
          0%, 100% { transform: translateX(0); }
          10%, 30%, 50%, 70%, 90% { transform: translateX(-3px); }
          20%, 40%, 60%, 80% { transform: translateX(3px); }
        }
        .animate-shake { animation: shake 0.3s ease-in-out; }
        @keyframes twinkle {
          0%, 100% { opacity: 0.15; transform: scale(0.6); }
          50% { opacity: 0.7; transform: scale(1); }
        }
        .gpu-accelerated {
          transform: translateZ(0);
          backface-visibility: hidden;
          will-change: transform, opacity;
        }
        .touch-target {
          min-height: 44px;
          min-width: 44px;
          touch-action: manipulation;
          -webkit-tap-highlight-color: transparent;
        }
      `})]})};export{je as TapSequenceGame};
