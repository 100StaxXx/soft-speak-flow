import{u as ie,r as v,q as te,aB as Y,aA as m,j as e,aa as R,dr as J,Z as ve,Q as Le,Y as Oe,cm as ee,bx as ne,al as Ge,a_ as Be,ds as ze,c9 as We,dt as Ve,aZ as Ne,dg as ue,du as He,dv as Ke,dn as Qe,bu as K,b_ as Ye,dw as Je,dx as oe,W as ye,bY as be,ak as Xe,dy as Ze,dz as es,dA as ss,dB as ts,bF as X,ad as as,o as rs,dh as ls,_ as we,ar as ns,X as xe,dC as os,dD as is}from"./vendor-FfY6MM0Z.js";import{s as g,f as O,B as N,G as V,ap as se,a as w,J as he,K as pe,N as ds,g as ge,L as u,P as cs,aq as Ce,c as ms,ar as us,p as fe,a5 as xs}from"./index-sX_cJ3I4.js";import"./date-vendor-Bk4KiHsJ.js";import"./three-vendor-qI8GXUTd.js";const Z=50,hs=()=>{const r=ie(),[y,k]=v.useState(null),[f,E]=v.useState(""),[D,b]=v.useState(null),{data:T,isLoading:L}=te({queryKey:["admin-referral-payouts"],queryFn:async()=>{const{data:t,error:l}=await g.from("referral_payouts").select(`
          *,
          referral_code:referral_codes!referral_code_id(
            code,
            owner_type,
            owner_user_id,
            influencer_name,
            influencer_email,
            influencer_handle,
            payout_identifier
          ),
          referee:profiles!referee_id(email)
        `).order("created_at",{ascending:!1});if(l)throw l;return t}}),M=T?Object.values(T.filter(t=>t.referral_code_id).reduce((t,l)=>{const n=l.referral_code_id;if(!t[n]){const p=l.referral_code;t[n]={referral_code_id:n,code:p?.code||"Unknown",owner_type:p?.owner_type||"user",referrer_name:p?.owner_type==="influencer"?p.influencer_name||"Unknown":p?.influencer_email||"Unknown",referrer_email:p?.owner_type==="influencer"?p.influencer_email||"":p?.influencer_email||"",referrer_handle:p?.owner_type==="influencer"?p.influencer_handle:null,paypal_email:p?.payout_identifier||null,total_pending:0,total_approved:0,total_paid:0,pending_count:0,approved_count:0,paid_count:0}}return l.status==="pending"?(t[n].total_pending+=Number(l.amount),t[n].pending_count++):l.status==="approved"?(t[n].total_approved+=Number(l.amount),t[n].approved_count++):l.status==="paid"&&(t[n].total_paid+=Number(l.amount),t[n].paid_count++),t},{})):[],j=Y({mutationFn:async({payoutId:t,notes:l})=>{const{error:n}=await g.from("referral_payouts").update({status:"approved",approved_at:new Date().toISOString(),admin_notes:l||null}).eq("id",t);if(n)throw n},onSuccess:()=>{r.invalidateQueries({queryKey:["admin-referral-payouts"]}),m.success("Payout approved"),E("")},onError:t=>{console.error("Failed to approve payout:",t),m.error("Failed to approve payout")}}),h=Y({mutationFn:async({payoutId:t,notes:l})=>{const{error:n}=await g.from("referral_payouts").update({status:"rejected",rejected_at:new Date().toISOString(),admin_notes:l||null}).eq("id",t);if(n)throw n},onSuccess:()=>{r.invalidateQueries({queryKey:["admin-referral-payouts"]}),m.success("Payout rejected"),E("")},onError:t=>{console.error("Failed to reject payout:",t),m.error("Failed to reject payout")}}),C=Y({mutationFn:async t=>{b(t);const{data:l,error:n}=await g.functions.invoke("process-paypal-payout",{body:{payout_id:t}});if(n)throw n;if(l.error)throw new Error(l.error);return l},onSuccess:t=>{r.invalidateQueries({queryKey:["admin-referral-payouts"]}),m.success(`Payout processed! PayPal Batch ID: ${t.payout_batch_id}`),b(null)},onError:t=>{console.error("Failed to process payout:",t),m.error(`Failed to process payout: ${t.message}`),b(null)}}),o=Y({mutationFn:async()=>{const{data:t,error:l}=await g.functions.invoke("retry-failed-payouts",{});if(l)throw l;if(t.error)throw new Error(t.error);return t},onSuccess:t=>{r.invalidateQueries({queryKey:["admin-referral-payouts"]}),m.success(`Retried ${t.processed||0} failed payouts`)},onError:t=>{console.error("Failed to bulk retry:",t),m.error(`Failed to retry payouts: ${t.message}`)}}),P=Y({mutationFn:async t=>{const l=T?.filter(p=>p.referral_code_id===t&&p.status==="pending");if(!l||l.length===0)return;const{error:n}=await g.from("referral_payouts").update({status:"approved",approved_at:new Date().toISOString()}).eq("referral_code_id",t).eq("status","pending");if(n)throw n},onSuccess:()=>{r.invalidateQueries({queryKey:["admin-referral-payouts"]}),m.success("All pending payouts approved")},onError:t=>{console.error("Failed to bulk approve:",t),m.error("Failed to approve payouts")}}),S=T?.filter(t=>t.status==="failed").length||0,$=T?.filter(t=>t.referral_code_id===y),d=M.find(t=>t.referral_code_id===y);return L?e.jsx(O,{className:"p-6 rounded-3xl",children:e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(R,{className:"h-8 w-8 animate-spin text-primary"})})}):e.jsxs(O,{className:"p-6 mb-8 rounded-3xl shadow-soft",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx(J,{className:"h-6 w-6 text-primary"}),e.jsx("h2",{className:"font-heading text-2xl font-semibold",children:"Referral Payouts Management"})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-secondary/30 rounded-lg p-4 text-center",children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Total Pending"}),e.jsxs("p",{className:"text-xl font-bold text-yellow-500",children:["$",T?.filter(t=>t.status==="pending").reduce((t,l)=>t+Number(l.amount),0).toFixed(2)||"0.00"]})]}),e.jsxs("div",{className:"bg-secondary/30 rounded-lg p-4 text-center",children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Total Approved"}),e.jsxs("p",{className:"text-xl font-bold text-blue-500",children:["$",T?.filter(t=>t.status==="approved").reduce((t,l)=>t+Number(l.amount),0).toFixed(2)||"0.00"]})]}),e.jsxs("div",{className:"bg-secondary/30 rounded-lg p-4 text-center",children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Total Paid"}),e.jsxs("p",{className:"text-xl font-bold text-green-500",children:["$",T?.filter(t=>t.status==="paid").reduce((t,l)=>t+Number(l.amount),0).toFixed(2)||"0.00"]})]}),e.jsxs("div",{className:"bg-secondary/30 rounded-lg p-4 text-center",children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Referrers"}),e.jsx("p",{className:"text-xl font-bold text-primary",children:M.length})]}),e.jsxs("div",{className:"bg-red-500/10 rounded-lg p-4 text-center border border-red-500/20",children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Failed"}),e.jsx("p",{className:"text-xl font-bold text-red-500",children:S})]})]}),S>0&&e.jsx("div",{className:"mb-6 p-4 bg-red-500/10 border border-red-500/20 rounded-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ve,{className:"h-5 w-5 text-red-500"}),e.jsxs("span",{className:"font-medium text-red-600",children:[S," failed payout(s) need attention"]})]}),e.jsxs(N,{size:"sm",variant:"outline",className:"border-red-500 text-red-500 hover:bg-red-50",onClick:()=>o.mutate(),disabled:o.isPending,children:[o.isPending?e.jsx(R,{className:"h-4 w-4 animate-spin mr-1"}):e.jsx(Le,{className:"h-4 w-4 mr-1"}),"Retry All Failed"]})]})}),e.jsxs("p",{className:"text-sm text-muted-foreground mb-4",children:[e.jsx(Oe,{className:"h-4 w-4 inline mr-1 text-amber-500"}),"Minimum payout threshold: $",Z,". Only process payouts when referrer total reaches this amount."]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"font-semibold text-lg flex items-center gap-2",children:[e.jsx(ee,{className:"h-5 w-5"}),"Referrers"]}),M.length===0?e.jsx("p",{className:"text-muted-foreground text-center py-8",children:"No referral payouts yet"}):e.jsx("div",{className:"space-y-3",children:M.map(t=>{const l=t.total_pending+t.total_approved+t.total_paid,n=t.total_approved>=Z,p=y===t.referral_code_id;return e.jsxs("div",{className:`p-4 rounded-lg border cursor-pointer transition-all ${p?"border-primary bg-primary/5":"border-border hover:border-primary/50"}`,onClick:()=>k(p?null:t.referral_code_id),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("p",{className:"font-medium",children:t.referrer_name}),t.owner_type==="influencer"&&e.jsx(V,{variant:"secondary",className:"text-xs",children:"Influencer"})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:t.referrer_email}),t.referrer_handle&&e.jsx("p",{className:"text-xs text-primary",children:t.referrer_handle}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Code: ",t.code]}),t.paypal_email&&e.jsxs("p",{className:"text-xs text-green-600",children:["PayPal: ",t.paypal_email]}),!t.paypal_email&&e.jsx("p",{className:"text-xs text-red-500",children:"No PayPal email set"})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-lg font-bold",children:["$",l.toFixed(2)]}),e.jsxs("div",{className:"flex gap-2 text-xs",children:[e.jsxs("span",{className:"text-yellow-500",children:["P: $",t.total_pending.toFixed(2)]}),e.jsxs("span",{className:"text-blue-500",children:["A: $",t.total_approved.toFixed(2)]}),e.jsxs("span",{className:"text-green-500",children:["D: $",t.total_paid.toFixed(2)]})]}),n&&t.paypal_email&&e.jsx(V,{className:"mt-1 bg-green-500",children:"Ready for payout"}),t.total_approved>0&&t.total_approved<Z&&e.jsxs(V,{variant:"outline",className:"mt-1",children:["$",(Z-t.total_approved).toFixed(2)," more needed"]})]})]}),p&&$&&e.jsxs("div",{className:"mt-4 pt-4 border-t space-y-4",children:[t.pending_count>0&&e.jsx("div",{className:"flex gap-2",children:e.jsxs(N,{size:"sm",onClick:a=>{a.stopPropagation(),P.mutate(t.referral_code_id)},disabled:P.isPending,children:[e.jsx(ne,{className:"h-4 w-4 mr-1"}),"Approve All Pending (",t.pending_count,")"]})}),e.jsx("div",{className:"space-y-2",children:$.map(a=>e.jsxs("div",{className:"flex items-center justify-between bg-secondary/20 rounded-lg p-3",onClick:c=>c.stopPropagation(),children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(V,{variant:a.status==="paid"?"default":a.status==="approved"?"secondary":a.status==="rejected"?"destructive":"outline",children:a.status}),e.jsxs("span",{className:"font-medium",children:["$",Number(a.amount).toFixed(2)]}),e.jsx("span",{className:"text-sm text-muted-foreground",children:a.payout_type==="first_month"?"Monthly":"Yearly"})]}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Referee: ",a.referee?.email]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:new Date(a.created_at).toLocaleDateString()}),a.admin_notes&&e.jsxs("p",{className:"text-xs text-amber-600 mt-1",children:["Note: ",a.admin_notes]})]}),e.jsxs("div",{className:"flex gap-2",children:[a.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsx(N,{size:"sm",variant:"outline",className:"text-green-600 border-green-600 hover:bg-green-50",onClick:()=>j.mutate({payoutId:a.id,notes:f}),disabled:j.isPending,children:e.jsx(ne,{className:"h-4 w-4"})}),e.jsx(N,{size:"sm",variant:"outline",className:"text-red-600 border-red-600 hover:bg-red-50",onClick:()=>h.mutate({payoutId:a.id,notes:f}),disabled:h.isPending,children:e.jsx(Ge,{className:"h-4 w-4"})})]}),a.status==="approved"&&e.jsx(N,{size:"sm",className:"bg-green-600 hover:bg-green-700",onClick:()=>C.mutate(a.id),disabled:D===a.id||!t.paypal_email,children:D===a.id?e.jsx(R,{className:"h-4 w-4 animate-spin"}):e.jsxs(e.Fragment,{children:[e.jsx(Be,{className:"h-4 w-4 mr-1"}),"Pay"]})}),a.status==="paid"&&e.jsxs("span",{className:"text-green-600 text-sm flex items-center",children:[e.jsx(ne,{className:"h-4 w-4 mr-1"}),"Paid"]})]})]},a.id))}),d&&(d.pending_count>0||d.approved_count>0)&&e.jsx("div",{className:"pt-2",children:e.jsx(se,{placeholder:"Admin notes (optional)",value:f,onChange:a=>E(a.target.value),className:"text-sm",rows:2})})]})]},t.referral_code_id)})})]})]})},ps=()=>{const r=ie(),[y,k]=v.useState(""),[f,E]=v.useState("all"),[D,b]=v.useState(null),{data:T,isLoading:L}=te({queryKey:["admin-referral-codes"],queryFn:async()=>{const{data:o,error:P}=await g.from("referral_codes").select("*").order("created_at",{ascending:!1});if(P)throw P;return await Promise.all(o.map(async $=>{const{count:d}=await g.from("profiles").select("*",{count:"exact",head:!0}).eq("referred_by_code",$.code),{data:t}=await g.from("referral_payouts").select("amount").eq("referral_code_id",$.id),l=t?.reduce((n,p)=>n+Number(p.amount),0)||0;return{...$,conversion_count:d||0,total_earnings:l}}))}}),M=Y({mutationFn:async({codeId:o,isActive:P})=>{b(o);const{error:S}=await g.from("referral_codes").update({is_active:!P}).eq("id",o);if(S)throw S},onSuccess:()=>{r.invalidateQueries({queryKey:["admin-referral-codes"]}),m.success("Code status updated"),b(null)},onError:o=>{console.error("Failed to toggle code status:",o),m.error("Failed to update code status"),b(null)}}),j=T?.filter(o=>{const P=o.code.toLowerCase().includes(y.toLowerCase())||o.influencer_name?.toLowerCase().includes(y.toLowerCase())||o.influencer_email?.toLowerCase().includes(y.toLowerCase())||o.influencer_handle?.toLowerCase().includes(y.toLowerCase()),S=f==="all"||o.owner_type===f;return P&&S}),h={totalCodes:T?.length||0,activeCodes:T?.filter(o=>o.is_active).length||0,userCodes:T?.filter(o=>o.owner_type==="user").length||0,influencerCodes:T?.filter(o=>o.owner_type==="influencer").length||0,totalConversions:T?.reduce((o,P)=>o+(P.conversion_count||0),0)||0,totalEarnings:T?.reduce((o,P)=>o+(P.total_earnings||0),0)||0},C=o=>{navigator.clipboard.writeText(o),m.success("Copied to clipboard")};return L?e.jsx(O,{className:"p-6 rounded-3xl",children:e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(R,{className:"h-8 w-8 animate-spin text-primary"})})}):e.jsxs(O,{className:"p-6 mb-8 rounded-3xl shadow-soft",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx(ze,{className:"h-6 w-6 text-primary"}),e.jsx("h2",{className:"font-heading text-2xl font-semibold",children:"Referral Codes Management"})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-secondary/30 rounded-lg p-4 text-center",children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Total Codes"}),e.jsx("p",{className:"text-2xl font-bold text-primary",children:h.totalCodes})]}),e.jsxs("div",{className:"bg-secondary/30 rounded-lg p-4 text-center",children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Active"}),e.jsx("p",{className:"text-2xl font-bold text-green-500",children:h.activeCodes})]}),e.jsxs("div",{className:"bg-secondary/30 rounded-lg p-4 text-center",children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"User Codes"}),e.jsx("p",{className:"text-2xl font-bold text-blue-500",children:h.userCodes})]}),e.jsxs("div",{className:"bg-secondary/30 rounded-lg p-4 text-center",children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Influencer Codes"}),e.jsx("p",{className:"text-2xl font-bold text-purple-500",children:h.influencerCodes})]}),e.jsxs("div",{className:"bg-secondary/30 rounded-lg p-4 text-center",children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Conversions"}),e.jsx("p",{className:"text-2xl font-bold text-orange-500",children:h.totalConversions})]}),e.jsxs("div",{className:"bg-secondary/30 rounded-lg p-4 text-center",children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Total Earnings"}),e.jsxs("p",{className:"text-2xl font-bold text-green-600",children:["$",h.totalEarnings.toFixed(2)]})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 mb-6",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(We,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(w,{placeholder:"Search by code, name, email, handle...",value:y,onChange:o=>k(o.target.value),className:"pl-10"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(N,{variant:f==="all"?"default":"outline",size:"sm",onClick:()=>E("all"),children:[e.jsx(Ve,{className:"h-4 w-4 mr-1"}),"All"]}),e.jsxs(N,{variant:f==="user"?"default":"outline",size:"sm",onClick:()=>E("user"),children:[e.jsx(ee,{className:"h-4 w-4 mr-1"}),"Users"]}),e.jsxs(N,{variant:f==="influencer"?"default":"outline",size:"sm",onClick:()=>E("influencer"),children:[e.jsx(Ne,{className:"h-4 w-4 mr-1"}),"Influencers"]})]})]}),e.jsx("div",{className:"space-y-3",children:j&&j.length===0?e.jsx("p",{className:"text-muted-foreground text-center py-8",children:"No referral codes found"}):j?.map(o=>e.jsx("div",{className:"p-4 rounded-lg border border-border hover:border-primary/50 transition-all",children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("code",{className:"font-mono text-lg font-bold text-primary",children:o.code}),e.jsx(N,{variant:"ghost",size:"sm",onClick:()=>C(o.code),className:"h-6 w-6 p-0",children:e.jsx(ue,{className:"h-3 w-3"})}),e.jsx(V,{variant:o.owner_type==="influencer"?"default":"secondary",children:o.owner_type}),e.jsx(V,{variant:o.is_active?"default":"outline",children:o.is_active?"Active":"Inactive"})]}),o.owner_type==="influencer"?e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"font-medium",children:o.influencer_name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:o.influencer_email}),o.influencer_handle&&e.jsx("p",{className:"text-sm text-primary",children:o.influencer_handle}),o.payout_identifier&&e.jsxs("p",{className:"text-xs text-green-600",children:["PayPal: ",o.payout_identifier]})]}):e.jsxs("p",{className:"text-sm text-muted-foreground",children:["User ID: ",o.owner_user_id?.substring(0,8),"..."]}),e.jsxs("div",{className:"flex items-center gap-4 mt-2 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ee,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("span",{children:[o.conversion_count," conversions"]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(J,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("span",{children:["$",o.total_earnings?.toFixed(2)||"0.00"," earned"]})]}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:["Created ",new Date(o.created_at).toLocaleDateString()]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(N,{variant:"outline",size:"sm",onClick:()=>M.mutate({codeId:o.id,isActive:o.is_active}),disabled:D===o.id,children:D===o.id?e.jsx(R,{className:"h-4 w-4 animate-spin"}):o.is_active?e.jsxs(e.Fragment,{children:[e.jsx(He,{className:"h-4 w-4 mr-1"}),"Deactivate"]}):e.jsxs(e.Fragment,{children:[e.jsx(Ke,{className:"h-4 w-4 mr-1"}),"Activate"]})}),o.owner_type==="influencer"&&e.jsx(N,{variant:"ghost",size:"sm",onClick:()=>C(`${window.location.origin}/?ref=${o.code}`),children:e.jsx(Qe,{className:"h-4 w-4"})})]})]})},o.id))}),e.jsxs("div",{className:"mt-6 p-4 bg-primary/5 border border-primary/20 rounded-lg",children:[e.jsx("p",{className:"text-sm font-medium mb-2",children:"Influencer Sign-Up Portal"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("code",{className:"flex-1 text-xs bg-background/50 px-3 py-2 rounded",children:[window.location.origin,"/creator"]}),e.jsx(N,{variant:"outline",size:"sm",onClick:()=>C(`${window.location.origin}/creator`),children:e.jsx(ue,{className:"h-4 w-4"})})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:"Share this link with influencers to generate their referral codes"})]})]})},gs=()=>{const[r,y]=v.useState(!1),[k,f]=v.useState([]),[E,D]=v.useState("test-influencer"),[b,T]=v.useState(""),[L,M]=v.useState(""),j=(d,t,l)=>{f(n=>[...n,{step:d,status:t,message:l}])},h=()=>{f([])},C=async()=>{y(!0),h();try{const d=`${E.toLowerCase().replace(/\s+/g,"")}@test.com`,t=`@${E.toLowerCase().replace(/\s+/g,"_")}`;j("Creating influencer code","success",`Attempting to create code for: ${E}`);const{data:l,error:n}=await g.functions.invoke("create-influencer-code",{body:{name:E,email:d,handle:t,paypal_email:d}});if(n)throw n;if(l.error)throw new Error(l.error);j("Influencer code created","success",`Code: ${l.code}, Link: ${l.link}`),T(l.code),m.success("Influencer code created successfully!")}catch(d){j("Failed to create code","error",d.message),m.error("Failed to create influencer code")}finally{y(!1)}},o=async()=>{if(!b){m.error("Please create an influencer code first");return}y(!0);try{j("Testing signup flow","success",`Using code: ${b}`);const{data:d,error:t}=await g.from("referral_codes").select("*").eq("code",b).eq("is_active",!0).maybeSingle();if(t)throw t;if(!d)throw new Error("Code not found or inactive");j("Code validation","success",`Code found: ${d.code}, Signups: ${d.total_signups||0}`);const{error:l}=await g.from("referral_codes").update({total_signups:(d.total_signups||0)+1}).eq("id",d.id);if(l)throw l;j("Signup tracked","success","User signup recorded successfully"),m.success("Signup test completed!")}catch(d){j("Signup test failed","error",d.message),m.error("Signup test failed")}finally{y(!1)}},P=async()=>{if(!b){m.error("Please create an influencer code first");return}y(!0);try{j("Simulating subscription","success",`Testing conversion for code: ${b}`);const{data:d,error:t}=await g.from("referral_codes").select("*").eq("code",b).maybeSingle();if(t)throw t;if(!d)throw new Error("Code not found");j("Code fetched","success",`Code ID: ${d.id}`);const l={referralCode:b,subscriptionType:"monthly",amount:9.99,currency:"USD",userId:L||"test-user-"+Date.now()};j("Webhook simulation","success",`Monthly sub: $${l.amount}`);const n=l.amount*.5,{data:{user:p}}=await g.auth.getUser(),a=p?.id||"00000000-0000-0000-0000-000000000000",c=p?.id||"00000000-0000-0000-0000-000000000000",{data:I,error:U}=await g.from("referral_payouts").insert({referral_code_id:d.id,referrer_id:a,referee_id:c,amount:n,payout_type:"first_month",status:"pending"}).select().maybeSingle();if(U)throw U;if(!I)throw new Error("Failed to create payout record");j("Payout created","success",`Payout ID: ${I.id}, Amount: $${n.toFixed(2)}`);const{error:i}=await g.from("referral_codes").update({total_conversions:(d.total_conversions||0)+1,total_revenue:(d.total_revenue||0)+l.amount}).eq("id",d.id);i&&j("Warning","error",`Stats update failed: ${i.message} (non-critical)`),j("Stats updated","success","Conversion and revenue tracked"),m.success("Subscription conversion test completed!")}catch(d){j("Conversion test failed","error",d.message),m.error("Conversion test failed")}finally{y(!1)}},S=async()=>{y(!0);try{j("Testing payout approval","success","Fetching pending payouts");const{data:d,error:t}=await g.from("referral_payouts").select("*").eq("status","pending").limit(1);if(t)throw t;if(!d||d.length===0)throw new Error("No pending payouts found. Create a subscription conversion first.");const l=d[0];if(l.referral_code_id){const{data:p}=await g.from("referral_codes").select("code, influencer_name, payout_identifier").eq("id",l.referral_code_id).maybeSingle();p?(j("Payout found","success",`ID: ${l.id}, Amount: $${l.amount}, Code: ${p.code}`),j("Payout check","success",`Identifier: ${p.payout_identifier||"Not set"}`)):j("Payout found","success",`ID: ${l.id}, Amount: $${l.amount}`)}else j("Payout found","success",`ID: ${l.id}, Amount: $${l.amount}`);const{error:n}=await g.from("referral_payouts").update({status:"approved",approved_at:new Date().toISOString()}).eq("id",l.id);if(n)throw n;j("Payout approved","success","Status updated to approved"),m.success("Payout approval test completed!")}catch(d){j("Approval test failed","error",d.message),m.error("Approval test failed")}finally{y(!1)}},$=async()=>{y(!0);try{j("Testing PayPal integration","success","Note: This requires valid PayPal credentials");const{data:d,error:t}=await g.from("referral_payouts").select("*").eq("status","approved").limit(1);if(t)throw t;if(!d||d.length===0)throw new Error("No approved payouts found. Approve a payout first.");const l=d[0];let n=null;if(l.referral_code_id){const{data:c}=await g.from("referral_codes").select("*").eq("id",l.referral_code_id).maybeSingle();n=c}j("Approved payout found","success",`ID: ${l.id}, Amount: $${l.amount}${n?`, Code: ${n.code}`:""}`);const{data:p,error:a}=await g.functions.invoke("process-paypal-payout",{body:{payout_id:l.id}});if(a)throw a;j("PayPal payout initiated","success",`Transaction ID: ${p.payoutBatchId||"N/A"}`),m.success("PayPal payout test completed!")}catch(d){j("PayPal test failed","error",d.message),m.error("PayPal test failed - check credentials")}finally{y(!1)}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(O,{children:[e.jsxs(he,{children:[e.jsx(pe,{children:"Referral System Testing Suite"}),e.jsx(ds,{children:"Test the complete referral flow from code creation to payout processing"})]}),e.jsxs(ge,{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"font-semibold",children:"1. Create Influencer Code"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(w,{placeholder:"Influencer name",value:E,onChange:d=>D(d.target.value)}),e.jsx(N,{onClick:C,disabled:r,children:r?e.jsx(R,{className:"w-4 h-4 animate-spin"}):"Create Code"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"font-semibold",children:"2. Simulate User Signup"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(w,{placeholder:"Referral code (auto-filled)",value:b,onChange:d=>T(d.target.value)}),e.jsx(N,{onClick:o,disabled:r||!b,children:r?e.jsx(R,{className:"w-4 h-4 animate-spin"}):"Test Signup"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"font-semibold",children:"3. Simulate Subscription"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(w,{placeholder:"User ID (optional)",value:L,onChange:d=>M(d.target.value)}),e.jsx(N,{onClick:P,disabled:r||!b,children:r?e.jsx(R,{className:"w-4 h-4 animate-spin"}):"Test Conversion"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"font-semibold",children:"4. Test Payout Approval"}),e.jsx(N,{onClick:S,disabled:r,variant:"secondary",children:r?e.jsx(R,{className:"w-4 h-4 animate-spin"}):"Test Approval"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"font-semibold",children:"5. Test PayPal Integration"}),e.jsx(N,{onClick:$,disabled:r,variant:"secondary",children:r?e.jsx(R,{className:"w-4 h-4 animate-spin"}):"Test PayPal"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Note: Requires valid PayPal API credentials configured"})]}),k.length>0&&e.jsxs("div",{className:"space-y-2 mt-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-semibold",children:"Test Results"}),e.jsx(N,{onClick:h,variant:"ghost",size:"sm",children:"Clear"})]}),e.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:k.map((d,t)=>e.jsx("div",{className:`p-3 rounded-lg border ${d.status==="success"?"bg-green-500/10 border-green-500/20":"bg-red-500/10 border-red-500/20"}`,children:e.jsxs("div",{className:"flex items-start gap-2",children:[d.status==="success"?e.jsx(K,{className:"w-4 h-4 text-green-500 mt-0.5"}):e.jsx(ve,{className:"w-4 h-4 text-red-500 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-sm",children:d.step}),e.jsx("p",{className:"text-xs text-muted-foreground",children:d.message})]})]})},t))})]})]})]}),e.jsxs(O,{children:[e.jsx(he,{children:e.jsx(pe,{children:"Testing Checklist"})}),e.jsxs(ge,{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(K,{className:"w-4 h-4 text-muted-foreground mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Code Creation"}),e.jsx("p",{className:"text-muted-foreground",children:"Verify influencer code is created and stored"})]})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(K,{className:"w-4 h-4 text-muted-foreground mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Signup Tracking"}),e.jsx("p",{className:"text-muted-foreground",children:"Confirm signups are tracked and counted"})]})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(K,{className:"w-4 h-4 text-muted-foreground mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Conversion Detection"}),e.jsx("p",{className:"text-muted-foreground",children:"Verify subscription creates payout record"})]})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(K,{className:"w-4 h-4 text-muted-foreground mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Payout Calculation"}),e.jsx("p",{className:"text-muted-foreground",children:"Confirm correct percentage (50% monthly, 20% yearly)"})]})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(K,{className:"w-4 h-4 text-muted-foreground mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Admin Approval"}),e.jsx("p",{className:"text-muted-foreground",children:"Test approval workflow and status updates"})]})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(K,{className:"w-4 h-4 text-muted-foreground mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"PayPal Integration"}),e.jsx("p",{className:"text-muted-foreground",children:"Verify PayPal API credentials and payout execution"})]})]})]})]})]})},fs=()=>{const r=ie(),[y,k]=v.useState(""),{data:f,isLoading:E}=te({queryKey:["admin-referral-config"],queryFn:async()=>{const{data:i,error:F}=await g.from("referral_config").select("*").order("config_key");if(F)throw F;return i}}),D=f?.find(i=>i.config_key==="commission_rates"),b=f?.find(i=>i.config_key==="payout_settings"),T=f?.find(i=>i.config_key==="trusted_influencers"),L=D?.config_value,M=b?.config_value,j=T?.config_value,[h,C]=v.useState(null),[o,P]=v.useState(null),[S,$]=v.useState(null);L&&!h&&C(L),M&&!o&&P(M),j&&!S&&$(j);const d=Y({mutationFn:async({configKey:i,configValue:F})=>{const{error:x}=await g.from("referral_config").update({config_value:F}).eq("config_key",i);if(x)throw x},onSuccess:()=>{r.invalidateQueries({queryKey:["admin-referral-config"]}),m.success("Configuration saved")},onError:i=>{console.error("Failed to update config:",i),m.error("Failed to save configuration")}}),t=()=>{h&&d.mutate({configKey:"commission_rates",configValue:h})},l=()=>{o&&d.mutate({configKey:"payout_settings",configValue:o})},n=()=>{S&&d.mutate({configKey:"trusted_influencers",configValue:S})},p=()=>{if(!y.trim()||!h)return;const i=y.toLowerCase().replace(/\s+/g,"_");if(h.tiers[i]){m.error("Tier already exists");return}C({...h,tiers:{...h.tiers,[i]:{min_conversions:0,monthly_percent:50,yearly_percent:20}}}),k("")},a=i=>{if(!h)return;const{[i]:F,...x}=h.tiers;C({...h,tiers:x})},c=(i,F,x)=>{h&&C({...h,tiers:{...h.tiers,[i]:{...h.tiers[i],[F]:x}}})},I=i=>{if(!(!S||!i.trim())){if(S.codes.includes(i.toUpperCase())){m.error("Code already in trusted list");return}$({...S,codes:[...S.codes,i.toUpperCase()]})}},U=i=>{S&&$({...S,codes:S.codes.filter(F=>F!==i)})};return E?e.jsx(O,{className:"p-6 rounded-3xl",children:e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(R,{className:"h-8 w-8 animate-spin text-primary"})})}):e.jsxs(O,{className:"p-6 mb-8 rounded-3xl shadow-soft",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx(Ye,{className:"h-6 w-6 text-primary"}),e.jsx("h2",{className:"font-heading text-2xl font-semibold",children:"Referral Configuration"})]}),e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Je,{className:"h-5 w-5 text-primary"}),e.jsx("h3",{className:"font-semibold text-lg",children:"Commission Rates"})]}),e.jsxs(N,{size:"sm",onClick:t,disabled:d.isPending,children:[d.isPending?e.jsx(R,{className:"h-4 w-4 animate-spin mr-1"}):e.jsx(oe,{className:"h-4 w-4 mr-1"}),"Save"]})]}),e.jsxs("div",{className:"bg-secondary/20 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm font-medium mb-3",children:"Default Rates"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(u,{className:"text-xs",children:"Monthly %"}),e.jsx(w,{type:"number",value:h?.default.monthly_percent||0,onChange:i=>h&&C({...h,default:{...h.default,monthly_percent:Number(i.target.value)}}),className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(u,{className:"text-xs",children:"Yearly %"}),e.jsx(w,{type:"number",value:h?.default.yearly_percent||0,onChange:i=>h&&C({...h,default:{...h.default,yearly_percent:Number(i.target.value)}}),className:"mt-1"})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-sm font-medium",children:"Commission Tiers"}),h&&Object.entries(h.tiers).sort(([,i],[,F])=>i.min_conversions-F.min_conversions).map(([i,F])=>e.jsxs("div",{className:"bg-secondary/10 border border-border rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx(V,{variant:"outline",className:"capitalize",children:i}),e.jsx(N,{variant:"ghost",size:"sm",onClick:()=>a(i),className:"text-destructive hover:text-destructive",children:e.jsx(ye,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs("div",{children:[e.jsx(u,{className:"text-xs",children:"Min Conversions"}),e.jsx(w,{type:"number",value:F.min_conversions,onChange:x=>c(i,"min_conversions",Number(x.target.value)),className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(u,{className:"text-xs",children:"Monthly %"}),e.jsx(w,{type:"number",value:F.monthly_percent,onChange:x=>c(i,"monthly_percent",Number(x.target.value)),className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(u,{className:"text-xs",children:"Yearly %"}),e.jsx(w,{type:"number",value:F.yearly_percent,onChange:x=>c(i,"yearly_percent",Number(x.target.value)),className:"mt-1"})]})]})]},i)),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(w,{placeholder:"New tier name (e.g., diamond)",value:y,onChange:i=>k(i.target.value),onKeyDown:i=>i.key==="Enter"&&p()}),e.jsxs(N,{variant:"outline",onClick:p,children:[e.jsx(be,{className:"h-4 w-4 mr-1"}),"Add Tier"]})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(J,{className:"h-5 w-5 text-primary"}),e.jsx("h3",{className:"font-semibold text-lg",children:"Payout Settings"})]}),e.jsxs(N,{size:"sm",onClick:l,disabled:d.isPending,children:[d.isPending?e.jsx(R,{className:"h-4 w-4 animate-spin mr-1"}):e.jsx(oe,{className:"h-4 w-4 mr-1"}),"Save"]})]}),e.jsx("div",{className:"bg-secondary/20 rounded-lg p-4",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(u,{className:"text-xs",children:"Minimum Payout Threshold ($)"}),e.jsx(w,{type:"number",value:o?.minimum_threshold||0,onChange:i=>o&&P({...o,minimum_threshold:Number(i.target.value)}),className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(u,{className:"text-xs",children:"Auto-Approve Threshold ($)"}),e.jsx(w,{type:"number",value:o?.auto_approve_threshold||0,onChange:i=>o&&P({...o,auto_approve_threshold:Number(i.target.value)}),className:"mt-1"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Payouts under this amount are auto-approved"})]}),e.jsxs("div",{children:[e.jsx(u,{className:"text-xs",children:"Max Retry Attempts"}),e.jsx(w,{type:"number",value:o?.max_retry_attempts||0,onChange:i=>o&&P({...o,max_retry_attempts:Number(i.target.value)}),className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(u,{className:"text-xs",children:"Retry Delay (hours)"}),e.jsx(w,{type:"number",value:o?.retry_delay_hours||0,onChange:i=>o&&P({...o,retry_delay_hours:Number(i.target.value)}),className:"mt-1"})]})]})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Xe,{className:"h-5 w-5 text-primary"}),e.jsx("h3",{className:"font-semibold text-lg",children:"Trusted Influencers"})]}),e.jsxs(N,{size:"sm",onClick:n,disabled:d.isPending,children:[d.isPending?e.jsx(R,{className:"h-4 w-4 animate-spin mr-1"}):e.jsx(oe,{className:"h-4 w-4 mr-1"}),"Save"]})]}),e.jsxs("div",{className:"bg-secondary/20 rounded-lg p-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx(u,{className:"text-xs",children:"Auto-approve after X successful payouts"}),e.jsx(w,{type:"number",value:S?.auto_approve_after_payouts||0,onChange:i=>S&&$({...S,auto_approve_after_payouts:Number(i.target.value)}),className:"mt-1 max-w-xs"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Influencers become trusted after this many successful payouts"})]}),e.jsxs("div",{children:[e.jsx(u,{className:"text-xs mb-2 block",children:"Trusted Referral Codes"}),e.jsxs("div",{className:"flex flex-wrap gap-2 mb-3",children:[S?.codes.map(i=>e.jsxs(V,{variant:"secondary",className:"flex items-center gap-1",children:[i,e.jsx("button",{onClick:()=>U(i),className:"ml-1 hover:text-destructive",children:"Ã—"})]},i)),(!S?.codes||S.codes.length===0)&&e.jsx("span",{className:"text-sm text-muted-foreground",children:"No trusted codes yet"})]}),e.jsx("div",{className:"flex gap-2",children:e.jsx(w,{placeholder:"Add referral code",className:"max-w-xs",onKeyDown:i=>{i.key==="Enter"&&(I(i.target.value),i.target.value="")}})})]})]})]})]})]})},js=()=>{const{data:r,isLoading:y}=te({queryKey:["admin-referral-analytics"],queryFn:async()=>{const{data:k}=await g.from("referral_codes").select("*"),{data:f}=await g.from("referral_payouts").select("*"),{data:E}=await g.from("profiles").select("referred_by_code, created_at").not("referred_by_code","is",null),D=E?.length||0,{count:b}=await g.from("referral_payouts").select("*",{count:"exact",head:!0}),T=D>0?(b||0)/D*100:0,L=f?.filter(t=>t.status==="paid").reduce((t,l)=>t+Number(l.amount),0)||0,M=f?.filter(t=>t.status==="pending").reduce((t,l)=>t+Number(l.amount),0)||0,j=f?.filter(t=>t.status==="requested").reduce((t,l)=>t+Number(l.amount),0)||0,h=f?.filter(t=>t.status==="approved").reduce((t,l)=>t+Number(l.amount),0)||0,C=f?.reduce((t,l)=>t+Number(l.amount),0)||0,o=f&&f.length>0?C/f.length:0,P=new Map;k?.forEach(t=>{const l=f?.filter(a=>a.referral_code_id===t.id),n=l?.reduce((a,c)=>a+Number(c.amount),0)||0,p=l?.length||0;P.set(t.id,{code:t.code,name:t.influencer_name||t.owner_user_id?.substring(0,8)||"Unknown",conversions:p,earnings:n})});const S=Array.from(P.values()).sort((t,l)=>l.earnings-t.earnings).slice(0,5),$=new Date,d=[];for(let t=5;t>=0;t--){const l=new Date($.getFullYear(),$.getMonth()-t,1),n=new Date($.getFullYear(),$.getMonth()-t+1,0),p=l.toLocaleDateString("en-US",{month:"short",year:"numeric"}),a=E?.filter(i=>{const F=new Date(i.created_at);return F>=l&&F<=n}).length||0,c=f?.filter(i=>{const F=new Date(i.created_at);return F>=l&&F<=n}),I=c?.length||0,U=c?.reduce((i,F)=>i+Number(F.amount),0)||0;d.push({month:p,signups:a,conversions:I,earnings:U})}return{totalSignups:D,totalConversions:b||0,conversionRate:T,totalPaid:L,totalPending:M,totalRequested:j,totalApproved:h,avgPayoutAmount:o,topReferrers:S,monthlyStats:d}}});return y?e.jsx(O,{className:"p-6 rounded-3xl",children:e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(R,{className:"h-8 w-8 animate-spin text-primary"})})}):e.jsxs(O,{className:"p-6 mb-8 rounded-3xl shadow-soft",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx(Ze,{className:"h-6 w-6 text-primary"}),e.jsx("h2",{className:"font-heading text-2xl font-semibold",children:"Referral Analytics"})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-8",children:[e.jsxs("div",{className:"bg-gradient-to-br from-blue-500/10 to-blue-600/5 border border-blue-500/20 rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(ee,{className:"h-4 w-4 text-blue-500"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:"Total Signups"})]}),e.jsx("p",{className:"text-2xl font-bold text-blue-500",children:r?.totalSignups||0})]}),e.jsxs("div",{className:"bg-gradient-to-br from-green-500/10 to-green-600/5 border border-green-500/20 rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Ne,{className:"h-4 w-4 text-green-500"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:"Conversions"})]}),e.jsx("p",{className:"text-2xl font-bold text-green-500",children:r?.totalConversions||0}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[r?.conversionRate.toFixed(1),"% rate"]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-purple-500/10 to-purple-600/5 border border-purple-500/20 rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(J,{className:"h-4 w-4 text-purple-500"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:"Total Paid Out"})]}),e.jsxs("p",{className:"text-2xl font-bold text-purple-500",children:["$",r?.totalPaid.toFixed(2)||"0.00"]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-amber-500/10 to-amber-600/5 border border-amber-500/20 rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(J,{className:"h-4 w-4 text-amber-500"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:"Avg Payout"})]}),e.jsxs("p",{className:"text-2xl font-bold text-amber-500",children:["$",r?.avgPayoutAmount.toFixed(2)||"0.00"]})]})]}),e.jsxs("div",{className:"mb-8",children:[e.jsx("h3",{className:"font-semibold text-lg mb-4",children:"Payout Pipeline"}),e.jsxs("div",{className:"grid grid-cols-4 gap-2",children:[e.jsxs("div",{className:"text-center p-3 bg-yellow-500/10 rounded-lg border border-yellow-500/20",children:[e.jsxs("p",{className:"text-lg font-bold text-yellow-600",children:["$",r?.totalPending.toFixed(2)||"0.00"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Pending"})]}),e.jsxs("div",{className:"text-center p-3 bg-orange-500/10 rounded-lg border border-orange-500/20",children:[e.jsxs("p",{className:"text-lg font-bold text-orange-600",children:["$",r?.totalRequested.toFixed(2)||"0.00"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Requested"})]}),e.jsxs("div",{className:"text-center p-3 bg-blue-500/10 rounded-lg border border-blue-500/20",children:[e.jsxs("p",{className:"text-lg font-bold text-blue-600",children:["$",r?.totalApproved.toFixed(2)||"0.00"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Approved"})]}),e.jsxs("div",{className:"text-center p-3 bg-green-500/10 rounded-lg border border-green-500/20",children:[e.jsxs("p",{className:"text-lg font-bold text-green-600",children:["$",r?.totalPaid.toFixed(2)||"0.00"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Paid"})]})]})]}),e.jsxs("div",{className:"mb-8",children:[e.jsx("h3",{className:"font-semibold text-lg mb-4",children:"Monthly Trend"}),e.jsx("div",{className:"grid grid-cols-6 gap-2",children:r?.monthlyStats.map((k,f)=>{const E=r.monthlyStats[f-1],D=E?k.earnings-E.earnings:0,b=D>=0;return e.jsxs("div",{className:"text-center p-3 bg-secondary/20 rounded-lg",children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:k.month}),e.jsxs("p",{className:"text-sm font-semibold",children:[k.signups," signups"]}),e.jsxs("p",{className:"text-xs text-green-500",children:[k.conversions," converts"]}),e.jsxs("p",{className:"text-sm font-bold text-primary mt-1",children:["$",k.earnings.toFixed(0)]}),f>0&&e.jsxs("div",{className:`flex items-center justify-center text-xs mt-1 ${b?"text-green-500":"text-red-500"}`,children:[b?e.jsx(es,{className:"h-3 w-3"}):e.jsx(ss,{className:"h-3 w-3"}),"$",Math.abs(D).toFixed(0)]})]},k.month)})})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg mb-4",children:"Top Referrers"}),r?.topReferrers&&r.topReferrers.length>0?e.jsx("div",{className:"space-y-2",children:r.topReferrers.map((k,f)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-secondary/20 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center font-bold ${f===0?"bg-yellow-500/20 text-yellow-500":f===1?"bg-gray-400/20 text-gray-400":f===2?"bg-amber-700/20 text-amber-700":"bg-secondary text-muted-foreground"}`,children:f+1}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:k.name}),e.jsx("p",{className:"text-xs text-muted-foreground",children:k.code})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"font-bold text-primary",children:["$",k.earnings.toFixed(2)]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[k.conversions," conversions"]})]})]},k.code))}):e.jsx("p",{className:"text-muted-foreground text-center py-4",children:"No referrer data yet"})]})]})},je={Canines:["Wolf","Fox","Arctic Fox","Fennec Fox","Dog","Hyena","Tanuki"],"Mythical Canines":["Fenrir"],Felines:["Cat","Lion","Tiger","Panther","Snow Leopard","Cheetah","Jaguar","Lynx","Puma / Cougar"],"Mythical Felines":["Sphinx","Kitsune"],"Dragons & Reptiles":["Dragon","Wyvern","Hydra","Basilisk","T-Rex","Velociraptor","Crocodile","Snake","Sea Turtle"],Birds:["Eagle","Falcon","Hawk","Owl","Raven","Parrot","Hummingbird","Penguin"],"Mythical Birds":["Phoenix","Thunderbird"],Equines:["Horse (Stallion)","Unicorn","Pegasus"],Aquatic:["Dolphin","Shark","Orca","Blue Whale","Jellyfish","Octopus","Manta Ray"],"Mythical Aquatic":["Kraken","Leviathan"],"Other Mammals":["Bear","Deer","Elephant","Gorilla","Rhino","Hippo","Mammoth","Kangaroo","Koala","Red Panda","Panda","Sloth","Rabbit","Mouse","Chinchilla","Raccoon","Bat"]},vs=["Fire","Water","Earth","Air","Lightning","Ice","Nature","Light","Shadow","Cosmic"],Ns=["","whimsical","epic","cozy","mysterious","triumphant","melancholic","playful"],Q=["Egg","Hatchling","Sproutling","Cub","Juvenile","Apprentice","Scout","Fledgling","Warrior","Guardian","Champion","Ascended","Vanguard","Titan","Mythic","Prime","Regal","Eternal","Transcendent","Apex","Ultimate Form"],ys=()=>{const[r,y]=v.useState({spiritAnimal:"Wolf",element:"Fire",stage:0,favoriteColor:"#FF6B35",eyeColor:"#FFD700",furColor:"#8B4513",storyTone:"",retryAttempt:0}),[k,f]=v.useState(!1),[E,D]=v.useState(!1),[b,T]=v.useState(null),[L,M]=v.useState({}),[j,h]=v.useState(null),[C,o]=v.useState(null),P=(a,c)=>a<=1?"Text-to-Image (Egg Stage)":a>=15?"Text-to-Image (Cosmic Stage)":c?"Text-to-Image (with Visual Metadata)":"Text-to-Image (No Reference)",S=a=>{const I=a*10;return I<60?`~${I} seconds`:`~${Math.ceil(I/60)} minutes`},$=async()=>{f(!0),h(null);try{const a=L[r.stage-1]?.imageUrl,c=P(r.stage,!!a),{data:I,error:U}=await g.functions.invoke("generate-companion-image",{body:{spiritAnimal:r.spiritAnimal,element:r.element,stage:r.stage,favoriteColor:r.favoriteColor,eyeColor:r.eyeColor||void 0,furColor:r.furColor||void 0,storyTone:r.storyTone||void 0,previousStageImageUrl:a,retryAttempt:r.retryAttempt||void 0,flowType:"admin",debug:!0}});if(U)throw U;const i={stage:r.stage,imageUrl:I.imageUrl,prompt:I.prompt,generationMode:c,qualityScore:I.qualityScore,extractedMetadata:I.extractedMetadata};if(M(F=>({...F,[r.stage]:i})),h(I.prompt||"Prompt not returned"),o(r.stage),I.qualityScore){const F=I.qualityScore;F.shouldRetry?m.warning(`Stage ${r.stage} generated with issues (Score: ${F.overall}/100)`,{description:F.issues?.slice(0,2).join(", ")||"Quality below threshold"}):m.success(`Stage ${r.stage} generated (Score: ${F.overall}/100)`)}else m.success(`Stage ${r.stage} image generated (${c})`)}catch(a){console.error("Error generating companion image:",a),m.error(a.message||"Failed to generate companion image")}finally{f(!1)}},d=async()=>{D(!0),T({current:0,total:r.stage+1}),M({});try{let a;for(let c=0;c<=r.stage;c++){T({current:c,total:r.stage+1});const I=P(c,!!a),{data:U,error:i}=await g.functions.invoke("generate-companion-image",{body:{spiritAnimal:r.spiritAnimal,element:r.element,stage:c,favoriteColor:r.favoriteColor,eyeColor:r.eyeColor||void 0,furColor:r.furColor||void 0,storyTone:r.storyTone||void 0,previousStageImageUrl:a,flowType:"admin",debug:!0}});if(i)throw i;const F={stage:c,imageUrl:U.imageUrl,prompt:U.prompt,generationMode:I,qualityScore:U.qualityScore,extractedMetadata:U.extractedMetadata};if(M(x=>({...x,[c]:F})),a=U.imageUrl,U.qualityScore){const x=U.qualityScore;m.success(`Stage ${c} (${Q[c]}) - Score: ${x.overall}/100`)}else m.success(`Stage ${c} (${Q[c]}) complete`)}T({current:r.stage+1,total:r.stage+1}),o(r.stage),m.success(`Evolution chain complete! Generated ${r.stage+1} images.`)}catch(a){console.error("Error generating evolution chain:",a),m.error(a.message||"Failed to generate evolution chain")}finally{D(!1),T(null)}},t=r.stage>0&&!!L[r.stage-1],l=P(r.stage,t),n=C!==null?L[C]:null,p=Object.keys(L).length;return e.jsxs(O,{className:"p-6 mb-8 rounded-3xl shadow-soft",children:[e.jsx("h2",{className:"font-heading text-2xl font-semibold mb-4",children:"ðŸŽ¨ Companion Image Tester"}),e.jsx("p",{className:"text-muted-foreground mb-6",children:"Test companion image generation with visual metadata extraction for consistent evolution chains"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs(u,{htmlFor:"spiritAnimal",children:["Spirit Animal (",Object.values(je).flat().length," creatures)"]}),e.jsx("select",{id:"spiritAnimal",value:r.spiritAnimal,onChange:a=>y({...r,spiritAnimal:a.target.value}),className:"w-full p-3 min-h-[44px] border rounded-2xl bg-background text-base",children:Object.entries(je).map(([a,c])=>e.jsx("optgroup",{label:a,children:c.map(I=>e.jsx("option",{value:I,children:I},I))},a))})]}),e.jsxs("div",{children:[e.jsx(u,{htmlFor:"element",children:"Element"}),e.jsx("select",{id:"element",value:r.element,onChange:a=>y({...r,element:a.target.value}),className:"w-full p-3 min-h-[44px] border rounded-2xl bg-background text-base",children:vs.map(a=>e.jsx("option",{value:a,children:a},a))})]})]}),e.jsxs("div",{children:[e.jsx(u,{htmlFor:"storyTone",children:"Story Tone (Optional)"}),e.jsxs("select",{id:"storyTone",value:r.storyTone,onChange:a=>y({...r,storyTone:a.target.value}),className:"w-full p-3 min-h-[44px] border rounded-2xl bg-background text-base",children:[e.jsx("option",{value:"",children:"None (default)"}),Ns.filter(Boolean).map(a=>e.jsx("option",{value:a,children:a.charAt(0).toUpperCase()+a.slice(1)},a))]})]}),e.jsxs("div",{children:[e.jsxs(u,{htmlFor:"stage",children:["Evolution Stage: ",r.stage," - ",Q[r.stage]]}),e.jsx("input",{type:"range",id:"stage",min:"0",max:"20",value:r.stage,onChange:a=>y({...r,stage:parseInt(a.target.value)}),className:"w-full h-10 cursor-pointer"}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 mt-2",children:[l.includes("Visual Metadata")?e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full bg-purple-500/20 text-purple-600 text-xs font-medium",children:[e.jsx(ts,{className:"w-3 h-3"}),"T2I + Visual Metadata (stage ",r.stage-1," â†’ ",r.stage,")"]}):l.includes("Egg")?e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full bg-amber-500/20 text-amber-600 text-xs font-medium",children:[e.jsx(X,{className:"w-3 h-3"}),"Text-to-Image (Egg)"]}):l.includes("Cosmic")?e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full bg-indigo-500/20 text-indigo-600 text-xs font-medium",children:[e.jsx(X,{className:"w-3 h-3"}),"Text-to-Image (Cosmic)"]}):e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full bg-blue-500/20 text-blue-600 text-xs font-medium",children:[e.jsx(X,{className:"w-3 h-3"}),"Text-to-Image"]}),r.stage>=2&&r.stage<=14&&!t&&e.jsx("span",{className:"text-xs text-amber-600",children:"âš ï¸ No previous stage - generate chain or prior stage first"})]}),t&&r.stage>=2&&r.stage<=14&&e.jsxs("div",{className:"mt-3 p-3 rounded-xl bg-muted/50 border border-border",children:[e.jsx("p",{className:"text-xs font-medium text-muted-foreground mb-2",children:"Colors that will be extracted & matched:"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"w-5 h-5 rounded-full border border-border",style:{backgroundColor:r.favoriteColor}}),e.jsx("span",{className:"text-xs text-muted-foreground",children:"Primary"})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"w-5 h-5 rounded-full border border-border",style:{backgroundColor:r.eyeColor}}),e.jsx("span",{className:"text-xs text-muted-foreground",children:"Eyes"})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"w-5 h-5 rounded-full border border-border",style:{backgroundColor:r.furColor}}),e.jsx("span",{className:"text-xs text-muted-foreground",children:"Fur"})]})]}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-2 italic",children:["âœ¨ Metadata (hex colors, pose, angle, style) will be extracted from stage ",r.stage-1]})]})]}),e.jsxs("div",{children:[e.jsx(u,{htmlFor:"retryAttempt",children:"Retry Attempt (0-3, affects enforcement text)"}),e.jsx(w,{type:"number",id:"retryAttempt",min:"0",max:"3",value:r.retryAttempt,onChange:a=>y({...r,retryAttempt:parseInt(a.target.value)||0}),className:"w-full rounded-2xl min-h-[44px] text-base"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx(u,{htmlFor:"favoriteColor",children:"Favorite Color"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(w,{type:"color",id:"favoriteColor",value:r.favoriteColor,onChange:a=>y({...r,favoriteColor:a.target.value}),className:"w-16 h-12 rounded-2xl cursor-pointer"}),e.jsx(w,{type:"text",value:r.favoriteColor,onChange:a=>y({...r,favoriteColor:a.target.value}),className:"flex-1 rounded-2xl min-h-[44px] text-base",placeholder:"#FF6B35"})]})]}),e.jsxs("div",{children:[e.jsx(u,{htmlFor:"eyeColor",children:"Eye Color"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(w,{type:"color",id:"eyeColor",value:r.eyeColor,onChange:a=>y({...r,eyeColor:a.target.value}),className:"w-16 h-12 rounded-2xl cursor-pointer"}),e.jsx(w,{type:"text",value:r.eyeColor,onChange:a=>y({...r,eyeColor:a.target.value}),className:"flex-1 rounded-2xl min-h-[44px] text-base",placeholder:"#FFD700"})]})]}),e.jsxs("div",{children:[e.jsx(u,{htmlFor:"furColor",children:"Fur/Scale Color"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(w,{type:"color",id:"furColor",value:r.furColor,onChange:a=>y({...r,furColor:a.target.value}),className:"w-16 h-12 rounded-2xl cursor-pointer"}),e.jsx(w,{type:"text",value:r.furColor,onChange:a=>y({...r,furColor:a.target.value}),className:"flex-1 rounded-2xl min-h-[44px] text-base",placeholder:"#8B4513"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(N,{onClick:$,disabled:k||E,variant:"outline",className:"w-full rounded-2xl min-h-[48px] text-base",children:k?e.jsxs(e.Fragment,{children:[e.jsx(R,{className:"h-5 w-5 mr-2 animate-spin"}),"Generating Stage ",r.stage,"..."]}):e.jsxs(e.Fragment,{children:[e.jsx(X,{className:"h-5 w-5 mr-2"}),"Generate Single Stage"]})}),e.jsx(N,{onClick:d,disabled:k||E,className:"w-full rounded-2xl min-h-[48px] text-base",children:E?e.jsxs(e.Fragment,{children:[e.jsx(R,{className:"h-5 w-5 mr-2 animate-spin"}),"Generating Chain..."]}):e.jsxs(e.Fragment,{children:[e.jsx(as,{className:"h-5 w-5 mr-2"}),"Generate Full Evolution (0â†’",r.stage,")"]})})]}),!E&&r.stage>0&&e.jsxs("p",{className:"text-xs text-muted-foreground text-center",children:["Full evolution will generate ",r.stage+1," images (",S(r.stage+1),")"]}),b&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("span",{children:["Generating stage ",b.current," of ",b.total-1]}),e.jsxs("span",{children:[Math.round(b.current/b.total*100),"%"]})]}),e.jsx(cs,{value:b.current/b.total*100}),e.jsxs("p",{className:"text-xs text-muted-foreground text-center",children:[b.current>0&&Q[b.current-1]," â†’ ",Q[b.current]]})]}),p>0&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs(u,{children:["Evolution Chain Gallery (",p," images)"]}),e.jsx("div",{className:"flex gap-2 overflow-x-auto pb-2",children:Array.from({length:21},(a,c)=>c).map(a=>{const c=L[a];return c?e.jsxs("button",{onClick:()=>{o(a),h(c.prompt||null)},className:`flex-shrink-0 relative rounded-xl overflow-hidden border-2 transition-all ${C===a?"border-primary ring-2 ring-primary/30":"border-border hover:border-primary/50"}`,children:[e.jsx("img",{src:c.imageUrl,alt:`Stage ${a}`,className:"w-20 h-20 object-cover"}),e.jsxs("div",{className:"absolute bottom-0 left-0 right-0 bg-black/60 text-white text-xs p-1 text-center",children:[a,c.qualityScore&&e.jsxs("span",{className:`ml-1 ${c.qualityScore.overall>=70?"text-green-400":"text-amber-400"}`,children:["(",c.qualityScore.overall,")"]})]}),e.jsx("div",{className:`absolute top-1 right-1 w-2 h-2 rounded-full ${c.generationMode.includes("Visual Metadata")?"bg-purple-500":c.generationMode.includes("Egg")?"bg-amber-500":c.generationMode.includes("Cosmic")?"bg-indigo-500":"bg-blue-500"}`})]},a):null})}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[e.jsx("span",{className:"inline-block w-2 h-2 rounded-full bg-blue-500 mr-1"})," T2I",e.jsx("span",{className:"inline-block w-2 h-2 rounded-full bg-purple-500 ml-3 mr-1"})," T2I + Metadata",e.jsx("span",{className:"inline-block w-2 h-2 rounded-full bg-amber-500 ml-3 mr-1"})," Egg",e.jsx("span",{className:"inline-block w-2 h-2 rounded-full bg-indigo-500 ml-3 mr-1"})," Cosmic"]})]}),n&&e.jsxs("div",{className:"space-y-4 p-4 md:p-6 border rounded-2xl bg-card",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold",children:["Stage ",n.stage," - ",Q[n.stage]]}),e.jsx("span",{className:`text-xs ${n.generationMode.includes("Visual Metadata")?"text-purple-600":n.generationMode.includes("Egg")?"text-amber-600":n.generationMode.includes("Cosmic")?"text-indigo-600":"text-blue-600"}`,children:n.generationMode})]}),e.jsx(N,{onClick:()=>Ce(n.imageUrl,`companion-${r.spiritAnimal}-stage${n.stage}.png`),variant:"outline",size:"sm",className:"rounded-full",children:rs.isNativePlatform()?e.jsxs(e.Fragment,{children:[e.jsx(ls,{className:"h-4 w-4 mr-1"})," Share"]}):e.jsxs(e.Fragment,{children:[e.jsx(we,{className:"h-4 w-4 mr-1"})," Download"]})})]}),e.jsx("div",{className:"flex justify-center",children:e.jsx("img",{src:n.imageUrl,alt:`Stage ${n.stage} - ${Q[n.stage]}`,className:"max-w-md w-full rounded-2xl shadow-lg"})}),n.qualityScore&&e.jsxs("div",{className:"p-4 rounded-xl bg-muted/50 border",children:[e.jsx(u,{className:"mb-3 block",children:"Quality Analysis"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:[e.jsxs("div",{className:"text-center p-2 rounded-lg bg-background",children:[e.jsx("div",{className:`text-2xl font-bold ${n.qualityScore.overall>=70?"text-green-600":n.qualityScore.overall>=50?"text-amber-600":"text-red-600"}`,children:n.qualityScore.overall}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Overall"})]}),e.jsxs("div",{className:"text-center p-2 rounded-lg bg-background",children:[e.jsx("div",{className:`text-2xl font-bold ${n.qualityScore.limbCount>=70?"text-green-600":"text-amber-600"}`,children:n.qualityScore.limbCount}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Limbs"})]}),e.jsxs("div",{className:"text-center p-2 rounded-lg bg-background",children:[e.jsx("div",{className:`text-2xl font-bold ${n.qualityScore.speciesFidelity>=70?"text-green-600":"text-amber-600"}`,children:n.qualityScore.speciesFidelity}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Species"})]}),e.jsxs("div",{className:"text-center p-2 rounded-lg bg-background",children:[e.jsx("div",{className:`text-2xl font-bold ${n.qualityScore.colorMatch>=70?"text-green-600":"text-amber-600"}`,children:n.qualityScore.colorMatch}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Colors"})]})]}),n.qualityScore.issues&&n.qualityScore.issues.length>0&&e.jsxs("div",{className:"mt-3 p-2 rounded-lg bg-red-500/10 border border-red-500/20",children:[e.jsx("p",{className:"text-xs font-medium text-red-600 mb-1",children:"Issues Detected:"}),e.jsx("ul",{className:"text-xs text-red-600/80 list-disc list-inside",children:n.qualityScore.issues.map((a,c)=>e.jsx("li",{children:a},c))})]})]}),n.extractedMetadata&&e.jsxs("div",{className:"p-4 rounded-xl bg-muted/50 border",children:[e.jsx(u,{className:"mb-3 block",children:"Extracted Visual Metadata"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-xs text-muted-foreground w-20",children:"Colors:"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-6 h-6 rounded-full border border-border shadow-sm",style:{backgroundColor:n.extractedMetadata.hexPrimaryColor},title:`Primary: ${n.extractedMetadata.hexPrimaryColor}`}),e.jsx("div",{className:"w-6 h-6 rounded-full border border-border shadow-sm",style:{backgroundColor:n.extractedMetadata.hexEyeColor},title:`Eyes: ${n.extractedMetadata.hexEyeColor}`}),n.extractedMetadata.hexAccentColor&&e.jsx("div",{className:"w-6 h-6 rounded-full border border-border shadow-sm",style:{backgroundColor:n.extractedMetadata.hexAccentColor},title:`Accent: ${n.extractedMetadata.hexAccentColor}`}),e.jsxs("span",{className:"text-xs text-muted-foreground ml-2",children:[n.extractedMetadata.hexPrimaryColor," / ",n.extractedMetadata.hexEyeColor]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2 text-xs",children:[e.jsxs("div",{className:"p-2 rounded bg-background",children:[e.jsx("span",{className:"text-muted-foreground",children:"Angle:"}),e.jsx("span",{className:"ml-1 font-medium",children:n.extractedMetadata.viewingAngle})]}),e.jsxs("div",{className:"p-2 rounded bg-background",children:[e.jsx("span",{className:"text-muted-foreground",children:"Pose:"}),e.jsx("span",{className:"ml-1 font-medium",children:n.extractedMetadata.pose})]}),e.jsxs("div",{className:"p-2 rounded bg-background",children:[e.jsx("span",{className:"text-muted-foreground",children:"Expression:"}),e.jsx("span",{className:"ml-1 font-medium",children:n.extractedMetadata.expression})]}),e.jsxs("div",{className:"p-2 rounded bg-background",children:[e.jsx("span",{className:"text-muted-foreground",children:"Style:"}),e.jsxs("span",{className:"ml-1 font-medium truncate",children:[n.extractedMetadata.artStyle.slice(0,20),"..."]})]})]}),e.jsxs("div",{className:"text-xs",children:[e.jsx("span",{className:"text-muted-foreground",children:"Markings:"}),e.jsx("span",{className:"ml-2",children:n.extractedMetadata.markings})]})]})]}),j&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{children:"Generated Prompt:"}),e.jsx(se,{value:j,readOnly:!0,className:"font-mono text-xs rounded-2xl min-h-[100px]"})]})]})]})]})},Ss=()=>{const{user:r,loading:y}=ms(),[k,f]=v.useState(!1),[E,D]=v.useState(!0),[b,T]=v.useState([]),[L,M]=v.useState(!1),[j,h]=v.useState(!1),[C,o]=v.useState(null),[P,S]=v.useState(null),[$,d]=v.useState(null),[t,l]=v.useState(!1),[n,p]=v.useState(null),[a,c]=v.useState({spiritAnimal:"wolf",element:"fire",stage:5,favoriteColor:"#FF6B35",eyeColor:"#FFD700",furColor:"#8B4513",mind:50,body:50,soul:50,customName:""}),[I,U]=v.useState(!1),[i,F]=v.useState(null),[x,B]=v.useState({spiritAnimal:"wolf",element:"fire",favoriteColor:"#FF6B35",eyeColor:"#FFD700",furColor:"#8B4513",milestonePercent:50,sourceImageUrl:""}),[de,ce]=v.useState(!1),[W,me]=v.useState(null),[ae,_e]=v.useState([]),[A,G]=v.useState({title:"",category:"",topic_category:[],emotional_triggers:[],quote:"",description:"",audio_url:"",is_featured:!1,mentor_id:"",tags:[],is_premium:!1});v.useEffect(()=>{(async()=>{if(y)return;if(!r){console.debug("Admin: no user after auth resolved"),f(!1),D(!1);return}const{data:_,error:q}=await g.functions.invoke("verify-admin-access");if(q||!_?.isAdmin){console.debug("Admin check failed",{error:q,data:_,userId:r.id}),m.error("Access Denied: You don't have permission to access this page."),f(!1),D(!1);return}f(!0),D(!1)})()},[r,y]),v.useEffect(()=>{k&&(re(),Se())},[k]);const Se=async()=>{const{data:s,error:_}=await g.from("mentors").select("*").order("name");if(_){m.error("Failed to load mentors");return}_e(s||[])},re=async()=>{const{data:s,error:_}=await g.from("pep_talks").select("*").order("created_at",{ascending:!1});if(_){m.error("Failed to load pep talks");return}T(s||[])},Fe=s=>{const _=s.target.files?.[0];_&&_.type.startsWith("audio/")?d(_):m.error("Please select a valid audio file")},Pe=async()=>{if(!$)return A.audio_url||null;l(!0);try{const s=$.name.split(".").pop(),q=`${`${Date.now()}.${s}`}`,{error:z}=await g.storage.from("pep-talk-audio").upload(q,$);if(z)throw z;const{data:{publicUrl:H}}=g.storage.from("pep-talk-audio").getPublicUrl(q);return H}catch(s){return console.error("Upload error:",s),m.error("Failed to upload audio file"),null}finally{l(!1)}},ke=async s=>{s.preventDefault(),o({...A,audioFile:$}),h(!0),M(!1)},Ae=async()=>{l(!0);const s=await Pe();if(!s&&!A.audio_url){m.error("Please upload an audio file"),l(!1);return}const _={...A,audio_url:s||A.audio_url};if(P){const{error:q}=await g.from("pep_talks").update(_).eq("id",P);if(q){m.error("Failed to update pep talk"),l(!1);return}m.success("Pep talk updated successfully")}else{const{error:q}=await g.from("pep_talks").insert([_]);if(q){m.error("Failed to create pep talk"),l(!1);return}m.success("Pep talk created successfully")}h(!1),o(null),le(),re(),l(!1)},Te=()=>{h(!1),M(!0),m.info("Returned to editing")},Ee=s=>{G({title:s.title,category:s.category,topic_category:s.topic_category||[],emotional_triggers:s.emotional_triggers||[],quote:s.quote,description:s.description,audio_url:s.audio_url,is_featured:s.is_featured,mentor_id:s.mentor_id||"",tags:s.tags||[],is_premium:s.is_premium||!1}),S(s.id),M(!0)},$e=async s=>{if(!confirm("Are you sure you want to delete this pep talk?"))return;const{error:_}=await g.from("pep_talks").delete().eq("id",s);if(_){m.error("Failed to delete pep talk");return}m.success("Pep talk deleted successfully"),re()},le=()=>{G({title:"",category:"",topic_category:[],emotional_triggers:[],quote:"",description:"",audio_url:"",is_featured:!1,mentor_id:"",tags:[],is_premium:!1}),S(null),M(!1),h(!1),o(null),d(null)},Ie={atlas:"Let's take a breath, get clear, and move with purpose.",eli:"Hey, you're doing better than you think. Keep going.",sienna:"You're safe, you're growing, and you're allowed to take your time.",stryker:"Stand tall. Lock in. This is your moment to push.",carmen:"No excuses. Show me what you're made of.",reign:"Excellence isn't optional. Let's make today count.",solace:"Let your mind settle. Peace starts from within."},Me=async s=>{const _=Ie[s];if(!_){m.error("No preview text for this mentor");return}p(s);try{const{data:q,error:z}=await g.functions.invoke("generate-mentor-audio",{body:{mentorSlug:s,script:_}});if(z)throw z;if(xs.getMuted())p(null);else{const H=new Audio(q.audioUrl);H.play().catch(Ue=>console.error("Audio play failed:",Ue)),H.onended=()=>{p(null)}}}catch(q){console.error("Error previewing voice:",q),m.error(q.message||"Failed to preview voice"),p(null)}},qe=s=>["Egg","Hatchling","Sproutling","Cub","Juvenile","Apprentice","Scout","Fledgling","Warrior","Guardian","Champion","Ascended","Vanguard","Titan","Mythic","Prime","Regal","Eternal","Transcendent","Apex","Ultimate Form"][s]||"Unknown",De=async()=>{U(!0),F(null);try{const{data:s,error:_}=await g.functions.invoke("generate-sample-card",{body:{spiritAnimal:a.spiritAnimal,element:a.element,stage:a.stage,favoriteColor:a.favoriteColor,eyeColor:a.eyeColor||void 0,furColor:a.furColor||void 0,mind:a.mind,body:a.body,soul:a.soul,customName:a.customName||void 0}});if(_)throw _;F(s.card),m.success("Sample card generated!")}catch(s){console.error("Error generating sample card:",s),m.error(s.message||"Failed to generate sample card")}finally{U(!1)}},Re=async()=>{ce(!0),me(null);try{let s=x.sourceImageUrl;if(!s){m.info("Generating companion image first...");const{data:z,error:H}=await g.functions.invoke("generate-companion-image",{body:{spiritAnimal:x.spiritAnimal,element:x.element,stage:5,favoriteColor:x.favoriteColor,eyeColor:x.eyeColor,furColor:x.furColor}});if(H)throw H;s=z.imageUrl,m.success("Companion image generated!")}m.info("Generating cosmic postcard...");const{data:_,error:q}=await g.functions.invoke("generate-cosmic-postcard-test",{body:{milestonePercent:x.milestonePercent,sourceImageUrl:s,companionData:{spirit_animal:x.spiritAnimal,core_element:x.element,favorite_color:x.favoriteColor,eye_color:x.eyeColor,fur_color:x.furColor}}});if(q)throw q;me({imageUrl:_.imageUrl,locationName:_.locationName,locationDescription:_.locationDescription,caption:_.caption}),m.success(`Postcard generated at ${_.locationName}!`)}catch(s){console.error("Error generating postcard:",s),m.error(s.message||"Failed to generate postcard")}finally{ce(!1)}};return E?e.jsx("div",{className:"min-h-screen pb-nav-safe bg-gradient-to-b from-cream-glow to-petal-pink/30 flex items-center justify-center",children:e.jsx("div",{className:"text-foreground text-xl",children:"Loading..."})}):k?e.jsx("div",{className:"min-h-screen pb-nav-safe bg-gradient-to-b from-cream-glow to-petal-pink/30 py-8 px-4",children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"font-heading text-4xl font-bold text-foreground mb-2",children:"Admin Panel"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage your pep talks"})]}),e.jsx("div",{className:"mb-8",children:e.jsx("div",{className:"bg-card/50 backdrop-blur-sm border border-border/50 rounded-3xl p-6 shadow-soft",children:e.jsxs("div",{className:"flex gap-4 mb-6 border-b border-border/50 pb-2",children:[e.jsx("button",{onClick:()=>{},className:"px-4 py-2 rounded-xl bg-primary text-primary-foreground",children:"Referral Codes"}),e.jsx("button",{onClick:()=>{},className:"px-4 py-2 rounded-xl hover:bg-muted",children:"Payouts"}),e.jsx("button",{onClick:()=>{},className:"px-4 py-2 rounded-xl hover:bg-muted",children:"Testing Suite"})]})})}),e.jsxs(O,{className:"p-6 mb-8 rounded-3xl shadow-soft",children:[e.jsx("h2",{className:"font-heading text-2xl font-semibold mb-4",children:"Voice Preview"}),e.jsx("p",{className:"text-muted-foreground mb-6",children:"Test each mentor's voice before generating content"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:ae.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-2xl bg-card",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.name}),e.jsx("p",{className:"text-sm text-muted-foreground capitalize",children:s.slug})]}),e.jsx(N,{variant:"outline",size:"sm",onClick:()=>Me(s.slug),disabled:n===s.slug,className:"rounded-full",children:n===s.slug?e.jsx(R,{className:"h-4 w-4 animate-spin"}):e.jsx(ns,{className:"h-4 w-4"})})]},s.id))})]}),e.jsx(ys,{}),e.jsxs(O,{className:"p-6 mb-8 rounded-3xl shadow-soft",children:[e.jsx("h2",{className:"font-heading text-2xl font-semibold mb-4",children:"ðŸƒ Sample Card Generator"}),e.jsx("p",{className:"text-muted-foreground mb-6",children:"Generate complete trading cards with images, names, traits, and lore"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(u,{htmlFor:"cardSpiritAnimal",children:"Spirit Animal"}),e.jsxs("select",{id:"cardSpiritAnimal",value:a.spiritAnimal,onChange:s=>c({...a,spiritAnimal:s.target.value}),className:"w-full p-3 min-h-[44px] border rounded-2xl bg-background text-base",children:[e.jsx("option",{value:"wolf",children:"Wolf"}),e.jsx("option",{value:"lion",children:"Lion"}),e.jsx("option",{value:"tiger",children:"Tiger"}),e.jsx("option",{value:"eagle",children:"Eagle"}),e.jsx("option",{value:"bear",children:"Bear"}),e.jsx("option",{value:"phoenix",children:"Phoenix"}),e.jsx("option",{value:"dragon",children:"Dragon"}),e.jsx("option",{value:"shark",children:"Shark"}),e.jsx("option",{value:"whale",children:"Whale"}),e.jsx("option",{value:"dolphin",children:"Dolphin"}),e.jsx("option",{value:"owl",children:"Owl"}),e.jsx("option",{value:"fox",children:"Fox"}),e.jsx("option",{value:"panther",children:"Panther"}),e.jsx("option",{value:"hawk",children:"Hawk"}),e.jsx("option",{value:"lynx",children:"Lynx"})]})]}),e.jsxs("div",{children:[e.jsx(u,{htmlFor:"cardElement",children:"Element"}),e.jsxs("select",{id:"cardElement",value:a.element,onChange:s=>c({...a,element:s.target.value}),className:"w-full p-3 min-h-[44px] border rounded-2xl bg-background text-base",children:[e.jsx("option",{value:"fire",children:"Fire"}),e.jsx("option",{value:"water",children:"Water"}),e.jsx("option",{value:"earth",children:"Earth"}),e.jsx("option",{value:"air",children:"Air"}),e.jsx("option",{value:"lightning",children:"Lightning"}),e.jsx("option",{value:"ice",children:"Ice"}),e.jsx("option",{value:"light",children:"Light"}),e.jsx("option",{value:"shadow",children:"Shadow"})]})]})]}),e.jsxs("div",{children:[e.jsxs(u,{htmlFor:"cardStage",children:["Evolution Stage: ",a.stage," - ",qe(a.stage)]}),e.jsx("input",{type:"range",id:"cardStage",min:"0",max:"20",value:a.stage,onChange:s=>c({...a,stage:parseInt(s.target.value)}),className:"w-full h-10 cursor-pointer"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx(u,{htmlFor:"cardFavoriteColor",children:"Favorite Color"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(w,{type:"color",id:"cardFavoriteColor",value:a.favoriteColor,onChange:s=>c({...a,favoriteColor:s.target.value}),className:"w-16 h-12 rounded-2xl cursor-pointer"}),e.jsx(w,{type:"text",value:a.favoriteColor,onChange:s=>c({...a,favoriteColor:s.target.value}),className:"flex-1 rounded-2xl min-h-[44px] text-base"})]})]}),e.jsxs("div",{children:[e.jsx(u,{htmlFor:"cardEyeColor",children:"Eye Color (Optional)"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(w,{type:"color",id:"cardEyeColor",value:a.eyeColor,onChange:s=>c({...a,eyeColor:s.target.value}),className:"w-16 h-12 rounded-2xl cursor-pointer"}),e.jsx(w,{type:"text",value:a.eyeColor,onChange:s=>c({...a,eyeColor:s.target.value}),className:"flex-1 rounded-2xl min-h-[44px] text-base"})]})]}),e.jsxs("div",{children:[e.jsx(u,{htmlFor:"cardFurColor",children:"Fur/Scale Color (Optional)"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(w,{type:"color",id:"cardFurColor",value:a.furColor,onChange:s=>c({...a,furColor:s.target.value}),className:"w-16 h-12 rounded-2xl cursor-pointer"}),e.jsx(w,{type:"text",value:a.furColor,onChange:s=>c({...a,furColor:s.target.value}),className:"flex-1 rounded-2xl min-h-[44px] text-base"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 p-4 rounded-2xl bg-muted/50",children:[e.jsxs("div",{children:[e.jsxs(u,{htmlFor:"cardMind",children:["ðŸ§  Mind: ",a.mind]}),e.jsx("input",{type:"range",id:"cardMind",min:"0",max:"100",value:a.mind,onChange:s=>c({...a,mind:parseInt(s.target.value)}),className:"w-full h-8 cursor-pointer"})]}),e.jsxs("div",{children:[e.jsxs(u,{htmlFor:"cardBody",children:["ðŸ’ª Body: ",a.body]}),e.jsx("input",{type:"range",id:"cardBody",min:"0",max:"100",value:a.body,onChange:s=>c({...a,body:parseInt(s.target.value)}),className:"w-full h-8 cursor-pointer"})]}),e.jsxs("div",{children:[e.jsxs(u,{htmlFor:"cardSoul",children:["ðŸ”¥ Soul: ",a.soul]}),e.jsx("input",{type:"range",id:"cardSoul",min:"0",max:"100",value:a.soul,onChange:s=>c({...a,soul:parseInt(s.target.value)}),className:"w-full h-8 cursor-pointer"})]})]}),e.jsxs("div",{children:[e.jsx(u,{htmlFor:"cardCustomName",children:"Custom Name (Optional - leave blank for auto-generated)"}),e.jsx(w,{type:"text",id:"cardCustomName",value:a.customName,onChange:s=>c({...a,customName:s.target.value}),placeholder:"Leave blank for AI to generate a name",className:"rounded-2xl min-h-[44px] text-base"})]}),e.jsx(N,{onClick:De,disabled:I,className:"w-full rounded-2xl min-h-[48px] text-base",children:I?e.jsxs(e.Fragment,{children:[e.jsx(R,{className:"h-5 w-5 mr-2 animate-spin"}),"Generating Card... (this may take a moment)"]}):"ðŸƒ Generate Sample Card"}),i&&e.jsxs("div",{className:"space-y-4 p-4 md:p-6 border rounded-2xl bg-card",children:[e.jsx("div",{className:"flex justify-center",children:e.jsx(us,{card:i})}),e.jsx("div",{className:"text-center text-sm text-muted-foreground",children:"Click the card to view full size â€¢ Click again to flip and see lore"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm text-muted-foreground bg-muted/30 rounded-xl p-3",children:[e.jsxs("div",{children:["Rarity: ",e.jsx("span",{className:"font-semibold text-foreground",children:i.rarity})]}),e.jsxs("div",{children:["Energy Cost: ",e.jsx("span",{className:"font-semibold text-foreground",children:i.energy_cost})]}),e.jsxs("div",{children:["Bond Level: ",e.jsx("span",{className:"font-semibold text-foreground",children:i.bond_level})]}),e.jsxs("div",{children:["Card ID: ",e.jsx("span",{className:"font-mono text-xs text-foreground",children:i.card_id})]})]})]})]})]}),e.jsxs(O,{className:"p-4 md:p-6 mb-8 rounded-3xl shadow-soft bg-card",children:[e.jsx("h2",{className:"font-heading text-xl font-semibold mb-2",children:"ðŸ“¸ Cosmic Postcard Tester"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-6",children:"Test the cosmic postcard generation system. Optionally provide a source image URL, or leave blank to generate a companion image first."}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(u,{htmlFor:"postcardAnimal",children:"Spirit Animal"}),e.jsxs("select",{id:"postcardAnimal",value:x.spiritAnimal,onChange:s=>B({...x,spiritAnimal:s.target.value}),className:"w-full p-3 min-h-[44px] border rounded-2xl bg-background text-base",children:[e.jsx("option",{value:"wolf",children:"Wolf"}),e.jsx("option",{value:"fox",children:"Fox"}),e.jsx("option",{value:"tiger",children:"Tiger"}),e.jsx("option",{value:"lion",children:"Lion"}),e.jsx("option",{value:"bear",children:"Bear"}),e.jsx("option",{value:"eagle",children:"Eagle"}),e.jsx("option",{value:"owl",children:"Owl"}),e.jsx("option",{value:"dragon",children:"Dragon"}),e.jsx("option",{value:"phoenix",children:"Phoenix"}),e.jsx("option",{value:"dolphin",children:"Dolphin"}),e.jsx("option",{value:"whale",children:"Whale"}),e.jsx("option",{value:"rabbit",children:"Rabbit"}),e.jsx("option",{value:"deer",children:"Deer"}),e.jsx("option",{value:"cat",children:"Cat"}),e.jsx("option",{value:"dog",children:"Dog"})]})]}),e.jsxs("div",{children:[e.jsx(u,{htmlFor:"postcardElement",children:"Element"}),e.jsxs("select",{id:"postcardElement",value:x.element,onChange:s=>B({...x,element:s.target.value}),className:"w-full p-3 min-h-[44px] border rounded-2xl bg-background text-base",children:[e.jsx("option",{value:"fire",children:"Fire"}),e.jsx("option",{value:"water",children:"Water"}),e.jsx("option",{value:"earth",children:"Earth"}),e.jsx("option",{value:"air",children:"Air"}),e.jsx("option",{value:"lightning",children:"Lightning"}),e.jsx("option",{value:"ice",children:"Ice"}),e.jsx("option",{value:"light",children:"Light"}),e.jsx("option",{value:"shadow",children:"Shadow"})]})]})]}),e.jsxs("div",{children:[e.jsxs(u,{htmlFor:"postcardMilestone",children:["Milestone: ",x.milestonePercent,"%"]}),e.jsx("div",{className:"flex gap-2 mt-2",children:[25,50,75,100].map(s=>e.jsxs(N,{variant:x.milestonePercent===s?"default":"outline",onClick:()=>B({...x,milestonePercent:s}),className:"flex-1 rounded-xl",children:[s,"%"]},s))})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx(u,{htmlFor:"postcardFavoriteColor",children:"Favorite Color"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(w,{type:"color",id:"postcardFavoriteColor",value:x.favoriteColor,onChange:s=>B({...x,favoriteColor:s.target.value}),className:"w-16 h-12 rounded-2xl cursor-pointer"}),e.jsx(w,{type:"text",value:x.favoriteColor,onChange:s=>B({...x,favoriteColor:s.target.value}),className:"flex-1 rounded-2xl min-h-[44px] text-base"})]})]}),e.jsxs("div",{children:[e.jsx(u,{htmlFor:"postcardEyeColor",children:"Eye Color"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(w,{type:"color",id:"postcardEyeColor",value:x.eyeColor,onChange:s=>B({...x,eyeColor:s.target.value}),className:"w-16 h-12 rounded-2xl cursor-pointer"}),e.jsx(w,{type:"text",value:x.eyeColor,onChange:s=>B({...x,eyeColor:s.target.value}),className:"flex-1 rounded-2xl min-h-[44px] text-base"})]})]}),e.jsxs("div",{children:[e.jsx(u,{htmlFor:"postcardFurColor",children:"Fur/Scale Color"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(w,{type:"color",id:"postcardFurColor",value:x.furColor,onChange:s=>B({...x,furColor:s.target.value}),className:"w-16 h-12 rounded-2xl cursor-pointer"}),e.jsx(w,{type:"text",value:x.furColor,onChange:s=>B({...x,furColor:s.target.value}),className:"flex-1 rounded-2xl min-h-[44px] text-base"})]})]})]}),e.jsxs("div",{children:[e.jsx(u,{htmlFor:"postcardSourceUrl",children:"Source Image URL (Optional - leave blank to generate companion first)"}),e.jsx(w,{type:"text",id:"postcardSourceUrl",value:x.sourceImageUrl,onChange:s=>B({...x,sourceImageUrl:s.target.value}),placeholder:"https://... or leave blank",className:"rounded-2xl min-h-[44px] text-base"})]}),e.jsx(N,{onClick:Re,disabled:de,className:"w-full rounded-2xl min-h-[48px] text-base",children:de?e.jsxs(e.Fragment,{children:[e.jsx(R,{className:"h-5 w-5 mr-2 animate-spin"}),"Generating Postcard... (this may take a moment)"]}):"ðŸ“¸ Generate Cosmic Postcard"}),W&&e.jsxs("div",{className:"space-y-4 p-4 md:p-6 border rounded-2xl bg-card",children:[e.jsx("div",{className:"relative aspect-[4/3] rounded-xl overflow-hidden",children:e.jsx("img",{src:W.imageUrl,alt:`Postcard from ${W.locationName}`,className:"w-full h-full object-cover"})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"font-semibold text-lg",children:W.locationName}),e.jsx("p",{className:"text-sm text-muted-foreground",children:W.locationDescription}),e.jsx("p",{className:"text-sm italic",children:W.caption})]}),e.jsx("div",{className:"flex gap-2",children:e.jsxs(N,{variant:"outline",onClick:()=>Ce(W.imageUrl,`postcard-${W.locationName.replace(/\s+/g,"-").toLowerCase()}.png`),className:"flex-1 rounded-xl",children:[e.jsx(we,{className:"h-4 w-4 mr-2"}),"Download"]})})]})]})]}),e.jsx("div",{className:"mb-8",children:e.jsxs(N,{onClick:()=>M(!0),className:"flex items-center gap-2",children:[e.jsx(be,{className:"h-4 w-4"}),"Create New Pep Talk"]})}),L&&e.jsxs(O,{className:"p-6 mb-8 rounded-3xl shadow-soft",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"font-heading text-2xl font-semibold",children:P?"Edit Pep Talk":"Create New Pep Talk"}),e.jsx(N,{variant:"ghost",size:"icon",onClick:le,className:"rounded-full",children:e.jsx(xe,{className:"h-5 w-5"})})]}),e.jsxs("form",{onSubmit:ke,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(u,{htmlFor:"title",children:"Title"}),e.jsx(w,{id:"title",value:A.title,onChange:s=>G({...A,title:s.target.value}),maxLength:200,required:!0,className:"rounded-2xl"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(u,{htmlFor:"category",children:"Category (Legacy)"}),e.jsx(w,{id:"category",value:A.category,onChange:s=>G({...A,category:s.target.value}),placeholder:"e.g., daily, heartbreak",maxLength:50,className:"rounded-2xl"})]}),e.jsxs("div",{children:[e.jsx(u,{htmlFor:"mentor",children:"Mentor"}),e.jsxs("select",{id:"mentor",value:A.mentor_id,onChange:s=>G({...A,mentor_id:s.target.value}),className:"w-full h-10 px-3 rounded-2xl border border-input bg-background",children:[e.jsx("option",{value:"",children:"No specific mentor"}),ae.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]})]}),e.jsxs("div",{children:[e.jsx(u,{htmlFor:"topic-category",children:"Topic Categories (up to 4)"}),e.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:["discipline","confidence","physique","focus","mindset","business"].map(s=>{const _=s.charAt(0).toUpperCase()+s.slice(1);return e.jsx(N,{type:"button",variant:A.topic_category.includes(s)?"default":"outline",size:"sm",onClick:()=>{const q=A.topic_category;q.includes(s)?G({...A,topic_category:q.filter(z=>z!==s)}):q.length<4?G({...A,topic_category:[...q,s]}):m.error("Maximum 4 categories allowed")},className:"rounded-full text-xs",children:_},s)})}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Selected: ",A.topic_category.length,"/4"]})]}),e.jsxs("div",{children:[e.jsx(u,{children:"Emotional Triggers (Optional)"}),e.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:["Exhausted","Avoiding Action","Anxious & Overthinking","Self-Doubt","Feeling Stuck","Frustrated","Heavy or Low","Emotionally Hurt","Unmotivated","In Transition","Needing Discipline","Motivated & Ready"].map(s=>e.jsx(N,{type:"button",variant:A.emotional_triggers.includes(s)?"default":"outline",size:"sm",onClick:()=>{const _=A.emotional_triggers.includes(s)?A.emotional_triggers.filter(q=>q!==s):[...A.emotional_triggers,s];G({...A,emotional_triggers:_})},className:"rounded-full text-xs",children:s},s))})]}),e.jsxs("div",{children:[e.jsx(u,{htmlFor:"quote",children:"Quote"}),e.jsx(se,{id:"quote",value:A.quote,onChange:s=>G({...A,quote:s.target.value}),maxLength:500,required:!0,className:"rounded-2xl min-h-24"})]}),e.jsxs("div",{children:[e.jsx(u,{htmlFor:"description",children:"Description"}),e.jsx(se,{id:"description",value:A.description,onChange:s=>G({...A,description:s.target.value}),maxLength:1e3,required:!0,className:"rounded-2xl min-h-24"})]}),e.jsxs("div",{children:[e.jsx(u,{htmlFor:"audio",children:"Audio File (MP3)"}),e.jsxs("div",{className:"mt-2",children:[e.jsx(w,{id:"audio",type:"file",accept:"audio/*",onChange:Fe,className:"rounded-2xl"}),$&&e.jsxs("p",{className:"text-sm text-muted-foreground mt-2",children:["Selected: ",$.name]}),A.audio_url&&!$&&e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"Current audio uploaded"})]})]}),e.jsxs("div",{children:[e.jsx(u,{htmlFor:"tags",children:"Tags (comma separated)"}),e.jsx(w,{id:"tags",value:A.tags.join(", "),onChange:s=>G({...A,tags:s.target.value.split(",").map(_=>_.trim()).filter(Boolean)}),placeholder:"discipline, focus, motivation",className:"rounded-2xl"})]}),e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(fe,{id:"featured",checked:A.is_featured,onCheckedChange:s=>G({...A,is_featured:s})}),e.jsx(u,{htmlFor:"featured",children:"Featured"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(fe,{id:"premium",checked:A.is_premium,onCheckedChange:s=>G({...A,is_premium:s})}),e.jsx(u,{htmlFor:"premium",children:"Premium"})]})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsxs(N,{type:"submit",className:"flex-1 rounded-full bg-gradient-to-r from-blush-rose to-lavender-mist hover:shadow-glow transition-all",children:["Preview ",P?"Update":"Creation"]}),e.jsx(N,{type:"button",variant:"outline",onClick:le,className:"rounded-full",children:"Cancel"})]})]})]}),j&&C&&e.jsxs(O,{className:"p-6 mb-8 rounded-3xl shadow-soft border-2 border-royal-purple",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"font-heading text-2xl font-semibold text-royal-purple",children:"Preview: Approve Before Saving"}),e.jsx(N,{variant:"ghost",size:"icon",onClick:()=>{h(!1),M(!0)},className:"rounded-full",children:e.jsx(xe,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx(u,{className:"text-muted-foreground",children:"Title"}),e.jsx("p",{className:"text-lg font-semibold mt-1",children:C.title})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(u,{className:"text-muted-foreground",children:"Category"}),e.jsx("p",{className:"text-sm mt-1 uppercase font-medium",children:C.category})]}),e.jsxs("div",{children:[e.jsx(u,{className:"text-muted-foreground",children:"Mentor"}),e.jsx("p",{className:"text-sm mt-1",children:C.mentor_id?ae.find(s=>s.id===C.mentor_id)?.name||"Unknown":"No specific mentor"})]})]}),e.jsxs("div",{children:[e.jsx(u,{className:"text-muted-foreground",children:"Quote / Script"}),e.jsx("p",{className:"text-base mt-1 italic",children:C.quote})]}),e.jsxs("div",{children:[e.jsx(u,{className:"text-muted-foreground",children:"Description"}),e.jsx("p",{className:"text-base mt-1",children:C.description})]}),C.tags&&C.tags.length>0&&e.jsxs("div",{children:[e.jsx(u,{className:"text-muted-foreground",children:"Tags"}),e.jsx("div",{className:"flex flex-wrap gap-2 mt-1",children:C.tags.map((s,_)=>e.jsxs("span",{className:"px-3 py-1 bg-royal-purple/10 text-royal-purple rounded-full text-sm",children:["#",s]},_))})]}),e.jsxs("div",{children:[e.jsx(u,{className:"text-muted-foreground",children:"Audio Preview"}),C.audio_url?e.jsx("audio",{controls:!0,className:"w-full mt-2 rounded-2xl",src:C.audio_url,children:"Your browser does not support the audio element."}):C.audioFile?e.jsx("audio",{controls:!0,className:"w-full mt-2 rounded-2xl",src:URL.createObjectURL(C.audioFile),children:"Your browser does not support the audio element."}):e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"No audio available"})]}),e.jsxs("div",{className:"flex gap-4",children:[C.is_featured&&e.jsx("div",{className:"flex items-center gap-2 px-3 py-1 bg-amber-500/10 text-amber-600 rounded-full text-sm",children:e.jsx("span",{className:"font-medium",children:"â­ Featured"})}),C.is_premium&&e.jsx("div",{className:"flex items-center gap-2 px-3 py-1 bg-purple-500/10 text-purple-600 rounded-full text-sm",children:e.jsx("span",{className:"font-medium",children:"ðŸ’Ž Premium"})})]}),e.jsxs("div",{className:"flex gap-3 pt-6 border-t",children:[e.jsx(N,{onClick:Ae,disabled:t,className:"flex-1 rounded-full bg-green-600 hover:bg-green-700 text-white",children:t?e.jsxs(e.Fragment,{children:[e.jsx(R,{className:"h-4 w-4 mr-2 animate-spin"}),"Saving..."]}):e.jsx(e.Fragment,{children:"âœ“ Approve & Save to Catalog"})}),e.jsx(N,{onClick:Te,disabled:t,variant:"outline",className:"rounded-full border-red-500 text-red-500 hover:bg-red-50",children:"âœ— Edit More"})]})]})]}),e.jsxs("div",{className:"space-y-6 mb-8",children:[e.jsx(js,{}),e.jsx(fs,{}),e.jsx(ps,{}),e.jsx(hs,{}),e.jsx(gs,{})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h2",{className:"font-heading text-2xl font-semibold text-foreground",children:["All Pep Talks (",b.length,")"]}),b.map(s=>e.jsx(O,{className:"p-5 rounded-3xl shadow-soft",children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"text-xs font-medium text-muted-foreground uppercase",children:s.category}),s.is_featured&&e.jsx("span",{className:"text-xs px-2 py-0.5 rounded-full bg-gold-accent/20 text-warm-charcoal font-medium",children:"Featured"})]}),e.jsx("h3",{className:"font-heading text-lg font-semibold text-foreground mb-1",children:s.title}),e.jsx("p",{className:"text-sm text-muted-foreground line-clamp-2",children:s.description})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(N,{variant:"ghost",size:"icon",onClick:()=>Ee(s),className:"rounded-full hover:bg-secondary",children:e.jsx(os,{className:"h-4 w-4"})}),e.jsx(N,{variant:"ghost",size:"icon",onClick:()=>$e(s.id),className:"rounded-full hover:bg-destructive/10 hover:text-destructive",children:e.jsx(ye,{className:"h-4 w-4"})})]})]})},s.id)),b.length===0&&e.jsxs(O,{className:"p-12 text-center rounded-3xl shadow-soft",children:[e.jsx(is,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"No pep talks yet. Create your first one!"})]})]})]})}):null};export{Ss as default};
