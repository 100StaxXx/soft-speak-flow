import{j as e,m as he,ar as Te,dF as Ue,dG as qe,ac as ze,r,bv as Ye,n as We,aL as Ve,K as Xe}from"./vendor-FfY6MM0Z.js";import{B as pe,c as Ke,s as z,bp as Ze,bq as Je,br as Qe,bo as ve}from"./index-sX_cJ3I4.js";import{t as ce,u as et}from"./gameUtils-G90wW1BE.js";import"./date-vendor-Bk4KiHsJ.js";import"./three-vendor-qI8GXUTd.js";const tt=({trackName:c,onRate:f,onSkip:m,isSubmitting:a=!1,currentRating:o})=>{const u=b=>{ce("medium"),f(b)};return e.jsxs(he.div,{className:"flex flex-col items-center gap-4 p-6 rounded-2xl",style:{background:"linear-gradient(135deg, hsl(var(--card)) 0%, hsl(var(--card) / 0.8) 100%)",border:"1px solid hsl(var(--border) / 0.5)",boxShadow:"0 8px 32px hsl(var(--primary) / 0.15)"},initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3},children:[e.jsxs("div",{className:"flex items-center gap-2 text-primary",children:[e.jsx(Te,{className:"w-5 h-5"}),e.jsx("span",{className:"text-lg font-semibold",children:"Rate this track!"})]}),c&&e.jsx("p",{className:"text-sm text-muted-foreground text-center max-w-[200px] truncate",children:c}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(he.div,{whileHover:{scale:1.05},whileTap:{scale:.95},children:e.jsxs(pe,{variant:o==="up"?"default":"outline",size:"lg",onClick:()=>u("up"),disabled:a,className:"flex items-center gap-2 min-w-[100px]",style:{background:o==="up"?"linear-gradient(135deg, hsl(142, 71%, 45%), hsl(142, 71%, 35%))":void 0,borderColor:"hsl(142, 71%, 45%)"},children:[e.jsx(Ue,{className:`w-5 h-5 ${o==="up"?"fill-current":""}`}),e.jsx("span",{children:"Like"})]})}),e.jsx(he.div,{whileHover:{scale:1.05},whileTap:{scale:.95},children:e.jsxs(pe,{variant:o==="down"?"default":"outline",size:"lg",onClick:()=>u("down"),disabled:a,className:"flex items-center gap-2 min-w-[100px]",style:{background:o==="down"?"linear-gradient(135deg, hsl(0, 84%, 60%), hsl(0, 84%, 50%))":void 0,borderColor:"hsl(0, 84%, 60%)"},children:[e.jsx(qe,{className:`w-5 h-5 ${o==="down"?"fill-current":""}`}),e.jsx("span",{children:"Dislike"})]})})]}),e.jsxs(pe,{variant:"ghost",size:"sm",onClick:m,disabled:a,className:"text-muted-foreground hover:text-foreground",children:[e.jsx(ze,{className:"w-4 h-4 mr-1"}),"Skip"]}),e.jsx("p",{className:"text-xs text-muted-foreground text-center",children:"Your feedback helps improve future tracks!"})]})},st=()=>{const{user:c}=Ke(),[f,m]=r.useState(null),[a,o]=r.useState(!1),[u,b]=r.useState(!1),[w,I]=r.useState(null),[i,x]=r.useState(null),g=r.useRef(!1),$=r.useCallback(async N=>{if(g.current)return null;g.current=!0,b(!0);try{console.log("Generating new rhythm track...");const{data:d,error:v}=await z.functions.invoke("generate-rhythm-track",{body:{genre:"stellar_beats",difficulty:N||"all"}});return v?(console.error("Error generating track:",v),null):d?.track?(console.log("Track generated successfully:",d.track),{...d.track,upvotes:0,downvotes:0,score:0,play_count:0}):null}catch(d){return console.error("Error generating track:",d),null}finally{b(!1),g.current=!1}},[]),V=r.useCallback(async N=>{o(!0),I(null),x(null);try{let d=z.from("rhythm_tracks").select("*").eq("is_active",!0);N&&N!=="all"&&(d=d.or(`difficulty_tier.eq.${N},difficulty_tier.eq.all`));const{data:v,error:A}=await d;if(A)return console.error("Error fetching rhythm tracks:",A),I("Failed to load tracks"),o(!1),null;if(!v||v.length===0){console.log("No rhythm tracks available, generating new track...");const l=await $(N);return l?(m(l),o(!1),l):(I("No tracks available"),o(!1),null)}const E=v.map(l=>l.id),{data:ue}=await z.from("rhythm_track_ratings").select("track_id, rating").in("track_id",E),Z=v.map(l=>{const F=ue?.filter(S=>S.track_id===l.id)||[],W=F.filter(S=>S.rating==="up").length,U=F.filter(S=>S.rating==="down").length,C=W-U;return{...l,upvotes:W,downvotes:U,score:C}}),O=Z.filter(l=>l.score>=-5);if(O.length===0){const l=Z[Math.floor(Math.random()*Z.length)];return m(l),await X(l.id),o(!1),l}const L=O.map(l=>Math.max(1,l.score+10)),ee=L.reduce((l,F)=>l+F,0);let te=Math.random()*ee,Y=O[0];for(let l=0;l<O.length;l++)if(te-=L[l],te<=0){Y=O[l];break}return m(Y),await X(Y.id),o(!1),Y}catch(d){return console.error("Error in fetchRandomTrack:",d),I("Failed to load track"),o(!1),null}},[$]),X=async N=>{if(!c?.id)return;const{data:d}=await z.from("rhythm_track_ratings").select("rating").eq("track_id",N).eq("user_id",c.id).maybeSingle();d&&x(d.rating)},ie=r.useCallback(async(N,d)=>{if(!c?.id)return console.error("User not authenticated"),!1;try{const{error:v}=await z.from("rhythm_track_ratings").upsert({track_id:N,user_id:c.id,rating:d},{onConflict:"track_id,user_id"});if(v)return console.error("Error rating track:",v),!1;if(x(d),f&&f.id===N){const A=d==="up"?1:-1;m(E=>E?{...E,upvotes:d==="up"?E.upvotes+1:E.upvotes,downvotes:d==="down"?E.downvotes+1:E.downvotes,score:E.score+A}:null)}return!0}catch(v){return console.error("Error rating track:",v),!1}},[c?.id,f]),K=r.useCallback(async N=>{try{const{data:d}=await z.from("rhythm_tracks").select("play_count").eq("id",N).maybeSingle();d&&await z.from("rhythm_tracks").update({play_count:(d.play_count||0)+1}).eq("id",N)}catch(d){console.error("Error incrementing play count:",d)}},[]);return{track:f,isLoading:a,isGenerating:u,error:w,userRating:i,fetchRandomTrack:V,rateTrack:ie,incrementPlayCount:K}},je={moon:0,star:1,sun:2},ge=1500,rt={beginner:{notesPerBeat:.25,patterns:["single"]},easy:{notesPerBeat:.5,patterns:["single"]},medium:{notesPerBeat:1,patterns:["single","double"]},hard:{notesPerBeat:2,patterns:["single","double","triple"]},master:{notesPerBeat:3,patterns:["single","double","triple"]}},oe={perfect:60,great:120,good:180},nt=30,ot={beginner:12,easy:10,medium:8,hard:5,master:3},B=85,at=16,$e={perfect:{label:"PERFECT!",points:100,color:"hsl(45, 100%, 60%)"},great:{label:"GREAT!",points:75,color:"hsl(271, 91%, 65%)"},good:{label:"GOOD",points:50,color:"hsl(142, 71%, 45%)"},miss:{label:"MISS",points:0,color:"hsl(0, 84%, 60%)"}},H={moon:{icon:Ve,color:"hsl(271, 91%, 65%)",glowColor:"hsl(271, 91%, 75%)"},star:{icon:We,color:"hsl(45, 100%, 60%)",glowColor:"hsl(45, 100%, 70%)"},sun:{icon:Ye,color:"hsl(25, 95%, 55%)",glowColor:"hsl(25, 95%, 65%)"}},P=["moon","star","sun"],ke=1500,Ne=500,Se=c=>c>=50?4:c>=25?3:c>=10?2:1,ae={score:0,combo:0,maxCombo:0,notesHit:0,notesMissed:0},_e=r.memo(({stars:c})=>e.jsxs("div",{className:"absolute inset-0 overflow-hidden pointer-events-none",children:[c.map((f,m)=>e.jsx("div",{className:"absolute rounded-full",style:{left:`${f.x}%`,top:`${f.y}%`,width:`${m%3===0?3:2}px`,height:`${m%3===0?3:2}px`,background:m%5===0?"hsl(45, 100%, 80%)":"hsl(210, 100%, 90%)",boxShadow:`0 0 ${2+m%3}px rgba(255,255,255,0.4)`,opacity:.4+m%4*.08}},f.id)),e.jsx("div",{className:"absolute inset-0 opacity-25",style:{background:"radial-gradient(ellipse at 20% 20%, hsl(271, 50%, 25%) 0%, transparent 50%), radial-gradient(ellipse at 80% 80%, hsl(45, 50%, 15%) 0%, transparent 50%)"}})]}));_e.displayName="StaticStarBackground";const Me=r.memo(({note:c,laneIndex:f,gameTimeMs:m})=>{const a=H[c.lane],o=c.expectedHitTime-m,u=Math.max(0,Math.min(1,1-o/ge)),b=.4+u*.6,w=30+u*50;return e.jsxs("div",{className:"absolute pointer-events-none",style:{left:`calc(${(f+.5)*33.33}% - 45px)`,top:`${c.y}%`,transform:"translateY(-50%) translateZ(0)",willChange:"transform",zIndex:15},children:[e.jsx("div",{className:"absolute left-1/2 -translate-x-1/2",style:{width:"60px",height:`${w}px`,bottom:"100%",background:`linear-gradient(to bottom, transparent 0%, ${a.color}40 50%, ${a.color}80 100%)`,filter:`blur(${4+u*4}px)`,opacity:b*.7}}),e.jsx("div",{style:{width:"90px",height:"18px",borderRadius:"9px",background:`linear-gradient(180deg, ${a.glowColor} 0%, ${a.color} 50%, ${a.color}cc 100%)`,boxShadow:`
            0 0 ${10+u*15}px ${a.color}${Math.round(b*99).toString(16).padStart(2,"0")},
            0 0 ${20+u*20}px ${a.color}60,
            inset 0 2px 4px rgba(255,255,255,0.4),
            inset 0 -2px 4px rgba(0,0,0,0.3)
          `,border:`2px solid ${a.glowColor}`,transform:`scaleY(${1+u*.2})`,transition:"transform 0.05s ease-out"},children:e.jsx("div",{className:"absolute top-1 left-2 right-2 h-1 rounded-full",style:{background:"rgba(255,255,255,0.5)"}})})]})});Me.displayName="NoteBar";const Ee=r.memo(({lane:c,result:f})=>{const m=je[c],a=$e[f],o=H[c];return e.jsxs("div",{className:"absolute flex flex-col items-center justify-center pointer-events-none",style:{left:`calc(${(m+.5)*33.33}%)`,top:`${B}%`,transform:"translate(-50%, -50%)"},children:[e.jsx("div",{className:"absolute animate-ping",style:{width:"80px",height:"80px",borderRadius:"50%",border:`3px solid ${f==="perfect"?a.color:o.color}`,opacity:.6}}),e.jsx("span",{className:"text-xl font-black whitespace-nowrap animate-stellar-hit-text",style:{color:a.color,textShadow:`0 0 15px ${a.color}, 0 0 30px ${a.color}80`},children:a.label})]})});Ee.displayName="HitEffect";const Ce=r.memo(({lane:c,laneIndex:f,onTap:m,isPressed:a,hasApproachingNote:o})=>{const u=H[c],b=u.icon,w=r.useRef(!1),I=r.useCallback(g=>{if(g.preventDefault(),g.stopPropagation(),w.current)return;w.current=!0;const $=performance.now();ce("light"),m($)},[m]),i=r.useCallback(g=>{g.preventDefault(),w.current=!1},[]),x=r.useCallback(g=>{if(g.pointerType==="touch")return;g.preventDefault(),g.stopPropagation();const $=performance.now();ce("light"),m($)},[m]);return e.jsx("button",{className:"flex-1 h-full flex items-center justify-center relative overflow-hidden select-none",onTouchStart:I,onTouchEnd:i,onTouchCancel:i,onPointerDown:x,onContextMenu:g=>g.preventDefault(),style:{background:a?`linear-gradient(to top, ${u.color}80, ${u.color}30)`:o?`linear-gradient(to top, ${u.color}40, transparent)`:"transparent",touchAction:"none",WebkitTapHighlightColor:"transparent",WebkitUserSelect:"none",userSelect:"none"},children:e.jsx("div",{className:"w-20 h-20 rounded-full flex items-center justify-center transition-all duration-50",style:{background:a?`radial-gradient(circle, ${u.color}, ${u.color}90)`:`radial-gradient(circle, ${u.color}50, ${u.color}20)`,border:`4px solid ${u.color}${a?"":"90"}`,boxShadow:a?`0 0 30px ${u.color}, 0 0 60px ${u.color}60`:o?`0 0 20px ${u.color}60`:`0 0 10px ${u.color}40`,transform:a?"scale(0.85)":"scale(1)"},children:e.jsx(b,{className:"w-8 h-8 pointer-events-none",style:{color:a?"white":u.color}})})})});Ce.displayName="LaneButton";const fe=(c,f,m)=>{const a=rt[m],u=6e4/c/a.notesPerBeat,b=[];let w=2e3;const I=(f-2)*1e3;for(;w<I;){const i=a.patterns[Math.floor(Math.random()*a.patterns.length)],x=w-ge;if(i==="single"){const g=P[Math.floor(Math.random()*3)];b.push({id:b.length,lane:g,spawnTime:x,expectedHitTime:w,y:-10,hit:!1,missed:!1})}else i==="double"?[...P].sort(()=>Math.random()-.5).slice(0,2).forEach($=>{b.push({id:b.length,lane:$,spawnTime:x,expectedHitTime:w,y:-10,hit:!1,missed:!1})}):i==="triple"&&P.forEach(g=>{b.push({id:b.length,lane:g,spawnTime:x,expectedHitTime:w,y:-10,hit:!1,missed:!1})});w+=u}return b},le=c=>fe(120,30,c),Re=r.memo(({isGenerating:c})=>e.jsxs("div",{className:"flex flex-col items-center justify-center h-full min-h-[300px] gap-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"animate-spin",children:e.jsx(Te,{className:"w-12 h-12 text-primary"})}),e.jsx(Xe,{className:"absolute -top-1 -right-1 w-5 h-5 text-yellow-400 animate-pulse"})]}),e.jsx("p",{className:"text-base font-medium text-foreground",children:c?"Preparing music...":"Loading music..."})]}));Re.displayName="TrackLoadingScreen";const mt=({companionStats:c,onComplete:f,onDamage:m,tierAttackDamage:a=15,difficulty:o="medium",questIntervalScale:u=0,maxTimer:b,isPractice:w=!1,compact:I=!1})=>{const[i,x]=r.useState("loading"),[g,$]=r.useState(ae),[V,X]=r.useState([]),[ie,K]=r.useState([]),[N,d]=r.useState({moon:!1,star:!1,sun:!1}),[v,A]=r.useState(null),[E,ue]=r.useState(!1),[Z,O]=r.useState(!1),[L,ee]=r.useState(!1),[te,Y]=r.useState(0),l=ot[o],F=r.useRef(0),W=r.useRef(0),U=r.useRef(),C=r.useRef([]),S=r.useRef(ae),j=r.useRef(null),_=r.useRef(null),se=r.useRef(0),Ie=et(20),{isGenerating:Ae,userRating:Le,fetchRandomTrack:re,rateTrack:xe}=st();r.useEffect(()=>((async()=>{se.current=Date.now();const s=await re(o),n=()=>{const T=Date.now()-se.current,k=Math.max(0,ke-T);setTimeout(()=>x("countdown"),k+Ne)};if(s){_.current=s,C.current=fe(s.bpm,s.duration_seconds,o);const T=new Audio(s.audio_url);T.preload="auto",j.current=T,T.addEventListener("canplaythrough",n,{once:!0}),T.addEventListener("error",()=>{C.current=le(o),n()}),T.load()}else C.current=le(o),n()})(),()=>{j.current&&(j.current.pause(),j.current=null)}),[o,re]);const De=r.useCallback(()=>{x("playing"),F.current=performance.now(),W.current=performance.now(),j.current&&(j.current.currentTime=0,j.current.play().catch(t=>{t.name!=="NotAllowedError"&&console.warn("Audio play failed:",t.message)}))},[]);r.useEffect(()=>{if(i!=="playing")return;const t=oe.good+50,s=n=>{const T=n-F.current,k=C.current;let G=0;for(let h=0;h<k.length;h++){const p=k[h];if(p.hit||p.missed)continue;const y=1-(p.expectedHitTime-T)/ge;p.y=-10+y*(B+10),T>p.expectedHitTime+t&&(p.missed=!0,G++)}if(G>0){const h=S.current,p=h.notesMissed+G;if(S.current={...h,notesMissed:p,combo:0},p>=l){j.current?.pause(),m?.({target:"player",amount:ve.eclipse_timing.tooManyMisses,source:"too_many_misses"});const M=k.length,y=S.current,ne=M>0?Math.round(y.notesHit/M*100):0;A({success:!1,accuracy:ne,result:"fail",highScoreValue:y.score,gameStats:{score:y.score,maxCombo:y.maxCombo,notesHit:y.notesHit,misses:y.notesMissed}}),$({...y}),x("complete");return}}if(n-W.current>=at){W.current=n;const h=[];for(let M=0;M<k.length;M++){const y=k[M];!y.hit&&!y.missed&&y.y>=-15&&y.y<=100&&h.push({...y})}X(h),$({...S.current}),Y(T);const p=S.current;ue(p.notesMissed>=l-2&&p.notesMissed<l),O(p.combo>=10)}let D=!0;for(let h=0;h<k.length;h++)if(!k[h].hit&&!k[h].missed&&k[h].y<=100){D=!1;break}if(D&&k.length>0){j.current?.pause(),m?.({target:"adversary",amount:ve.eclipse_timing.songComplete,source:"song_complete"});const h=k.length,p=S.current,M=h>0?Math.round(p.notesHit/h*100):0;A({success:!0,accuracy:M,result:M>=90?"perfect":"good",highScoreValue:p.score,gameStats:{score:p.score,maxCombo:p.maxCombo,notesHit:p.notesHit,misses:p.notesMissed}}),$({...p}),_.current&&!w?x("rating"):x("complete");return}U.current=requestAnimationFrame(s)};return U.current=requestAnimationFrame(s),()=>{U.current&&cancelAnimationFrame(U.current)}},[i,w,m,l]);const J=r.useCallback((t,s)=>{if(i!=="playing")return;d(R=>({...R,[t]:!0})),setTimeout(()=>d(R=>({...R,[t]:!1})),80);const n=s-F.current+nt,T=C.current;let k=null,G=1/0;for(let R=0;R<T.length;R++){const q=T[R];if(q.lane!==t||q.hit||q.missed)continue;const me=Math.abs(n-q.expectedHitTime);me<G&&me<=oe.good&&(G=me,k=q)}if(!k)return;let D;G<=oe.perfect?D="perfect":G<=oe.great?D="great":D="good",k.hit=!0;const h=S.current,p=Se(h.combo),M=$e[D].points*p,y=h.combo+1;S.current={score:h.score+M,combo:y,maxCombo:Math.max(h.maxCombo,y),notesHit:h.notesHit+1,notesMissed:h.notesMissed},$({...S.current});const ne=Date.now();K(R=>[...R.slice(-3),{id:ne,lane:t,result:D}]),setTimeout(()=>K(R=>R.filter(q=>q.id!==ne)),400),ce(D==="perfect"?"success":"light")},[i]);r.useEffect(()=>{const t=s=>{if(i!=="playing")return;const n=performance.now();s.key==="a"||s.key==="ArrowLeft"?J("moon",n):s.key==="s"||s.key==="ArrowDown"?J("star",n):(s.key==="d"||s.key==="ArrowRight")&&J("sun",n)};return window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)},[i,J]);const He=r.useCallback(async t=>{_.current&&await xe(_.current.id,t)},[xe]),Fe=r.useCallback(async()=>{j.current?.pause(),j.current=null,S.current=ae,$(ae),X([]),K([]),A(null),x("loading"),se.current=Date.now();const t=()=>{const n=Date.now()-se.current,T=Math.max(0,ke-n);setTimeout(()=>x("countdown"),T+Ne)},s=await re(o);if(s){_.current=s,C.current=fe(s.bpm,s.duration_seconds,o);const n=new Audio(s.audio_url);n.preload="auto",j.current=n,n.addEventListener("canplaythrough",t,{once:!0}),n.addEventListener("error",()=>{C.current=le(o),t()}),n.load()}else C.current=le(o),_.current=null,t()},[o,re]),Ge=r.useCallback(()=>x("complete"),[]);r.useEffect(()=>{i==="complete"&&v&&setTimeout(()=>f(v),300)},[i,v,f]),r.useEffect(()=>{j.current&&(i==="paused"?j.current.pause():i==="playing"&&j.current.play().catch(t=>{t.name!=="NotAllowedError"&&console.warn("Audio play failed:",t.message)}))},[i]),r.useEffect(()=>{if(i!=="playing"||!_.current)return;const s=6e4/(_.current.bpm||120),n=setInterval(()=>{ee(!0),setTimeout(()=>ee(!1),80)},s);return()=>clearInterval(n)},[i]);const de=r.useMemo(()=>{const t={moon:!1,star:!1,sun:!1};for(const s of V)s.y>B-20&&s.y<B+5&&(t[s.lane]=!0);return t},[V]),{score:be,combo:ye,notesHit:Be,notesMissed:Q}=g,Pe=Se(ye),we=C.current.length,Oe=Be+Q;return i==="loading"?e.jsx("div",{className:"flex flex-col items-center relative w-full h-full min-h-[500px] overflow-hidden",style:{touchAction:"none"},children:e.jsx(Re,{isGenerating:Ae})}):i==="rating"?e.jsxs("div",{className:"flex flex-col items-center justify-center relative w-full h-full min-h-[500px] gap-6 p-4 overflow-hidden",style:{touchAction:"none"},children:[e.jsxs("div",{className:"text-center mb-4",children:[e.jsx("h2",{className:"text-2xl font-bold text-foreground mb-2",children:"Song Complete!"}),e.jsxs("p",{className:"text-lg text-muted-foreground",children:["Score: ",e.jsx("span",{className:"text-primary font-bold",children:be})," ‚Ä¢ Accuracy: ",e.jsxs("span",{className:"text-primary font-bold",children:[v?.accuracy,"%"]})]})]}),_.current&&e.jsx(tt,{trackName:_.current.genre,onRate:He,onSkip:()=>{},currentRating:Le}),e.jsxs("div",{className:"flex gap-4 mt-4",children:[e.jsx("button",{onClick:Fe,className:"px-6 py-3 rounded-lg bg-primary text-primary-foreground font-semibold hover:bg-primary/90 transition-colors",children:"Next Song ‚Üí"}),e.jsx("button",{onClick:Ge,className:"px-6 py-3 rounded-lg bg-secondary text-secondary-foreground font-semibold hover:bg-secondary/90 transition-colors",children:"Finish"})]})]}):e.jsxs("div",{className:"flex flex-col items-center relative w-full h-full min-h-[500px] overflow-hidden",style:{touchAction:"none"},children:[i==="countdown"&&e.jsx(Ze,{count:3,onComplete:De}),i==="paused"&&e.jsx(Je,{onResume:()=>x("playing")}),e.jsx(Qe,{title:"Stellar Beats",subtitle:`${Oe}/${we} notes${_.current?` ‚Ä¢ ${_.current.bpm} BPM`:""}`,score:be,maxScore:we*100*4,combo:ye,showCombo:!0,primaryStat:{value:Q,label:`Misses (max ${l})`,color:Q>=l-2?"hsl(0, 84%, 60%)":"hsl(45, 100%, 60%)"},isPaused:i==="paused",onPauseToggle:()=>x(i==="paused"?"playing":"paused"),compact:I}),E&&i==="playing"&&e.jsxs("div",{className:"absolute top-20 right-4 z-30 px-3 py-1 rounded-full text-sm font-bold animate-pulse",style:{background:"linear-gradient(135deg, hsl(0, 70%, 50%), hsl(0, 84%, 40%))",color:"white"},children:["‚ö†Ô∏è ",l-Q," MISS",l-Q>1?"ES":""," LEFT!"]}),Z&&e.jsxs("div",{className:"absolute top-20 left-1/2 -translate-x-1/2 z-30 px-4 py-2 rounded-full text-base font-bold",style:{background:"linear-gradient(135deg, hsl(45, 100%, 50%), hsl(25, 95%, 50%))",color:"white",boxShadow:"0 0 15px hsl(45, 100%, 50% / 0.4)"},children:["üî• ",Pe,"x MULTIPLIER"]}),e.jsxs("div",{className:"relative w-full rounded-xl overflow-hidden",style:{background:"linear-gradient(to bottom, hsl(240, 35%, 5%), hsl(260, 40%, 8%), hsl(270, 45%, 10%))",height:"calc(100% - 100px)",minHeight:"350px",touchAction:"none",perspective:"800px",perspectiveOrigin:"center 30%"},children:[e.jsx(_e,{stars:Ie}),e.jsxs("div",{className:"absolute inset-0",style:{transformStyle:"preserve-3d",transform:"rotateX(35deg)",transformOrigin:"center bottom"},children:[e.jsx("div",{className:"absolute inset-0 flex pointer-events-none",children:P.map((t,s)=>e.jsx("div",{className:"flex-1 relative",style:{borderRight:s<2?"2px solid hsl(var(--border) / 0.4)":"none"},children:e.jsx("div",{className:"absolute left-1/2 top-0 bottom-0 w-0.5 -translate-x-1/2",style:{background:`linear-gradient(to bottom, ${H[t].color}10 0%, ${H[t].color}30 50%, ${H[t].color}50 100%)`}})},t))}),e.jsx("div",{className:"absolute inset-0 flex pointer-events-none",children:P.map(t=>{const s=H[t],n=de[t];return e.jsx("div",{className:"flex-1 transition-all duration-100",style:{background:`linear-gradient(to bottom, 
                      transparent 0%, 
                      ${s.color}${n?"18":"08"} 40%, 
                      ${s.color}${n?"40":"20"} 70%, 
                      ${s.color}${n?"60":"30"} 100%)`}},t)})})]}),e.jsx("div",{className:"absolute left-0 right-0 pointer-events-none z-8",style:{top:`${B-4}%`,height:"10%",background:`linear-gradient(to bottom, transparent, hsl(45, 100%, 60% / ${L?.3:.15}), transparent)`,transition:"background 0.08s ease-out"}}),e.jsx("div",{className:"absolute left-1/2 -translate-x-1/2 pointer-events-none z-6 transition-all duration-60",style:{top:`${B}%`,transform:"translate(-50%, -50%)",width:L?"180px":"120px",height:L?"180px":"120px",borderRadius:"50%",background:`radial-gradient(circle, hsl(45, 100%, 80% / ${L?.4:.1}), transparent 70%)`,boxShadow:L?"0 0 80px hsl(45, 100%, 60% / 0.6)":"none"}}),e.jsx("div",{className:"absolute left-0 right-0 pointer-events-none z-10",style:{top:`${B}%`,height:"6px",background:"linear-gradient(90deg, hsl(271, 91%, 65%), hsl(45, 100%, 60%), hsl(25, 95%, 55%))",boxShadow:`0 0 25px hsl(45, 100%, 60% / 0.8), 0 0 50px hsl(45, 100%, 60% / ${L?.6:.4})`,transition:"box-shadow 0.08s ease-out"}}),e.jsx("div",{className:"absolute left-0 right-0 flex justify-around pointer-events-none z-5",style:{top:`${B}%`,transform:"translateY(-50%)"},children:P.map(t=>{const s=H[t],n=de[t];return e.jsx("div",{className:"w-24 h-6 rounded-full transition-all duration-100",style:{background:n?`linear-gradient(180deg, ${s.color}60, ${s.color}30)`:`linear-gradient(180deg, ${s.color}30, ${s.color}10)`,border:`3px solid ${n?s.color:`${s.color}60`}`,boxShadow:n?`0 0 25px ${s.color}, inset 0 0 10px ${s.color}40`:`0 0 12px ${s.color}40`,transform:n?"scaleX(1.1)":"scaleX(1)"}},t)})}),e.jsx("div",{className:"absolute top-4 left-0 right-0 flex justify-around pointer-events-none z-20",children:P.map(t=>{const s=H[t],n=s.icon;return e.jsx("div",{className:"p-2 rounded-full",style:{background:`${s.color}25`},children:e.jsx(n,{className:"w-6 h-6",style:{color:s.color,opacity:.9}})},t)})}),V.map(t=>e.jsx(Me,{note:t,laneIndex:je[t.lane],gameTimeMs:te},t.id)),ie.map(t=>e.jsx(Ee,{lane:t.lane,result:t.result},t.id)),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 flex",style:{height:"14%"},children:P.map((t,s)=>e.jsx(Ce,{lane:t,laneIndex:s,onTap:n=>J(t,n),isPressed:N[t],hasApproachingNote:de[t]},t))})]}),i==="playing"&&e.jsx("div",{className:"text-center py-2 text-xs text-muted-foreground",children:"Tap lanes when bars reach the line ‚Ä¢ Keys: A/S/D or ‚Üê/‚Üì/‚Üí"})]})};export{mt as EclipseTimingGame};
