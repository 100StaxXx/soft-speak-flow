import{u as ys,q as Qe,aB as be,aA as B,j as e,Z as Xe,c6 as je,r as d,n as ue,dW as vs,cG as ge,c_ as Ne,dX as ws,cr as bs,W as Ae,dY as Cs,dZ as Ss,v as ks,d_ as Ds,d$ as We,e0 as Ze,db as Ge,da as E,e1 as W,o as qe,cm as O,bY as Ee,aq as he,cX as Je,e2 as Le,e3 as _s,b6 as Is,b7 as Ps,aT as Fs,c5 as es,bd as ss,au as Ce,e4 as Ts,b_ as Rs,l as As,m as V,c9 as ts,_ as qs,bx as Ue,H as Es,cg as Ls}from"./vendor-FfY6MM0Z.js";import{bb as M,s as U,b6 as Ms,b7 as Os,b8 as zs,H as A,b9 as $s,f as Qs,b3 as as,b4 as ns,b5 as rs,bc as Us,bd as Bs,B as p,be as Vs,bf as Se,L as xe,Z,_ as G,$ as J,a0 as ee,a as F,ap as ls,aW as Ks,aX as Hs,aY as Ys,bg as Xs,bh as Ws,bi as Zs,bj as Gs,bk as Js,bl as et,ac as is,ad as os,ae as pe,af as Be,ah as ke,O as De,R as _e,T as Ie,U as Pe,V as Fe,W as Te,X as Re,bm as cs,aV as Ve,C as Ke,P as st,Y as tt}from"./index-sX_cJ3I4.js";import{X as ds,J as at,Y as Me,o as fe,h as He,Z as de,_ as me}from"./date-vendor-Bk4KiHsJ.js";import"./three-vendor-qI8GXUTd.js";function ye(t){const s=ys(),i=Qe({queryKey:M.contactReminders.byContact(t??""),queryFn:async()=>{if(!t)return[];const{data:o,error:a}=await U.from("contact_reminders").select("*").eq("contact_id",t).order("reminder_at",{ascending:!0});if(a)throw a;return o},enabled:!!t}),c=Qe({queryKey:M.contactReminders.upcoming(),queryFn:async()=>{const{data:{user:o}}=await U.auth.getUser();if(!o)return[];const{data:a,error:u}=await U.from("contact_reminders").select(`
          *,
          contacts:contact_id (
            id,
            name,
            avatar_url
          )
        `).eq("user_id",o.id).eq("sent",!1).gte("reminder_at",new Date().toISOString()).order("reminder_at",{ascending:!0}).limit(10);if(u)throw u;return a}}),l=be({mutationFn:async({contactId:o,reminderAt:a,reason:u})=>{const{data:{user:j}}=await U.auth.getUser();if(!j)throw new Error("Not authenticated");const{data:w,error:C}=await U.from("contact_reminders").insert({contact_id:o,user_id:j.id,reminder_at:a.toISOString(),reason:u||null}).select().single();if(C)throw C;return w},onSuccess:(o,a)=>{s.invalidateQueries({queryKey:M.contactReminders.byContact(a.contactId)}),s.invalidateQueries({queryKey:M.contactReminders.upcoming()}),B.success("Follow-up quest scheduled! ðŸ—“ï¸")},onError:o=>{B.error("Failed to schedule quest"),console.error("Create reminder error:",o)}}),n=be({mutationFn:async o=>{const{error:a}=await U.from("contact_reminders").delete().eq("id",o);if(a)throw a},onSuccess:()=>{t&&s.invalidateQueries({queryKey:M.contactReminders.byContact(t)}),s.invalidateQueries({queryKey:M.contactReminders.upcoming()}),B.success("Follow-up quest cancelled")},onError:o=>{B.error("Failed to cancel quest"),console.error("Delete reminder error:",o)}}),r=be({mutationFn:async o=>{const{error:a}=await U.from("contact_reminders").update({sent:!0,sent_at:new Date().toISOString()}).eq("id",o);if(a)throw a},onSuccess:()=>{t&&s.invalidateQueries({queryKey:M.contactReminders.byContact(t)}),s.invalidateQueries({queryKey:M.contactReminders.upcoming()}),B.success("Quest complete! Connection made ðŸŽ‰")},onError:o=>{B.error("Quest completion failed"),console.error("Mark complete error:",o)}});return{reminders:i.data??[],upcomingReminders:c.data??[],isLoading:i.isLoading,isUpcomingLoading:c.isLoading,createReminder:l.mutate,deleteReminder:n.mutate,markComplete:r.mutate,isCreating:l.isPending,isDeleting:n.isPending}}function nt({reminderAt:t,reason:s,className:i}){const c=new Date(t),l=ds(c),n=at(c),r=Me(c,{addSuffix:!0}),o=s?`${l?"Overdue":"Reminder"}: ${s} (${r})`:`Reminder ${r}`;return e.jsx(Ms,{children:e.jsxs(Os,{children:[e.jsx(zs,{asChild:!0,children:e.jsxs("div",{className:A("inline-flex items-center gap-1 px-2 py-0.5 rounded-full text-xs font-medium",l&&"bg-destructive/10 text-destructive",n&&!l&&"bg-amber-500/10 text-amber-600",!l&&!n&&"bg-primary/10 text-primary",i),children:[l?e.jsx(Xe,{className:"h-3 w-3"}):e.jsx(je,{className:"h-3 w-3"}),e.jsx("span",{className:"truncate max-w-[80px]",children:l?"Overdue":n?"Today":r.replace("in ","")})]})}),e.jsx($s,{children:e.jsx("p",{children:o})})]})})}function rt(t){return t.split(" ").map(s=>s[0]).join("").toUpperCase().slice(0,2)}const lt=d.memo(function({contact:s,onEdit:i,onDelete:c,onToggleFavorite:l,onClick:n}){const{reminders:r}=ye(s.id),o=r.find(a=>!a.sent);return e.jsxs(Qs,{className:"p-4 flex items-start gap-4 cursor-pointer hover:bg-accent/50 transition-colors",onClick:()=>n?.(s),children:[e.jsxs(as,{className:"h-12 w-12 shrink-0",children:[e.jsx(ns,{src:s.avatar_url??void 0,alt:s.name}),e.jsx(rs,{className:"bg-primary/10 text-primary font-medium",children:rt(s.name)})]}),e.jsxs("div",{className:"flex-1 min-w-0 space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"font-semibold text-foreground truncate",children:s.name}),s.is_favorite&&e.jsx(ue,{className:"h-4 w-4 fill-yellow-400 text-yellow-400 shrink-0"}),o&&e.jsx(nt,{reminderAt:o.reminder_at,reason:o.reason})]}),(s.role||s.company)&&e.jsxs("p",{className:"text-sm text-muted-foreground truncate flex items-center gap-1",children:[s.role&&e.jsx("span",{children:s.role}),s.role&&s.company&&e.jsx("span",{children:"@"}),s.company&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(vs,{className:"h-3 w-3"}),s.company]})]}),e.jsxs("div",{className:"flex flex-wrap gap-3 text-sm text-muted-foreground",children:[s.email&&e.jsxs("a",{href:`mailto:${s.email}`,onClick:a=>a.stopPropagation(),className:"flex items-center gap-1 hover:text-primary transition-colors",children:[e.jsx(ge,{className:"h-3.5 w-3.5"}),e.jsx("span",{className:"truncate max-w-[150px]",children:s.email})]}),s.phone&&e.jsxs("a",{href:`tel:${s.phone}`,onClick:a=>a.stopPropagation(),className:"flex items-center gap-1 hover:text-primary transition-colors",children:[e.jsx(Ne,{className:"h-3.5 w-3.5"}),e.jsx("span",{children:s.phone})]})]}),s.tags&&s.tags.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1 pt-1",children:s.tags.map(a=>e.jsx("span",{className:"px-2 py-0.5 text-xs rounded-full bg-secondary text-secondary-foreground",children:a},a))})]}),e.jsxs(Us,{children:[e.jsx(Bs,{asChild:!0,children:e.jsx(p,{variant:"ghost",size:"icon",className:"h-8 w-8 shrink-0",onClick:a=>a.stopPropagation(),children:e.jsx(ws,{className:"h-4 w-4"})})}),e.jsxs(Vs,{align:"end",children:[e.jsxs(Se,{onClick:()=>l(s.id,!s.is_favorite),children:[e.jsx(ue,{className:A("h-4 w-4 mr-2",s.is_favorite&&"fill-yellow-400 text-yellow-400")}),s.is_favorite?"Remove from favorites":"Add to favorites"]}),e.jsxs(Se,{onClick:()=>i(s),children:[e.jsx(bs,{className:"h-4 w-4 mr-2"}),"Edit"]}),e.jsxs(Se,{onClick:()=>c(s.id),className:"text-destructive",children:[e.jsx(Ae,{className:"h-4 w-4 mr-2"}),"Delete"]})]})]})]})}),ms=Cs,xs=d.createContext({}),T=({...t})=>e.jsx(xs.Provider,{value:{name:t.name},children:e.jsx(Ss,{...t})}),ve=()=>{const t=d.useContext(xs),s=d.useContext(us),{getFieldState:i,formState:c}=Ds(),l=i(t.name,c);if(!t)throw new Error("useFormField should be used within <FormField>");const{id:n}=s;return{id:n,name:t.name,formItemId:`${n}-form-item`,formDescriptionId:`${n}-form-item-description`,formMessageId:`${n}-form-item-message`,...l}},us=d.createContext({}),_=d.forwardRef(({className:t,...s},i)=>{const c=d.useId();return e.jsx(us.Provider,{value:{id:c},children:e.jsx("div",{ref:i,className:A("space-y-2",t),...s})})});_.displayName="FormItem";const I=d.forwardRef(({className:t,...s},i)=>{const{error:c,formItemId:l}=ve();return e.jsx(xe,{ref:i,className:A(c&&"text-destructive",t),htmlFor:l,...s})});I.displayName="FormLabel";const R=d.forwardRef(({...t},s)=>{const{error:i,formItemId:c,formDescriptionId:l,formMessageId:n}=ve();return e.jsx(ks,{ref:s,id:c,"aria-describedby":i?`${l} ${n}`:`${l}`,"aria-invalid":!!i,...t})});R.displayName="FormControl";const it=d.forwardRef(({className:t,...s},i)=>{const{formDescriptionId:c}=ve();return e.jsx("p",{ref:i,id:c,className:A("text-sm text-muted-foreground",t),...s})});it.displayName="FormDescription";const P=d.forwardRef(({className:t,children:s,...i},c)=>{const{error:l,formMessageId:n}=ve(),r=l?String(l?.message):s;return r?e.jsx("p",{ref:c,id:n,className:A("text-sm font-medium text-destructive",t),...i,children:r}):null});P.displayName="FormMessage";const ot=Ge({name:E().min(1,"Name is required"),email:E().email("Invalid email").optional().or(W("")),phone:E().optional().or(W("")),company:E().optional().or(W("")),role:E().optional().or(W("")),notes:E().optional().or(W("")),tags:E().optional()});function ct({open:t,onOpenChange:s,contact:i,onSubmit:c,isLoading:l}){const n=!!i,r=We({resolver:Ze(ot),defaultValues:{name:"",email:"",phone:"",company:"",role:"",notes:"",tags:""}});d.useEffect(()=>{i?r.reset({name:i.name,email:i.email??"",phone:i.phone??"",company:i.company??"",role:i.role??"",notes:i.notes??"",tags:i.tags?.join(", ")??""}):r.reset({name:"",email:"",phone:"",company:"",role:"",notes:"",tags:""})},[i,r]);const o=a=>{const u=a.tags?a.tags.split(",").map(j=>j.trim()).filter(Boolean):[];c({name:a.name,email:a.email||null,phone:a.phone||null,company:a.company||null,role:a.role||null,notes:a.notes||null,avatar_url:i?.avatar_url??null,is_favorite:i?.is_favorite??!1,tags:u})};return e.jsx(Z,{open:t,onOpenChange:s,children:e.jsxs(G,{className:"sm:max-w-[425px]",children:[e.jsx(J,{children:e.jsx(ee,{children:n?"Edit Contact":"Add Contact"})}),e.jsx(ms,{...r,children:e.jsxs("form",{onSubmit:r.handleSubmit(o),className:"space-y-4",children:[e.jsx(T,{control:r.control,name:"name",render:({field:a})=>e.jsxs(_,{children:[e.jsx(I,{children:"Name *"}),e.jsx(R,{children:e.jsx(F,{placeholder:"John Smith",...a})}),e.jsx(P,{})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(T,{control:r.control,name:"email",render:({field:a})=>e.jsxs(_,{children:[e.jsx(I,{children:"Email"}),e.jsx(R,{children:e.jsx(F,{type:"email",placeholder:"john@example.com",...a})}),e.jsx(P,{})]})}),e.jsx(T,{control:r.control,name:"phone",render:({field:a})=>e.jsxs(_,{children:[e.jsx(I,{children:"Phone"}),e.jsx(R,{children:e.jsx(F,{type:"tel",placeholder:"+1 555 123 4567",...a})}),e.jsx(P,{})]})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(T,{control:r.control,name:"company",render:({field:a})=>e.jsxs(_,{children:[e.jsx(I,{children:"Company"}),e.jsx(R,{children:e.jsx(F,{placeholder:"Acme Corp",...a})}),e.jsx(P,{})]})}),e.jsx(T,{control:r.control,name:"role",render:({field:a})=>e.jsxs(_,{children:[e.jsx(I,{children:"Role"}),e.jsx(R,{children:e.jsx(F,{placeholder:"CEO",...a})}),e.jsx(P,{})]})})]}),e.jsx(T,{control:r.control,name:"tags",render:({field:a})=>e.jsxs(_,{children:[e.jsx(I,{children:"Tags"}),e.jsx(R,{children:e.jsx(F,{placeholder:"client, vip, personal (comma-separated)",...a})}),e.jsx(P,{})]})}),e.jsx(T,{control:r.control,name:"notes",render:({field:a})=>e.jsxs(_,{children:[e.jsx(I,{children:"Notes"}),e.jsx(R,{children:e.jsx(ls,{placeholder:"Any notes about this contact...",className:"resize-none",rows:3,...a})}),e.jsx(P,{})]})}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[e.jsx(p,{type:"button",variant:"outline",onClick:()=>s(!1),children:"Cancel"}),e.jsx(p,{type:"submit",disabled:l,children:l?"Saving...":n?"Save Changes":"Add Contact"})]})]})})]})})}function dt({onAddContact:t,onImportFromPhone:s,isFavoritesView:i}){const c=qe.isNativePlatform();return i?e.jsxs("div",{className:"flex flex-col items-center justify-center py-16 text-center",children:[e.jsx("div",{className:"h-16 w-16 rounded-full bg-muted flex items-center justify-center mb-4",children:e.jsx(O,{className:"h-8 w-8 text-muted-foreground"})}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No favorite contacts"}),e.jsx("p",{className:"text-muted-foreground text-sm max-w-xs",children:"Star your most important contacts to see them here for quick access."})]}):e.jsxs("div",{className:"flex flex-col items-center justify-center py-16 text-center",children:[e.jsx("div",{className:"h-16 w-16 rounded-full bg-primary/10 flex items-center justify-center mb-4",children:e.jsx(O,{className:"h-8 w-8 text-primary"})}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No contacts yet"}),e.jsx("p",{className:"text-muted-foreground text-sm max-w-xs mb-6",children:"Start building your network by adding your first contact."}),e.jsxs("div",{className:"flex flex-col gap-3 w-full max-w-xs",children:[e.jsxs(p,{onClick:t,className:"w-full",children:[e.jsx(Ee,{className:"h-4 w-4 mr-2"}),"Add Contact"]}),c&&s&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex-1 h-px bg-border"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:"or"}),e.jsx("div",{className:"flex-1 h-px bg-border"})]}),e.jsxs(p,{onClick:s,variant:"outline",className:"w-full",children:[e.jsx(he,{className:"h-4 w-4 mr-2"}),"Import from Phone"]})]})]})]})}const mt=Ge({interaction_type:_s(["call","email","meeting","message","note"]),summary:E().min(1,"Summary is required").max(200,"Summary too long"),notes:E().optional(),occurred_at:E()}),xt=[{value:"call",label:"Call",icon:Ne},{value:"email",label:"Email",icon:ge},{value:"meeting",label:"Meeting",icon:O},{value:"message",label:"Message",icon:Je},{value:"note",label:"Note",icon:Le}];function ut({open:t,onOpenChange:s,onSubmit:i,isLoading:c}){const l=We({resolver:Ze(mt),defaultValues:{interaction_type:"call",summary:"",notes:"",occurred_at:new Date().toISOString().slice(0,16)}}),n=r=>{i({...r,occurred_at:new Date(r.occurred_at).toISOString()}),l.reset()};return e.jsx(Z,{open:t,onOpenChange:s,children:e.jsxs(G,{className:"sm:max-w-md",children:[e.jsx(J,{children:e.jsx(ee,{children:"Log Interaction"})}),e.jsx(ms,{...l,children:e.jsxs("form",{onSubmit:l.handleSubmit(n),className:"space-y-4",children:[e.jsx(T,{control:l.control,name:"interaction_type",render:({field:r})=>e.jsxs(_,{children:[e.jsx(I,{children:"Type"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:xt.map(o=>{const a=o.icon;return e.jsxs(p,{type:"button",variant:r.value===o.value?"default":"outline",size:"sm",onClick:()=>r.onChange(o.value),className:A("flex items-center gap-1.5",r.value===o.value&&"ring-2 ring-primary ring-offset-2"),children:[e.jsx(a,{className:"h-4 w-4"}),o.label]},o.value)})}),e.jsx(P,{})]})}),e.jsx(T,{control:l.control,name:"occurred_at",render:({field:r})=>e.jsxs(_,{children:[e.jsx(I,{children:"Date & Time"}),e.jsx(R,{children:e.jsx(F,{type:"datetime-local",...r})}),e.jsx(P,{})]})}),e.jsx(T,{control:l.control,name:"summary",render:({field:r})=>e.jsxs(_,{children:[e.jsx(I,{children:"Summary"}),e.jsx(R,{children:e.jsx(F,{placeholder:"Brief description...",...r})}),e.jsx(P,{})]})}),e.jsx(T,{control:l.control,name:"notes",render:({field:r})=>e.jsxs(_,{children:[e.jsx(I,{children:"Notes (optional)"}),e.jsx(R,{children:e.jsx(ls,{placeholder:"Additional details...",className:"resize-none",rows:3,...r})}),e.jsx(P,{})]})}),e.jsxs("div",{className:"flex justify-end gap-2 pt-2",children:[e.jsx(p,{type:"button",variant:"outline",onClick:()=>s(!1),children:"Cancel"}),e.jsx(p,{type:"submit",disabled:c,children:c?"Saving...":"Save"})]})]})})]})})}const ht={call:{icon:Ne,label:"Call",color:"text-green-500"},email:{icon:ge,label:"Email",color:"text-blue-500"},meeting:{icon:O,label:"Meeting",color:"text-purple-500"},message:{icon:Je,label:"Message",color:"text-orange-500"},note:{icon:Le,label:"Note",color:"text-yellow-500"}};function pt({interactions:t,onDelete:s,isLoading:i}){const[c,l]=d.useState(null);return i?e.jsx("div",{className:"flex items-center justify-center py-8 text-muted-foreground",children:"Loading interactions..."}):t.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-8 text-center text-muted-foreground",children:[e.jsx(Le,{className:"h-8 w-8 mb-2 opacity-50"}),e.jsx("p",{children:"No interactions yet"}),e.jsx("p",{className:"text-sm",children:"Log your first interaction above"})]}):e.jsx("div",{className:"space-y-3",children:t.map(n=>{const r=ht[n.interaction_type],o=r.icon,a=c===n.id,u=n.notes&&n.notes.trim().length>0;return e.jsx("div",{className:"border rounded-lg p-3 bg-card hover:bg-accent/50 transition-colors",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:A("p-2 rounded-full bg-muted",r.color),children:e.jsx(o,{className:"h-4 w-4"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"text-xs font-medium text-muted-foreground uppercase",children:r.label}),e.jsx("span",{className:"text-xs text-muted-foreground",children:"â€¢"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:Me(new Date(n.occurred_at),{addSuffix:!0})})]}),e.jsx("p",{className:"text-sm font-medium text-foreground",children:n.summary}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:fe(new Date(n.occurred_at),"MMM d, yyyy Â· h:mm a")}),u&&e.jsxs(e.Fragment,{children:[e.jsx(p,{variant:"ghost",size:"sm",className:"h-6 px-0 text-xs text-muted-foreground hover:text-foreground mt-1",onClick:()=>l(a?null:n.id),children:a?e.jsxs(e.Fragment,{children:[e.jsx(Is,{className:"h-3 w-3 mr-1"}),"Hide notes"]}):e.jsxs(e.Fragment,{children:[e.jsx(Ps,{className:"h-3 w-3 mr-1"}),"Show notes"]})}),a&&e.jsx("p",{className:"text-sm text-muted-foreground mt-2 p-2 bg-muted rounded",children:n.notes})]})]}),s&&e.jsx(p,{variant:"ghost",size:"icon",className:"h-8 w-8 text-muted-foreground hover:text-destructive shrink-0",onClick:()=>s(n.id),children:e.jsx(Ae,{className:"h-4 w-4"})})]})},n.id)})})}const ft=[{label:"Tomorrow",getDays:()=>1},{label:"In 3 days",getDays:()=>3},{label:"Next week",getDays:()=>7},{label:"In 2 weeks",getDays:()=>14}];function jt({contact:t,open:s,onOpenChange:i}){const c=He(new Date,1),l=de(me(c,9),0),[n,r]=d.useState(l),[o,a]=d.useState("09:00"),[u,j]=d.useState(""),{createReminder:w,isCreating:C}=ye(t.id),x=N=>{const k=He(new Date,N),[D,z]=o.split(":").map(Number);r(de(me(k,D),z))},v=N=>{a(N);const[k,D]=N.split(":").map(Number);r(de(me(n,k),D))},h=N=>{if(N){const[k,D]=o.split(":").map(Number);r(de(me(N,k),D))}},g=()=>{w({contactId:t.id,reminderAt:n,reason:u.trim()||void 0},{onSuccess:()=>{i(!1),j(""),r(l),a("09:00")}})};return e.jsx(Z,{open:s,onOpenChange:i,children:e.jsxs(G,{className:"sm:max-w-md",children:[e.jsx(J,{children:e.jsxs(ee,{className:"flex items-center gap-2",children:[e.jsx(je,{className:"h-5 w-5 text-primary"}),"Schedule Follow-Up Quest"]})}),e.jsxs("div",{className:"space-y-4 pt-2",children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Set a reminder to connect with ",e.jsx("span",{className:"font-medium text-foreground",children:t.name})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:ft.map(N=>e.jsx(p,{variant:"outline",size:"sm",onClick:()=>x(N.getDays()),children:N.label},N.label))}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(xe,{children:"Date"}),e.jsxs(Ks,{children:[e.jsx(Hs,{asChild:!0,children:e.jsxs(p,{variant:"outline",className:A("w-full justify-start text-left font-normal",!n&&"text-muted-foreground"),children:[e.jsx(Fs,{className:"mr-2 h-4 w-4"}),fe(n,"PPP")]})}),e.jsx(Ys,{className:"w-auto p-0",align:"start",children:e.jsx(Xs,{mode:"single",selected:n,onSelect:h,disabled:N=>N<new Date,initialFocus:!0})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(xe,{children:"Time"}),e.jsxs("div",{className:"relative",children:[e.jsx(es,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(F,{type:"time",value:o,onChange:N=>v(N.target.value),className:"pl-10"})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Times are in your local timezone"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(xe,{children:"Reason (optional)"}),e.jsx(F,{placeholder:"e.g., Follow up on proposal",value:u,onChange:N=>j(N.target.value)})]}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsx(p,{variant:"outline",className:"flex-1",onClick:()=>i(!1),children:"Cancel"}),e.jsx(p,{className:"flex-1",onClick:g,disabled:C,children:C?"Scheduling...":"Set Reminder"})]})]})]})})}function gt({contactId:t}){const{reminders:s,isLoading:i,deleteReminder:c,markComplete:l,isDeleting:n}=ye(t),r=s.filter(a=>!a.sent),o=s.filter(a=>a.sent);return i?e.jsx("div",{className:"flex items-center justify-center py-4",children:e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-primary"})}):s.length===0?e.jsxs("div",{className:"text-center py-6 text-muted-foreground",children:[e.jsx(je,{className:"h-8 w-8 mx-auto mb-2 opacity-50"}),e.jsx("p",{className:"text-sm",children:"No follow-up quests scheduled"})]}):e.jsxs("div",{className:"space-y-4",children:[r.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h4",{className:"text-sm font-medium text-muted-foreground flex items-center gap-2",children:[e.jsx(es,{className:"h-4 w-4"}),"Upcoming Quests"]}),e.jsx("div",{className:"space-y-2",children:r.map(a=>e.jsx(Ye,{reminder:a,onComplete:()=>l(a.id),onDelete:()=>c(a.id),isDeleting:n},a.id))})]}),o.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h4",{className:"text-sm font-medium text-muted-foreground flex items-center gap-2",children:[e.jsx(ss,{className:"h-4 w-4"}),"Completed"]}),e.jsx("div",{className:"space-y-2 opacity-60",children:o.slice(0,3).map(a=>e.jsx(Ye,{reminder:a,onDelete:()=>c(a.id),isDeleting:n,isCompleted:!0},a.id))})]})]})}function Ye({reminder:t,onComplete:s,onDelete:i,isDeleting:c,isCompleted:l}){const n=new Date(t.reminder_at),r=!l&&ds(n);return e.jsxs("div",{className:A("flex items-center gap-3 p-3 rounded-lg border bg-card",r&&"border-destructive/50 bg-destructive/5",l&&"line-through"),children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("p",{className:A("text-sm font-medium",r&&"text-destructive"),children:[fe(n,"PPP")," at ",fe(n,"p")]}),t.reason&&e.jsx("p",{className:"text-xs text-muted-foreground truncate",children:t.reason})]}),e.jsxs("div",{className:"flex items-center gap-1 shrink-0",children:[!l&&s&&e.jsx(p,{variant:"ghost",size:"icon",className:"h-8 w-8 text-primary hover:text-primary hover:bg-primary/10",onClick:s,children:e.jsx(ss,{className:"h-4 w-4"})}),e.jsx(p,{variant:"ghost",size:"icon",className:"h-8 w-8 text-muted-foreground hover:text-destructive hover:bg-destructive/10",onClick:i,disabled:c,children:e.jsx(Ae,{className:"h-4 w-4"})})]})]})}function Nt(t){return t.split(" ").map(s=>s[0]).join("").toUpperCase().slice(0,2)}function yt({contact:t,open:s,onOpenChange:i}){const[c,l]=d.useState(!1),[n,r]=d.useState(!1),{interactions:o,isLoading:a,createInteraction:u,deleteInteraction:j}=Ws(t?.id),{reminders:w}=ye(t?.id),C=w.filter(h=>!h.sent);if(!t)return null;const x=o[0],v=o.length;return e.jsxs(e.Fragment,{children:[e.jsx(Zs,{open:s,onOpenChange:i,children:e.jsxs(Gs,{className:"w-full sm:max-w-md p-0 flex flex-col",children:[e.jsxs(Js,{className:"p-6 pb-4 border-b",children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsxs(as,{className:"h-16 w-16 shrink-0",children:[e.jsx(ns,{src:t.avatar_url??void 0,alt:t.name}),e.jsx(rs,{className:"bg-primary/10 text-primary text-lg font-medium",children:Nt(t.name)})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(et,{className:"text-left truncate",children:t.name}),t.is_favorite&&e.jsx(ue,{className:"h-4 w-4 fill-yellow-400 text-yellow-400 shrink-0"})]}),(t.role||t.company)&&e.jsxs("p",{className:"text-sm text-muted-foreground truncate mt-0.5",children:[t.role,t.role&&t.company&&" @ ",t.company]})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-3 mt-4 text-sm",children:[t.email&&e.jsxs("a",{href:`mailto:${t.email}`,className:"flex items-center gap-1.5 text-muted-foreground hover:text-primary transition-colors",children:[e.jsx(ge,{className:"h-4 w-4"}),e.jsx("span",{className:"truncate max-w-[180px]",children:t.email})]}),t.phone&&e.jsxs("a",{href:`tel:${t.phone}`,className:"flex items-center gap-1.5 text-muted-foreground hover:text-primary transition-colors",children:[e.jsx(Ne,{className:"h-4 w-4"}),e.jsx("span",{children:t.phone})]})]}),t.tags&&t.tags.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1.5 mt-3",children:t.tags.map(h=>e.jsx("span",{className:"px-2 py-0.5 text-xs rounded-full bg-secondary text-secondary-foreground",children:h},h))}),e.jsxs("div",{className:"flex gap-4 mt-4 pt-4 border-t text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Last contact"}),e.jsx("p",{className:"font-medium",children:x?Me(new Date(x.occurred_at),{addSuffix:!0}):"Never"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Total interactions"}),e.jsx("p",{className:"font-medium",children:v})]})]})]}),e.jsxs(is,{defaultValue:"interactions",className:"flex-1 flex flex-col min-h-0",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-3 border-b bg-muted/50",children:[e.jsxs(os,{className:"h-8",children:[e.jsx(pe,{value:"interactions",className:"text-xs px-3",children:"History"}),e.jsxs(pe,{value:"reminders",className:"text-xs px-3 relative",children:["Reminders",C.length>0&&e.jsx("span",{className:"absolute -top-1 -right-1 h-4 w-4 rounded-full bg-primary text-[10px] text-primary-foreground flex items-center justify-center",children:C.length})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(p,{size:"sm",variant:"outline",onClick:()=>r(!0),className:"h-8",children:[e.jsx(je,{className:"h-4 w-4 mr-1"}),"Remind"]}),e.jsxs(p,{size:"sm",onClick:()=>l(!0),className:"h-8",children:[e.jsx(Ee,{className:"h-4 w-4 mr-1"}),"Log"]})]})]}),e.jsx(Be,{value:"interactions",className:"flex-1 m-0",children:e.jsx(ke,{className:"h-full px-6 py-4",children:e.jsx(pt,{interactions:o,isLoading:a,onDelete:h=>j.mutate({id:h,contactId:t.id})})})}),e.jsx(Be,{value:"reminders",className:"flex-1 m-0",children:e.jsx(ke,{className:"h-full px-6 py-4",children:e.jsx(gt,{contactId:t.id})})})]})]})}),e.jsx(ut,{open:c,onOpenChange:l,onSubmit:h=>{u.mutate({contact_id:t.id,interaction_type:h.interaction_type,summary:h.summary,notes:h.notes,occurred_at:h.occurred_at}),l(!1)},isLoading:u.isPending}),e.jsx(jt,{contact:t,open:n,onOpenChange:r})]})}function vt(){const[t,s]=d.useState([]),[i,c]=d.useState(!1),[l,n]=d.useState(null),[r,o]=d.useState(null),a=qe.isNativePlatform(),u=d.useCallback(async()=>{if(!a)return"denied";try{const{Contacts:x}=await Ce(async()=>{const{Contacts:g}=await import("@capacitor-community/contacts");return{Contacts:g}},[]),h=(await x.checkPermissions()).contacts;return o(h),h}catch(x){return console.error("Error checking contacts permission:",x),n("Failed to check contacts permission"),"denied"}},[a]),j=d.useCallback(async()=>{if(!a)return"denied";try{const{Contacts:x}=await Ce(async()=>{const{Contacts:g}=await import("@capacitor-community/contacts");return{Contacts:g}},[]),h=(await x.requestPermissions()).contacts;return o(h),h}catch(x){return console.error("Error requesting contacts permission:",x),n("Failed to request contacts permission"),"denied"}},[a]),w=d.useCallback(async()=>{if(!a){const x="Contacts sync is only available in the native app";return n(x),{contacts:[],error:x}}c(!0),n(null);try{const{Contacts:x}=await Ce(async()=>{const{Contacts:g}=await import("@capacitor-community/contacts");return{Contacts:g}},[]),h=(await x.getContacts({projection:{name:!0,phones:!0,emails:!0,organization:!0}})).contacts.filter(g=>g.name?.display).map(g=>({id:g.contactId||crypto.randomUUID(),name:g.name?.display||"Unknown",email:g.emails?.[0]?.address||null,phone:g.phones?.[0]?.number||null,company:g.organization?.company||null,role:g.organization?.jobTitle||null})).sort((g,N)=>g.name.localeCompare(N.name));return s(h),c(!1),{contacts:h,error:null}}catch(x){console.error("Error fetching contacts:",x);const v="Failed to fetch contacts from device";return n(v),c(!1),{contacts:[],error:v}}},[a]),C=d.useCallback(x=>({name:x.name,email:x.email,phone:x.phone,company:x.company,role:x.role,notes:null,avatar_url:null,is_favorite:!1,tags:[]}),[]);return{phoneContacts:t,isLoading:i,error:l,permissionStatus:r,isNative:a,checkPermission:u,requestPermission:j,fetchContacts:w,mapToAppContact:C}}function wt({isOpen:t,onClose:s,onRequestPermission:i,permissionStatus:c,isRequesting:l=!1}){return c==="denied"?e.jsx(De,{open:t,onOpenChange:s,children:e.jsxs(_e,{className:"max-w-sm",children:[e.jsxs(Ie,{children:[e.jsx("div",{className:"flex justify-center mb-4",children:e.jsx("div",{className:"w-16 h-16 rounded-full bg-destructive/10 flex items-center justify-center",children:e.jsx(Ts,{className:"w-8 h-8 text-destructive"})})}),e.jsx(Pe,{className:"text-center",children:"Contacts Access Blocked"}),e.jsx(Fe,{asChild:!0,children:e.jsxs("div",{className:"text-center space-y-3 text-sm text-muted-foreground",children:[e.jsx("p",{children:"You've previously denied contacts access. To import contacts, you'll need to enable it in your device settings."}),e.jsxs("div",{className:"bg-muted rounded-lg p-3 text-left text-sm",children:[e.jsx("span",{className:"font-medium block mb-1",children:"How to enable:"}),e.jsxs("ul",{className:"list-disc list-inside space-y-1 text-muted-foreground",children:[e.jsx("li",{children:"Open iPhone Settings"}),e.jsx("li",{children:"Scroll down and tap this app"}),e.jsx("li",{children:'Toggle on "Contacts"'})]})]})]})})]}),e.jsxs(Te,{className:"flex-col sm:flex-col gap-2",children:[e.jsxs(p,{onClick:s,className:"w-full",children:[e.jsx(Rs,{className:"w-4 h-4 mr-2"}),"Got It"]}),e.jsx(Re,{className:"w-full mt-0",children:"Cancel"})]})]})}):e.jsx(De,{open:t,onOpenChange:s,children:e.jsxs(_e,{className:"max-w-sm",children:[e.jsxs(Ie,{children:[e.jsx("div",{className:"flex justify-center mb-4",children:e.jsx("div",{className:"w-16 h-16 rounded-full bg-primary/10 flex items-center justify-center animate-pulse",children:e.jsx(O,{className:"w-8 h-8 text-primary"})})}),e.jsx(Pe,{className:"text-center",children:"Import Contacts?"}),e.jsx(Fe,{className:"text-center",children:"Allow access to your contacts to quickly import them into the app. You can select which contacts to add."})]}),e.jsxs(Te,{className:"flex-col sm:flex-col gap-2",children:[e.jsx(p,{onClick:i,className:"w-full",disabled:l,children:l?e.jsx(e.Fragment,{children:"Requesting Access..."}):e.jsxs(e.Fragment,{children:[e.jsx(O,{className:"w-4 h-4 mr-2"}),"Allow Access"]})}),e.jsx(Re,{className:"w-full mt-0",children:"Maybe Later"})]})]})})}function bt({open:t,onOpenChange:s}){const{fetchContacts:i,mapToAppContact:c,isNative:l,checkPermission:n,requestPermission:r}=vt(),{contacts:o,createContact:a}=cs(),[u,j]=d.useState("idle"),[w,C]=d.useState([]),[x,v]=d.useState(new Set),[h,g]=d.useState(""),[N,k]=d.useState(0),[D,z]=d.useState(0),[K,H]=d.useState(0),[X,Y]=d.useState(null),[se,te]=d.useState(null),[ae,L]=d.useState(!1),[f,S]=d.useState(!1);d.useEffect(()=>{t&&(j("idle"),v(new Set),g(""),k(0),z(0),H(0),Y(null),L(!1),S(!1))},[t]),d.useEffect(()=>{t&&u==="idle"&&l&&$()},[t,u,l]);const $=async()=>{j("checking-permission");const m=await n();te(m),m==="granted"?await Oe():(L(!0),j("idle"))},hs=async()=>{S(!0);const m=await r();te(m),S(!1),m==="granted"?(L(!1),await Oe()):L(!0)},Oe=async()=>{j("loading");const{contacts:m,error:y}=await i();if(y){Y(y),j("error");return}C(m),j("selecting")},{filteredContacts:we,duplicateIds:ne}=d.useMemo(()=>{const m=new Set;return w.forEach(b=>{o.some(Q=>{if(b.phone&&Q.phone){const oe=b.phone.replace(/\D/g,""),ce=Q.phone.replace(/\D/g,"");if(oe&&ce&&oe===ce)return!0}return!!(b.email&&Q.email&&b.email.toLowerCase()===Q.email.toLowerCase())})&&m.add(b.id)}),{filteredContacts:w.filter(b=>{if(!h.trim())return!0;const q=h.toLowerCase();return b.name.toLowerCase().includes(q)||b.email?.toLowerCase().includes(q)||b.phone?.includes(q)||b.company?.toLowerCase().includes(q)}),duplicateIds:m}},[w,o,h]),re=d.useMemo(()=>w.filter(m=>!ne.has(m.id)),[w,ne]),le=we.filter(m=>!ne.has(m.id)),ze=le.length>0&&le.every(m=>x.has(m.id)),ps=()=>{v(ze?new Set:new Set(le.map(m=>m.id)))},fs=m=>{const y=new Set(x);y.has(m)?y.delete(m):y.add(m),v(y)},$e=async m=>{if(m.length===0)return;j("importing"),k(0),z(0),H(0);let y=0,b=0;for(let q=0;q<m.length;q++){const Q=m[q],oe=c(Q);try{await a.mutateAsync(oe),y++,z(y)}catch(ce){console.error("Failed to import contact:",Q.name,ce),b++,H(b)}k((q+1)/m.length*100)}j("complete"),y>0&&B.success(`Imported ${y} contact${y!==1?"s":""}`)},js=async()=>{const m=w.filter(y=>x.has(y.id));await $e(m)},gs=async()=>{await $e(re)},ie=()=>{s(!1)},Ns=()=>{L(!1),se==="denied"&&s(!1)};return l?e.jsxs(e.Fragment,{children:[e.jsx(wt,{isOpen:ae,onClose:Ns,onRequestPermission:hs,permissionStatus:se,isRequesting:f}),e.jsx(Z,{open:t&&!ae,onOpenChange:s,children:e.jsxs(G,{className:"max-w-md max-h-[85vh] flex flex-col",hideCloseButton:!0,children:[e.jsxs(J,{children:[e.jsxs(ee,{className:"flex items-center gap-2",children:[e.jsx(he,{className:"h-5 w-5"}),"Import from Phone"]}),e.jsxs(Ve,{children:[u==="checking-permission"&&"Checking permissions...",u==="loading"&&"Fetching your contacts...",u==="selecting"&&`Select contacts to import (${w.length} found)`,u==="importing"&&"Importing contacts...",u==="complete"&&"Import complete!",u==="error"&&"Something went wrong"]})]}),e.jsxs(As,{mode:"wait",children:[u==="checking-permission"&&e.jsxs(V.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"flex flex-col items-center py-12",children:[e.jsx("div",{className:"h-12 w-12 rounded-full border-2 border-primary border-t-transparent animate-spin mb-4"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Checking permissions..."})]},"checking"),u==="loading"&&e.jsxs(V.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"flex flex-col items-center py-12",children:[e.jsx("div",{className:"h-12 w-12 rounded-full border-2 border-primary border-t-transparent animate-spin mb-4"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Loading contacts..."})]},"loading"),u==="error"&&e.jsxs(V.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"flex flex-col items-center py-8 text-center",children:[e.jsx("div",{className:"h-16 w-16 rounded-full bg-destructive/10 flex items-center justify-center mb-4",children:e.jsx(Xe,{className:"h-8 w-8 text-destructive"})}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:X}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(p,{onClick:$,variant:"outline",children:"Try Again"}),e.jsx(p,{onClick:ie,variant:"ghost",children:"Cancel"})]})]},"error"),u==="selecting"&&e.jsxs(V.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"flex flex-col flex-1 min-h-0",children:[e.jsxs("div",{className:"relative mb-3",children:[e.jsx(ts,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(F,{placeholder:"Search contacts...",value:h,onChange:m=>g(m.target.value),className:"pl-10"})]}),re.length>0&&e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-muted/50 rounded-lg cursor-pointer flex-1",onClick:ps,children:[e.jsx(Ke,{checked:ze}),e.jsxs("span",{className:"font-medium text-sm",children:["Select All (",le.length,")"]})]}),e.jsxs(p,{size:"sm",variant:"secondary",onClick:gs,className:"shrink-0",children:[e.jsx(qs,{className:"h-4 w-4 mr-1"}),"Import All (",re.length,")"]})]}),e.jsx(ke,{className:"flex-1 -mx-6 px-6",children:e.jsxs("div",{className:"space-y-1 pb-4",children:[we.map(m=>{const y=ne.has(m.id),b=x.has(m.id);return e.jsxs("div",{className:`flex items-center gap-3 p-3 rounded-xl transition-colors ${y?"bg-muted/30 opacity-60":b?"bg-primary/10":"hover:bg-muted/50"} ${y?"":"cursor-pointer"}`,onClick:()=>!y&&fs(m.id),children:[y?e.jsx(Ue,{className:"h-5 w-5 text-muted-foreground shrink-0"}):e.jsx(Ke,{checked:b,className:"shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium truncate",children:m.name}),e.jsx("p",{className:"text-xs text-muted-foreground truncate",children:[m.phone,m.email,m.company].filter(Boolean).join(" â€¢ ")||"No details"})]}),y&&e.jsx("span",{className:"text-xs text-muted-foreground",children:"Already added"})]},m.id)}),we.length===0&&e.jsxs("div",{className:"flex flex-col items-center py-8 text-center",children:[e.jsx(O,{className:"h-8 w-8 text-muted-foreground mb-2"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:h?"No contacts match your search":"No contacts found"})]})]})}),e.jsxs("div",{className:"flex gap-2 pt-3 border-t mt-2",children:[e.jsx(p,{onClick:ie,variant:"outline",className:"flex-1",children:"Cancel"}),e.jsxs(p,{onClick:js,disabled:x.size===0,className:"flex-1",children:["Import ",x.size>0?`(${x.size})`:""]})]})]},"selecting"),u==="importing"&&e.jsxs(V.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"flex flex-col items-center py-8",children:[e.jsx("div",{className:"w-full mb-4",children:e.jsx(st,{value:N,className:"h-2"})}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Importing ",D," of ",x.size||re.length," contacts..."]})]},"importing"),u==="complete"&&e.jsxs(V.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0},className:"flex flex-col items-center py-8 text-center",children:[e.jsx("div",{className:"h-16 w-16 rounded-full bg-green-500/10 flex items-center justify-center mb-4",children:e.jsx(Ue,{className:"h-8 w-8 text-green-500"})}),e.jsx("h3",{className:"font-semibold text-lg mb-1",children:"Import Complete"}),e.jsxs("p",{className:"text-sm text-muted-foreground mb-4",children:[D," contact",D!==1?"s":""," imported",K>0&&`, ${K} skipped`]}),e.jsx(p,{onClick:ie,className:"w-full",children:"Done"})]},"complete")]})]})})]}):e.jsx(Z,{open:t,onOpenChange:s,children:e.jsxs(G,{className:"max-w-md",children:[e.jsxs(J,{children:[e.jsx(ee,{children:"Import Contacts"}),e.jsx(Ve,{children:"Contact import is only available in the native iOS app."})]}),e.jsxs("div",{className:"flex flex-col items-center py-8 text-center",children:[e.jsx("div",{className:"h-16 w-16 rounded-full bg-muted flex items-center justify-center mb-4",children:e.jsx(he,{className:"h-8 w-8 text-muted-foreground"})}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Open the app on your iPhone to import contacts from your phone."})]}),e.jsx(p,{onClick:ie,variant:"outline",className:"w-full",children:"Close"})]})})}function _t(){const t=Es(),{contacts:s,isLoading:i,createContact:c,updateContact:l,deleteContact:n,toggleFavorite:r}=cs(),o=qe.isNativePlatform(),[a,u]=d.useState(""),[j,w]=d.useState("all"),[C,x]=d.useState(!1),[v,h]=d.useState(null),[g,N]=d.useState(null),[k,D]=d.useState(null),[z,K]=d.useState(!1),H=d.useMemo(()=>{let f=s;if(j==="favorites"&&(f=f.filter(S=>S.is_favorite)),a.trim()){const S=a.toLowerCase();f=f.filter($=>$.name.toLowerCase().includes(S)||$.email?.toLowerCase().includes(S)||$.company?.toLowerCase().includes(S)||$.role?.toLowerCase().includes(S))}return f},[s,j,a]),X=f=>{h(f??null),x(!0)},Y=()=>{x(!1),h(null)},se=f=>{v?l.mutate({id:v.id,...f},{onSuccess:Y}):c.mutate(f,{onSuccess:Y})},te=()=>{g&&n.mutate(g,{onSuccess:()=>N(null)})},ae=(f,S)=>{r.mutate({id:f,is_favorite:S})},L=s.filter(f=>f.is_favorite).length;return e.jsxs(V.div,{initial:{opacity:0},animate:{opacity:1},className:"min-h-screen bg-background pb-nav-safe pt-safe",children:[e.jsx("div",{className:"sticky top-0 z-10 bg-background/80 backdrop-blur-lg border-b border-border safe-area-top",children:e.jsxs("div",{className:"px-4 py-4 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(p,{variant:"ghost",size:"icon",onClick:()=>t(-1),children:e.jsx(Ls,{className:"h-5 w-5"})}),e.jsx("div",{className:"h-10 w-10 rounded-full bg-primary/10 flex items-center justify-center",children:e.jsx(O,{className:"h-5 w-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold",children:"Contacts"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[s.length," ",s.length===1?"contact":"contacts"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[o&&e.jsx(p,{size:"sm",variant:"outline",onClick:()=>K(!0),children:e.jsx(he,{className:"h-4 w-4"})}),e.jsxs(p,{size:"sm",onClick:()=>X(),children:[e.jsx(Ee,{className:"h-4 w-4 mr-1"}),"Add"]})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(ts,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(F,{placeholder:"Search contacts...",value:a,onChange:f=>u(f.target.value),className:"pl-10"})]}),e.jsx(is,{value:j,onValueChange:f=>w(f),children:e.jsxs(os,{className:"w-full",children:[e.jsx(pe,{value:"all",className:"flex-1",children:"All Contacts"}),e.jsxs(pe,{value:"favorites",className:"flex-1 gap-1",children:[e.jsx(ue,{className:"h-4 w-4"}),"Favorites",L>0&&e.jsx("span",{className:"ml-1 text-xs bg-primary/10 text-primary px-1.5 py-0.5 rounded-full",children:L})]})]})})]})}),e.jsx("div",{className:"px-4 py-4 space-y-3",children:i?e.jsx("div",{className:"space-y-3",children:[1,2,3].map(f=>e.jsx("div",{className:"h-24 bg-muted/50 rounded-2xl animate-pulse"},f))}):H.length===0?e.jsx(dt,{onAddContact:()=>X(),onImportFromPhone:()=>K(!0),isFavoritesView:j==="favorites"}):H.map(f=>e.jsx(lt,{contact:f,onEdit:X,onDelete:S=>N(S),onToggleFavorite:ae,onClick:D},f.id))}),e.jsx(ct,{open:C,onOpenChange:Y,contact:v,onSubmit:se,isLoading:c.isPending||l.isPending}),e.jsx(De,{open:!!g,onOpenChange:()=>N(null),children:e.jsxs(_e,{children:[e.jsxs(Ie,{children:[e.jsx(Pe,{children:"Delete Contact?"}),e.jsx(Fe,{children:"This action cannot be undone. The contact will be permanently removed."})]}),e.jsxs(Te,{children:[e.jsx(Re,{children:"Cancel"}),e.jsx(tt,{onClick:te,className:"bg-destructive text-destructive-foreground",children:"Delete"})]})]})}),e.jsx(yt,{contact:k,open:!!k,onOpenChange:f=>!f&&D(null)}),e.jsx(bt,{open:z,onOpenChange:K})]})}export{_t as default};
