import{r as o,H as q,j as e,da as C}from"./vendor-FfY6MM0Z.js";import{u as L,s as m,B as g,L as b,a as v}from"./index-sX_cJ3I4.js";import{s as i}from"./nativeNavigation-DLS7qEr9.js";import"./date-vendor-Bk4KiHsJ.js";import"./three-vendor-qI8GXUTd.js";const U=C().min(8,"Password must be at least 8 characters").regex(/[A-Z]/,"Password must contain at least one uppercase letter").regex(/[a-z]/,"Password must contain at least one lowercase letter").regex(/[0-9]/,"Password must contain at least one number"),_=()=>{const[n,y]=o.useState(""),[p,P]=o.useState(""),[h,f]=o.useState(!1),[x,w]=o.useState(!1),[j,N]=o.useState(!1),{toast:t}=L(),r=q();o.useEffect(()=>{const s=new URLSearchParams(window.location.hash.substring(1)),c=s.get("error"),a=s.get("error_description");if(c){t({variant:"destructive",title:"Reset Link Expired",description:a||"This password reset link has expired or was already used. Please request a new one."}),i(r,"/auth");return}const T=s.get("access_token"),S=s.get("type");if(!T||S!=="recovery"){t({variant:"destructive",title:"Invalid Link",description:"This password reset link is invalid or has expired. Please request a new one."}),i(r,"/auth");return}const d=setTimeout(()=>{x||(t({variant:"destructive",title:"Verification Timeout",description:"Unable to verify the reset link. Please request a new one."}),i(r,"/auth"))},1e4),l=setTimeout(()=>{N(!0)},5e3),{data:{subscription:R}}=m.auth.onAuthStateChange((u,E)=>{u==="PASSWORD_RECOVERY"&&(clearTimeout(d),clearTimeout(l),E?w(!0):(t({variant:"destructive",title:"Session Error",description:"Unable to establish password reset session. Please request a new link."}),i(r,"/auth")))});return m.auth.getSession().then(({data:{session:u}})=>{u&&(clearTimeout(d),clearTimeout(l),w(!0))}),()=>{R.unsubscribe(),clearTimeout(d),clearTimeout(l)}},[r]);const k=async s=>{if(s.preventDefault(),n!==p){t({variant:"destructive",title:"Passwords don't match",description:"Please make sure both passwords are identical"});return}const c=U.safeParse(n);if(!c.success){t({variant:"destructive",title:"Invalid Password",description:c.error.errors[0].message});return}f(!0);try{const{error:a}=await m.auth.updateUser({password:n});a?t({variant:"destructive",title:"Error",description:a.message}):(t({title:"Password Updated",description:"Your password has been successfully reset"}),i(r,"/auth"))}catch(a){t({variant:"destructive",title:"Error",description:a.message||"An unexpected error occurred"})}finally{f(!1)}};return x?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-background via-secondary/20 to-background p-4",children:e.jsxs("div",{className:"w-full max-w-md space-y-8",children:[e.jsxs("div",{className:"text-center space-y-2",children:[e.jsx("h1",{className:"text-4xl font-bold bg-gradient-to-r from-primary via-accent to-primary bg-clip-text text-transparent",children:"Reset Password"}),e.jsx("p",{className:"text-muted-foreground",children:"Enter your new password below"})]}),e.jsx("div",{className:"bg-card/50 backdrop-blur-sm border border-border rounded-2xl p-8 shadow-lg",children:e.jsxs("form",{onSubmit:k,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{htmlFor:"password",className:"text-foreground",children:"New Password"}),e.jsx(v,{id:"password",type:"password",value:n,onChange:s=>y(s.target.value),placeholder:"••••••••",required:!0,className:"bg-secondary/50 border-border text-foreground"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Must be at least 8 characters with uppercase, lowercase, and numbers"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{htmlFor:"confirmPassword",className:"text-foreground",children:"Confirm Password"}),e.jsx(v,{id:"confirmPassword",type:"password",value:p,onChange:s=>P(s.target.value),placeholder:"••••••••",required:!0,className:"bg-secondary/50 border-border text-foreground"})]}),e.jsx(g,{type:"submit",className:"w-full",disabled:h,children:h?"Resetting...":"Reset Password"})]})})]})}):e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-background via-secondary/20 to-background p-4",children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("div",{className:"h-12 w-12 mx-auto rounded-full border-4 border-primary border-t-transparent animate-spin"}),e.jsx("p",{className:"text-muted-foreground",children:"Verifying reset link..."}),j&&e.jsxs("div",{className:"pt-4 space-y-2",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Taking too long?"}),e.jsx(g,{variant:"outline",onClick:()=>i(r,"/auth"),children:"Request New Link"})]})]})})};export{_ as default};
