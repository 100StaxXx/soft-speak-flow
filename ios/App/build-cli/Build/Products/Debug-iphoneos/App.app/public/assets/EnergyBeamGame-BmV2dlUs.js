import{r as a,j as e,ak as Se,ad as ke,c5 as Ne,e7 as Ee,l as I,m as x,cg as Qe,az as Je,af as Me,n as et}from"./vendor-FfY6MM0Z.js";import{bo as we,bp as tt,bq as st}from"./index-sX_cJ3I4.js";import{t as _}from"./gameUtils-G90wW1BE.js";import"./date-vendor-Bk4KiHsJ.js";import"./three-vendor-qI8GXUTd.js";const at={beginner:{startLives:5,baseEnemiesPerWave:6,enemyFireRate:0,enemySpeed:.2,diveChance:.01,powerUpChance:.25,enemyIncreasePerWave:1,speedIncreasePerWave:.03,diveIncreasePerWave:.003},easy:{startLives:4,baseEnemiesPerWave:8,enemyFireRate:0,enemySpeed:.3,diveChance:.02,powerUpChance:.2,enemyIncreasePerWave:2,speedIncreasePerWave:.05,diveIncreasePerWave:.005},medium:{startLives:3,baseEnemiesPerWave:10,enemyFireRate:.003,enemySpeed:.4,diveChance:.03,powerUpChance:.15,enemyIncreasePerWave:2,speedIncreasePerWave:.06,diveIncreasePerWave:.006},hard:{startLives:2,baseEnemiesPerWave:12,enemyFireRate:.006,enemySpeed:.5,diveChance:.04,powerUpChance:.12,enemyIncreasePerWave:3,speedIncreasePerWave:.08,diveIncreasePerWave:.008},master:{startLives:2,baseEnemiesPerWave:15,enemyFireRate:.01,enemySpeed:.65,diveChance:.06,powerUpChance:.08,enemyIncreasePerWave:4,speedIncreasePerWave:.1,diveIncreasePerWave:.01}},re={scout:{hp:1,points:10,color:"#22c55e",size:24},fighter:{hp:1,points:25,color:"#3b82f6",size:28},cruiser:{hp:2,points:50,color:"#a855f7",size:32},boss:{hp:5,points:200,color:"#ef4444",size:40}},Ce=a.memo(()=>{const t=a.useMemo(()=>Array.from({length:60},(i,l)=>({id:l,x:Math.random()*100,y:Math.random()*100,size:Math.random()*2+1,speed:Math.random()*2+1,opacity:Math.random()*.5+.3})),[]);return e.jsx("div",{className:"absolute inset-0 overflow-hidden bg-gradient-to-b from-slate-950 via-indigo-950 to-slate-950",children:t.map(i=>e.jsx(x.div,{className:"absolute rounded-full bg-white",style:{left:`${i.x}%`,width:i.size,height:i.size,opacity:i.opacity},animate:{top:["0%","100%"]},transition:{duration:8/i.speed,repeat:1/0,ease:"linear",delay:i.y/100*(8/i.speed)}},i.id))})});Ce.displayName="StarfieldBackground";const Pe=a.memo(({x:t,hasShield:i,isInvulnerable:l})=>e.jsxs("div",{className:"absolute bottom-16 transition-transform duration-75",style:{left:`${t}%`,transform:"translateX(-50%)"},children:[i&&e.jsx(x.div,{className:"absolute -inset-4 rounded-full",style:{background:"radial-gradient(circle, rgba(59,130,246,0.3) 0%, transparent 70%)",border:"2px solid rgba(59,130,246,0.5)"},animate:{scale:[1,1.1,1],opacity:[.5,.8,.5]},transition:{duration:1,repeat:1/0}}),e.jsx(x.div,{animate:l?{opacity:[1,.3,1]}:{opacity:1},transition:{duration:.2,repeat:l?1/0:0},children:e.jsxs("svg",{width:"36",height:"40",viewBox:"0 0 36 40",className:"drop-shadow-lg",children:[e.jsx("ellipse",{cx:"18",cy:"38",rx:"6",ry:"4",fill:"#f59e0b",opacity:"0.8",children:e.jsx("animate",{attributeName:"ry",values:"3;5;3",dur:"0.2s",repeatCount:"indefinite"})}),e.jsx("ellipse",{cx:"18",cy:"38",rx:"3",ry:"2",fill:"#fef3c7",children:e.jsx("animate",{attributeName:"ry",values:"2;3;2",dur:"0.15s",repeatCount:"indefinite"})}),e.jsx("path",{d:"M18 2 L4 36 L18 30 L32 36 Z",fill:"url(#shipGradient)",stroke:"#60a5fa",strokeWidth:"1.5"}),e.jsx("ellipse",{cx:"18",cy:"16",rx:"4",ry:"6",fill:"#0ea5e9",opacity:"0.8"}),e.jsx("ellipse",{cx:"18",cy:"14",rx:"2",ry:"3",fill:"#7dd3fc"}),e.jsx("line",{x1:"8",y1:"28",x2:"14",y2:"24",stroke:"#3b82f6",strokeWidth:"2"}),e.jsx("line",{x1:"28",y1:"28",x2:"22",y2:"24",stroke:"#3b82f6",strokeWidth:"2"}),e.jsx("defs",{children:e.jsxs("linearGradient",{id:"shipGradient",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[e.jsx("stop",{offset:"0%",stopColor:"#1e40af"}),e.jsx("stop",{offset:"50%",stopColor:"#3b82f6"}),e.jsx("stop",{offset:"100%",stopColor:"#1e3a8a"})]})})]})})]}));Pe.displayName="PlayerShip";const $e=a.memo(({enemy:t})=>{const i=re[t.type];return e.jsxs(x.div,{className:"absolute",style:{left:`${t.x}%`,top:`${t.y}%`,transform:"translate(-50%, -50%)"},animate:t.isDiving?{rotate:[0,10,-10,0]}:{},transition:{duration:.3,repeat:t.isDiving?1/0:0},children:[e.jsxs("svg",{width:i.size,height:i.size,viewBox:"0 0 32 32",children:[t.type==="scout"&&e.jsxs(e.Fragment,{children:[e.jsx("path",{d:"M16 4 L4 28 L16 22 L28 28 Z",fill:i.color,stroke:"#fff",strokeWidth:"1"}),e.jsx("circle",{cx:"16",cy:"14",r:"4",fill:"#1a1a2e",stroke:"#fff",strokeWidth:"1"})]}),t.type==="fighter"&&e.jsxs(e.Fragment,{children:[e.jsx("path",{d:"M16 2 L2 30 L16 24 L30 30 Z",fill:i.color,stroke:"#fff",strokeWidth:"1"}),e.jsx("path",{d:"M8 20 L2 26 L8 24 Z",fill:i.color}),e.jsx("path",{d:"M24 20 L30 26 L24 24 Z",fill:i.color}),e.jsx("circle",{cx:"16",cy:"12",r:"5",fill:"#1a1a2e",stroke:"#fff",strokeWidth:"1"}),e.jsx("circle",{cx:"16",cy:"12",r:"2",fill:"#ef4444"})]}),t.type==="cruiser"&&e.jsxs(e.Fragment,{children:[e.jsx("rect",{x:"6",y:"4",width:"20",height:"24",rx:"4",fill:i.color,stroke:"#fff",strokeWidth:"1"}),e.jsx("rect",{x:"2",y:"12",width:"6",height:"12",rx:"2",fill:i.color}),e.jsx("rect",{x:"24",y:"12",width:"6",height:"12",rx:"2",fill:i.color}),e.jsx("circle",{cx:"16",cy:"12",r:"4",fill:"#1a1a2e",stroke:"#fff",strokeWidth:"1"}),e.jsx("circle",{cx:"12",cy:"22",r:"2",fill:"#ef4444"}),e.jsx("circle",{cx:"20",cy:"22",r:"2",fill:"#ef4444"})]}),t.type==="boss"&&e.jsxs(e.Fragment,{children:[e.jsx("ellipse",{cx:"16",cy:"16",rx:"14",ry:"12",fill:i.color,stroke:"#fbbf24",strokeWidth:"2"}),e.jsx("ellipse",{cx:"10",cy:"12",rx:"4",ry:"5",fill:"#1a1a2e",stroke:"#fff",strokeWidth:"1"}),e.jsx("ellipse",{cx:"22",cy:"12",rx:"4",ry:"5",fill:"#1a1a2e",stroke:"#fff",strokeWidth:"1"}),e.jsx("circle",{cx:"10",cy:"12",r:"2",fill:"#22c55e"}),e.jsx("circle",{cx:"22",cy:"12",r:"2",fill:"#22c55e"}),e.jsx("path",{d:"M8 22 Q16 28 24 22",stroke:"#fff",strokeWidth:"2",fill:"none"})]})]}),t.maxHp>1&&e.jsx("div",{className:"absolute -bottom-2 left-1/2 -translate-x-1/2 w-8 h-1 bg-slate-800 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-green-500 transition-all",style:{width:`${t.hp/t.maxHp*100}%`}})})]})});$e.displayName="EnemySprite";const Ie=a.memo(({projectile:t})=>e.jsx(x.div,{className:"absolute w-1 h-4 rounded-full",style:{left:`${t.x}%`,top:`${t.y}%`,transform:"translate(-50%, -50%)",background:t.isEnemy?"linear-gradient(180deg, #ef4444, #fca5a5)":"linear-gradient(0deg, #3b82f6, #93c5fd)",boxShadow:t.isEnemy?"0 0 8px #ef4444":"0 0 8px #3b82f6"}}));Ie.displayName="ProjectileSprite";const We=a.memo(({powerUp:t})=>{const i={shield:{icon:Se,color:"#3b82f6",bg:"rgba(59,130,246,0.3)"},rapid:{icon:ke,color:"#f59e0b",bg:"rgba(245,158,11,0.3)"},repair:{icon:Me,color:"#22c55e",bg:"rgba(34,197,94,0.3)"},slowmo:{icon:Ne,color:"#a855f7",bg:"rgba(168,85,247,0.3)"},spread:{icon:Ee,color:"#ec4899",bg:"rgba(236,72,153,0.3)"},bonus:{icon:et,color:"#fbbf24",bg:"rgba(251,191,36,0.3)"}}[t.type],l=i.icon;return e.jsx(x.div,{className:"absolute",style:{left:`${t.x}%`,top:`${t.y}%`,transform:"translate(-50%, -50%)"},animate:{rotate:360,scale:[1,1.1,1]},transition:{rotate:{duration:2,repeat:1/0,ease:"linear"},scale:{duration:.5,repeat:1/0}},children:e.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center",style:{background:i.bg,border:`2px solid ${i.color}`,boxShadow:`0 0 15px ${i.color}`},children:e.jsx(l,{className:"w-4 h-4",style:{color:i.color}})})})});We.displayName="PowerUpSprite";const Le=a.memo(({explosion:t})=>e.jsx(x.div,{className:"absolute pointer-events-none",style:{left:`${t.x}%`,top:`${t.y}%`,transform:"translate(-50%, -50%)"},initial:{scale:0,opacity:1},animate:{scale:t.size==="large"?3:1.5,opacity:0},transition:{duration:.4},children:e.jsx("div",{className:"w-8 h-8 rounded-full",style:{background:"radial-gradient(circle, #fbbf24 0%, #f59e0b 30%, #ef4444 60%, transparent 100%)"}})}));Le.displayName="ExplosionEffect";const Re=a.memo(({popup:t})=>e.jsx(x.div,{className:`absolute pointer-events-none font-bold text-sm z-30 ${t.type==="repair"?"text-green-400":t.score<0?"text-red-400":t.type==="bonus"?"text-yellow-400":"text-green-400"}`,style:{left:`${t.x}%`,top:`${t.y}%`,transform:"translate(-50%, -50%)"},initial:{opacity:1,y:0,scale:1.2},animate:{opacity:0,y:-20,scale:1},transition:{duration:.6},children:t.type==="repair"?"+1 ❤️":t.score>0?`+${t.score}`:t.score}));Re.displayName="ScorePopupComponent";const Te=a.memo(({wave:t})=>e.jsx(x.div,{className:"absolute inset-0 z-40 flex items-center justify-center bg-background/80 backdrop-blur-sm",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:e.jsxs(x.div,{className:"text-center",initial:{scale:0},animate:{scale:1},transition:{type:"spring",stiffness:200},children:[e.jsxs("p",{className:"text-4xl font-black text-transparent bg-clip-text bg-gradient-to-r from-cyan-400 to-blue-500",children:["WAVE ",t]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"Enemies incoming!"})]})}));Te.displayName="WaveTransition";const Fe=a.memo(({lives:t,maxLives:i})=>e.jsx("div",{className:"flex items-center gap-0.5",children:Array.from({length:i}).map((l,g)=>e.jsx(Me,{className:`w-4 h-4 ${g<t?"text-red-500 fill-red-500":"text-slate-600"}`},g))}));Fe.displayName="LivesDisplay";const De=a.memo(({effect:t})=>e.jsxs(x.div,{className:"absolute pointer-events-none z-40",style:{left:`${t.x}%`,top:`${t.y}%`,transform:"translate(-50%, -50%)"},initial:{scale:0,opacity:1},animate:{scale:2.5,opacity:0},transition:{duration:.4,ease:"easeOut"},children:[e.jsx("div",{className:"w-12 h-12 rounded-full",style:{border:`3px solid ${t.color}`,boxShadow:`0 0 20px ${t.color}, inset 0 0 15px ${t.color}40`}}),Array.from({length:8}).map((i,l)=>e.jsx(x.div,{className:"absolute w-2 h-2 rounded-full",style:{background:t.color,boxShadow:`0 0 6px ${t.color}`,left:"50%",top:"50%",marginLeft:-4,marginTop:-4},initial:{x:0,y:0,opacity:1},animate:{x:Math.cos(l/8*Math.PI*2)*50,y:Math.sin(l/8*Math.PI*2)*50,opacity:0},transition:{duration:.35,ease:"easeOut"}},l))]}));De.displayName="PowerUpCollectEffect";const ze=a.memo(({effect:t})=>e.jsxs(x.div,{className:"absolute pointer-events-none z-40",style:{left:`${t.x}%`,top:`${t.y}%`,transform:"translate(-50%, -50%)"},initial:{scale:.3,opacity:1},animate:{scale:2,opacity:0},transition:{duration:.35,ease:"easeOut"},children:[e.jsx("div",{className:"w-16 h-16 rounded-full",style:{background:t.type==="shield-break"?"radial-gradient(circle, rgba(59,130,246,0.9) 0%, rgba(59,130,246,0.4) 40%, transparent 70%)":"radial-gradient(circle, rgba(239,68,68,0.9) 0%, rgba(239,68,68,0.4) 40%, transparent 70%)",boxShadow:t.type==="shield-break"?"0 0 30px rgba(59,130,246,0.6)":"0 0 30px rgba(239,68,68,0.6)"}}),t.type==="shield-break"&&Array.from({length:6}).map((i,l)=>e.jsx(x.div,{className:"absolute w-3 h-3",style:{background:"linear-gradient(135deg, #60a5fa, #3b82f6)",left:"50%",top:"50%",marginLeft:-6,marginTop:-6,clipPath:"polygon(50% 0%, 100% 100%, 0% 100%)"},initial:{x:0,y:0,opacity:1,rotate:l*60},animate:{x:Math.cos(l/6*Math.PI*2)*40,y:Math.sin(l/6*Math.PI*2)*40,opacity:0,rotate:l*60+180},transition:{duration:.4,ease:"easeOut"}},l))]}));ze.displayName="PlayerHitEffect";const je=(t,i)=>{const l=[],g=i.baseEnemiesPerWave+(t-1)*i.enemyIncreasePerWave,E=Math.min(3+Math.floor(t/3),5),H=Math.ceil(g/E);let M=0;for(let m=0;m<E&&M<g;m++)for(let u=0;u<H&&M<g;u++){const d=15+u*70/(H-1||1),v=8+m*10;let N="scout";t>=3&&m===0?N="cruiser":t>=2&&m<=1&&(N="fighter"),t%5===0&&m===0&&u===Math.floor(H/2)&&(N="boss");const W=re[N];l.push({id:`enemy-${t}-${m}-${u}`,type:N,x:d,y:v,hp:W.hp,maxHp:W.hp,points:W.points,isDiving:!1,diveStartX:d,divePhase:0,formationX:d,formationY:v}),M++}return l};function ct({companionStats:t,onComplete:i,onDamage:l,tierAttackDamage:g=15,difficulty:E="medium",questIntervalScale:H=1,isPractice:M=!1,compact:m=!1}){const u=at[E],[d,v]=a.useState("countdown"),[N,W]=a.useState(3),[V,K]=a.useState(0),[w,Ue]=a.useState(1),[ie,Q]=a.useState(u.startLives),[y,L]=a.useState(50),[R,J]=a.useState(!1),[ee,ne]=a.useState(!1),[te,oe]=a.useState(!1),[se,le]=a.useState(!1),[O,G]=a.useState(!1),[T,F]=a.useState([]),[Ae,Y]=a.useState([]),[Xe,ce]=a.useState([]),[_e,de]=a.useState([]),[He,q]=a.useState([]),[Oe,fe]=a.useState([]),[Ge,D]=a.useState([]),[ue,j]=a.useState(null),ae=a.useRef(null),pe=a.useRef(0),he=a.useRef(1),B=a.useRef(0),xe=a.useRef(null),z=a.useRef(),me=a.useRef(0),U=a.useRef(!1),C=a.useRef({enemiesDestroyed:0,shotsHit:0,shotsFired:0,wavesCompleted:0,powerUpsCollected:0}),A=te?.5:1,P=a.useMemo(()=>({enemySpeed:u.enemySpeed+(w-1)*u.speedIncreasePerWave,diveChance:u.diveChance+(w-1)*u.diveIncreasePerWave,enemyFireRate:u.enemyFireRate+(w-1)*.001,powerUpChance:u.powerUpChance}),[u,w]);a.useEffect(()=>{d==="playing"&&T.length===0&&!U.current&&F(je(w,u))},[d,w,u,T.length]),a.useEffect(()=>{if(d!=="countdown")return;const s=setInterval(()=>{W(f=>f<=1?(v("playing"),0):f-1)},1e3);return()=>clearInterval(s)},[d]);const X=a.useCallback(()=>{const s=Date.now(),f=ee?100:180;s-pe.current<f||(pe.current=s,C.current.shotsFired++,Y(se?b=>[...b,{id:`p-${s}-l`,x:y-4,y:82,isEnemy:!1,speed:3},{id:`p-${s}-c`,x:y,y:82,isEnemy:!1,speed:3},{id:`p-${s}-r`,x:y+4,y:82,isEnemy:!1,speed:3}]:b=>[...b,{id:`p-${s}`,x:y,y:82,isEnemy:!1,speed:3}]))},[y,ee,se]);a.useEffect(()=>{if(d!=="playing")return;const s=new Set,f=r=>{s.add(r.key.toLowerCase()),(r.key===" "||r.key==="ArrowUp")&&(r.preventDefault(),X()),r.key==="Escape"&&v("paused")},b=r=>{s.delete(r.key.toLowerCase())},c=()=>{(s.has("arrowleft")||s.has("a"))&&L(r=>Math.max(5,r-2)),(s.has("arrowright")||s.has("d"))&&L(r=>Math.min(95,r+2))};window.addEventListener("keydown",f),window.addEventListener("keyup",b);const o=setInterval(c,16);return()=>{window.removeEventListener("keydown",f),window.removeEventListener("keyup",b),clearInterval(o)}},[d,X]);const Ye=a.useCallback(s=>{xe.current=s.touches[0].clientX},[]),qe=a.useCallback(s=>{if(!ae.current||xe.current===null)return;const f=ae.current.getBoundingClientRect(),c=(s.touches[0].clientX-f.left)/f.width*100;L(Math.max(5,Math.min(95,c)))},[]),Be=a.useCallback(()=>{L(s=>Math.max(5,s-8))},[]),Ze=a.useCallback(()=>{L(s=>Math.min(95,s+8))},[]);a.useEffect(()=>{if(d!=="playing")return;const s=f=>{if(f-me.current<16){z.current=requestAnimationFrame(s);return}me.current=f,X(),B.current+=P.enemySpeed*he.current*.3*A,Math.abs(B.current)>12&&(he.current*=-1),F(c=>c.map(o=>{if(o.isDiving){o.divePhase+=.05*A;const p=o.formationY+Math.sin(o.divePhase)*50+o.divePhase*15,h=o.diveStartX+Math.sin(o.divePhase*2)*20;return p>90?{...o,isDiving:!1,divePhase:0,x:o.formationX+B.current,y:o.formationY}:{...o,x:Math.max(5,Math.min(95,h)),y:p}}const r=o.formationX+B.current;return Math.random()<P.diveChance*.1&&!o.isDiving?{...o,isDiving:!0,diveStartX:r,divePhase:0}:(P.enemyFireRate>0&&Math.random()<P.enemyFireRate*A&&Y(p=>[...p,{id:`ep-${Date.now()}-${o.id}`,x:r,y:o.y+3,isEnemy:!0,speed:1.5*A}]),{...o,x:r})})),Y(c=>{const o=[];return c.forEach(r=>{const p=r.isEnemy?r.speed*A:r.speed,h=r.y+(r.isEnemy?p:-p);if(!(h<0||h>100)){if(!r.isEnemy){let S=!1;if(F($=>$.map(n=>{if(S)return n;const Z=Math.abs(r.x-n.x),Ve=Math.abs(h-n.y),be=re[n.type].size/8;if(Z<be&&Ve<be){S=!0,C.current.shotsHit++;const ve=n.hp-1;if(ve<=0){C.current.enemiesDestroyed++;const ge=n.isDiving?n.points*2:n.points;if(K(k=>k+ge),_("light"),n.type==="boss"&&l?.({target:"adversary",amount:we.energy_beam.bossKill,source:"boss_kill"}),de(k=>[...k,{id:`exp-${Date.now()}-${n.id}`,x:n.x,y:n.y,size:n.type==="boss"?"large":"small"}]),q(k=>[...k,{id:`sp-${Date.now()}`,x:n.x,y:n.y,score:ge,type:"normal"}]),Math.random()<P.powerUpChance){const k=["shield","rapid","repair","slowmo","spread","bonus"];ce(Ke=>[...Ke,{id:`pu-${Date.now()}`,type:k[Math.floor(Math.random()*k.length)],x:n.x,y:n.y}])}return{...n,hp:0}}return{...n,hp:ve}}return n}).filter(n=>n.hp>0)),S)return}if(r.isEnemy&&!O){const S=Math.abs(r.x-y),$=Math.abs(h-85);if(S<4&&$<4){R?(J(!1),_("medium"),D(n=>[...n,{id:`shield-${Date.now()}`,x:y,y:85,type:"shield-break"}]),j("rgba(59,130,246,0.4)"),setTimeout(()=>j(null),150)):(l?.({target:"player",amount:g,source:"player_hit"}),D(n=>[...n,{id:`hit-${Date.now()}`,x:y,y:85,type:"damage"}]),j("rgba(239,68,68,0.5)"),setTimeout(()=>j(null),200),Q(n=>{const Z=n-1;return Z<=0&&v("complete"),Z}),G(!0),setTimeout(()=>G(!1),2e3),_("heavy"));return}}o.push({...r,y:h})}}),o}),ce(c=>{const o=[];return c.forEach(r=>{const p=r.y+.5;if(p>100)return;const h=Math.abs(r.x-y),S=Math.abs(p-85);if(h<6&&S<6){C.current.powerUpsCollected++,_("medium");const $={shield:"#3b82f6",rapid:"#f59e0b",repair:"#22c55e",slowmo:"#a855f7",spread:"#ec4899",bonus:"#fbbf24"};switch(fe(n=>[...n,{id:`collect-${Date.now()}`,x:r.x,y:p,color:$[r.type]}]),j(`${$[r.type]}40`),setTimeout(()=>j(null),120),r.type){case"shield":J(!0);break;case"rapid":ne(!0),setTimeout(()=>ne(!1),5e3);break;case"repair":Q(n=>Math.min(n+1,u.startLives)),q(n=>[...n,{id:`sp-repair-${Date.now()}`,x:r.x,y:r.y,score:0,type:"repair"}]);break;case"slowmo":oe(!0),setTimeout(()=>oe(!1),5e3);break;case"spread":le(!0),setTimeout(()=>le(!1),5e3);break;case"bonus":K(n=>n+200),q(n=>[...n,{id:`sp-bonus-${Date.now()}`,x:r.x,y:r.y,score:200,type:"bonus"}]);break}return}o.push({...r,y:p})}),o}),O||F(c=>(c.forEach(o=>{const r=Math.abs(o.x-y),p=Math.abs(o.y-85);r<5&&p<5&&(R?(J(!1),D(h=>[...h,{id:`shield-enemy-${Date.now()}`,x:y,y:85,type:"shield-break"}]),j("rgba(59,130,246,0.4)"),setTimeout(()=>j(null),150)):(l?.({target:"player",amount:g,source:"enemy_collision"}),D(h=>[...h,{id:`hit-enemy-${Date.now()}`,x:y,y:85,type:"damage"}]),j("rgba(239,68,68,0.5)"),setTimeout(()=>j(null),200),Q(h=>{const S=h-1;return S<=0&&v("complete"),S}),G(!0),setTimeout(()=>G(!1),2e3)),_("heavy"))}),c)),de(c=>c.slice(-10)),q(c=>c.slice(-10)),fe(c=>c.slice(-8)),D(c=>c.slice(-6)),z.current=requestAnimationFrame(s)};return z.current=requestAnimationFrame(s),()=>{z.current&&cancelAnimationFrame(z.current)}},[d,y,P,X,R,O,l,g]),a.useEffect(()=>{if(d!=="playing"||T.length>0||U.current)return;U.current=!0;const s=C.current;if(s.wavesCompleted++,M&&s.wavesCompleted>=2){U.current=!1,v("complete");return}K(f=>f+100+w*50),l?.({target:"adversary",amount:we.energy_beam.waveComplete,source:"wave_complete"}),v("wave-transition"),setTimeout(()=>{Ue(f=>{const b=f+1;return F(je(b,u)),b}),v("playing"),U.current=!1},2e3)},[T.length,w,u,d,M,l]);const ye=a.useCallback(s=>s>=90?"perfect":s>=50?"good":"fail",[]);return a.useEffect(()=>{if(d!=="complete")return;const f=C.current.wavesCompleted,c={beginner:5,easy:4,medium:3,hard:2,master:2}[E],o=Math.min(100,Math.round(f/c*100)),r=ye(o),p=setTimeout(()=>{i({success:r!=="fail",accuracy:o,result:r,highScoreValue:f,gameStats:{wavesCleared:f,score:V}})},1500);return()=>clearTimeout(p)},[d,ie,E,i,ye,V]),e.jsxs("div",{className:"relative w-full h-full flex-1 min-h-0 flex flex-col items-center overflow-hidden select-none",children:[e.jsx(Ce,{}),e.jsxs("div",{className:`absolute top-0 left-0 right-0 z-30 ${m?"px-2 pb-2 pt-[calc(env(safe-area-inset-top,0px)+0.5rem)]":"px-3 pb-3 pt-[calc(env(safe-area-inset-top,0px)+0.75rem)]"}`,children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("div",{className:`font-black text-white ${m?"text-lg":"text-2xl"}`,style:{textShadow:"0 0 10px rgba(59,130,246,0.5)"},children:V.toLocaleString()}),!m&&e.jsx("div",{className:"text-xs text-muted-foreground",children:"SCORE"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:`font-bold text-cyan-400 ${m?"text-sm":"text-lg"}`,children:["WAVE ",w]}),!m&&e.jsx("div",{className:"text-xs text-muted-foreground",children:"Endless Mode"})]}),e.jsx(Fe,{lives:ie,maxLives:u.startLives})]}),!m&&e.jsxs("div",{className:"flex gap-2 mt-2",children:[R&&e.jsxs("div",{className:"px-2 py-1 bg-blue-500/30 rounded text-xs text-blue-400 flex items-center gap-1",children:[e.jsx(Se,{className:"w-3 h-3"})," SHIELD"]}),ee&&e.jsxs("div",{className:"px-2 py-1 bg-amber-500/30 rounded text-xs text-amber-400 flex items-center gap-1",children:[e.jsx(ke,{className:"w-3 h-3"})," RAPID"]}),te&&e.jsxs("div",{className:"px-2 py-1 bg-purple-500/30 rounded text-xs text-purple-400 flex items-center gap-1",children:[e.jsx(Ne,{className:"w-3 h-3"})," SLOW-MO"]}),se&&e.jsxs("div",{className:"px-2 py-1 bg-pink-500/30 rounded text-xs text-pink-400 flex items-center gap-1",children:[e.jsx(Ee,{className:"w-3 h-3"})," SPREAD"]})]})]}),te&&e.jsx("div",{className:"absolute inset-0 bg-purple-500/10 pointer-events-none z-10"}),e.jsx(I,{children:ue&&e.jsx(x.div,{className:"absolute inset-0 z-50 pointer-events-none",style:{backgroundColor:ue},initial:{opacity:1},animate:{opacity:0},exit:{opacity:0},transition:{duration:.15}})}),e.jsxs("div",{ref:ae,className:"relative w-full h-full",onTouchStart:Ye,onTouchMove:qe,onClick:X,children:[T.map(s=>e.jsx($e,{enemy:s},s.id)),Ae.map(s=>e.jsx(Ie,{projectile:s},s.id)),Xe.map(s=>e.jsx(We,{powerUp:s},s.id)),e.jsx(I,{children:_e.map(s=>e.jsx(Le,{explosion:s},s.id))}),e.jsx(I,{children:He.map(s=>e.jsx(Re,{popup:s},s.id))}),e.jsx(I,{children:Oe.map(s=>e.jsx(De,{effect:s},s.id))}),e.jsx(I,{children:Ge.map(s=>e.jsx(ze,{effect:s},s.id))}),d==="playing"&&e.jsx(Pe,{x:y,hasShield:R,isInvulnerable:O})]}),d==="playing"&&e.jsxs("div",{className:"absolute bottom-2 left-0 right-0 flex justify-between px-4 z-20",children:[e.jsx("button",{className:"w-16 h-16 rounded-full bg-slate-800/80 border border-slate-600 flex items-center justify-center active:bg-slate-700",onTouchStart:Be,children:e.jsx(Qe,{className:"w-8 h-8 text-white"})}),e.jsx("button",{className:"w-16 h-16 rounded-full bg-slate-800/80 border border-slate-600 flex items-center justify-center active:bg-slate-700",onTouchStart:Ze,children:e.jsx(Je,{className:"w-8 h-8 text-white"})})]}),e.jsxs(I,{children:[d==="countdown"&&e.jsx(tt,{count:N,onComplete:()=>{}}),d==="wave-transition"&&e.jsx(Te,{wave:w+1}),d==="paused"&&e.jsx(st,{onResume:()=>v("playing")})]})]})}export{ct as EnergyBeamGame};
