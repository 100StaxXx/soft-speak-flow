import{v as ce,r as j,u as ae,aB as V,aA as m,j as e,aa as U,dk as X,Z as be,Q as Oe,Y as Be,cp as se,bE as ie,al as ze,b5 as We,dl as He,cg as Ve,dm as Ke,aZ as we,de as pe,dn as Qe,dp as Ye,dh as Je,bC as Q,c5 as Xe,dq as Ze,dr as de,W as Ce,c3 as _e,ak as es,c4 as ss,ds as ts,dt as as,du as rs,bM as Z,ad as ls,o as ns,df as os,_ as Se,H as is,ar as ds,X as ge,dv as cs,dw as ms}from"./vendor-CkzXtEGd.js";import{s as g,e as G,B as N,F as K,am as te,a as b,H as fe,J as je,K as us,f as ve,L as h,P as xs,an as Fe,b as hs,ao as ps,o as Ne,a4 as gs}from"./index-B9iotTKE.js";import"./date-vendor-CuPqBTxb.js";import"./three-vendor-qI8GXUTd.js";const ee=50,fs=()=>{const r=ce(),[y,P]=j.useState(null),[v,T]=j.useState(""),[D,f]=j.useState(null),{data:E,isLoading:O}=ae({queryKey:["admin-referral-payouts"],queryFn:async()=>{const{data:t,error:a}=await g.from("referral_payouts").select(`
          *,
          referral_code:referral_codes!referral_code_id(
            code,
            owner_type,
            owner_user_id,
            influencer_name,
            influencer_email,
            influencer_handle,
            payout_identifier
          ),
          referee:profiles!referee_id(email)
        `).order("created_at",{ascending:!1});if(a)throw a;return t}}),R=E?Object.values(E.filter(t=>t.referral_code_id).reduce((t,a)=>{const n=a.referral_code_id;if(!t[n]){const c=a.referral_code;t[n]={referral_code_id:n,code:c?.code||"Unknown",owner_type:c?.owner_type||"user",referrer_name:c?.owner_type==="influencer"?c.influencer_name||"Unknown":c?.influencer_email||"Unknown",referrer_email:c?.owner_type==="influencer"?c.influencer_email||"":c?.influencer_email||"",referrer_handle:c?.owner_type==="influencer"?c.influencer_handle:null,paypal_email:c?.payout_identifier||null,total_pending:0,total_approved:0,total_paid:0,pending_count:0,approved_count:0,paid_count:0}}return a.status==="pending"?(t[n].total_pending+=Number(a.amount),t[n].pending_count++):a.status==="approved"?(t[n].total_approved+=Number(a.amount),t[n].approved_count++):a.status==="paid"&&(t[n].total_paid+=Number(a.amount),t[n].paid_count++),t},{})):[],L=V({mutationFn:async({payoutId:t,notes:a})=>{const{error:n}=await g.from("referral_payouts").update({status:"approved",approved_at:new Date().toISOString(),admin_notes:a||null}).eq("id",t);if(n)throw n},onSuccess:()=>{r.invalidateQueries({queryKey:["admin-referral-payouts"]}),m.success("Payout approved"),T("")},onError:t=>{console.error("Failed to approve payout:",t),m.error("Failed to approve payout")}}),p=V({mutationFn:async({payoutId:t,notes:a})=>{const{error:n}=await g.from("referral_payouts").update({status:"rejected",rejected_at:new Date().toISOString(),admin_notes:a||null}).eq("id",t);if(n)throw n},onSuccess:()=>{r.invalidateQueries({queryKey:["admin-referral-payouts"]}),m.success("Payout rejected"),T("")},onError:t=>{console.error("Failed to reject payout:",t),m.error("Failed to reject payout")}}),u=V({mutationFn:async t=>{f(t);const{data:a,error:n}=await g.functions.invoke("process-paypal-payout",{body:{payout_id:t}});if(n)throw n;if(a.error)throw new Error(a.error);return a},onSuccess:t=>{r.invalidateQueries({queryKey:["admin-referral-payouts"]}),m.success(`Payout processed! PayPal Batch ID: ${t.payout_batch_id}`),f(null)},onError:t=>{console.error("Failed to process payout:",t),m.error(`Failed to process payout: ${t.message}`),f(null)}});V({mutationFn:async t=>{f(t);const{error:a}=await g.from("referral_payouts").update({status:"approved",failure_reason:null}).eq("id",t);if(a)throw a;const{data:n,error:c}=await g.functions.invoke("process-paypal-payout",{body:{payout_id:t}});if(c)throw c;if(n.error)throw new Error(n.error);return n},onSuccess:t=>{r.invalidateQueries({queryKey:["admin-referral-payouts"]}),m.success(`Retry successful! PayPal Batch ID: ${t.payout_batch_id}`),f(null)},onError:t=>{console.error("Failed to retry payout:",t),m.error(`Failed to retry payout: ${t.message}`),f(null)}});const o=V({mutationFn:async()=>{const{data:t,error:a}=await g.functions.invoke("retry-failed-payouts",{});if(a)throw a;if(t.error)throw new Error(t.error);return t},onSuccess:t=>{r.invalidateQueries({queryKey:["admin-referral-payouts"]}),m.success(`Retried ${t.processed||0} failed payouts`)},onError:t=>{console.error("Failed to bulk retry:",t),m.error(`Failed to retry payouts: ${t.message}`)}}),S=V({mutationFn:async t=>{const a=E?.filter(c=>c.referral_code_id===t&&c.status==="pending");if(!a||a.length===0)return;const{error:n}=await g.from("referral_payouts").update({status:"approved",approved_at:new Date().toISOString()}).eq("referral_code_id",t).eq("status","pending");if(n)throw n},onSuccess:()=>{r.invalidateQueries({queryKey:["admin-referral-payouts"]}),m.success("All pending payouts approved")},onError:t=>{console.error("Failed to bulk approve:",t),m.error("Failed to approve payouts")}}),_=E?.filter(t=>t.status==="failed").length||0,$=E?.filter(t=>t.referral_code_id===y),M=R.find(t=>t.referral_code_id===y);return O?e.jsx(G,{className:"p-6 rounded-3xl",children:e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(U,{className:"h-8 w-8 animate-spin text-primary"})})}):e.jsxs(G,{className:"p-6 mb-8 rounded-3xl shadow-soft",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx(X,{className:"h-6 w-6 text-primary"}),e.jsx("h2",{className:"font-heading text-2xl font-semibold",children:"Referral Payouts Management"})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-secondary/30 rounded-lg p-4 text-center",children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Total Pending"}),e.jsxs("p",{className:"text-xl font-bold text-yellow-500",children:["$",E?.filter(t=>t.status==="pending").reduce((t,a)=>t+Number(a.amount),0).toFixed(2)||"0.00"]})]}),e.jsxs("div",{className:"bg-secondary/30 rounded-lg p-4 text-center",children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Total Approved"}),e.jsxs("p",{className:"text-xl font-bold text-blue-500",children:["$",E?.filter(t=>t.status==="approved").reduce((t,a)=>t+Number(a.amount),0).toFixed(2)||"0.00"]})]}),e.jsxs("div",{className:"bg-secondary/30 rounded-lg p-4 text-center",children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Total Paid"}),e.jsxs("p",{className:"text-xl font-bold text-green-500",children:["$",E?.filter(t=>t.status==="paid").reduce((t,a)=>t+Number(a.amount),0).toFixed(2)||"0.00"]})]}),e.jsxs("div",{className:"bg-secondary/30 rounded-lg p-4 text-center",children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Referrers"}),e.jsx("p",{className:"text-xl font-bold text-primary",children:R.length})]}),e.jsxs("div",{className:"bg-red-500/10 rounded-lg p-4 text-center border border-red-500/20",children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Failed"}),e.jsx("p",{className:"text-xl font-bold text-red-500",children:_})]})]}),_>0&&e.jsx("div",{className:"mb-6 p-4 bg-red-500/10 border border-red-500/20 rounded-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(be,{className:"h-5 w-5 text-red-500"}),e.jsxs("span",{className:"font-medium text-red-600",children:[_," failed payout(s) need attention"]})]}),e.jsxs(N,{size:"sm",variant:"outline",className:"border-red-500 text-red-500 hover:bg-red-50",onClick:()=>o.mutate(),disabled:o.isPending,children:[o.isPending?e.jsx(U,{className:"h-4 w-4 animate-spin mr-1"}):e.jsx(Oe,{className:"h-4 w-4 mr-1"}),"Retry All Failed"]})]})}),e.jsxs("p",{className:"text-sm text-muted-foreground mb-4",children:[e.jsx(Be,{className:"h-4 w-4 inline mr-1 text-amber-500"}),"Minimum payout threshold: $",ee,". Only process payouts when referrer total reaches this amount."]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"font-semibold text-lg flex items-center gap-2",children:[e.jsx(se,{className:"h-5 w-5"}),"Referrers"]}),R.length===0?e.jsx("p",{className:"text-muted-foreground text-center py-8",children:"No referral payouts yet"}):e.jsx("div",{className:"space-y-3",children:R.map(t=>{const a=t.total_pending+t.total_approved+t.total_paid,n=t.total_approved>=ee,c=y===t.referral_code_id;return e.jsxs("div",{className:`p-4 rounded-lg border cursor-pointer transition-all ${c?"border-primary bg-primary/5":"border-border hover:border-primary/50"}`,onClick:()=>P(c?null:t.referral_code_id),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("p",{className:"font-medium",children:t.referrer_name}),t.owner_type==="influencer"&&e.jsx(K,{variant:"secondary",className:"text-xs",children:"Influencer"})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:t.referrer_email}),t.referrer_handle&&e.jsx("p",{className:"text-xs text-primary",children:t.referrer_handle}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Code: ",t.code]}),t.paypal_email&&e.jsxs("p",{className:"text-xs text-green-600",children:["PayPal: ",t.paypal_email]}),!t.paypal_email&&e.jsx("p",{className:"text-xs text-red-500",children:"No PayPal email set"})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-lg font-bold",children:["$",a.toFixed(2)]}),e.jsxs("div",{className:"flex gap-2 text-xs",children:[e.jsxs("span",{className:"text-yellow-500",children:["P: $",t.total_pending.toFixed(2)]}),e.jsxs("span",{className:"text-blue-500",children:["A: $",t.total_approved.toFixed(2)]}),e.jsxs("span",{className:"text-green-500",children:["D: $",t.total_paid.toFixed(2)]})]}),n&&t.paypal_email&&e.jsx(K,{className:"mt-1 bg-green-500",children:"Ready for payout"}),t.total_approved>0&&t.total_approved<ee&&e.jsxs(K,{variant:"outline",className:"mt-1",children:["$",(ee-t.total_approved).toFixed(2)," more needed"]})]})]}),c&&$&&e.jsxs("div",{className:"mt-4 pt-4 border-t space-y-4",children:[t.pending_count>0&&e.jsx("div",{className:"flex gap-2",children:e.jsxs(N,{size:"sm",onClick:l=>{l.stopPropagation(),S.mutate(t.referral_code_id)},disabled:S.isPending,children:[e.jsx(ie,{className:"h-4 w-4 mr-1"}),"Approve All Pending (",t.pending_count,")"]})}),e.jsx("div",{className:"space-y-2",children:$.map(l=>e.jsxs("div",{className:"flex items-center justify-between bg-secondary/20 rounded-lg p-3",onClick:x=>x.stopPropagation(),children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(K,{variant:l.status==="paid"?"default":l.status==="approved"?"secondary":l.status==="rejected"?"destructive":"outline",children:l.status}),e.jsxs("span",{className:"font-medium",children:["$",Number(l.amount).toFixed(2)]}),e.jsx("span",{className:"text-sm text-muted-foreground",children:l.payout_type==="first_month"?"Monthly":"Yearly"})]}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Referee: ",l.referee?.email]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:new Date(l.created_at).toLocaleDateString()}),l.admin_notes&&e.jsxs("p",{className:"text-xs text-amber-600 mt-1",children:["Note: ",l.admin_notes]})]}),e.jsxs("div",{className:"flex gap-2",children:[l.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsx(N,{size:"sm",variant:"outline",className:"text-green-600 border-green-600 hover:bg-green-50",onClick:()=>L.mutate({payoutId:l.id,notes:v}),disabled:L.isPending,children:e.jsx(ie,{className:"h-4 w-4"})}),e.jsx(N,{size:"sm",variant:"outline",className:"text-red-600 border-red-600 hover:bg-red-50",onClick:()=>p.mutate({payoutId:l.id,notes:v}),disabled:p.isPending,children:e.jsx(ze,{className:"h-4 w-4"})})]}),l.status==="approved"&&e.jsx(N,{size:"sm",className:"bg-green-600 hover:bg-green-700",onClick:()=>u.mutate(l.id),disabled:D===l.id||!t.paypal_email,children:D===l.id?e.jsx(U,{className:"h-4 w-4 animate-spin"}):e.jsxs(e.Fragment,{children:[e.jsx(We,{className:"h-4 w-4 mr-1"}),"Pay"]})}),l.status==="paid"&&e.jsxs("span",{className:"text-green-600 text-sm flex items-center",children:[e.jsx(ie,{className:"h-4 w-4 mr-1"}),"Paid"]})]})]},l.id))}),M&&(M.pending_count>0||M.approved_count>0)&&e.jsx("div",{className:"pt-2",children:e.jsx(te,{placeholder:"Admin notes (optional)",value:v,onChange:l=>T(l.target.value),className:"text-sm",rows:2})})]})]},t.referral_code_id)})})]})]})},js=()=>{const r=ce(),[y,P]=j.useState(""),[v,T]=j.useState("all"),[D,f]=j.useState(null),{data:E,isLoading:O}=ae({queryKey:["admin-referral-codes"],queryFn:async()=>{const{data:o,error:S}=await g.from("referral_codes").select("*").order("created_at",{ascending:!1});if(S)throw S;return await Promise.all(o.map(async $=>{const{count:M}=await g.from("profiles").select("*",{count:"exact",head:!0}).eq("referred_by_code",$.code),{data:t}=await g.from("referral_payouts").select("amount").eq("referral_code_id",$.id),a=t?.reduce((n,c)=>n+Number(c.amount),0)||0;return{...$,conversion_count:M||0,total_earnings:a}}))}}),R=V({mutationFn:async({codeId:o,isActive:S})=>{f(o);const{error:_}=await g.from("referral_codes").update({is_active:!S}).eq("id",o);if(_)throw _},onSuccess:()=>{r.invalidateQueries({queryKey:["admin-referral-codes"]}),m.success("Code status updated"),f(null)},onError:o=>{console.error("Failed to toggle code status:",o),m.error("Failed to update code status"),f(null)}}),L=E?.filter(o=>{const S=o.code.toLowerCase().includes(y.toLowerCase())||o.influencer_name?.toLowerCase().includes(y.toLowerCase())||o.influencer_email?.toLowerCase().includes(y.toLowerCase())||o.influencer_handle?.toLowerCase().includes(y.toLowerCase()),_=v==="all"||o.owner_type===v;return S&&_}),p={totalCodes:E?.length||0,activeCodes:E?.filter(o=>o.is_active).length||0,userCodes:E?.filter(o=>o.owner_type==="user").length||0,influencerCodes:E?.filter(o=>o.owner_type==="influencer").length||0,totalConversions:E?.reduce((o,S)=>o+(S.conversion_count||0),0)||0,totalEarnings:E?.reduce((o,S)=>o+(S.total_earnings||0),0)||0},u=o=>{navigator.clipboard.writeText(o),m.success("Copied to clipboard")};return O?e.jsx(G,{className:"p-6 rounded-3xl",children:e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(U,{className:"h-8 w-8 animate-spin text-primary"})})}):e.jsxs(G,{className:"p-6 mb-8 rounded-3xl shadow-soft",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx(He,{className:"h-6 w-6 text-primary"}),e.jsx("h2",{className:"font-heading text-2xl font-semibold",children:"Referral Codes Management"})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-secondary/30 rounded-lg p-4 text-center",children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Total Codes"}),e.jsx("p",{className:"text-2xl font-bold text-primary",children:p.totalCodes})]}),e.jsxs("div",{className:"bg-secondary/30 rounded-lg p-4 text-center",children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Active"}),e.jsx("p",{className:"text-2xl font-bold text-green-500",children:p.activeCodes})]}),e.jsxs("div",{className:"bg-secondary/30 rounded-lg p-4 text-center",children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"User Codes"}),e.jsx("p",{className:"text-2xl font-bold text-blue-500",children:p.userCodes})]}),e.jsxs("div",{className:"bg-secondary/30 rounded-lg p-4 text-center",children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Influencer Codes"}),e.jsx("p",{className:"text-2xl font-bold text-purple-500",children:p.influencerCodes})]}),e.jsxs("div",{className:"bg-secondary/30 rounded-lg p-4 text-center",children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Conversions"}),e.jsx("p",{className:"text-2xl font-bold text-orange-500",children:p.totalConversions})]}),e.jsxs("div",{className:"bg-secondary/30 rounded-lg p-4 text-center",children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Total Earnings"}),e.jsxs("p",{className:"text-2xl font-bold text-green-600",children:["$",p.totalEarnings.toFixed(2)]})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 mb-6",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(Ve,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(b,{placeholder:"Search by code, name, email, handle...",value:y,onChange:o=>P(o.target.value),className:"pl-10"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(N,{variant:v==="all"?"default":"outline",size:"sm",onClick:()=>T("all"),children:[e.jsx(Ke,{className:"h-4 w-4 mr-1"}),"All"]}),e.jsxs(N,{variant:v==="user"?"default":"outline",size:"sm",onClick:()=>T("user"),children:[e.jsx(se,{className:"h-4 w-4 mr-1"}),"Users"]}),e.jsxs(N,{variant:v==="influencer"?"default":"outline",size:"sm",onClick:()=>T("influencer"),children:[e.jsx(we,{className:"h-4 w-4 mr-1"}),"Influencers"]})]})]}),e.jsx("div",{className:"space-y-3",children:L&&L.length===0?e.jsx("p",{className:"text-muted-foreground text-center py-8",children:"No referral codes found"}):L?.map(o=>e.jsx("div",{className:"p-4 rounded-lg border border-border hover:border-primary/50 transition-all",children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("code",{className:"font-mono text-lg font-bold text-primary",children:o.code}),e.jsx(N,{variant:"ghost",size:"sm",onClick:()=>u(o.code),className:"h-6 w-6 p-0",children:e.jsx(pe,{className:"h-3 w-3"})}),e.jsx(K,{variant:o.owner_type==="influencer"?"default":"secondary",children:o.owner_type}),e.jsx(K,{variant:o.is_active?"default":"outline",children:o.is_active?"Active":"Inactive"})]}),o.owner_type==="influencer"?e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"font-medium",children:o.influencer_name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:o.influencer_email}),o.influencer_handle&&e.jsx("p",{className:"text-sm text-primary",children:o.influencer_handle}),o.payout_identifier&&e.jsxs("p",{className:"text-xs text-green-600",children:["PayPal: ",o.payout_identifier]})]}):e.jsxs("p",{className:"text-sm text-muted-foreground",children:["User ID: ",o.owner_user_id?.substring(0,8),"..."]}),e.jsxs("div",{className:"flex items-center gap-4 mt-2 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(se,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("span",{children:[o.conversion_count," conversions"]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(X,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("span",{children:["$",o.total_earnings?.toFixed(2)||"0.00"," earned"]})]}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:["Created ",new Date(o.created_at).toLocaleDateString()]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(N,{variant:"outline",size:"sm",onClick:()=>R.mutate({codeId:o.id,isActive:o.is_active}),disabled:D===o.id,children:D===o.id?e.jsx(U,{className:"h-4 w-4 animate-spin"}):o.is_active?e.jsxs(e.Fragment,{children:[e.jsx(Qe,{className:"h-4 w-4 mr-1"}),"Deactivate"]}):e.jsxs(e.Fragment,{children:[e.jsx(Ye,{className:"h-4 w-4 mr-1"}),"Activate"]})}),o.owner_type==="influencer"&&e.jsx(N,{variant:"ghost",size:"sm",onClick:()=>u(`${window.location.origin}/?ref=${o.code}`),children:e.jsx(Je,{className:"h-4 w-4"})})]})]})},o.id))}),e.jsxs("div",{className:"mt-6 p-4 bg-primary/5 border border-primary/20 rounded-lg",children:[e.jsx("p",{className:"text-sm font-medium mb-2",children:"Influencer Sign-Up Portal"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("code",{className:"flex-1 text-xs bg-background/50 px-3 py-2 rounded",children:[window.location.origin,"/creator"]}),e.jsx(N,{variant:"outline",size:"sm",onClick:()=>u(`${window.location.origin}/creator`),children:e.jsx(pe,{className:"h-4 w-4"})})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:"Share this link with influencers to generate their referral codes"})]})]})},vs=()=>{const[r,y]=j.useState(!1),[P,v]=j.useState([]),[T,D]=j.useState("test-influencer"),[f,E]=j.useState(""),[O,R]=j.useState(""),[L,p]=j.useState(""),u=(a,n,c)=>{v(l=>[...l,{step:a,status:n,message:c}])},o=()=>{v([])},S=async()=>{y(!0),o();try{const a=`${T.toLowerCase().replace(/\s+/g,"")}@test.com`,n=`@${T.toLowerCase().replace(/\s+/g,"_")}`;u("Creating influencer code","success",`Attempting to create code for: ${T}`);const{data:c,error:l}=await g.functions.invoke("create-influencer-code",{body:{name:T,email:a,handle:n,paypal_email:a}});if(l)throw l;if(c.error)throw new Error(c.error);u("Influencer code created","success",`Code: ${c.code}, Link: ${c.link}`),E(c.code),m.success("Influencer code created successfully!")}catch(a){u("Failed to create code","error",a.message),m.error("Failed to create influencer code")}finally{y(!1)}},_=async()=>{if(!f){m.error("Please create an influencer code first");return}y(!0);try{u("Testing signup flow","success",`Using code: ${f}`);const{data:a,error:n}=await g.from("referral_codes").select("*").eq("code",f).eq("is_active",!0).maybeSingle();if(n)throw n;if(!a)throw new Error("Code not found or inactive");u("Code validation","success",`Code found: ${a.code}, Signups: ${a.total_signups||0}`);const{error:c}=await g.from("referral_codes").update({total_signups:(a.total_signups||0)+1}).eq("id",a.id);if(c)throw c;u("Signup tracked","success","User signup recorded successfully"),m.success("Signup test completed!")}catch(a){u("Signup test failed","error",a.message),m.error("Signup test failed")}finally{y(!1)}},$=async()=>{if(!f){m.error("Please create an influencer code first");return}y(!0);try{u("Simulating subscription","success",`Testing conversion for code: ${f}`);const{data:a,error:n}=await g.from("referral_codes").select("*").eq("code",f).maybeSingle();if(n)throw n;if(!a)throw new Error("Code not found");u("Code fetched","success",`Code ID: ${a.id}`);const c={referralCode:f,subscriptionType:"monthly",amount:9.99,currency:"USD",userId:L||"test-user-"+Date.now()};u("Webhook simulation","success",`Monthly sub: $${c.amount}`);const l=c.amount*.5,{data:{user:x}}=await g.auth.getUser(),d=x?.id||"00000000-0000-0000-0000-000000000000",k=x?.id||"00000000-0000-0000-0000-000000000000",{data:i,error:w}=await g.from("referral_payouts").insert({referral_code_id:a.id,referrer_id:d,referee_id:k,amount:l,payout_type:"first_month",status:"pending"}).select().maybeSingle();if(w)throw w;if(!i)throw new Error("Failed to create payout record");u("Payout created","success",`Payout ID: ${i.id}, Amount: $${l.toFixed(2)}`);const{error:I}=await g.from("referral_codes").update({total_conversions:(a.total_conversions||0)+1,total_revenue:(a.total_revenue||0)+c.amount}).eq("id",a.id);I&&u("Warning","error",`Stats update failed: ${I.message} (non-critical)`),u("Stats updated","success","Conversion and revenue tracked"),m.success("Subscription conversion test completed!")}catch(a){u("Conversion test failed","error",a.message),m.error("Conversion test failed")}finally{y(!1)}},M=async()=>{y(!0);try{u("Testing payout approval","success","Fetching pending payouts");const{data:a,error:n}=await g.from("referral_payouts").select("*").eq("status","pending").limit(1);if(n)throw n;if(!a||a.length===0)throw new Error("No pending payouts found. Create a subscription conversion first.");const c=a[0];if(c.referral_code_id){const{data:x}=await g.from("referral_codes").select("code, influencer_name, payout_identifier").eq("id",c.referral_code_id).maybeSingle();x?(u("Payout found","success",`ID: ${c.id}, Amount: $${c.amount}, Code: ${x.code}`),u("Payout check","success",`Identifier: ${x.payout_identifier||"Not set"}`)):u("Payout found","success",`ID: ${c.id}, Amount: $${c.amount}`)}else u("Payout found","success",`ID: ${c.id}, Amount: $${c.amount}`);const{error:l}=await g.from("referral_payouts").update({status:"approved",approved_at:new Date().toISOString()}).eq("id",c.id);if(l)throw l;u("Payout approved","success","Status updated to approved"),m.success("Payout approval test completed!")}catch(a){u("Approval test failed","error",a.message),m.error("Approval test failed")}finally{y(!1)}},t=async()=>{y(!0);try{u("Testing PayPal integration","success","Note: This requires valid PayPal credentials");const{data:a,error:n}=await g.from("referral_payouts").select("*").eq("status","approved").limit(1);if(n)throw n;if(!a||a.length===0)throw new Error("No approved payouts found. Approve a payout first.");const c=a[0];let l=null;if(c.referral_code_id){const{data:k}=await g.from("referral_codes").select("*").eq("id",c.referral_code_id).maybeSingle();l=k}u("Approved payout found","success",`ID: ${c.id}, Amount: $${c.amount}${l?`, Code: ${l.code}`:""}`);const{data:x,error:d}=await g.functions.invoke("process-paypal-payout",{body:{payout_id:c.id}});if(d)throw d;u("PayPal payout initiated","success",`Transaction ID: ${x.payoutBatchId||"N/A"}`),m.success("PayPal payout test completed!")}catch(a){u("PayPal test failed","error",a.message),m.error("PayPal test failed - check credentials")}finally{y(!1)}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(G,{children:[e.jsxs(fe,{children:[e.jsx(je,{children:"Referral System Testing Suite"}),e.jsx(us,{children:"Test the complete referral flow from code creation to payout processing"})]}),e.jsxs(ve,{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"font-semibold",children:"1. Create Influencer Code"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(b,{placeholder:"Influencer name",value:T,onChange:a=>D(a.target.value)}),e.jsx(N,{onClick:S,disabled:r,children:r?e.jsx(U,{className:"w-4 h-4 animate-spin"}):"Create Code"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"font-semibold",children:"2. Simulate User Signup"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(b,{placeholder:"Referral code (auto-filled)",value:f,onChange:a=>E(a.target.value)}),e.jsx(N,{onClick:_,disabled:r||!f,children:r?e.jsx(U,{className:"w-4 h-4 animate-spin"}):"Test Signup"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"font-semibold",children:"3. Simulate Subscription"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(b,{placeholder:"User ID (optional)",value:L,onChange:a=>p(a.target.value)}),e.jsx(N,{onClick:$,disabled:r||!f,children:r?e.jsx(U,{className:"w-4 h-4 animate-spin"}):"Test Conversion"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"font-semibold",children:"4. Test Payout Approval"}),e.jsx(N,{onClick:M,disabled:r,variant:"secondary",children:r?e.jsx(U,{className:"w-4 h-4 animate-spin"}):"Test Approval"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"font-semibold",children:"5. Test PayPal Integration"}),e.jsx(N,{onClick:t,disabled:r,variant:"secondary",children:r?e.jsx(U,{className:"w-4 h-4 animate-spin"}):"Test PayPal"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Note: Requires valid PayPal API credentials configured"})]}),P.length>0&&e.jsxs("div",{className:"space-y-2 mt-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-semibold",children:"Test Results"}),e.jsx(N,{onClick:o,variant:"ghost",size:"sm",children:"Clear"})]}),e.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:P.map((a,n)=>e.jsx("div",{className:`p-3 rounded-lg border ${a.status==="success"?"bg-green-500/10 border-green-500/20":"bg-red-500/10 border-red-500/20"}`,children:e.jsxs("div",{className:"flex items-start gap-2",children:[a.status==="success"?e.jsx(Q,{className:"w-4 h-4 text-green-500 mt-0.5"}):e.jsx(be,{className:"w-4 h-4 text-red-500 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-sm",children:a.step}),e.jsx("p",{className:"text-xs text-muted-foreground",children:a.message})]})]})},n))})]})]})]}),e.jsxs(G,{children:[e.jsx(fe,{children:e.jsx(je,{children:"Testing Checklist"})}),e.jsxs(ve,{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(Q,{className:"w-4 h-4 text-muted-foreground mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Code Creation"}),e.jsx("p",{className:"text-muted-foreground",children:"Verify influencer code is created and stored"})]})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(Q,{className:"w-4 h-4 text-muted-foreground mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Signup Tracking"}),e.jsx("p",{className:"text-muted-foreground",children:"Confirm signups are tracked and counted"})]})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(Q,{className:"w-4 h-4 text-muted-foreground mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Conversion Detection"}),e.jsx("p",{className:"text-muted-foreground",children:"Verify subscription creates payout record"})]})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(Q,{className:"w-4 h-4 text-muted-foreground mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Payout Calculation"}),e.jsx("p",{className:"text-muted-foreground",children:"Confirm correct percentage (50% monthly, 20% yearly)"})]})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(Q,{className:"w-4 h-4 text-muted-foreground mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Admin Approval"}),e.jsx("p",{className:"text-muted-foreground",children:"Test approval workflow and status updates"})]})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(Q,{className:"w-4 h-4 text-muted-foreground mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"PayPal Integration"}),e.jsx("p",{className:"text-muted-foreground",children:"Verify PayPal API credentials and payout execution"})]})]})]})]})]})},Ns=()=>{const r=ce(),[y,P]=j.useState(""),{data:v,isLoading:T}=ae({queryKey:["admin-referral-config"],queryFn:async()=>{const{data:i,error:w}=await g.from("referral_config").select("*").order("config_key");if(w)throw w;return i}}),D=v?.find(i=>i.config_key==="commission_rates"),f=v?.find(i=>i.config_key==="payout_settings"),E=v?.find(i=>i.config_key==="trusted_influencers"),O=D?.config_value,R=f?.config_value,L=E?.config_value,[p,u]=j.useState(null),[o,S]=j.useState(null),[_,$]=j.useState(null);O&&!p&&u(O),R&&!o&&S(R),L&&!_&&$(L);const M=V({mutationFn:async({configKey:i,configValue:w})=>{const{error:I}=await g.from("referral_config").update({config_value:w}).eq("config_key",i);if(I)throw I},onSuccess:()=>{r.invalidateQueries({queryKey:["admin-referral-config"]}),m.success("Configuration saved")},onError:i=>{console.error("Failed to update config:",i),m.error("Failed to save configuration")}}),t=()=>{p&&M.mutate({configKey:"commission_rates",configValue:p})},a=()=>{o&&M.mutate({configKey:"payout_settings",configValue:o})},n=()=>{_&&M.mutate({configKey:"trusted_influencers",configValue:_})},c=()=>{if(!y.trim()||!p)return;const i=y.toLowerCase().replace(/\s+/g,"_");if(p.tiers[i]){m.error("Tier already exists");return}u({...p,tiers:{...p.tiers,[i]:{min_conversions:0,monthly_percent:50,yearly_percent:20}}}),P("")},l=i=>{if(!p)return;const{[i]:w,...I}=p.tiers;u({...p,tiers:I})},x=(i,w,I)=>{p&&u({...p,tiers:{...p.tiers,[i]:{...p.tiers[i],[w]:I}}})},d=i=>{if(!(!_||!i.trim())){if(_.codes.includes(i.toUpperCase())){m.error("Code already in trusted list");return}$({..._,codes:[..._.codes,i.toUpperCase()]})}},k=i=>{_&&$({..._,codes:_.codes.filter(w=>w!==i)})};return T?e.jsx(G,{className:"p-6 rounded-3xl",children:e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(U,{className:"h-8 w-8 animate-spin text-primary"})})}):e.jsxs(G,{className:"p-6 mb-8 rounded-3xl shadow-soft",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx(Xe,{className:"h-6 w-6 text-primary"}),e.jsx("h2",{className:"font-heading text-2xl font-semibold",children:"Referral Configuration"})]}),e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ze,{className:"h-5 w-5 text-primary"}),e.jsx("h3",{className:"font-semibold text-lg",children:"Commission Rates"})]}),e.jsxs(N,{size:"sm",onClick:t,disabled:M.isPending,children:[M.isPending?e.jsx(U,{className:"h-4 w-4 animate-spin mr-1"}):e.jsx(de,{className:"h-4 w-4 mr-1"}),"Save"]})]}),e.jsxs("div",{className:"bg-secondary/20 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm font-medium mb-3",children:"Default Rates"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(h,{className:"text-xs",children:"Monthly %"}),e.jsx(b,{type:"number",value:p?.default.monthly_percent||0,onChange:i=>p&&u({...p,default:{...p.default,monthly_percent:Number(i.target.value)}}),className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(h,{className:"text-xs",children:"Yearly %"}),e.jsx(b,{type:"number",value:p?.default.yearly_percent||0,onChange:i=>p&&u({...p,default:{...p.default,yearly_percent:Number(i.target.value)}}),className:"mt-1"})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-sm font-medium",children:"Commission Tiers"}),p&&Object.entries(p.tiers).sort(([,i],[,w])=>i.min_conversions-w.min_conversions).map(([i,w])=>e.jsxs("div",{className:"bg-secondary/10 border border-border rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx(K,{variant:"outline",className:"capitalize",children:i}),e.jsx(N,{variant:"ghost",size:"sm",onClick:()=>l(i),className:"text-destructive hover:text-destructive",children:e.jsx(Ce,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs("div",{children:[e.jsx(h,{className:"text-xs",children:"Min Conversions"}),e.jsx(b,{type:"number",value:w.min_conversions,onChange:I=>x(i,"min_conversions",Number(I.target.value)),className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(h,{className:"text-xs",children:"Monthly %"}),e.jsx(b,{type:"number",value:w.monthly_percent,onChange:I=>x(i,"monthly_percent",Number(I.target.value)),className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(h,{className:"text-xs",children:"Yearly %"}),e.jsx(b,{type:"number",value:w.yearly_percent,onChange:I=>x(i,"yearly_percent",Number(I.target.value)),className:"mt-1"})]})]})]},i)),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(b,{placeholder:"New tier name (e.g., diamond)",value:y,onChange:i=>P(i.target.value),onKeyDown:i=>i.key==="Enter"&&c()}),e.jsxs(N,{variant:"outline",onClick:c,children:[e.jsx(_e,{className:"h-4 w-4 mr-1"}),"Add Tier"]})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(X,{className:"h-5 w-5 text-primary"}),e.jsx("h3",{className:"font-semibold text-lg",children:"Payout Settings"})]}),e.jsxs(N,{size:"sm",onClick:a,disabled:M.isPending,children:[M.isPending?e.jsx(U,{className:"h-4 w-4 animate-spin mr-1"}):e.jsx(de,{className:"h-4 w-4 mr-1"}),"Save"]})]}),e.jsx("div",{className:"bg-secondary/20 rounded-lg p-4",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(h,{className:"text-xs",children:"Minimum Payout Threshold ($)"}),e.jsx(b,{type:"number",value:o?.minimum_threshold||0,onChange:i=>o&&S({...o,minimum_threshold:Number(i.target.value)}),className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(h,{className:"text-xs",children:"Auto-Approve Threshold ($)"}),e.jsx(b,{type:"number",value:o?.auto_approve_threshold||0,onChange:i=>o&&S({...o,auto_approve_threshold:Number(i.target.value)}),className:"mt-1"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Payouts under this amount are auto-approved"})]}),e.jsxs("div",{children:[e.jsx(h,{className:"text-xs",children:"Max Retry Attempts"}),e.jsx(b,{type:"number",value:o?.max_retry_attempts||0,onChange:i=>o&&S({...o,max_retry_attempts:Number(i.target.value)}),className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(h,{className:"text-xs",children:"Retry Delay (hours)"}),e.jsx(b,{type:"number",value:o?.retry_delay_hours||0,onChange:i=>o&&S({...o,retry_delay_hours:Number(i.target.value)}),className:"mt-1"})]})]})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(es,{className:"h-5 w-5 text-primary"}),e.jsx("h3",{className:"font-semibold text-lg",children:"Trusted Influencers"})]}),e.jsxs(N,{size:"sm",onClick:n,disabled:M.isPending,children:[M.isPending?e.jsx(U,{className:"h-4 w-4 animate-spin mr-1"}):e.jsx(de,{className:"h-4 w-4 mr-1"}),"Save"]})]}),e.jsxs("div",{className:"bg-secondary/20 rounded-lg p-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx(h,{className:"text-xs",children:"Auto-approve after X successful payouts"}),e.jsx(b,{type:"number",value:_?.auto_approve_after_payouts||0,onChange:i=>_&&$({..._,auto_approve_after_payouts:Number(i.target.value)}),className:"mt-1 max-w-xs"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Influencers become trusted after this many successful payouts"})]}),e.jsxs("div",{children:[e.jsx(h,{className:"text-xs mb-2 block",children:"Trusted Referral Codes"}),e.jsxs("div",{className:"flex flex-wrap gap-2 mb-3",children:[_?.codes.map(i=>e.jsxs(K,{variant:"secondary",className:"flex items-center gap-1",children:[i,e.jsx("button",{onClick:()=>k(i),className:"ml-1 hover:text-destructive",children:"Ã—"})]},i)),(!_?.codes||_.codes.length===0)&&e.jsx("span",{className:"text-sm text-muted-foreground",children:"No trusted codes yet"})]}),e.jsx("div",{className:"flex gap-2",children:e.jsx(b,{placeholder:"Add referral code",className:"max-w-xs",onKeyDown:i=>{i.key==="Enter"&&(d(i.target.value),i.target.value="")}})})]})]})]})]})]})},ys=()=>{const{data:r,isLoading:y}=ae({queryKey:["admin-referral-analytics"],queryFn:async()=>{const{data:P}=await g.from("referral_codes").select("*"),{data:v}=await g.from("referral_payouts").select("*"),{data:T}=await g.from("profiles").select("referred_by_code, created_at").not("referred_by_code","is",null),D=T?.length||0,{count:f}=await g.from("referral_payouts").select("*",{count:"exact",head:!0}),E=D>0?(f||0)/D*100:0,O=v?.filter(t=>t.status==="paid").reduce((t,a)=>t+Number(a.amount),0)||0,R=v?.filter(t=>t.status==="pending").reduce((t,a)=>t+Number(a.amount),0)||0,L=v?.filter(t=>t.status==="requested").reduce((t,a)=>t+Number(a.amount),0)||0,p=v?.filter(t=>t.status==="approved").reduce((t,a)=>t+Number(a.amount),0)||0,u=v?.reduce((t,a)=>t+Number(a.amount),0)||0,o=v&&v.length>0?u/v.length:0,S=new Map;P?.forEach(t=>{const a=v?.filter(l=>l.referral_code_id===t.id),n=a?.reduce((l,x)=>l+Number(x.amount),0)||0,c=a?.length||0;S.set(t.id,{code:t.code,name:t.influencer_name||t.owner_user_id?.substring(0,8)||"Unknown",conversions:c,earnings:n})});const _=Array.from(S.values()).sort((t,a)=>a.earnings-t.earnings).slice(0,5),$=new Date,M=[];for(let t=5;t>=0;t--){const a=new Date($.getFullYear(),$.getMonth()-t,1),n=new Date($.getFullYear(),$.getMonth()-t+1,0),c=a.toLocaleDateString("en-US",{month:"short",year:"numeric"}),l=T?.filter(i=>{const w=new Date(i.created_at);return w>=a&&w<=n}).length||0,x=v?.filter(i=>{const w=new Date(i.created_at);return w>=a&&w<=n}),d=x?.length||0,k=x?.reduce((i,w)=>i+Number(w.amount),0)||0;M.push({month:c,signups:l,conversions:d,earnings:k})}return{totalSignups:D,totalConversions:f||0,conversionRate:E,totalPaid:O,totalPending:R,totalRequested:L,totalApproved:p,avgPayoutAmount:o,topReferrers:_,monthlyStats:M}}});return y?e.jsx(G,{className:"p-6 rounded-3xl",children:e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(U,{className:"h-8 w-8 animate-spin text-primary"})})}):e.jsxs(G,{className:"p-6 mb-8 rounded-3xl shadow-soft",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx(ss,{className:"h-6 w-6 text-primary"}),e.jsx("h2",{className:"font-heading text-2xl font-semibold",children:"Referral Analytics"})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-8",children:[e.jsxs("div",{className:"bg-gradient-to-br from-blue-500/10 to-blue-600/5 border border-blue-500/20 rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(se,{className:"h-4 w-4 text-blue-500"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:"Total Signups"})]}),e.jsx("p",{className:"text-2xl font-bold text-blue-500",children:r?.totalSignups||0})]}),e.jsxs("div",{className:"bg-gradient-to-br from-green-500/10 to-green-600/5 border border-green-500/20 rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(we,{className:"h-4 w-4 text-green-500"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:"Conversions"})]}),e.jsx("p",{className:"text-2xl font-bold text-green-500",children:r?.totalConversions||0}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[r?.conversionRate.toFixed(1),"% rate"]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-purple-500/10 to-purple-600/5 border border-purple-500/20 rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(X,{className:"h-4 w-4 text-purple-500"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:"Total Paid Out"})]}),e.jsxs("p",{className:"text-2xl font-bold text-purple-500",children:["$",r?.totalPaid.toFixed(2)||"0.00"]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-amber-500/10 to-amber-600/5 border border-amber-500/20 rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(X,{className:"h-4 w-4 text-amber-500"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:"Avg Payout"})]}),e.jsxs("p",{className:"text-2xl font-bold text-amber-500",children:["$",r?.avgPayoutAmount.toFixed(2)||"0.00"]})]})]}),e.jsxs("div",{className:"mb-8",children:[e.jsx("h3",{className:"font-semibold text-lg mb-4",children:"Payout Pipeline"}),e.jsxs("div",{className:"grid grid-cols-4 gap-2",children:[e.jsxs("div",{className:"text-center p-3 bg-yellow-500/10 rounded-lg border border-yellow-500/20",children:[e.jsxs("p",{className:"text-lg font-bold text-yellow-600",children:["$",r?.totalPending.toFixed(2)||"0.00"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Pending"})]}),e.jsxs("div",{className:"text-center p-3 bg-orange-500/10 rounded-lg border border-orange-500/20",children:[e.jsxs("p",{className:"text-lg font-bold text-orange-600",children:["$",r?.totalRequested.toFixed(2)||"0.00"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Requested"})]}),e.jsxs("div",{className:"text-center p-3 bg-blue-500/10 rounded-lg border border-blue-500/20",children:[e.jsxs("p",{className:"text-lg font-bold text-blue-600",children:["$",r?.totalApproved.toFixed(2)||"0.00"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Approved"})]}),e.jsxs("div",{className:"text-center p-3 bg-green-500/10 rounded-lg border border-green-500/20",children:[e.jsxs("p",{className:"text-lg font-bold text-green-600",children:["$",r?.totalPaid.toFixed(2)||"0.00"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Paid"})]})]})]}),e.jsxs("div",{className:"mb-8",children:[e.jsx("h3",{className:"font-semibold text-lg mb-4",children:"Monthly Trend"}),e.jsx("div",{className:"grid grid-cols-6 gap-2",children:r?.monthlyStats.map((P,v)=>{const T=r.monthlyStats[v-1],D=T?P.earnings-T.earnings:0,f=D>=0;return e.jsxs("div",{className:"text-center p-3 bg-secondary/20 rounded-lg",children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:P.month}),e.jsxs("p",{className:"text-sm font-semibold",children:[P.signups," signups"]}),e.jsxs("p",{className:"text-xs text-green-500",children:[P.conversions," converts"]}),e.jsxs("p",{className:"text-sm font-bold text-primary mt-1",children:["$",P.earnings.toFixed(0)]}),v>0&&e.jsxs("div",{className:`flex items-center justify-center text-xs mt-1 ${f?"text-green-500":"text-red-500"}`,children:[f?e.jsx(ts,{className:"h-3 w-3"}):e.jsx(as,{className:"h-3 w-3"}),"$",Math.abs(D).toFixed(0)]})]},P.month)})})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg mb-4",children:"Top Referrers"}),r?.topReferrers&&r.topReferrers.length>0?e.jsx("div",{className:"space-y-2",children:r.topReferrers.map((P,v)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-secondary/20 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center font-bold ${v===0?"bg-yellow-500/20 text-yellow-500":v===1?"bg-gray-400/20 text-gray-400":v===2?"bg-amber-700/20 text-amber-700":"bg-secondary text-muted-foreground"}`,children:v+1}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:P.name}),e.jsx("p",{className:"text-xs text-muted-foreground",children:P.code})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"font-bold text-primary",children:["$",P.earnings.toFixed(2)]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[P.conversions," conversions"]})]})]},P.code))}):e.jsx("p",{className:"text-muted-foreground text-center py-4",children:"No referrer data yet"})]})]})},ye={Canines:["Wolf","Fox","Arctic Fox","Fennec Fox","Dog","Hyena","Tanuki"],"Mythical Canines":["Fenrir"],Felines:["Cat","Lion","Tiger","Panther","Snow Leopard","Cheetah","Jaguar","Lynx","Puma / Cougar"],"Mythical Felines":["Sphinx","Kitsune"],"Dragons & Reptiles":["Dragon","Wyvern","Hydra","Basilisk","T-Rex","Velociraptor","Crocodile","Snake","Sea Turtle"],Birds:["Eagle","Falcon","Hawk","Owl","Raven","Parrot","Hummingbird","Penguin"],"Mythical Birds":["Phoenix","Thunderbird"],Equines:["Horse (Stallion)","Unicorn","Pegasus"],Aquatic:["Dolphin","Shark","Orca","Blue Whale","Jellyfish","Octopus","Manta Ray"],"Mythical Aquatic":["Kraken","Leviathan"],"Other Mammals":["Bear","Deer","Elephant","Gorilla","Rhino","Hippo","Mammoth","Kangaroo","Koala","Red Panda","Panda","Sloth","Rabbit","Mouse","Chinchilla","Raccoon","Bat"]},bs=["Fire","Water","Earth","Air","Lightning","Ice","Nature","Light","Shadow","Cosmic"],ws=["","whimsical","epic","cozy","mysterious","triumphant","melancholic","playful"],Y=["Egg","Hatchling","Sproutling","Cub","Juvenile","Apprentice","Scout","Fledgling","Warrior","Guardian","Champion","Ascended","Vanguard","Titan","Mythic","Prime","Regal","Eternal","Transcendent","Apex","Ultimate Form"],Cs=()=>{const[r,y]=j.useState({spiritAnimal:"Wolf",element:"Fire",stage:0,favoriteColor:"#FF6B35",eyeColor:"#FFD700",furColor:"#8B4513",storyTone:"",retryAttempt:0}),[P,v]=j.useState(!1),[T,D]=j.useState(!1),[f,E]=j.useState(null),[O,R]=j.useState({}),[L,p]=j.useState(null),[u,o]=j.useState(null),S=(l,x)=>l<=1?"Text-to-Image (Egg Stage)":l>=15?"Text-to-Image (Cosmic Stage)":x?"Text-to-Image (with Visual Metadata)":"Text-to-Image (No Reference)",_=l=>{const d=l*10;return d<60?`~${d} seconds`:`~${Math.ceil(d/60)} minutes`},$=async()=>{v(!0),p(null);try{const l=O[r.stage-1]?.imageUrl,x=S(r.stage,!!l),{data:d,error:k}=await g.functions.invoke("generate-companion-image",{body:{spiritAnimal:r.spiritAnimal,element:r.element,stage:r.stage,favoriteColor:r.favoriteColor,eyeColor:r.eyeColor||void 0,furColor:r.furColor||void 0,storyTone:r.storyTone||void 0,previousStageImageUrl:l,retryAttempt:r.retryAttempt||void 0}});if(k)throw k;const i={stage:r.stage,imageUrl:d.imageUrl,prompt:d.prompt,generationMode:x,qualityScore:d.qualityScore,extractedMetadata:d.extractedMetadata};if(R(w=>({...w,[r.stage]:i})),p(d.prompt||"Prompt not returned"),o(r.stage),d.qualityScore){const w=d.qualityScore;w.shouldRetry?m.warning(`Stage ${r.stage} generated with issues (Score: ${w.overall}/100)`,{description:w.issues?.slice(0,2).join(", ")||"Quality below threshold"}):m.success(`Stage ${r.stage} generated (Score: ${w.overall}/100)`)}else m.success(`Stage ${r.stage} image generated (${x})`)}catch(l){console.error("Error generating companion image:",l),m.error(l.message||"Failed to generate companion image")}finally{v(!1)}},M=async()=>{D(!0),E({current:0,total:r.stage+1}),R({});try{let l;for(let x=0;x<=r.stage;x++){E({current:x,total:r.stage+1});const d=S(x,!!l),{data:k,error:i}=await g.functions.invoke("generate-companion-image",{body:{spiritAnimal:r.spiritAnimal,element:r.element,stage:x,favoriteColor:r.favoriteColor,eyeColor:r.eyeColor||void 0,furColor:r.furColor||void 0,storyTone:r.storyTone||void 0,previousStageImageUrl:l}});if(i)throw i;const w={stage:x,imageUrl:k.imageUrl,prompt:k.prompt,generationMode:d,qualityScore:k.qualityScore,extractedMetadata:k.extractedMetadata};if(R(I=>({...I,[x]:w})),l=k.imageUrl,k.qualityScore){const I=k.qualityScore;m.success(`Stage ${x} (${Y[x]}) - Score: ${I.overall}/100`)}else m.success(`Stage ${x} (${Y[x]}) complete`)}E({current:r.stage+1,total:r.stage+1}),o(r.stage),m.success(`Evolution chain complete! Generated ${r.stage+1} images.`)}catch(l){console.error("Error generating evolution chain:",l),m.error(l.message||"Failed to generate evolution chain")}finally{D(!1),E(null)}},t=r.stage>0&&!!O[r.stage-1],a=S(r.stage,t),n=u!==null?O[u]:null,c=Object.keys(O).length;return e.jsxs(G,{className:"p-6 mb-8 rounded-3xl shadow-soft",children:[e.jsx("h2",{className:"font-heading text-2xl font-semibold mb-4",children:"ðŸŽ¨ Companion Image Tester"}),e.jsx("p",{className:"text-muted-foreground mb-6",children:"Test companion image generation with visual metadata extraction for consistent evolution chains"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs(h,{htmlFor:"spiritAnimal",children:["Spirit Animal (",Object.values(ye).flat().length," creatures)"]}),e.jsx("select",{id:"spiritAnimal",value:r.spiritAnimal,onChange:l=>y({...r,spiritAnimal:l.target.value}),className:"w-full p-3 min-h-[44px] border rounded-2xl bg-background text-base",children:Object.entries(ye).map(([l,x])=>e.jsx("optgroup",{label:l,children:x.map(d=>e.jsx("option",{value:d,children:d},d))},l))})]}),e.jsxs("div",{children:[e.jsx(h,{htmlFor:"element",children:"Element"}),e.jsx("select",{id:"element",value:r.element,onChange:l=>y({...r,element:l.target.value}),className:"w-full p-3 min-h-[44px] border rounded-2xl bg-background text-base",children:bs.map(l=>e.jsx("option",{value:l,children:l},l))})]})]}),e.jsxs("div",{children:[e.jsx(h,{htmlFor:"storyTone",children:"Story Tone (Optional)"}),e.jsxs("select",{id:"storyTone",value:r.storyTone,onChange:l=>y({...r,storyTone:l.target.value}),className:"w-full p-3 min-h-[44px] border rounded-2xl bg-background text-base",children:[e.jsx("option",{value:"",children:"None (default)"}),ws.filter(Boolean).map(l=>e.jsx("option",{value:l,children:l.charAt(0).toUpperCase()+l.slice(1)},l))]})]}),e.jsxs("div",{children:[e.jsxs(h,{htmlFor:"stage",children:["Evolution Stage: ",r.stage," - ",Y[r.stage]]}),e.jsx("input",{type:"range",id:"stage",min:"0",max:"20",value:r.stage,onChange:l=>y({...r,stage:parseInt(l.target.value)}),className:"w-full h-10 cursor-pointer"}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 mt-2",children:[a.includes("Visual Metadata")?e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full bg-purple-500/20 text-purple-600 text-xs font-medium",children:[e.jsx(rs,{className:"w-3 h-3"}),"T2I + Visual Metadata (stage ",r.stage-1," â†’ ",r.stage,")"]}):a.includes("Egg")?e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full bg-amber-500/20 text-amber-600 text-xs font-medium",children:[e.jsx(Z,{className:"w-3 h-3"}),"Text-to-Image (Egg)"]}):a.includes("Cosmic")?e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full bg-indigo-500/20 text-indigo-600 text-xs font-medium",children:[e.jsx(Z,{className:"w-3 h-3"}),"Text-to-Image (Cosmic)"]}):e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full bg-blue-500/20 text-blue-600 text-xs font-medium",children:[e.jsx(Z,{className:"w-3 h-3"}),"Text-to-Image"]}),r.stage>=2&&r.stage<=14&&!t&&e.jsx("span",{className:"text-xs text-amber-600",children:"âš ï¸ No previous stage - generate chain or prior stage first"})]}),t&&r.stage>=2&&r.stage<=14&&e.jsxs("div",{className:"mt-3 p-3 rounded-xl bg-muted/50 border border-border",children:[e.jsx("p",{className:"text-xs font-medium text-muted-foreground mb-2",children:"Colors that will be extracted & matched:"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"w-5 h-5 rounded-full border border-border",style:{backgroundColor:r.favoriteColor}}),e.jsx("span",{className:"text-xs text-muted-foreground",children:"Primary"})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"w-5 h-5 rounded-full border border-border",style:{backgroundColor:r.eyeColor}}),e.jsx("span",{className:"text-xs text-muted-foreground",children:"Eyes"})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"w-5 h-5 rounded-full border border-border",style:{backgroundColor:r.furColor}}),e.jsx("span",{className:"text-xs text-muted-foreground",children:"Fur"})]})]}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-2 italic",children:["âœ¨ Metadata (hex colors, pose, angle, style) will be extracted from stage ",r.stage-1]})]})]}),e.jsxs("div",{children:[e.jsx(h,{htmlFor:"retryAttempt",children:"Retry Attempt (0-3, affects enforcement text)"}),e.jsx(b,{type:"number",id:"retryAttempt",min:"0",max:"3",value:r.retryAttempt,onChange:l=>y({...r,retryAttempt:parseInt(l.target.value)||0}),className:"w-full rounded-2xl min-h-[44px] text-base"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx(h,{htmlFor:"favoriteColor",children:"Favorite Color"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(b,{type:"color",id:"favoriteColor",value:r.favoriteColor,onChange:l=>y({...r,favoriteColor:l.target.value}),className:"w-16 h-12 rounded-2xl cursor-pointer"}),e.jsx(b,{type:"text",value:r.favoriteColor,onChange:l=>y({...r,favoriteColor:l.target.value}),className:"flex-1 rounded-2xl min-h-[44px] text-base",placeholder:"#FF6B35"})]})]}),e.jsxs("div",{children:[e.jsx(h,{htmlFor:"eyeColor",children:"Eye Color"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(b,{type:"color",id:"eyeColor",value:r.eyeColor,onChange:l=>y({...r,eyeColor:l.target.value}),className:"w-16 h-12 rounded-2xl cursor-pointer"}),e.jsx(b,{type:"text",value:r.eyeColor,onChange:l=>y({...r,eyeColor:l.target.value}),className:"flex-1 rounded-2xl min-h-[44px] text-base",placeholder:"#FFD700"})]})]}),e.jsxs("div",{children:[e.jsx(h,{htmlFor:"furColor",children:"Fur/Scale Color"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(b,{type:"color",id:"furColor",value:r.furColor,onChange:l=>y({...r,furColor:l.target.value}),className:"w-16 h-12 rounded-2xl cursor-pointer"}),e.jsx(b,{type:"text",value:r.furColor,onChange:l=>y({...r,furColor:l.target.value}),className:"flex-1 rounded-2xl min-h-[44px] text-base",placeholder:"#8B4513"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(N,{onClick:$,disabled:P||T,variant:"outline",className:"w-full rounded-2xl min-h-[48px] text-base",children:P?e.jsxs(e.Fragment,{children:[e.jsx(U,{className:"h-5 w-5 mr-2 animate-spin"}),"Generating Stage ",r.stage,"..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Z,{className:"h-5 w-5 mr-2"}),"Generate Single Stage"]})}),e.jsx(N,{onClick:M,disabled:P||T,className:"w-full rounded-2xl min-h-[48px] text-base",children:T?e.jsxs(e.Fragment,{children:[e.jsx(U,{className:"h-5 w-5 mr-2 animate-spin"}),"Generating Chain..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ls,{className:"h-5 w-5 mr-2"}),"Generate Full Evolution (0â†’",r.stage,")"]})})]}),!T&&r.stage>0&&e.jsxs("p",{className:"text-xs text-muted-foreground text-center",children:["Full evolution will generate ",r.stage+1," images (",_(r.stage+1),")"]}),f&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("span",{children:["Generating stage ",f.current," of ",f.total-1]}),e.jsxs("span",{children:[Math.round(f.current/f.total*100),"%"]})]}),e.jsx(xs,{value:f.current/f.total*100}),e.jsxs("p",{className:"text-xs text-muted-foreground text-center",children:[f.current>0&&Y[f.current-1]," â†’ ",Y[f.current]]})]}),c>0&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs(h,{children:["Evolution Chain Gallery (",c," images)"]}),e.jsx("div",{className:"flex gap-2 overflow-x-auto pb-2",children:Array.from({length:21},(l,x)=>x).map(l=>{const x=O[l];return x?e.jsxs("button",{onClick:()=>{o(l),p(x.prompt||null)},className:`flex-shrink-0 relative rounded-xl overflow-hidden border-2 transition-all ${u===l?"border-primary ring-2 ring-primary/30":"border-border hover:border-primary/50"}`,children:[e.jsx("img",{src:x.imageUrl,alt:`Stage ${l}`,className:"w-20 h-20 object-cover"}),e.jsxs("div",{className:"absolute bottom-0 left-0 right-0 bg-black/60 text-white text-xs p-1 text-center",children:[l,x.qualityScore&&e.jsxs("span",{className:`ml-1 ${x.qualityScore.overall>=70?"text-green-400":"text-amber-400"}`,children:["(",x.qualityScore.overall,")"]})]}),e.jsx("div",{className:`absolute top-1 right-1 w-2 h-2 rounded-full ${x.generationMode.includes("Visual Metadata")?"bg-purple-500":x.generationMode.includes("Egg")?"bg-amber-500":x.generationMode.includes("Cosmic")?"bg-indigo-500":"bg-blue-500"}`})]},l):null})}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[e.jsx("span",{className:"inline-block w-2 h-2 rounded-full bg-blue-500 mr-1"})," T2I",e.jsx("span",{className:"inline-block w-2 h-2 rounded-full bg-purple-500 ml-3 mr-1"})," T2I + Metadata",e.jsx("span",{className:"inline-block w-2 h-2 rounded-full bg-amber-500 ml-3 mr-1"})," Egg",e.jsx("span",{className:"inline-block w-2 h-2 rounded-full bg-indigo-500 ml-3 mr-1"})," Cosmic"]})]}),n&&e.jsxs("div",{className:"space-y-4 p-4 md:p-6 border rounded-2xl bg-card",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold",children:["Stage ",n.stage," - ",Y[n.stage]]}),e.jsx("span",{className:`text-xs ${n.generationMode.includes("Visual Metadata")?"text-purple-600":n.generationMode.includes("Egg")?"text-amber-600":n.generationMode.includes("Cosmic")?"text-indigo-600":"text-blue-600"}`,children:n.generationMode})]}),e.jsx(N,{onClick:()=>Fe(n.imageUrl,`companion-${r.spiritAnimal}-stage${n.stage}.png`),variant:"outline",size:"sm",className:"rounded-full",children:ns.isNativePlatform()?e.jsxs(e.Fragment,{children:[e.jsx(os,{className:"h-4 w-4 mr-1"})," Share"]}):e.jsxs(e.Fragment,{children:[e.jsx(Se,{className:"h-4 w-4 mr-1"})," Download"]})})]}),e.jsx("div",{className:"flex justify-center",children:e.jsx("img",{src:n.imageUrl,alt:`Stage ${n.stage} - ${Y[n.stage]}`,className:"max-w-md w-full rounded-2xl shadow-lg"})}),n.qualityScore&&e.jsxs("div",{className:"p-4 rounded-xl bg-muted/50 border",children:[e.jsx(h,{className:"mb-3 block",children:"Quality Analysis"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:[e.jsxs("div",{className:"text-center p-2 rounded-lg bg-background",children:[e.jsx("div",{className:`text-2xl font-bold ${n.qualityScore.overall>=70?"text-green-600":n.qualityScore.overall>=50?"text-amber-600":"text-red-600"}`,children:n.qualityScore.overall}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Overall"})]}),e.jsxs("div",{className:"text-center p-2 rounded-lg bg-background",children:[e.jsx("div",{className:`text-2xl font-bold ${n.qualityScore.limbCount>=70?"text-green-600":"text-amber-600"}`,children:n.qualityScore.limbCount}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Limbs"})]}),e.jsxs("div",{className:"text-center p-2 rounded-lg bg-background",children:[e.jsx("div",{className:`text-2xl font-bold ${n.qualityScore.speciesFidelity>=70?"text-green-600":"text-amber-600"}`,children:n.qualityScore.speciesFidelity}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Species"})]}),e.jsxs("div",{className:"text-center p-2 rounded-lg bg-background",children:[e.jsx("div",{className:`text-2xl font-bold ${n.qualityScore.colorMatch>=70?"text-green-600":"text-amber-600"}`,children:n.qualityScore.colorMatch}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Colors"})]})]}),n.qualityScore.issues&&n.qualityScore.issues.length>0&&e.jsxs("div",{className:"mt-3 p-2 rounded-lg bg-red-500/10 border border-red-500/20",children:[e.jsx("p",{className:"text-xs font-medium text-red-600 mb-1",children:"Issues Detected:"}),e.jsx("ul",{className:"text-xs text-red-600/80 list-disc list-inside",children:n.qualityScore.issues.map((l,x)=>e.jsx("li",{children:l},x))})]})]}),n.extractedMetadata&&e.jsxs("div",{className:"p-4 rounded-xl bg-muted/50 border",children:[e.jsx(h,{className:"mb-3 block",children:"Extracted Visual Metadata"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-xs text-muted-foreground w-20",children:"Colors:"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-6 h-6 rounded-full border border-border shadow-sm",style:{backgroundColor:n.extractedMetadata.hexPrimaryColor},title:`Primary: ${n.extractedMetadata.hexPrimaryColor}`}),e.jsx("div",{className:"w-6 h-6 rounded-full border border-border shadow-sm",style:{backgroundColor:n.extractedMetadata.hexEyeColor},title:`Eyes: ${n.extractedMetadata.hexEyeColor}`}),n.extractedMetadata.hexAccentColor&&e.jsx("div",{className:"w-6 h-6 rounded-full border border-border shadow-sm",style:{backgroundColor:n.extractedMetadata.hexAccentColor},title:`Accent: ${n.extractedMetadata.hexAccentColor}`}),e.jsxs("span",{className:"text-xs text-muted-foreground ml-2",children:[n.extractedMetadata.hexPrimaryColor," / ",n.extractedMetadata.hexEyeColor]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2 text-xs",children:[e.jsxs("div",{className:"p-2 rounded bg-background",children:[e.jsx("span",{className:"text-muted-foreground",children:"Angle:"}),e.jsx("span",{className:"ml-1 font-medium",children:n.extractedMetadata.viewingAngle})]}),e.jsxs("div",{className:"p-2 rounded bg-background",children:[e.jsx("span",{className:"text-muted-foreground",children:"Pose:"}),e.jsx("span",{className:"ml-1 font-medium",children:n.extractedMetadata.pose})]}),e.jsxs("div",{className:"p-2 rounded bg-background",children:[e.jsx("span",{className:"text-muted-foreground",children:"Expression:"}),e.jsx("span",{className:"ml-1 font-medium",children:n.extractedMetadata.expression})]}),e.jsxs("div",{className:"p-2 rounded bg-background",children:[e.jsx("span",{className:"text-muted-foreground",children:"Style:"}),e.jsxs("span",{className:"ml-1 font-medium truncate",children:[n.extractedMetadata.artStyle.slice(0,20),"..."]})]})]}),e.jsxs("div",{className:"text-xs",children:[e.jsx("span",{className:"text-muted-foreground",children:"Markings:"}),e.jsx("span",{className:"ml-2",children:n.extractedMetadata.markings})]})]})]}),L&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{children:"Generated Prompt:"}),e.jsx(te,{value:L,readOnly:!0,className:"font-mono text-xs rounded-2xl min-h-[100px]"})]})]})]})]})},ks=()=>{const{user:r,loading:y}=hs();is();const[P,v]=j.useState(!1),[T,D]=j.useState(!0),[f,E]=j.useState([]),[O,R]=j.useState(!1),[L,p]=j.useState(!1),[u,o]=j.useState(null),[S,_]=j.useState(null),[$,M]=j.useState(null),[t,a]=j.useState(!1),[n,c]=j.useState(!1),[l,x]=j.useState(null),[d,k]=j.useState({spiritAnimal:"wolf",element:"fire",stage:5,favoriteColor:"#FF6B35",eyeColor:"#FFD700",furColor:"#8B4513",mind:50,body:50,soul:50,customName:""}),[i,w]=j.useState(!1),[I,me]=j.useState(null),[F,z]=j.useState({spiritAnimal:"wolf",element:"fire",favoriteColor:"#FF6B35",eyeColor:"#FFD700",furColor:"#8B4513",milestonePercent:50,sourceImageUrl:""}),[ue,xe]=j.useState(!1),[H,he]=j.useState(null),[re,Pe]=j.useState([]),[A,B]=j.useState({title:"",category:"",topic_category:[],emotional_triggers:[],quote:"",description:"",audio_url:"",is_featured:!1,mentor_id:"",tags:[],is_premium:!1});j.useEffect(()=>{(async()=>{if(y)return;if(!r){console.debug("Admin: no user after auth resolved"),v(!1),D(!1);return}const{data:C,error:q}=await g.functions.invoke("verify-admin-access");if(q||!C?.isAdmin){console.debug("Admin check failed",{error:q,data:C,userId:r.id}),m.error("Access Denied: You don't have permission to access this page."),v(!1),D(!1);return}v(!0),D(!1)})()},[r,y]),j.useEffect(()=>{P&&(le(),ke())},[P]);const ke=async()=>{const{data:s,error:C}=await g.from("mentors").select("*").order("name");if(C){m.error("Failed to load mentors");return}Pe(s||[])},le=async()=>{const{data:s,error:C}=await g.from("pep_talks").select("*").order("created_at",{ascending:!1});if(C){m.error("Failed to load pep talks");return}E(s||[])},Ae=s=>{const C=s.target.files?.[0];C&&C.type.startsWith("audio/")?M(C):m.error("Please select a valid audio file")},Ee=async()=>{if(!$)return A.audio_url||null;a(!0);try{const s=$.name.split(".").pop(),q=`${`${Date.now()}.${s}`}`,{error:W,data:J}=await g.storage.from("pep-talk-audio").upload(q,$);if(W)throw W;const{data:{publicUrl:oe}}=g.storage.from("pep-talk-audio").getPublicUrl(q);return oe}catch(s){return console.error("Upload error:",s),m.error("Failed to upload audio file"),null}finally{a(!1)}},Te=async s=>{s.preventDefault(),o({...A,audioFile:$}),p(!0),R(!1)},$e=async()=>{a(!0);const s=await Ee();if(!s&&!A.audio_url){m.error("Please upload an audio file"),a(!1);return}const C={...A,audio_url:s||A.audio_url};if(S){const{error:q}=await g.from("pep_talks").update(C).eq("id",S);if(q){m.error("Failed to update pep talk"),a(!1);return}m.success("Pep talk updated successfully")}else{const{error:q}=await g.from("pep_talks").insert([C]);if(q){m.error("Failed to create pep talk"),a(!1);return}m.success("Pep talk created successfully")}p(!1),o(null),ne(),le(),a(!1)},Ie=()=>{p(!1),R(!0),m.info("Returned to editing")},Me=s=>{B({title:s.title,category:s.category,topic_category:s.topic_category||[],emotional_triggers:s.emotional_triggers||[],quote:s.quote,description:s.description,audio_url:s.audio_url,is_featured:s.is_featured,mentor_id:s.mentor_id||"",tags:s.tags||[],is_premium:s.is_premium||!1}),_(s.id),R(!0)},qe=async s=>{if(!confirm("Are you sure you want to delete this pep talk?"))return;const{error:C}=await g.from("pep_talks").delete().eq("id",s);if(C){m.error("Failed to delete pep talk");return}m.success("Pep talk deleted successfully"),le()},ne=()=>{B({title:"",category:"",topic_category:[],emotional_triggers:[],quote:"",description:"",audio_url:"",is_featured:!1,mentor_id:"",tags:[],is_premium:!1}),_(null),R(!1),p(!1),o(null),M(null)},De={atlas:"Let's take a breath, get clear, and move with purpose.",eli:"Hey, you're doing better than you think. Keep going.",sienna:"You're safe, you're growing, and you're allowed to take your time.",stryker:"Stand tall. Lock in. This is your moment to push.",carmen:"No excuses. Show me what you're made of.",reign:"Excellence isn't optional. Let's make today count.",solace:"Let your mind settle. Peace starts from within."},Re=async s=>{const C=De[s];if(!C){m.error("No preview text for this mentor");return}x(s);try{const{data:q,error:W}=await g.functions.invoke("generate-mentor-audio",{body:{mentorSlug:s,script:C}});if(W)throw W;if(gs.getMuted())x(null);else{const J=new Audio(q.audioUrl);J.play().catch(oe=>console.error("Audio play failed:",oe)),J.onended=()=>{x(null)}}}catch(q){console.error("Error previewing voice:",q),m.error(q.message||"Failed to preview voice"),x(null)}},Ue=s=>["Egg","Hatchling","Sproutling","Cub","Juvenile","Apprentice","Scout","Fledgling","Warrior","Guardian","Champion","Ascended","Vanguard","Titan","Mythic","Prime","Regal","Eternal","Transcendent","Apex","Ultimate Form"][s]||"Unknown",Le=async()=>{w(!0),me(null);try{const{data:s,error:C}=await g.functions.invoke("generate-sample-card",{body:{spiritAnimal:d.spiritAnimal,element:d.element,stage:d.stage,favoriteColor:d.favoriteColor,eyeColor:d.eyeColor||void 0,furColor:d.furColor||void 0,mind:d.mind,body:d.body,soul:d.soul,customName:d.customName||void 0}});if(C)throw C;me(s.card),m.success("Sample card generated!")}catch(s){console.error("Error generating sample card:",s),m.error(s.message||"Failed to generate sample card")}finally{w(!1)}},Ge=async()=>{xe(!0),he(null);try{let s=F.sourceImageUrl;if(!s){m.info("Generating companion image first...");const{data:W,error:J}=await g.functions.invoke("generate-companion-image",{body:{spiritAnimal:F.spiritAnimal,element:F.element,stage:5,favoriteColor:F.favoriteColor,eyeColor:F.eyeColor,furColor:F.furColor}});if(J)throw J;s=W.imageUrl,m.success("Companion image generated!")}m.info("Generating cosmic postcard...");const{data:C,error:q}=await g.functions.invoke("generate-cosmic-postcard-test",{body:{milestonePercent:F.milestonePercent,sourceImageUrl:s,companionData:{spirit_animal:F.spiritAnimal,core_element:F.element,favorite_color:F.favoriteColor,eye_color:F.eyeColor,fur_color:F.furColor}}});if(q)throw q;he({imageUrl:C.imageUrl,locationName:C.locationName,locationDescription:C.locationDescription,caption:C.caption}),m.success(`Postcard generated at ${C.locationName}!`)}catch(s){console.error("Error generating postcard:",s),m.error(s.message||"Failed to generate postcard")}finally{xe(!1)}};return T?e.jsx("div",{className:"min-h-screen bg-gradient-to-b from-cream-glow to-petal-pink/30 flex items-center justify-center",children:e.jsx("div",{className:"text-foreground text-xl",children:"Loading..."})}):P?e.jsx("div",{className:"min-h-screen bg-gradient-to-b from-cream-glow to-petal-pink/30 py-8 px-4",children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"font-heading text-4xl font-bold text-foreground mb-2",children:"Admin Panel"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage your pep talks"})]}),e.jsx("div",{className:"mb-8",children:e.jsx("div",{className:"bg-card/50 backdrop-blur-sm border border-border/50 rounded-3xl p-6 shadow-soft",children:e.jsxs("div",{className:"flex gap-4 mb-6 border-b border-border/50 pb-2",children:[e.jsx("button",{onClick:()=>{},className:"px-4 py-2 rounded-xl bg-primary text-primary-foreground",children:"Referral Codes"}),e.jsx("button",{onClick:()=>{},className:"px-4 py-2 rounded-xl hover:bg-muted",children:"Payouts"}),e.jsx("button",{onClick:()=>{},className:"px-4 py-2 rounded-xl hover:bg-muted",children:"Testing Suite"})]})})}),e.jsxs(G,{className:"p-6 mb-8 rounded-3xl shadow-soft",children:[e.jsx("h2",{className:"font-heading text-2xl font-semibold mb-4",children:"Voice Preview"}),e.jsx("p",{className:"text-muted-foreground mb-6",children:"Test each mentor's voice before generating content"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:re.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-2xl bg-card",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.name}),e.jsx("p",{className:"text-sm text-muted-foreground capitalize",children:s.slug})]}),e.jsx(N,{variant:"outline",size:"sm",onClick:()=>Re(s.slug),disabled:l===s.slug,className:"rounded-full",children:l===s.slug?e.jsx(U,{className:"h-4 w-4 animate-spin"}):e.jsx(ds,{className:"h-4 w-4"})})]},s.id))})]}),e.jsx(Cs,{}),e.jsxs(G,{className:"p-6 mb-8 rounded-3xl shadow-soft",children:[e.jsx("h2",{className:"font-heading text-2xl font-semibold mb-4",children:"ðŸƒ Sample Card Generator"}),e.jsx("p",{className:"text-muted-foreground mb-6",children:"Generate complete trading cards with images, names, traits, and lore"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(h,{htmlFor:"cardSpiritAnimal",children:"Spirit Animal"}),e.jsxs("select",{id:"cardSpiritAnimal",value:d.spiritAnimal,onChange:s=>k({...d,spiritAnimal:s.target.value}),className:"w-full p-3 min-h-[44px] border rounded-2xl bg-background text-base",children:[e.jsx("option",{value:"wolf",children:"Wolf"}),e.jsx("option",{value:"lion",children:"Lion"}),e.jsx("option",{value:"tiger",children:"Tiger"}),e.jsx("option",{value:"eagle",children:"Eagle"}),e.jsx("option",{value:"bear",children:"Bear"}),e.jsx("option",{value:"phoenix",children:"Phoenix"}),e.jsx("option",{value:"dragon",children:"Dragon"}),e.jsx("option",{value:"shark",children:"Shark"}),e.jsx("option",{value:"whale",children:"Whale"}),e.jsx("option",{value:"dolphin",children:"Dolphin"}),e.jsx("option",{value:"owl",children:"Owl"}),e.jsx("option",{value:"fox",children:"Fox"}),e.jsx("option",{value:"panther",children:"Panther"}),e.jsx("option",{value:"hawk",children:"Hawk"}),e.jsx("option",{value:"lynx",children:"Lynx"})]})]}),e.jsxs("div",{children:[e.jsx(h,{htmlFor:"cardElement",children:"Element"}),e.jsxs("select",{id:"cardElement",value:d.element,onChange:s=>k({...d,element:s.target.value}),className:"w-full p-3 min-h-[44px] border rounded-2xl bg-background text-base",children:[e.jsx("option",{value:"fire",children:"Fire"}),e.jsx("option",{value:"water",children:"Water"}),e.jsx("option",{value:"earth",children:"Earth"}),e.jsx("option",{value:"air",children:"Air"}),e.jsx("option",{value:"lightning",children:"Lightning"}),e.jsx("option",{value:"ice",children:"Ice"}),e.jsx("option",{value:"light",children:"Light"}),e.jsx("option",{value:"shadow",children:"Shadow"})]})]})]}),e.jsxs("div",{children:[e.jsxs(h,{htmlFor:"cardStage",children:["Evolution Stage: ",d.stage," - ",Ue(d.stage)]}),e.jsx("input",{type:"range",id:"cardStage",min:"0",max:"20",value:d.stage,onChange:s=>k({...d,stage:parseInt(s.target.value)}),className:"w-full h-10 cursor-pointer"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx(h,{htmlFor:"cardFavoriteColor",children:"Favorite Color"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(b,{type:"color",id:"cardFavoriteColor",value:d.favoriteColor,onChange:s=>k({...d,favoriteColor:s.target.value}),className:"w-16 h-12 rounded-2xl cursor-pointer"}),e.jsx(b,{type:"text",value:d.favoriteColor,onChange:s=>k({...d,favoriteColor:s.target.value}),className:"flex-1 rounded-2xl min-h-[44px] text-base"})]})]}),e.jsxs("div",{children:[e.jsx(h,{htmlFor:"cardEyeColor",children:"Eye Color (Optional)"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(b,{type:"color",id:"cardEyeColor",value:d.eyeColor,onChange:s=>k({...d,eyeColor:s.target.value}),className:"w-16 h-12 rounded-2xl cursor-pointer"}),e.jsx(b,{type:"text",value:d.eyeColor,onChange:s=>k({...d,eyeColor:s.target.value}),className:"flex-1 rounded-2xl min-h-[44px] text-base"})]})]}),e.jsxs("div",{children:[e.jsx(h,{htmlFor:"cardFurColor",children:"Fur/Scale Color (Optional)"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(b,{type:"color",id:"cardFurColor",value:d.furColor,onChange:s=>k({...d,furColor:s.target.value}),className:"w-16 h-12 rounded-2xl cursor-pointer"}),e.jsx(b,{type:"text",value:d.furColor,onChange:s=>k({...d,furColor:s.target.value}),className:"flex-1 rounded-2xl min-h-[44px] text-base"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 p-4 rounded-2xl bg-muted/50",children:[e.jsxs("div",{children:[e.jsxs(h,{htmlFor:"cardMind",children:["ðŸ§  Mind: ",d.mind]}),e.jsx("input",{type:"range",id:"cardMind",min:"0",max:"100",value:d.mind,onChange:s=>k({...d,mind:parseInt(s.target.value)}),className:"w-full h-8 cursor-pointer"})]}),e.jsxs("div",{children:[e.jsxs(h,{htmlFor:"cardBody",children:["ðŸ’ª Body: ",d.body]}),e.jsx("input",{type:"range",id:"cardBody",min:"0",max:"100",value:d.body,onChange:s=>k({...d,body:parseInt(s.target.value)}),className:"w-full h-8 cursor-pointer"})]}),e.jsxs("div",{children:[e.jsxs(h,{htmlFor:"cardSoul",children:["ðŸ”¥ Soul: ",d.soul]}),e.jsx("input",{type:"range",id:"cardSoul",min:"0",max:"100",value:d.soul,onChange:s=>k({...d,soul:parseInt(s.target.value)}),className:"w-full h-8 cursor-pointer"})]})]}),e.jsxs("div",{children:[e.jsx(h,{htmlFor:"cardCustomName",children:"Custom Name (Optional - leave blank for auto-generated)"}),e.jsx(b,{type:"text",id:"cardCustomName",value:d.customName,onChange:s=>k({...d,customName:s.target.value}),placeholder:"Leave blank for AI to generate a name",className:"rounded-2xl min-h-[44px] text-base"})]}),e.jsx(N,{onClick:Le,disabled:i,className:"w-full rounded-2xl min-h-[48px] text-base",children:i?e.jsxs(e.Fragment,{children:[e.jsx(U,{className:"h-5 w-5 mr-2 animate-spin"}),"Generating Card... (this may take a moment)"]}):"ðŸƒ Generate Sample Card"}),I&&e.jsxs("div",{className:"space-y-4 p-4 md:p-6 border rounded-2xl bg-card",children:[e.jsx("div",{className:"flex justify-center",children:e.jsx(ps,{card:I})}),e.jsx("div",{className:"text-center text-sm text-muted-foreground",children:"Click the card to view full size â€¢ Click again to flip and see lore"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm text-muted-foreground bg-muted/30 rounded-xl p-3",children:[e.jsxs("div",{children:["Rarity: ",e.jsx("span",{className:"font-semibold text-foreground",children:I.rarity})]}),e.jsxs("div",{children:["Energy Cost: ",e.jsx("span",{className:"font-semibold text-foreground",children:I.energy_cost})]}),e.jsxs("div",{children:["Bond Level: ",e.jsx("span",{className:"font-semibold text-foreground",children:I.bond_level})]}),e.jsxs("div",{children:["Card ID: ",e.jsx("span",{className:"font-mono text-xs text-foreground",children:I.card_id})]})]})]})]})]}),e.jsxs(G,{className:"p-4 md:p-6 mb-8 rounded-3xl shadow-soft bg-card",children:[e.jsx("h2",{className:"font-heading text-xl font-semibold mb-2",children:"ðŸ“¸ Cosmic Postcard Tester"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-6",children:"Test the cosmic postcard generation system. Optionally provide a source image URL, or leave blank to generate a companion image first."}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(h,{htmlFor:"postcardAnimal",children:"Spirit Animal"}),e.jsxs("select",{id:"postcardAnimal",value:F.spiritAnimal,onChange:s=>z({...F,spiritAnimal:s.target.value}),className:"w-full p-3 min-h-[44px] border rounded-2xl bg-background text-base",children:[e.jsx("option",{value:"wolf",children:"Wolf"}),e.jsx("option",{value:"fox",children:"Fox"}),e.jsx("option",{value:"tiger",children:"Tiger"}),e.jsx("option",{value:"lion",children:"Lion"}),e.jsx("option",{value:"bear",children:"Bear"}),e.jsx("option",{value:"eagle",children:"Eagle"}),e.jsx("option",{value:"owl",children:"Owl"}),e.jsx("option",{value:"dragon",children:"Dragon"}),e.jsx("option",{value:"phoenix",children:"Phoenix"}),e.jsx("option",{value:"dolphin",children:"Dolphin"}),e.jsx("option",{value:"whale",children:"Whale"}),e.jsx("option",{value:"rabbit",children:"Rabbit"}),e.jsx("option",{value:"deer",children:"Deer"}),e.jsx("option",{value:"cat",children:"Cat"}),e.jsx("option",{value:"dog",children:"Dog"})]})]}),e.jsxs("div",{children:[e.jsx(h,{htmlFor:"postcardElement",children:"Element"}),e.jsxs("select",{id:"postcardElement",value:F.element,onChange:s=>z({...F,element:s.target.value}),className:"w-full p-3 min-h-[44px] border rounded-2xl bg-background text-base",children:[e.jsx("option",{value:"fire",children:"Fire"}),e.jsx("option",{value:"water",children:"Water"}),e.jsx("option",{value:"earth",children:"Earth"}),e.jsx("option",{value:"air",children:"Air"}),e.jsx("option",{value:"lightning",children:"Lightning"}),e.jsx("option",{value:"ice",children:"Ice"}),e.jsx("option",{value:"light",children:"Light"}),e.jsx("option",{value:"shadow",children:"Shadow"})]})]})]}),e.jsxs("div",{children:[e.jsxs(h,{htmlFor:"postcardMilestone",children:["Milestone: ",F.milestonePercent,"%"]}),e.jsx("div",{className:"flex gap-2 mt-2",children:[25,50,75,100].map(s=>e.jsxs(N,{variant:F.milestonePercent===s?"default":"outline",onClick:()=>z({...F,milestonePercent:s}),className:"flex-1 rounded-xl",children:[s,"%"]},s))})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx(h,{htmlFor:"postcardFavoriteColor",children:"Favorite Color"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(b,{type:"color",id:"postcardFavoriteColor",value:F.favoriteColor,onChange:s=>z({...F,favoriteColor:s.target.value}),className:"w-16 h-12 rounded-2xl cursor-pointer"}),e.jsx(b,{type:"text",value:F.favoriteColor,onChange:s=>z({...F,favoriteColor:s.target.value}),className:"flex-1 rounded-2xl min-h-[44px] text-base"})]})]}),e.jsxs("div",{children:[e.jsx(h,{htmlFor:"postcardEyeColor",children:"Eye Color"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(b,{type:"color",id:"postcardEyeColor",value:F.eyeColor,onChange:s=>z({...F,eyeColor:s.target.value}),className:"w-16 h-12 rounded-2xl cursor-pointer"}),e.jsx(b,{type:"text",value:F.eyeColor,onChange:s=>z({...F,eyeColor:s.target.value}),className:"flex-1 rounded-2xl min-h-[44px] text-base"})]})]}),e.jsxs("div",{children:[e.jsx(h,{htmlFor:"postcardFurColor",children:"Fur/Scale Color"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(b,{type:"color",id:"postcardFurColor",value:F.furColor,onChange:s=>z({...F,furColor:s.target.value}),className:"w-16 h-12 rounded-2xl cursor-pointer"}),e.jsx(b,{type:"text",value:F.furColor,onChange:s=>z({...F,furColor:s.target.value}),className:"flex-1 rounded-2xl min-h-[44px] text-base"})]})]})]}),e.jsxs("div",{children:[e.jsx(h,{htmlFor:"postcardSourceUrl",children:"Source Image URL (Optional - leave blank to generate companion first)"}),e.jsx(b,{type:"text",id:"postcardSourceUrl",value:F.sourceImageUrl,onChange:s=>z({...F,sourceImageUrl:s.target.value}),placeholder:"https://... or leave blank",className:"rounded-2xl min-h-[44px] text-base"})]}),e.jsx(N,{onClick:Ge,disabled:ue,className:"w-full rounded-2xl min-h-[48px] text-base",children:ue?e.jsxs(e.Fragment,{children:[e.jsx(U,{className:"h-5 w-5 mr-2 animate-spin"}),"Generating Postcard... (this may take a moment)"]}):"ðŸ“¸ Generate Cosmic Postcard"}),H&&e.jsxs("div",{className:"space-y-4 p-4 md:p-6 border rounded-2xl bg-card",children:[e.jsx("div",{className:"relative aspect-[4/3] rounded-xl overflow-hidden",children:e.jsx("img",{src:H.imageUrl,alt:`Postcard from ${H.locationName}`,className:"w-full h-full object-cover"})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"font-semibold text-lg",children:H.locationName}),e.jsx("p",{className:"text-sm text-muted-foreground",children:H.locationDescription}),e.jsx("p",{className:"text-sm italic",children:H.caption})]}),e.jsx("div",{className:"flex gap-2",children:e.jsxs(N,{variant:"outline",onClick:()=>Fe(H.imageUrl,`postcard-${H.locationName.replace(/\s+/g,"-").toLowerCase()}.png`),className:"flex-1 rounded-xl",children:[e.jsx(Se,{className:"h-4 w-4 mr-2"}),"Download"]})})]})]})]}),e.jsx("div",{className:"mb-8",children:e.jsxs(N,{onClick:()=>R(!0),className:"flex items-center gap-2",children:[e.jsx(_e,{className:"h-4 w-4"}),"Create New Pep Talk"]})}),O&&e.jsxs(G,{className:"p-6 mb-8 rounded-3xl shadow-soft",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"font-heading text-2xl font-semibold",children:S?"Edit Pep Talk":"Create New Pep Talk"}),e.jsx(N,{variant:"ghost",size:"icon",onClick:ne,className:"rounded-full",children:e.jsx(ge,{className:"h-5 w-5"})})]}),e.jsxs("form",{onSubmit:Te,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(h,{htmlFor:"title",children:"Title"}),e.jsx(b,{id:"title",value:A.title,onChange:s=>B({...A,title:s.target.value}),maxLength:200,required:!0,className:"rounded-2xl"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(h,{htmlFor:"category",children:"Category (Legacy)"}),e.jsx(b,{id:"category",value:A.category,onChange:s=>B({...A,category:s.target.value}),placeholder:"e.g., daily, heartbreak",maxLength:50,className:"rounded-2xl"})]}),e.jsxs("div",{children:[e.jsx(h,{htmlFor:"mentor",children:"Mentor"}),e.jsxs("select",{id:"mentor",value:A.mentor_id,onChange:s=>B({...A,mentor_id:s.target.value}),className:"w-full h-10 px-3 rounded-2xl border border-input bg-background",children:[e.jsx("option",{value:"",children:"No specific mentor"}),re.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]})]}),e.jsxs("div",{children:[e.jsx(h,{htmlFor:"topic-category",children:"Topic Categories (up to 4)"}),e.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:["discipline","confidence","physique","focus","mindset","business"].map(s=>{const C=s.charAt(0).toUpperCase()+s.slice(1);return e.jsx(N,{type:"button",variant:A.topic_category.includes(s)?"default":"outline",size:"sm",onClick:()=>{const q=A.topic_category;q.includes(s)?B({...A,topic_category:q.filter(W=>W!==s)}):q.length<4?B({...A,topic_category:[...q,s]}):m.error("Maximum 4 categories allowed")},className:"rounded-full text-xs",children:C},s)})}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Selected: ",A.topic_category.length,"/4"]})]}),e.jsxs("div",{children:[e.jsx(h,{children:"Emotional Triggers (Optional)"}),e.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:["Exhausted","Avoiding Action","Anxious & Overthinking","Self-Doubt","Feeling Stuck","Frustrated","Heavy or Low","Emotionally Hurt","Unmotivated","In Transition","Needing Discipline","Motivated & Ready"].map(s=>e.jsx(N,{type:"button",variant:A.emotional_triggers.includes(s)?"default":"outline",size:"sm",onClick:()=>{const C=A.emotional_triggers.includes(s)?A.emotional_triggers.filter(q=>q!==s):[...A.emotional_triggers,s];B({...A,emotional_triggers:C})},className:"rounded-full text-xs",children:s},s))})]}),e.jsxs("div",{children:[e.jsx(h,{htmlFor:"quote",children:"Quote"}),e.jsx(te,{id:"quote",value:A.quote,onChange:s=>B({...A,quote:s.target.value}),maxLength:500,required:!0,className:"rounded-2xl min-h-24"})]}),e.jsxs("div",{children:[e.jsx(h,{htmlFor:"description",children:"Description"}),e.jsx(te,{id:"description",value:A.description,onChange:s=>B({...A,description:s.target.value}),maxLength:1e3,required:!0,className:"rounded-2xl min-h-24"})]}),e.jsxs("div",{children:[e.jsx(h,{htmlFor:"audio",children:"Audio File (MP3)"}),e.jsxs("div",{className:"mt-2",children:[e.jsx(b,{id:"audio",type:"file",accept:"audio/*",onChange:Ae,className:"rounded-2xl"}),$&&e.jsxs("p",{className:"text-sm text-muted-foreground mt-2",children:["Selected: ",$.name]}),A.audio_url&&!$&&e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"Current audio uploaded"})]})]}),e.jsxs("div",{children:[e.jsx(h,{htmlFor:"tags",children:"Tags (comma separated)"}),e.jsx(b,{id:"tags",value:A.tags.join(", "),onChange:s=>B({...A,tags:s.target.value.split(",").map(C=>C.trim()).filter(Boolean)}),placeholder:"discipline, focus, motivation",className:"rounded-2xl"})]}),e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ne,{id:"featured",checked:A.is_featured,onCheckedChange:s=>B({...A,is_featured:s})}),e.jsx(h,{htmlFor:"featured",children:"Featured"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ne,{id:"premium",checked:A.is_premium,onCheckedChange:s=>B({...A,is_premium:s})}),e.jsx(h,{htmlFor:"premium",children:"Premium"})]})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsxs(N,{type:"submit",className:"flex-1 rounded-full bg-gradient-to-r from-blush-rose to-lavender-mist hover:shadow-glow transition-all",children:["Preview ",S?"Update":"Creation"]}),e.jsx(N,{type:"button",variant:"outline",onClick:ne,className:"rounded-full",children:"Cancel"})]})]})]}),L&&u&&e.jsxs(G,{className:"p-6 mb-8 rounded-3xl shadow-soft border-2 border-royal-purple",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"font-heading text-2xl font-semibold text-royal-purple",children:"Preview: Approve Before Saving"}),e.jsx(N,{variant:"ghost",size:"icon",onClick:()=>{p(!1),R(!0)},className:"rounded-full",children:e.jsx(ge,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx(h,{className:"text-muted-foreground",children:"Title"}),e.jsx("p",{className:"text-lg font-semibold mt-1",children:u.title})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(h,{className:"text-muted-foreground",children:"Category"}),e.jsx("p",{className:"text-sm mt-1 uppercase font-medium",children:u.category})]}),e.jsxs("div",{children:[e.jsx(h,{className:"text-muted-foreground",children:"Mentor"}),e.jsx("p",{className:"text-sm mt-1",children:u.mentor_id?re.find(s=>s.id===u.mentor_id)?.name||"Unknown":"No specific mentor"})]})]}),e.jsxs("div",{children:[e.jsx(h,{className:"text-muted-foreground",children:"Quote / Script"}),e.jsx("p",{className:"text-base mt-1 italic",children:u.quote})]}),e.jsxs("div",{children:[e.jsx(h,{className:"text-muted-foreground",children:"Description"}),e.jsx("p",{className:"text-base mt-1",children:u.description})]}),u.tags&&u.tags.length>0&&e.jsxs("div",{children:[e.jsx(h,{className:"text-muted-foreground",children:"Tags"}),e.jsx("div",{className:"flex flex-wrap gap-2 mt-1",children:u.tags.map((s,C)=>e.jsxs("span",{className:"px-3 py-1 bg-royal-purple/10 text-royal-purple rounded-full text-sm",children:["#",s]},C))})]}),e.jsxs("div",{children:[e.jsx(h,{className:"text-muted-foreground",children:"Audio Preview"}),u.audio_url?e.jsx("audio",{controls:!0,className:"w-full mt-2 rounded-2xl",src:u.audio_url,children:"Your browser does not support the audio element."}):u.audioFile?e.jsx("audio",{controls:!0,className:"w-full mt-2 rounded-2xl",src:URL.createObjectURL(u.audioFile),children:"Your browser does not support the audio element."}):e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"No audio available"})]}),e.jsxs("div",{className:"flex gap-4",children:[u.is_featured&&e.jsx("div",{className:"flex items-center gap-2 px-3 py-1 bg-amber-500/10 text-amber-600 rounded-full text-sm",children:e.jsx("span",{className:"font-medium",children:"â­ Featured"})}),u.is_premium&&e.jsx("div",{className:"flex items-center gap-2 px-3 py-1 bg-purple-500/10 text-purple-600 rounded-full text-sm",children:e.jsx("span",{className:"font-medium",children:"ðŸ’Ž Premium"})})]}),e.jsxs("div",{className:"flex gap-3 pt-6 border-t",children:[e.jsx(N,{onClick:$e,disabled:t,className:"flex-1 rounded-full bg-green-600 hover:bg-green-700 text-white",children:t?e.jsxs(e.Fragment,{children:[e.jsx(U,{className:"h-4 w-4 mr-2 animate-spin"}),"Saving..."]}):e.jsx(e.Fragment,{children:"âœ“ Approve & Save to Catalog"})}),e.jsx(N,{onClick:Ie,disabled:t,variant:"outline",className:"rounded-full border-red-500 text-red-500 hover:bg-red-50",children:"âœ— Edit More"})]})]})]}),e.jsxs("div",{className:"space-y-6 mb-8",children:[e.jsx(ys,{}),e.jsx(Ns,{}),e.jsx(js,{}),e.jsx(fs,{}),e.jsx(vs,{})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h2",{className:"font-heading text-2xl font-semibold text-foreground",children:["All Pep Talks (",f.length,")"]}),f.map(s=>e.jsx(G,{className:"p-5 rounded-3xl shadow-soft",children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"text-xs font-medium text-muted-foreground uppercase",children:s.category}),s.is_featured&&e.jsx("span",{className:"text-xs px-2 py-0.5 rounded-full bg-gold-accent/20 text-warm-charcoal font-medium",children:"Featured"})]}),e.jsx("h3",{className:"font-heading text-lg font-semibold text-foreground mb-1",children:s.title}),e.jsx("p",{className:"text-sm text-muted-foreground line-clamp-2",children:s.description})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(N,{variant:"ghost",size:"icon",onClick:()=>Me(s),className:"rounded-full hover:bg-secondary",children:e.jsx(cs,{className:"h-4 w-4"})}),e.jsx(N,{variant:"ghost",size:"icon",onClick:()=>qe(s.id),className:"rounded-full hover:bg-destructive/10 hover:text-destructive",children:e.jsx(Ce,{className:"h-4 w-4"})})]})]})},s.id)),f.length===0&&e.jsxs(G,{className:"p-12 text-center rounded-3xl shadow-soft",children:[e.jsx(ms,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"No pep talks yet. Create your first one!"})]})]})]})}):null};export{ks as default};
