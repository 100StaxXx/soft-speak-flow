import{r as a,j as t,l as de,m as R}from"./vendor-CkzXtEGd.js";import{bs as J,bt as _t,bu as Rt,bv as Ot}from"./index-B9iotTKE.js";import{t as _}from"./gameUtils-BnwM_CJ4.js";import"./date-vendor-CuPqBTxb.js";import"./three-vendor-qI8GXUTd.js";const Bt={beginner:{targetMod:.5,timeMod:1.5},easy:{targetMod:.7,timeMod:1.3},medium:{targetMod:1,timeMod:1},hard:{targetMod:1.4,timeMod:.85},master:{targetMod:2,timeMod:.7}},He=(c,l)=>{const f=500+(c-1)*300,g=Math.max(30,60-(c-1)*2.5),x=Math.min(6,4+Math.floor(c/4)),C=Math.max(4,10-Math.floor(c/3)),H=Math.min(.3,c*.02);return{targetScore:Math.round(f*l.targetMod),timeLimit:Math.round(g*l.timeMod),colors:x,moveTime:C,specialSpawnBonus:H}},w=5,y=6,Ye=c=>{for(let l=0;l<w;l++)for(let f=0;f<y-2;f++){const g=c[l][f],x=c[l][f+1],C=c[l][f+2];if(g&&x&&C&&g.color===x.color&&x.color===C.color)return!0}for(let l=0;l<y;l++)for(let f=0;f<w-2;f++){const g=c[f][l],x=c[f+1][l],C=c[f+2][l];if(g&&x&&C&&g.color===x.color&&x.color===C.color)return!0}return!1},Xe={fire:"â—",water:"â—†",earth:"â– ",light:"â˜…",dark:"â–²",cosmic:"âœ¦"},me={fire:{gradient:"linear-gradient(135deg, #ff6b6b 0%, #ee5a24 50%, #ff4757 100%)",glow:"rgba(255, 107, 107, 0.6)",inner:"rgba(255, 200, 150, 0.4)",emoji:"ðŸ”¥"},water:{gradient:"linear-gradient(135deg, #4facfe 0%, #00cec9 50%, #0984e3 100%)",glow:"rgba(79, 172, 254, 0.6)",inner:"rgba(200, 240, 255, 0.4)",emoji:"ðŸ’§"},earth:{gradient:"linear-gradient(135deg, #00b894 0%, #55a630 50%, #2d6a4f 100%)",glow:"rgba(0, 184, 148, 0.6)",inner:"rgba(200, 255, 220, 0.4)",emoji:"ðŸŒ¿"},light:{gradient:"linear-gradient(135deg, #ffd93d 0%, #ff9f1c 50%, #f9a825 100%)",glow:"rgba(255, 217, 61, 0.6)",inner:"rgba(255, 255, 220, 0.5)",emoji:"âœ¨"},dark:{gradient:"linear-gradient(135deg, #a855f7 0%, #7c3aed 50%, #6366f1 100%)",glow:"rgba(168, 85, 247, 0.6)",inner:"rgba(220, 200, 255, 0.4)",emoji:"ðŸŒ™"},cosmic:{gradient:"linear-gradient(135deg, #f472b6 0%, #ec4899 50%, #e11d48 100%)",glow:"rgba(244, 114, 182, 0.6)",inner:"rgba(255, 200, 230, 0.4)",emoji:"ðŸ’«"}},Fe=a.memo(({intensity:c=.7})=>t.jsxs("div",{className:"absolute inset-0 overflow-hidden pointer-events-none",children:[t.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-purple-500/5 via-transparent to-cyan-500/5"}),t.jsx("div",{className:"stars-layer",style:{opacity:c}})]}));Fe.displayName="StarBackground";const ze=a.memo(({explosion:c,onComplete:l})=>(a.useEffect(()=>{const f=setTimeout(l,400);return()=>clearTimeout(f)},[l]),t.jsxs("div",{className:"absolute pointer-events-none z-50 explosion-effect",style:{left:c.x,top:c.y,"--explosion-color":c.color},children:[t.jsx("div",{className:"explosion-ring",style:{borderColor:c.color}}),t.jsxs("div",{className:"explosion-score",style:{color:c.color},children:["+",c.score]})]})));ze.displayName="MatchExplosionEffect";const Ve=a.memo(({multiplier:c})=>t.jsx("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 z-50 pointer-events-none cascade-popup",children:t.jsxs("span",{className:"text-4xl font-black text-yellow-400 drop-shadow-glow",children:["x",c,"!"]})}));Ve.displayName="CascadeMultiplier";const We=a.memo(({orbs:c,cellSize:l})=>t.jsx(t.Fragment,{children:c.map((f,g)=>t.jsx("div",{className:"absolute rounded-full pointer-events-none z-40 hint-pulse",style:{width:l-12,height:l-12,left:f.col*l+6,top:f.row*l+6}},g))}));We.displayName="HintIndicator";const Je=a.memo(({progress:c,isComplete:l})=>{const g=2*Math.PI*18,x=g*(1-Math.min(1,c));return t.jsxs("svg",{className:"absolute -right-1 -top-1",width:"44",height:"44",viewBox:"0 0 44 44",children:[t.jsx("circle",{cx:"22",cy:"22",r:18,fill:"none",stroke:"rgba(255,255,255,0.1)",strokeWidth:"3"}),t.jsx("circle",{cx:"22",cy:"22",r:18,fill:"none",stroke:l?"#22c55e":"#a855f7",strokeWidth:"3",strokeLinecap:"round",strokeDasharray:g,strokeDashoffset:x,className:"transition-all duration-200",style:{transform:"rotate(-90deg)",transformOrigin:"center"}})]})});Je.displayName="ScoreProgressRing";const Ke=a.memo(()=>t.jsx("div",{className:"absolute inset-0 pointer-events-none z-30 rounded-2xl urgency-pulse"}));Ke.displayName="UrgencyOverlay";const Qe=a.memo(()=>t.jsx("div",{className:"absolute inset-0 flex items-center justify-center z-50 pointer-events-none perfect-banner",children:t.jsx("div",{className:"px-8 py-4 rounded-2xl bg-yellow-500/20 border-2 border-yellow-500/60 shadow-glow-yellow",children:t.jsx("span",{className:"text-2xl font-black text-yellow-400 drop-shadow-glow",children:"â­ PERFECT! +50 â­"})})}));Qe.displayName="PerfectGameBanner";const Ze=a.memo(()=>t.jsxs("div",{className:"absolute inset-0 flex items-center justify-center z-50 bg-black/50 rounded-2xl",children:[t.jsx("span",{className:"text-4xl animate-spin",children:"ðŸ”€"}),t.jsx("span",{className:"ml-3 text-lg font-bold text-white",children:"Shuffling..."})]}));Ze.displayName="ShuffleOverlay";const qe=a.memo(({level:c,levelScore:l,timeBonus:f,totalScore:g,onContinue:x})=>(a.useEffect(()=>{const C=setTimeout(x,2500);return()=>clearTimeout(C)},[x]),t.jsx(R.div,{className:"absolute inset-0 flex flex-col items-center justify-center z-50 bg-black/70 rounded-2xl backdrop-blur-sm",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:t.jsxs(R.div,{initial:{scale:0,rotate:-10},animate:{scale:1,rotate:0},transition:{type:"spring",damping:15},className:"text-center",children:[t.jsx("div",{className:"text-4xl mb-2",children:"ðŸŽ‰"}),t.jsxs("h2",{className:"text-2xl font-black text-yellow-400 mb-1 drop-shadow-glow",children:["LEVEL ",c," COMPLETE!"]}),t.jsxs("div",{className:"space-y-1 text-sm",children:[t.jsxs("p",{className:"text-white/80",children:["Level Score: ",t.jsxs("span",{className:"text-green-400 font-bold",children:["+",l]})]}),t.jsxs("p",{className:"text-white/80",children:["Time Bonus: ",t.jsxs("span",{className:"text-cyan-400 font-bold",children:["+",f]})]}),t.jsxs("p",{className:"text-white/60 text-xs mt-2",children:["Total: ",t.jsx("span",{className:"text-purple-400 font-bold",children:g})]})]}),t.jsx(R.div,{className:"mt-4 px-4 py-2 bg-purple-500/30 rounded-full border border-purple-400/50",initial:{opacity:0},animate:{opacity:1},transition:{delay:1},children:t.jsx("span",{className:"text-sm text-purple-200",children:"Next level starting..."})})]})})));qe.displayName="LevelCompleteOverlay";const et=a.memo(({level:c,progress:l,targetScore:f})=>t.jsx("div",{className:"absolute left-1 top-1 z-40",children:t.jsxs("div",{className:"flex items-center gap-1.5 px-2 py-1 bg-black/60 rounded-full border border-purple-500/40 backdrop-blur-sm",children:[t.jsx("span",{className:"text-[10px] font-bold text-purple-400",children:"LVL"}),t.jsx("span",{className:"text-base font-black text-white",children:c}),t.jsx("div",{className:"w-10 h-1 bg-white/10 rounded-full overflow-hidden",children:t.jsx("div",{className:"h-full bg-gradient-to-r from-purple-500 to-pink-500 transition-all duration-200",style:{width:`${Math.min(100,l*100)}%`}})})]})}));et.displayName="LevelIndicator";const tt=a.memo(()=>t.jsx(R.div,{className:"absolute inset-0 flex items-center justify-center z-50 pointer-events-none",initial:{opacity:0,scale:.5},animate:{opacity:[0,1,1,0],scale:[.5,1.2,1,1]},transition:{duration:1,times:[0,.3,.7,1]},children:t.jsx("div",{className:"px-8 py-4 rounded-2xl bg-gradient-to-r from-purple-500/40 to-pink-500/40 border-2 border-purple-400/60 shadow-glow-purple",children:t.jsx("span",{className:"text-3xl font-black text-transparent bg-clip-text bg-gradient-to-r from-yellow-400 to-pink-400",children:"â¬†ï¸ LEVEL UP! â¬†ï¸"})})}));tt.displayName="LevelUpBanner";const ot=a.memo(({effect:c,cellSize:l,onComplete:f})=>{a.useEffect(()=>{const x=setTimeout(f,400);return()=>clearTimeout(x)},[f]);const g=c.type==="beam_horizontal";return t.jsx(R.div,{className:"absolute z-50 pointer-events-none",initial:{opacity:0,scaleX:g?0:1,scaleY:g?1:0},animate:{opacity:1,scaleX:1,scaleY:1},exit:{opacity:0},style:{background:"linear-gradient(90deg, transparent, rgba(255,255,255,0.9), transparent)",height:g?6:l*w,width:g?l*y:6,top:g?c.row*l+l/2-3:0,left:g?0:c.col*l+l/2-3,boxShadow:"0 0 20px rgba(255,255,255,0.8), 0 0 40px rgba(168,85,247,0.6)"}})});ot.displayName="BeamEffect";const at=a.memo(({effect:c,cellSize:l,onComplete:f})=>(a.useEffect(()=>{const g=setTimeout(f,500);return()=>clearTimeout(g)},[f]),t.jsxs(t.Fragment,{children:[t.jsx(R.div,{className:"absolute z-50 pointer-events-none",initial:{opacity:0,scaleX:0},animate:{opacity:1,scaleX:1},exit:{opacity:0},style:{background:"linear-gradient(90deg, transparent, rgba(255,215,0,0.9), transparent)",height:6,width:l*y,top:c.row*l+l/2-3,left:0,boxShadow:"0 0 20px rgba(255,215,0,0.8)"}}),t.jsx(R.div,{className:"absolute z-50 pointer-events-none",initial:{opacity:0,scaleY:0},animate:{opacity:1,scaleY:1},exit:{opacity:0},style:{background:"linear-gradient(180deg, transparent, rgba(255,215,0,0.9), transparent)",height:l*w,width:6,top:0,left:c.col*l+l/2-3,boxShadow:"0 0 20px rgba(255,215,0,0.8)"}})]})));at.displayName="CrossBeamEffect";const st=a.memo(({effect:c,cellSize:l,onComplete:f})=>(a.useEffect(()=>{const g=setTimeout(f,600);return()=>clearTimeout(g)},[f]),t.jsx(R.div,{className:"absolute z-50 pointer-events-none",initial:{scale:0,opacity:1},animate:{scale:4,opacity:0},transition:{duration:.6},style:{width:l,height:l,left:c.col*l,top:c.row*l,background:`radial-gradient(circle, ${c.color||"rgba(255,215,0,0.8)"}, transparent)`,borderRadius:"50%"}})));st.displayName="ColorBurstEffect";const rt=a.memo(({effect:c,cellSize:l,onComplete:f})=>(a.useEffect(()=>{const g=setTimeout(f,700);return()=>clearTimeout(g)},[f]),t.jsxs(t.Fragment,{children:[t.jsx(R.div,{className:"absolute rounded-full z-50 pointer-events-none",initial:{scale:0,opacity:1},animate:{scale:5,opacity:0},transition:{duration:.7},style:{width:l*3,height:l*3,left:c.col*l-l,top:c.row*l-l,background:"radial-gradient(circle, rgba(255,255,255,0.9), rgba(168,85,247,0.6), rgba(236,72,153,0.4), transparent)"}}),[...Array(8)].map((g,x)=>t.jsx(R.div,{className:"absolute z-50 pointer-events-none",initial:{scale:0,opacity:1,x:0,y:0},animate:{scale:[0,1,.5],opacity:[1,.8,0],x:Math.cos(x*Math.PI/4)*l*2,y:Math.sin(x*Math.PI/4)*l*2},transition:{duration:.5},style:{width:12,height:12,borderRadius:"50%",background:"white",left:c.col*l+l/2-6,top:c.row*l+l/2-6,boxShadow:"0 0 10px rgba(255,255,255,0.8)"}},x))]})));rt.displayName="CosmicNovaEffect";const nt=a.memo(({orb:c,cellSize:l,isSelected:f,isDragging:g,isInPath:x,isReverting:C,showAccessibility:H})=>{const T=me[c.color],D=l-8,k=(()=>{switch(c.special){case"line_bomb":return{border:"3px dashed rgba(255,255,255,0.9)",animation:"special-pulse 1s infinite",icon:"âž–"};case"star":return{border:"3px solid gold",animation:"special-rainbow 1.5s infinite",icon:"â˜…"};case"cross_bomb":return{border:"3px double rgba(255,215,0,0.9)",animation:"special-rotate 2s linear infinite",icon:"âœš"};case"cosmic_nova":return{border:"4px solid magenta",animation:"special-nova 0.8s infinite",icon:"âœ¦"};default:return{border:"2px solid rgba(255,255,255,0.25)",animation:void 0,icon:null}}})(),E=c.col*l+(l-D)/2,P=c.row*l+(l-D)/2,Y=c.matched?0:f?1.15:x?1.08:1;return t.jsxs("div",{className:`absolute rounded-full flex items-center justify-center orb-base ${f?"z-30":x?"z-20":"z-10"} ${c.matched?"orb-matched":""} ${c.isNew?"orb-new":""} ${C?"orb-revert":""}`,style:{width:D,height:D,background:T.gradient,border:k.border,transform:`translate(${E}px, ${P}px) scale(${Y})`,boxShadow:f||x?`0 8px 20px rgba(0,0,0,0.4), 0 0 15px ${T.glow}`:c.special!=="normal"?`0 4px 15px rgba(0,0,0,0.4), 0 0 20px ${T.glow}, 0 0 30px ${c.special==="cosmic_nova"?"rgba(236,72,153,0.5)":"rgba(255,215,0,0.3)"}`:`0 4px 10px rgba(0,0,0,0.3), 0 0 10px ${T.glow}`,animation:k.animation,"--start-y":`${-l*2}px`},children:[t.jsx("div",{className:"absolute rounded-full pointer-events-none",style:{width:"60%",height:"60%",top:"10%",left:"20%",background:`radial-gradient(circle at 30% 30%, ${T.inner}, transparent 70%)`}}),t.jsx("span",{className:"text-base select-none relative z-10 drop-shadow-sm",children:H?Xe[c.color]:T.emoji}),k.icon&&t.jsx("span",{className:"absolute -top-1 -right-1 text-xs bg-black/60 rounded-full w-4 h-4 flex items-center justify-center z-20",children:k.icon}),(f||x)&&t.jsx("div",{className:"absolute inset-[-3px] rounded-full pointer-events-none selection-ring",style:{borderColor:T.glow,boxShadow:`0 0 10px ${T.glow}`}})]})});nt.displayName="OrbComponent";const Ut=({companionStats:c,onComplete:l,onDamage:f,tierAttackDamage:g,difficulty:x="medium",questIntervalScale:C=0,maxTimer:H,isPractice:T=!1,compact:D=!1})=>{const[b,k]=a.useState("countdown"),[E,P]=a.useState([]),[Y,Z]=a.useState(null),[ue,q]=a.useState([]),[X,pe]=a.useState(0),[O,K]=a.useState(0),[S,ye]=a.useState(0),[fe,it]=a.useState(0),[B,lt]=a.useState(1),[A,ct]=a.useState(0),[dt,mt]=a.useState(0),[he,ut]=a.useState(0),[pt,ve]=a.useState(!1),[ft,je]=a.useState(0),[ge,ht]=a.useState(0),[Me,Ne]=a.useState(0),[gt,Ce]=a.useState(!1),[xt,ke]=a.useState([]),[Se,ee]=a.useState(null),[xe,Te]=a.useState(!1),[bt,wt]=a.useState(!1),[yt,Ee]=a.useState(new Set),[te,vt]=a.useState(!1),[jt,$e]=a.useState([]),be=a.useRef(null),F=a.useRef(null),Q=a.useRef(null),G=a.useRef(!1),U=a.useRef(E),oe=a.useRef(null);a.useEffect(()=>{U.current=E},[E]);const Le=c.soul/100,ae=Bt[x],j=a.useMemo(()=>{const e=He(B,ae);return{...e,moveTime:Math.max(3,e.moveTime-C*.5+Le*1.5)}},[B,ae,C,Le]),we=H??j.timeLimit,z=a.useMemo(()=>["fire","water","earth","light","dark","cosmic"].slice(0,j.colors),[j.colors]),$=a.useMemo(()=>280/y,[]),se=a.useCallback(e=>{const s=Array(w).fill(null).map(()=>Array(y).fill(null));e.forEach(o=>{s[o.row][o.col]=o});for(let o=0;o<w;o++)for(let r=0;r<y;r++){const d=s[o][r];if(d){if(r<y-1&&s[o][r+1]){const n=s.map(p=>[...p]);if(n[o][r]=s[o][r+1],n[o][r+1]=d,Ye(n))return[{row:o,col:r},{row:o,col:r+1}]}if(o<w-1&&s[o+1][r]){const n=s.map(p=>[...p]);if(n[o][r]=s[o+1][r],n[o+1][r]=d,Ye(n))return[{row:o,col:r},{row:o+1,col:r}]}}}return null},[]),_e=a.useCallback(()=>{Te(!0),_("medium"),f?.({target:"player",amount:g||15,source:"no_moves"}),setTimeout(()=>{P(e=>{const s=e.map(o=>o.color);for(let o=s.length-1;o>0;o--){const r=Math.floor(Math.random()*(o+1));[s[o],s[r]]=[s[r],s[o]]}return e.map((o,r)=>({...o,color:s[r]}))}),Te(!1)},600)},[f]),re=a.useCallback(e=>{const s=e||z,o=[];for(let r=0;r<w;r++)for(let d=0;d<y;d++)o.push({id:`${r}-${d}`,color:s[Math.floor(Math.random()*s.length)],row:r,col:d,special:"normal"});P(o),U.current=o},[z]),Re=a.useCallback(()=>{re(),K(j.moveTime),Z(null),q([]),ee(null),G.current=!1},[re,j.moveTime]),Mt=a.useCallback(()=>{k("playing"),pe(we),Re()},[we,Re]),V=a.useCallback(()=>{ee(null),Q.current&&clearTimeout(Q.current),Q.current=setTimeout(()=>{const e=se(U.current);e&&(ee(e),_("light"))},4e3)},[se]),Oe=a.useCallback((e,s,o)=>{switch(e.special){case"line_bomb":{const r=e.col%2===0,d=[];if(r)for(let n=0;n<y;n++){const p=s[e.row][n];p&&d.push(p.id)}else for(let n=0;n<w;n++){const p=s[n][e.col];p&&d.push(p.id)}return{affectedIds:d,bonusDamage:J.orb_match.specialActivation,effectType:r?"beam_horizontal":"beam_vertical"}}case"cross_bomb":{const r=[];for(let d=0;d<y;d++){const n=s[e.row][d];n&&r.push(n.id)}for(let d=0;d<w;d++){const n=s[d][e.col];n&&!r.includes(n.id)&&r.push(n.id)}return{affectedIds:r,bonusDamage:J.orb_match.specialActivation,effectType:"cross_beam"}}case"star":return{affectedIds:o.filter(d=>d.color===e.color).map(d=>d.id),bonusDamage:J.orb_match.specialActivation,effectType:"color_burst"};case"cosmic_nova":{const r=[];for(let d=Math.max(0,e.row-1);d<=Math.min(w-1,e.row+1);d++)for(let n=Math.max(0,e.col-1);n<=Math.min(y-1,e.col+1);n++){const p=s[d][n];p&&r.push(p.id)}return{affectedIds:r,bonusDamage:J.orb_match.specialActivation,effectType:"cosmic_nova"}}default:return null}},[]),Be=a.useCallback(e=>{const s=new Set,o=[],r=[],d=[],n=Array(w).fill(null).map(()=>Array(y).fill(null));e.forEach(i=>{n[i.row][i.col]=i});const p=new Map;for(let i=0;i<w;i++){let u=0;for(;u<y;){const m=n[i][u];if(!m){u++;continue}let h=1;for(;u+h<y&&n[i][u+h]?.color===m.color;)h++;if(h>=3){const v=[];for(let L=0;L<h;L++){const I=n[i][u+L];I&&(s.add(I.id),v.push(I.id),p.set(`${i}-${u+L}`,{row:i,col:u+L,color:m.color}))}const N=u+Math.floor(h/2);o.push({ids:v,size:h,color:m.color,centerRow:i,centerCol:N,isHorizontal:!0}),h===4?r.push({row:i,col:N,type:"line_bomb",color:m.color}):h>=5&&r.push({row:i,col:N,type:"cross_bomb",color:m.color})}u+=Math.max(1,h)}}for(let i=0;i<y;i++){let u=0;for(;u<w;){const m=n[u][i];if(!m){u++;continue}let h=1;for(;u+h<w&&n[u+h][i]?.color===m.color;)h++;if(h>=3){const v=[];for(let L=0;L<h;L++){const I=n[u+L][i];I&&!s.has(I.id)&&v.push(I.id),I&&(s.add(I.id),p.set(`${u+L}-${i}`,{row:u+L,col:i,color:m.color}))}const N=u+Math.floor(h/2);v.length>0&&o.push({ids:v,size:h,color:m.color,centerRow:N,centerCol:i,isHorizontal:!1}),h===4?r.push({row:N,col:i,type:"line_bomb",color:m.color}):h>=5&&r.push({row:N,col:i,type:"cross_bomb",color:m.color})}u+=Math.max(1,h)}}for(const[,i]of p){const u=p.has(`${i.row}-${i.col-1}`)&&p.get(`${i.row}-${i.col-1}`)?.color===i.color||p.has(`${i.row}-${i.col+1}`)&&p.get(`${i.row}-${i.col+1}`)?.color===i.color,m=p.has(`${i.row-1}-${i.col}`)&&p.get(`${i.row-1}-${i.col}`)?.color===i.color||p.has(`${i.row+1}-${i.col}`)&&p.get(`${i.row+1}-${i.col}`)?.color===i.color;if(u&&m&&!r.find(v=>v.row===i.row&&v.col===i.col&&v.type==="star")){const v=r.findIndex(N=>N.row===i.row&&N.col===i.col);v>=0?r[v]={row:i.row,col:i.col,type:"star",color:i.color}:r.push({row:i.row,col:i.col,type:"star",color:i.color})}}for(const i of s){const u=e.find(m=>m.id===i);if(u&&u.special&&u.special!=="normal"){const m=Oe(u,n,e);m&&(d.push({orb:u,...m}),m.affectedIds.forEach(h=>s.add(h)))}}const M=Array.from(s).map(i=>e.find(u=>u.id===i)).filter(i=>i&&i.special&&i.special!=="normal");if(M.length>=2){const i=M[0],u=[];for(const m of M)for(let h=Math.max(0,m.row-1);h<=Math.min(w-1,m.row+1);h++)for(let v=Math.max(0,m.col-1);v<=Math.min(y-1,m.col+1);v++){const N=n[h][v];N&&u.push(N.id)}d.push({orb:i,affectedIds:u,bonusDamage:J.orb_match.specialActivation,effectType:"cosmic_nova"}),u.forEach(m=>s.add(m))}return{matched:s,matchGroups:o,specialsToCreate:r,specialsActivated:d}},[Oe]),Ae=a.useCallback((e,s=[])=>{const o=Array(w).fill(null).map(()=>Array(y).fill(null));e.forEach(n=>{n.matched||(o[n.row][n.col]=n)});const r=new Map;s.forEach(n=>{const p=r.get(n.col)||[];p.push(n),r.set(n.col,p)});for(let n=0;n<y;n++){let p=w-1;for(let u=w-1;u>=0;u--)o[u][n]&&(u!==p&&(o[p][n]=o[u][n],o[u][n]=null),p--);const M=r.get(n)||[];let i=0;for(let u=p;u>=0;u--){const m=M[i],h=m&&i<M.length;o[u][n]={id:`${u}-${n}-${Date.now()}-${Math.random()}`,color:h?m.color:z[Math.floor(Math.random()*z.length)],row:u,col:n,special:h?m.type:"normal",isNew:!0},h&&i++}}const d=[];for(let n=0;n<w;n++)for(let p=0;p<y;p++){const M=o[n][p];M&&d.push({...M,row:n,col:p})}return d},[z]),Ie=a.useCallback(e=>{_("error"),Ee(new Set([e.orb1.id,e.orb2.id])),P(s=>s.map(o=>o.id===e.orb1.id?{...o,row:e.orb1.row,col:e.orb1.col}:o.id===e.orb2.id?{...o,row:e.orb2.row,col:e.orb2.col}:o)),setTimeout(()=>Ee(new Set),200)},[]),De=a.useCallback(async e=>{let s=e,o=0,r=0;const d=async()=>{const{matched:n,matchGroups:p,specialsToCreate:M,specialsActivated:i}=Be(s);if(n.size>=3){o++,Ne(o),o>1&&(Ce(!0),setTimeout(()=>Ce(!1),500));for(const m of i){const h={id:`effect-${Date.now()}-${Math.random()}`,type:m.effectType,row:m.orb.row,col:m.orb.col,color:me[m.orb.color].glow};$e(v=>[...v,h]),f?.({target:"adversary",amount:m.bonusDamage,source:`special_${m.orb.special}`,isCritical:!0}),r+=m.bonusDamage*5,_("heavy")}const u=p.map(m=>{const h=m.size*10,v=1+(o-1)*.5,N=Math.round(h*v);return r+=N,{id:`exp-${Date.now()}-${Math.random()}`,x:m.centerCol*$+$/2,y:m.centerRow*$+$/2,color:me[m.color].glow,size:m.size,score:N}});ke(m=>[...m,...u]),s=s.map(m=>n.has(m.id)?{...m,matched:!0}:m),P([...s]),U.current=[...s],n.size>=5||i.length>0?_("heavy"):_("success"),await new Promise(m=>setTimeout(m,i.length>0?350:200)),s=Ae(s,M),P([...s]),U.current=[...s],await new Promise(m=>setTimeout(m,180)),await d()}};return await d(),o>0&&(ye(n=>n+r),je(n=>{const p=n+o;return ht(M=>Math.max(M,p)),p}),K(j.moveTime),V(),setTimeout(()=>{!se(U.current)&&b==="playing"&&_e()},200)),Ne(0),o},[Be,Ae,j.moveTime,$,V,se,b,_e,f]),ne=a.useCallback((e,s)=>{if(!be.current)return null;const o=be.current.getBoundingClientRect(),r=Math.floor((e-o.left)/(o.width/y)),d=Math.floor((s-o.top)/(o.height/w));return d>=0&&d<w&&r>=0&&r<y?{row:d,col:r}:null},[]),Pe=a.useCallback((e,s)=>{oe.current={orb1:{id:e.id,row:e.row,col:e.col},orb2:{id:s.id,row:s.row,col:s.col}},P(o=>{const r=o.map(d=>d.id===e.id?{...d,row:s.row,col:s.col}:d.id===s.id?{...d,row:e.row,col:e.col}:d);return U.current=r,r})},[]),ie=a.useCallback((e,s)=>{if(b!=="playing"||O<=0||xe)return;const o=ne(e,s);if(!o)return;const r=E.find(d=>d.row===o.row&&d.col===o.col);r&&(Z(r),q([r.id]),G.current=!0,_("light"),ee(null))},[b,O,xe,ne,E]),le=a.useCallback((e,s)=>{if(!G.current||!Y||b!=="playing")return;const o=ne(e,s);if(!o)return;const r=E.find(p=>p.id===Y.id);if(!r)return;const d=Math.abs(o.row-r.row),n=Math.abs(o.col-r.col);if(d===1&&n===0||d===0&&n===1){const p=E.find(M=>M.row===o.row&&M.col===o.col);p&&p.id!==Y.id&&(Pe(r,p),q(M=>[...M,p.id]),_("light"),Z({...r,row:o.row,col:o.col}))}},[Y,b,ne,E,Pe]),W=a.useCallback(async()=>{G.current&&(G.current=!1,ue.length>1&&(F.current&&(clearInterval(F.current),F.current=null),await De(U.current)===0&&oe.current&&Ie(oe.current),oe.current=null),Z(null),q([]),V())},[ue,De,Ie,V]),Nt=a.useCallback(e=>ie(e.clientX,e.clientY),[ie]),Ct=a.useCallback(e=>le(e.clientX,e.clientY),[le]),Ge=a.useCallback(()=>W(),[W]),kt=a.useCallback(e=>{e.preventDefault(),ie(e.touches[0].clientX,e.touches[0].clientY)},[ie]),St=a.useCallback(e=>{e.preventDefault(),le(e.touches[0].clientX,e.touches[0].clientY)},[le]),Tt=a.useCallback(e=>{e.preventDefault(),W()},[W]);a.useEffect(()=>{if(b==="playing"){if(O<=0&&!G.current){K(j.moveTime);return}if(!(O<=0))return F.current=setInterval(()=>{K(e=>e<=.15?(G.current&&W(),0):e-.15)},150),()=>{F.current&&clearInterval(F.current)}}},[b,O,W,j.moveTime]),a.useEffect(()=>{if(b!=="playing")return;const e=setInterval(()=>{pe(s=>s<=1?(k("complete"),0):s-1)},1e3);return()=>clearInterval(e)},[b]),a.useEffect(()=>(b==="playing"&&V(),()=>{Q.current&&clearTimeout(Q.current)}),[b,V]),a.useEffect(()=>{if(b==="playing"&&S>=j.targetScore){const e=X*5,s=S+e;if(mt(S),ut(e),it(o=>o+s),ct(o=>o+1),T){k("complete");return}f?.({target:"adversary",amount:J.orb_match.scoreTarget,source:"level_complete"}),_("heavy"),k("levelComplete")}},[S,j.targetScore,b,X,f,T]);const Et=a.useCallback(()=>{const e=B+1;lt(e),ye(0),je(0),ve(!0),setTimeout(()=>ve(!1),1e3);const s=He(e,ae),r=["fire","water","earth","light","dark","cosmic"].slice(0,s.colors);pe(H??s.timeLimit),re(r),K(s.moveTime),k("playing")},[B,ae,re,H]);a.useEffect(()=>{if(b==="complete"){const e=fe+S,s=A>=1;A>=3&&(wt(!0),_("heavy"));const o=Math.min(ge*2,15),r=A*5,d=Math.round(s?Math.min(100,50+r+o):Math.min(50,S/j.targetScore*50)),n=A>=5?"perfect":s?"good":"fail";setTimeout(()=>l({success:s,accuracy:d,result:n,highScoreValue:e,gameStats:{score:e,level:B,levelsCompleted:A,maxCombo:ge,time:X,timeBonus:he}}),A>=3?1200:400)}},[b,S,fe,A,B,j.targetScore,ge,X,he,l]);const $t=a.useCallback(e=>ke(s=>s.filter(o=>o.id!==e)),[]),ce=a.useCallback(e=>$e(s=>s.filter(o=>o.id!==e)),[]),Ue=S/j.targetScore,Lt=X<=5&&b==="playing";return t.jsxs("div",{className:"flex flex-col items-center relative flex-1 min-h-0",children:[b==="countdown"&&t.jsx(_t,{count:3,onComplete:Mt}),t.jsx(de,{children:b==="paused"&&t.jsx(Rt,{onResume:()=>k("playing")})}),t.jsx(de,{children:b==="levelComplete"&&t.jsx(qe,{level:B,levelScore:dt,timeBonus:he,totalScore:fe,onContinue:Et})}),t.jsx(Ot,{title:`Starburst - Level ${B}`,subtitle:`Target: ${j.targetScore} pts`,timeLeft:X,totalTime:we,combo:ft,showCombo:!0,primaryStat:{value:S,label:`${S}/${j.targetScore}`,color:S>=j.targetScore?"#22c55e":"#a855f7"},secondaryStat:{value:A,label:`${A} cleared`,color:"#22d3ee"},isPaused:b==="paused",onPauseToggle:()=>k(b==="paused"?"playing":"paused"),compact:D}),t.jsxs("div",{className:"relative w-full max-w-xs mb-2",children:[t.jsx(et,{level:B,progress:Ue,targetScore:j.targetScore}),t.jsx("div",{className:"absolute right-0 top-0",children:t.jsx(Je,{progress:Ue,isComplete:S>=j.targetScore})}),b==="playing"&&t.jsxs("div",{className:"pt-8",children:[t.jsx("div",{className:"h-2 bg-muted rounded-full overflow-hidden",children:t.jsx("div",{className:`h-full transition-all duration-150 ${O<2?"animate-pulse":""}`,style:{width:`${O/j.moveTime*100}%`,background:O<2?"linear-gradient(90deg, #ef4444, #f87171)":"linear-gradient(90deg, hsl(var(--primary)), hsl(var(--accent)))"}})}),t.jsxs("p",{className:"text-xs text-center text-muted-foreground mt-1",children:["Move: ",O.toFixed(1),"s"]})]})]}),!D&&t.jsx("button",{className:"text-xs text-muted-foreground mb-2 underline",onClick:()=>vt(!te),children:te?"Show Emojis":"Show Shapes"}),t.jsxs("div",{ref:be,className:"relative w-full max-w-xs rounded-2xl overflow-hidden cursor-pointer touch-none game-container",style:{aspectRatio:`${y}/${w}`,maxWidth:300},onMouseDown:Nt,onMouseMove:Ct,onMouseUp:Ge,onMouseLeave:Ge,onTouchStart:kt,onTouchMove:St,onTouchEnd:Tt,children:[t.jsx(Fe,{}),t.jsx("div",{className:"absolute inset-0 pointer-events-none grid-lines"}),Se&&t.jsx(We,{orbs:Se,cellSize:$}),E.map(e=>t.jsx(nt,{orb:e,cellSize:$,isSelected:Y?.id===e.id,isDragging:G.current,isInPath:ue.includes(e.id),isReverting:yt.has(e.id),showAccessibility:te},e.id)),xt.map(e=>t.jsx(ze,{explosion:e,onComplete:()=>$t(e.id)},e.id)),t.jsx(de,{children:jt.map(e=>{switch(e.type){case"beam_horizontal":case"beam_vertical":return t.jsx(ot,{effect:e,cellSize:$,onComplete:()=>ce(e.id)},e.id);case"cross_beam":return t.jsx(at,{effect:e,cellSize:$,onComplete:()=>ce(e.id)},e.id);case"color_burst":return t.jsx(st,{effect:e,cellSize:$,onComplete:()=>ce(e.id)},e.id);case"cosmic_nova":return t.jsx(rt,{effect:e,cellSize:$,onComplete:()=>ce(e.id)},e.id);default:return null}})}),gt&&Me>1&&t.jsx(Ve,{multiplier:Me}),Lt&&t.jsx(Ke,{}),xe&&t.jsx(Ze,{}),bt&&t.jsx(Qe,{}),t.jsx(de,{children:pt&&t.jsx(tt,{})})]}),!D&&t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"flex flex-wrap justify-center gap-3 mt-4 text-xs",children:z.slice(0,4).map(e=>t.jsxs("div",{className:"flex items-center gap-1.5 px-2 py-1 rounded-full bg-white/5 border border-white/10",children:[t.jsx("span",{className:"text-sm",children:te?Xe[e]:me[e].emoji}),t.jsx("span",{className:"capitalize text-white/60 font-medium",children:e})]},e))}),t.jsx("p",{className:"text-xs text-white/40 mt-3 text-center font-medium",children:"Match 4+ for specials â€¢ T/L shapes = â˜… Star â€¢ Match specials for big damage!"})]}),t.jsx("style",{children:`
        .orb-base {
          transition: transform 120ms ease-out, box-shadow 100ms ease-out;
          will-change: transform;
        }
        .orb-matched {
          animation: orb-pop 180ms ease-out forwards;
        }
        .orb-new {
          animation: orb-drop 200ms ease-out;
        }
        .orb-revert {
          animation: orb-shake 150ms ease-out;
        }
        @keyframes orb-pop {
          0% { transform: scale(1); opacity: 1; }
          50% { transform: scale(1.2); opacity: 0.8; }
          100% { transform: scale(0); opacity: 0; }
        }
        @keyframes orb-drop {
          0% { transform: translateY(var(--start-y, -80px)) scale(0.8); opacity: 0; }
          100% { opacity: 1; }
        }
        @keyframes orb-shake {
          0%, 100% { transform: translateX(0); }
          25% { transform: translateX(-4px); }
          75% { transform: translateX(4px); }
        }
        .selection-ring {
          border: 2px solid;
          animation: ring-pulse 400ms ease-in-out infinite;
        }
        @keyframes ring-pulse {
          0%, 100% { opacity: 0.6; }
          50% { opacity: 1; }
        }
        .hint-pulse {
          border: 3px solid rgba(255, 215, 0, 0.8);
          box-shadow: 0 0 12px rgba(255, 215, 0, 0.6);
          animation: hint-glow 800ms ease-in-out infinite;
        }
        @keyframes hint-glow {
          0%, 100% { transform: scale(1); opacity: 0.6; }
          50% { transform: scale(1.08); opacity: 1; }
        }
        .explosion-effect {
          transform: translate(-50%, -50%);
        }
        .explosion-ring {
          position: absolute;
          width: 50px; height: 50px;
          left: -25px; top: -25px;
          border: 3px solid;
          border-radius: 50%;
          animation: ring-expand 350ms ease-out forwards;
        }
        @keyframes ring-expand {
          0% { transform: scale(0); opacity: 1; }
          100% { transform: scale(2); opacity: 0; }
        }
        .explosion-score {
          position: absolute;
          font-size: 16px; font-weight: 800;
          text-shadow: 0 0 8px currentColor, 0 2px 4px rgba(0,0,0,0.5);
          animation: score-float 400ms ease-out forwards;
        }
        @keyframes score-float {
          0% { transform: translateY(0); opacity: 1; }
          100% { transform: translateY(-40px); opacity: 0; }
        }
        .cascade-popup {
          animation: cascade-pop 500ms ease-out forwards;
        }
        @keyframes cascade-pop {
          0% { transform: translate(-50%, -50%) scale(0); opacity: 0; }
          30% { transform: translate(-50%, -50%) scale(1.3); opacity: 1; }
          100% { transform: translate(-50%, -50%) scale(1); opacity: 0; }
        }
        .urgency-pulse {
          box-shadow: inset 0 0 40px rgba(239, 68, 68, 0.4);
          border: 2px solid rgba(239, 68, 68, 0.5);
          animation: urgency 400ms ease-in-out infinite;
        }
        @keyframes urgency {
          0%, 100% { box-shadow: inset 0 0 40px rgba(239, 68, 68, 0.3); }
          50% { box-shadow: inset 0 0 60px rgba(239, 68, 68, 0.5); }
        }
        .perfect-banner {
          animation: banner-pop 300ms ease-out;
        }
        @keyframes banner-pop {
          0% { transform: scale(0) rotate(-10deg); opacity: 0; }
          100% { transform: scale(1) rotate(0); opacity: 1; }
        }
        .game-container {
          background: linear-gradient(145deg, rgba(0,0,0,0.85) 0%, rgba(15,15,35,0.95) 50%, rgba(25,15,45,0.9) 100%);
          border: 1px solid rgba(255,255,255,0.08);
          box-shadow: 0 20px 40px -12px rgba(0,0,0,0.6);
        }
        .grid-lines {
          background-image: 
            linear-gradient(to right, rgba(255,255,255,0.04) 1px, transparent 1px),
            linear-gradient(to bottom, rgba(255,255,255,0.04) 1px, transparent 1px);
          background-size: calc(100% / 6) calc(100% / 5);
        }
        .stars-layer {
          position: absolute; inset: 0;
          background-image: radial-gradient(1px 1px at 10% 20%, white, transparent),
            radial-gradient(1px 1px at 30% 60%, white, transparent),
            radial-gradient(1px 1px at 50% 30%, white, transparent),
            radial-gradient(1px 1px at 70% 80%, white, transparent),
            radial-gradient(1px 1px at 90% 40%, white, transparent);
        }
        .drop-shadow-glow { text-shadow: 0 0 20px rgba(250,204,21,0.8); }
        .shadow-glow-yellow { box-shadow: 0 0 40px rgba(250,204,21,0.4); }
        .shadow-glow-purple { box-shadow: 0 0 40px rgba(168,85,247,0.4); }
        
        /* Special orb animations */
        @keyframes special-pulse {
          0%, 100% { box-shadow: 0 0 10px rgba(255,255,255,0.5); }
          50% { box-shadow: 0 0 25px rgba(255,255,255,0.9), 0 0 35px rgba(255,255,255,0.4); }
        }
        @keyframes special-rainbow {
          0% { border-color: gold; box-shadow: 0 0 15px gold; }
          33% { border-color: #ff6b6b; box-shadow: 0 0 15px #ff6b6b; }
          66% { border-color: #4facfe; box-shadow: 0 0 15px #4facfe; }
          100% { border-color: gold; box-shadow: 0 0 15px gold; }
        }
        @keyframes special-rotate {
          0% { transform: rotate(0deg); }
          100% { transform: rotate(360deg); }
        }
        @keyframes special-nova {
          0%, 100% { box-shadow: 0 0 15px rgba(236,72,153,0.6), 0 0 30px rgba(168,85,247,0.3); }
          50% { box-shadow: 0 0 30px rgba(236,72,153,0.9), 0 0 50px rgba(168,85,247,0.6); }
        }
      `})]})};export{Ut as OrbMatchGame};
