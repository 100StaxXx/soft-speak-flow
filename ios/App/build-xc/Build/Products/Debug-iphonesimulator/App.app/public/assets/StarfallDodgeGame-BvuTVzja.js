import{r as t,j as e,m as E,l as He,aq as me,cV as qe}from"./vendor-CkzXtEGd.js";import{bw as Ve,bx as We,by as Ye,bt as Je,bu as Ke,B as V,bs as Qe}from"./index-B9iotTKE.js";import{a as Ze,u as et,b as tt,t as f}from"./gameUtils-BnwM_CJ4.js";import"./date-vendor-CuPqBTxb.js";import"./three-vendor-qI8GXUTd.js";const st={beginner:{initialSpawnRate:1e3,debrisRatio:.35,baseSpeed:1.5,speedIncrease:.2,spawnRateDecrease:8,minSpawnRate:350,maxSpeed:7},easy:{initialSpawnRate:800,debrisRatio:.45,baseSpeed:2,speedIncrease:.3,spawnRateDecrease:14,minSpawnRate:250,maxSpeed:9.5},medium:{initialSpawnRate:650,debrisRatio:.55,baseSpeed:2.8,speedIncrease:.4,spawnRateDecrease:18,minSpawnRate:200,maxSpeed:11},hard:{initialSpawnRate:500,debrisRatio:.65,baseSpeed:3.5,speedIncrease:.28,spawnRateDecrease:22,minSpawnRate:150,maxSpeed:12},master:{initialSpawnRate:400,debrisRatio:.75,baseSpeed:4.5,speedIncrease:.35,spawnRateDecrease:28,minSpawnRate:120,maxSpeed:14}},ue={magnet:5e3,slowmo:4e3},pe=t.memo(({stars:l})=>e.jsx("div",{className:"absolute inset-0 overflow-hidden pointer-events-none",children:l.map(a=>e.jsx("div",{className:"absolute rounded-full bg-white",style:{width:a.size,height:a.size,left:`${a.x}%`,top:`${a.y}%`,opacity:a.opacity,animation:`twinkle ${a.animationDuration}s ease-in-out infinite`}},a.id))}));pe.displayName="StarBackground";const xe=t.memo(({obj:l})=>{switch(l.type){case"crystal":return e.jsx("div",{className:"w-7 h-7 flex items-center justify-center",style:{filter:"drop-shadow(0 0 8px #22d3ee)",animation:"spin 3s linear infinite"},children:e.jsx("span",{className:"text-2xl",children:"ðŸ’Ž"})});case"powerup_shield":return e.jsx("div",{className:"w-8 h-8 flex items-center justify-center",style:{filter:"drop-shadow(0 0 12px #10b981)",animation:"pulse 1.5s ease-in-out infinite"},children:e.jsx("span",{className:"text-2xl",children:"ðŸ›¡ï¸"})});case"powerup_magnet":return e.jsx("div",{className:"w-8 h-8 flex items-center justify-center",style:{filter:"drop-shadow(0 0 12px #f59e0b)",animation:"pulse 1.2s ease-in-out infinite"},children:e.jsx("span",{className:"text-2xl",children:"ðŸ§²"})});case"powerup_slowmo":return e.jsx("div",{className:"w-8 h-8 flex items-center justify-center",style:{filter:"drop-shadow(0 0 12px #8b5cf6)",animation:"pulse 1.8s ease-in-out infinite"},children:e.jsx("span",{className:"text-2xl",children:"â³"})});case"powerup_life":return e.jsx("div",{className:"w-9 h-9 flex items-center justify-center",style:{filter:"drop-shadow(0 0 15px #ec4899)",animation:"pulse 0.8s ease-in-out infinite"},children:e.jsx("span",{className:"text-2xl",children:"ðŸ’–"})});case"bomb":return e.jsx("div",{className:"w-10 h-10 flex items-center justify-center",style:{filter:"drop-shadow(0 0 15px #ef4444)",animation:"pulse 0.5s ease-in-out infinite"},children:e.jsx("span",{className:"text-3xl",children:"ðŸ’£"})});case"homing_debris":return e.jsx("div",{className:"w-7 h-7 rounded-full bg-gradient-to-br from-orange-500 via-red-600 to-orange-500",style:{boxShadow:"0 0 16px rgba(249, 115, 22, 0.8), 0 0 8px rgba(255, 255, 255, 0.4)",animation:"spin 0.4s linear infinite"},children:e.jsx("div",{className:"absolute inset-1 rounded-full bg-yellow-400/50"})});default:return e.jsx("div",{className:"w-6 h-6 rounded-full bg-gradient-to-br from-red-500 via-orange-500 to-red-600",style:{boxShadow:"0 0 12px rgba(239, 68, 68, 0.6)",animation:"spin 0.8s linear infinite"}})}});xe.displayName="FallingObjectComponent";const fe=t.memo(({particles:l})=>e.jsx(e.Fragment,{children:l.map(a=>e.jsx("div",{className:"absolute w-2 h-2 rounded-full pointer-events-none",style:{left:`${a.x}%`,top:`${a.y}%`,backgroundColor:a.color,boxShadow:`0 0 6px ${a.color}`,opacity:a.life/a.maxLife,transform:"translate(-50%, -50%)"}},a.id))}));fe.displayName="ParticleRenderer";const he=t.memo(({onContinue:l})=>e.jsxs(E.div,{initial:{opacity:0},animate:{opacity:1},className:"fixed inset-0 bg-black/95 backdrop-blur-sm flex flex-col items-center justify-center p-6",style:{zIndex:100},children:[e.jsx(E.div,{animate:{rotate:[0,-90,-90,0]},transition:{duration:2,repeat:1/0,repeatDelay:1},className:"mb-6",children:e.jsx(me,{className:"w-20 h-20 text-cyan-400"})}),e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(qe,{className:"w-6 h-6 text-cyan-400"}),e.jsx("h3",{className:"text-xl font-bold text-white",children:"Rotate Your Phone"})]}),e.jsx("p",{className:"text-muted-foreground text-center text-sm mb-6 max-w-xs",children:"Turn your phone sideways (landscape mode) for the best gameplay experience!"}),e.jsx(V,{onClick:l,className:"bg-cyan-500 hover:bg-cyan-600 text-white font-bold px-8 py-3",style:{zIndex:101},children:"Continue"})]}));he.displayName="RotatePhoneOverlay";const ye=t.memo(({onRequest:l,onSkip:a})=>e.jsxs(E.div,{initial:{opacity:0},animate:{opacity:1},className:"absolute inset-0 bg-black/80 backdrop-blur-sm flex flex-col items-center justify-center z-50 p-6",children:[e.jsx(me,{className:"w-16 h-16 text-cyan-400 mb-4 animate-bounce"}),e.jsx("h3",{className:"text-xl font-bold text-white mb-2",children:"Enable Tilt Controls?"}),e.jsx("p",{className:"text-muted-foreground text-center text-sm mb-6 max-w-xs",children:"Tilt your device left and right to dodge! This requires motion sensor permission."}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(V,{onClick:l,className:"bg-cyan-500 hover:bg-cyan-600",children:"Enable Tilt"}),e.jsx(V,{variant:"ghost",onClick:a,children:"Use Touch"})]})]}));ye.displayName="TiltPermissionOverlay";const be=t.memo(({lives:l,maxLives:a=3})=>e.jsx("div",{className:"flex gap-0.5",children:Array.from({length:a}).map((R,y)=>e.jsx("span",{className:`text-lg ${y<l?"opacity-100":"opacity-30"}`,children:"â¤ï¸"},y))}));be.displayName="LivesDisplay";const ge=t.memo(({hasShield:l,hasMagnet:a,hasSlowMo:R,magnetTimeLeft:y,slowMoTimeLeft:b})=>e.jsxs("div",{className:"flex gap-1",children:[l&&e.jsx("div",{className:"bg-emerald-500/30 backdrop-blur-sm rounded-full px-1.5 py-0.5",children:e.jsx("span",{className:"text-emerald-300 text-xs",children:"ðŸ›¡ï¸"})}),a&&e.jsxs("div",{className:"bg-amber-500/30 backdrop-blur-sm rounded-full px-1.5 py-0.5 flex items-center gap-0.5",children:[e.jsx("span",{className:"text-amber-300 text-xs",children:"ðŸ§²"}),e.jsxs("span",{className:"text-amber-300 text-[10px]",children:[Math.ceil(y/1e3),"s"]})]}),R&&e.jsxs("div",{className:"bg-purple-500/30 backdrop-blur-sm rounded-full px-1.5 py-0.5 flex items-center gap-0.5",children:[e.jsx("span",{className:"text-purple-300 text-xs",children:"â³"}),e.jsxs("span",{className:"text-purple-300 text-[10px]",children:[Math.ceil(b/1e3),"s"]})]})]}));ge.displayName="ActivePowerupsDisplay";const ot=({companionStats:l,onComplete:a,onDamage:R,tierAttackDamage:y=15,difficulty:b="medium",questIntervalScale:$=0,isPractice:we=!1,compact:N=!1})=>{const[c,p]=t.useState("rotate"),[g,W]=t.useState(!1),[P,Y]=t.useState(50),[I,ve]=t.useState(0),[w,A]=t.useState(3),[v,J]=t.useState(!1),[S,K]=t.useState(!1),[j,Q]=t.useState(!1),[_,Se]=t.useState(0),[D,Re]=t.useState(0),[M,Ne]=t.useState(0),[je,L]=t.useState(!1),[z,Z]=t.useState(0),[Me,ee]=t.useState(0),te=t.useRef(null),O=t.useRef([]),[ke,Te]=t.useState([]),Ce=t.useRef(0),se=t.useRef(0),F=t.useRef(P),B=t.useRef(c),k=t.useRef(null),Ee=t.useRef(w),ae=t.useRef(v),G=t.useRef(S),U=t.useRef(j),ne=t.useRef(_),ie=t.useRef(D),re=t.useRef(50),H=t.useRef(50),{available:X,requestPermission:le,getLandscapePositionFromTilt:Pe}=Ve();t.useEffect(()=>{F.current=P},[P]),t.useEffect(()=>{B.current=c},[c]),t.useEffect(()=>{Ee.current=w},[w]),t.useEffect(()=>{ae.current=v},[v]),t.useEffect(()=>{G.current=S},[S]),t.useEffect(()=>{U.current=j},[j]),t.useEffect(()=>{ne.current=_},[_]),t.useEffect(()=>{ie.current=D},[D]),t.useEffect(()=>()=>{We()},[]);const{particles:_e,emit:x}=Ze(40),De=et(20),Le=Math.round((l.mind+l.body)/2),oe=32+Math.floor(Le/35),u=t.useMemo(()=>{const n=st[b];return{...n,initialSpawnRate:n.initialSpawnRate-$*30,baseSpeed:n.baseSpeed+$*.1}},[b,$]);t.useEffect(()=>{Z(u.baseSpeed),ee(u.initialSpawnRate)},[u]);const ce=Date.now(),Oe=Math.max(0,_-ce),Xe=Math.max(0,D-ce),$e=t.useCallback(async()=>{await Ye(),p("permission")},[]),Ie=t.useCallback(async()=>{if(X){const n=await le();W(n)}p("countdown")},[X,le]),Ae=t.useCallback(()=>{W(!1),p("countdown")},[]),ze=t.useCallback(n=>{if(B.current!=="playing")return;const m=n.touches[0];k.current={x:m.clientX,playerX:F.current}},[]),Fe=t.useCallback(n=>{if(!k.current||B.current!=="playing"||g)return;n.preventDefault();const i=n.touches[0].clientX-k.current.x,r=te.current?.getBoundingClientRect().width||500,d=i/r*100,o=Math.max(5,Math.min(95,k.current.playerX+d));Y(o)},[g]),Be=t.useCallback(()=>{k.current=null},[]),Ge=t.useCallback(()=>{p("playing")},[]),Ue=t.useCallback((n,m)=>{const i=Math.random();let r,d;i<.01?(r="powerup_life",d=36):i<.03?(r="bomb",d=40):i<.06?(r="homing_debris",d=28):i<.1?(r="powerup_shield",d=32):i<.14?(r="powerup_magnet",d=32):i<.18?(r="powerup_slowmo",d=32):i<.18+u.debrisRatio*.82?(r="debris",d=24):(r="crystal",d=28);const o={id:Ce.current++,x:5+Math.random()*90,y:-5,type:r,speed:z*(.8+Math.random()*.4),size:d,targetX:r==="homing_debris"?m:void 0};O.current.push(o)},[u.debrisRatio,z]);return tt((n,m)=>{const i=Date.now();G.current&&i>ne.current&&K(!1),U.current&&i>ie.current&&Q(!1);const r=U.current?.5:1,d=.12;let o;g?(re.current=Pe(6,1.4),H.current+=(re.current-H.current)*d,o=H.current,Y(o)):o=F.current,Ne(s=>{const T=s+n/1e3,h=Math.floor(s/10);return Math.floor(T/10)>h&&R?.({target:"adversary",amount:Qe.starfall_dodge.survivalMilestone,source:"survival_milestone"}),we&&T>=15&&p("complete"),T}),Z(s=>Math.min(u.maxSpeed,s+u.speedIncrease*n/1e3)),ee(s=>Math.max(u.minSpawnRate,s-u.spawnRateDecrease*n/1e3)),m-se.current>Me&&(se.current=m,Ue(m,o)),O.current=O.current.filter(s=>{const T=s.speed*r;if(s.y+=T*n*60*.5,s.type==="homing_debris"&&s.y>0&&s.y<60){const h=.15*r;s.x<o?s.x=Math.min(s.x+h,o):s.x>o&&(s.x=Math.max(s.x-h,o))}if(s.type==="crystal"&&G.current&&Math.abs(s.x-o)<25&&(s.x<o?s.x+=.3:s.x-=.3),s.y>70&&s.y<92){const h=Math.abs(s.x-o),q=s.type==="bomb"?5:s.type==="debris"||s.type==="homing_debris"?3.5:4.5;if(h<q)switch(s.type){case"crystal":return ve(C=>C+1),x(s.x,s.y,"#22d3ee",6),f("light"),!1;case"powerup_shield":return J(!0),x(s.x,s.y,"#10b981",8),f("medium"),!1;case"powerup_magnet":return K(!0),Se(i+ue.magnet),x(s.x,s.y,"#f59e0b",8),f("medium"),!1;case"powerup_slowmo":return Q(!0),Re(i+ue.slowmo),x(s.x,s.y,"#8b5cf6",8),f("medium"),!1;case"powerup_life":return A(C=>Math.min(C+1,5)),x(s.x,s.y,"#ec4899",12),f("heavy"),!1;case"bomb":return x(s.x,s.y,"#ef4444",15),x(s.x,s.y,"#f97316",15),f("heavy"),A(0),L(!0),setTimeout(()=>L(!1),400),p("complete"),!1;case"debris":case"homing_debris":return ae.current?(J(!1),x(s.x,s.y,"#ef4444",6),f("medium")):(R?.({target:"player",amount:y,source:"hit_by_projectile"}),A(C=>{const de=C-1;return de<=0&&p("complete"),de}),L(!0),setTimeout(()=>L(!1),200),x(s.x,s.y,"#ef4444",8),f("heavy")),!1}}return s.y<110}),Te([...O.current])},c==="playing"),t.useEffect(()=>{if(c!=="complete")return;const m={beginner:90,easy:60,medium:45,hard:30,master:20}[b],i=Math.min(100,Math.round(M/m*100)),r=i>=90?"perfect":i>=50?"good":"fail";a({success:r!=="fail",accuracy:Math.min(100,Math.max(0,i)),result:r,usedTiltControls:g,highScoreValue:Math.floor(M),gameStats:{time:Math.floor(M),itemsCollected:I,livesRemaining:w}})},[c,I,M,b,a,g,w]),e.jsxs("div",{ref:te,className:`relative overflow-hidden ${je?"animate-shake":""}`,style:{background:j?"linear-gradient(to bottom, #1a0a2e, #2d1052)":"linear-gradient(to bottom, #0f0a1a, #1a1033)",transition:"background 0.5s ease",width:"100vw",height:"100dvh",minHeight:"100vh",borderRadius:0,position:"fixed",top:0,left:0,zIndex:60,paddingTop:"env(safe-area-inset-top)",paddingBottom:"env(safe-area-inset-bottom)",paddingLeft:"env(safe-area-inset-left)",paddingRight:"env(safe-area-inset-right)"},onTouchStart:ze,onTouchMove:Fe,onTouchEnd:Be,children:[e.jsx(pe,{stars:De}),c!=="rotate"&&c!=="permission"&&e.jsx("div",{className:`absolute top-1 left-0 right-0 z-20 ${N?"px-2":"px-4"}`,children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[!N&&e.jsx("div",{className:"text-sm font-bold text-white/80",children:"Starfall Dodge"}),e.jsx("div",{className:"bg-black/40 backdrop-blur-sm rounded-lg px-2 py-0.5",children:e.jsxs("span",{className:`text-cyan-400 ${N?"text-xs":"text-sm"}`,children:["ðŸ’Ž ",I]})}),e.jsx("div",{className:"bg-black/40 backdrop-blur-sm rounded-lg px-2 py-0.5",children:e.jsxs("span",{className:`text-yellow-400 ${N?"text-xs":"text-sm"}`,children:["â±ï¸ ",Math.floor(M),"s"]})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ge,{hasShield:v,hasMagnet:S,hasSlowMo:j,magnetTimeLeft:Oe,slowMoTimeLeft:Xe}),e.jsx(be,{lives:w,maxLives:3})]})]})}),c==="playing"&&!N&&e.jsxs("div",{className:"absolute top-10 left-1/2 -translate-x-1/2 flex gap-2",children:[g&&e.jsx("div",{className:"bg-cyan-500/20 backdrop-blur-sm rounded-full px-3 py-1 text-xs text-cyan-300",children:"ðŸ“± Tilt +25% XP"}),e.jsxs("div",{className:"bg-purple-500/20 backdrop-blur-sm rounded-full px-3 py-1 text-xs text-purple-300",children:["âš¡ ",(z/u.baseSpeed*100).toFixed(0),"% Speed"]})]}),ke.map(n=>e.jsx("div",{className:"absolute",style:{left:`${n.x}%`,top:`${n.y}%`,transform:"translate(-50%, -50%)"},children:e.jsx(xe,{obj:n})},n.id)),e.jsx(fe,{particles:_e}),e.jsx(E.div,{className:"absolute",style:{left:`${P}%`,bottom:"8%",transform:"translateX(-50%)"},animate:{x:0},transition:{type:"spring",stiffness:300,damping:25},children:e.jsxs("div",{className:"rounded-full bg-gradient-to-br from-purple-500 to-pink-500 relative",style:{width:oe,height:oe,boxShadow:v?"0 0 20px #10b981, 0 0 40px #10b98150":S?"0 0 20px #f59e0b, 0 0 40px #f59e0b50":"0 0 20px #a855f7, 0 0 40px #a855f750"},children:[v&&e.jsx("div",{className:"absolute -inset-2 rounded-full border-2 border-emerald-400 animate-pulse"}),S&&e.jsx("div",{className:"absolute -inset-3 rounded-full border-2 border-amber-400 animate-spin",style:{animationDuration:"2s"}}),e.jsx("div",{className:"absolute inset-2 rounded-full bg-white/20"})]})}),e.jsxs(He,{children:[c==="rotate"&&e.jsx(he,{onContinue:$e}),c==="permission"&&X&&e.jsx(ye,{onRequest:Ie,onSkip:Ae}),c==="permission"&&!X&&e.jsx(E.div,{initial:{opacity:0},animate:{opacity:1},onAnimationComplete:()=>p("countdown")}),c==="countdown"&&e.jsx(Je,{count:3,onComplete:Ge}),c==="paused"&&e.jsx(Ke,{onResume:()=>p("playing")})]})]})};export{ot as StarfallDodgeGame};
