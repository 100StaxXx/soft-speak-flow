import{r,j as e,m as Y,dy as H,dz as K,cY as ee,bd as te,be as se,X as ae,a_ as V,dA as ne,Z as re,b5 as oe,v as ie,H as le,u as ce,cn as de,M as ue}from"./vendor-CkzXtEGd.js";import{b as U,B as u,s as M,u as me,G as he,e as Q,a as fe,k as ge,ar as pe,as as ye,g as xe,d as be,a9 as ve,a8 as we,ae as je,at as ke}from"./index-B9iotTKE.js";import"./date-vendor-CuPqBTxb.js";import"./three-vendor-qI8GXUTd.js";const $=["Channeling wisdom...","Consulting the stars...","Gathering insights...","Aligning thoughts...","Seeking clarity..."],Ne=({mentorName:a})=>{const[n,m]=r.useState(0);return r.useEffect(()=>{const t=setInterval(()=>{m(i=>(i+1)%$.length)},1800);return()=>clearInterval(t)},[]),e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsx("div",{className:"font-semibold text-sm",children:a}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"relative w-8 h-8",children:[e.jsx(Y.div,{className:"absolute inset-0 rounded-full border border-primary/30",animate:{rotate:360},transition:{duration:8,repeat:1/0,ease:"linear"}}),e.jsx(Y.div,{className:"absolute inset-1 rounded-full bg-gradient-to-br from-primary/40 to-purple-500/30",animate:{scale:[1,1.15,1],opacity:[.6,1,.6]},transition:{duration:1.5,repeat:1/0,ease:"easeInOut"}}),[0,1,2].map(t=>e.jsx(Y.div,{className:"absolute w-1.5 h-1.5 rounded-full bg-primary/80",style:{top:"50%",left:"50%",marginTop:-3,marginLeft:-3},animate:{x:Math.cos(t*Math.PI*2/3)*12,y:Math.sin(t*Math.PI*2/3)*12,opacity:[.5,1,.5]},transition:{duration:2,repeat:1/0,delay:t*.3,ease:"easeInOut"}},t))]}),e.jsx(Y.span,{initial:{opacity:0,x:-5},animate:{opacity:1,x:0},exit:{opacity:0,x:5},className:"text-sm text-muted-foreground italic",children:$[n]},n)]})]})},Ce=(a,n,m)=>{const t=a.toLowerCase(),i=/tough|direct/i.test(m),c=/empathetic|supportive/i.test(m);return t.includes("habit")||t.includes("consistent")?{content:Me(i,c),isFallback:!0}:t.includes("motivat")||t.includes("boost")||t.includes("encourage")?{content:Se(i,c),isFallback:!0}:t.includes("start")||t.includes("begin")||t.includes("day")?{content:Ie(i,c),isFallback:!0}:t.includes("reflect")||t.includes("think")||t.includes("today")?{content:Re(i,c),isFallback:!0}:t.includes("struggle")||t.includes("hard")||t.includes("difficult")?{content:Te(i,c),isFallback:!0}:t.includes("goal")||t.includes("challenge")||t.includes("improve")?{content:Ee(i,c),isFallback:!0}:{content:_e(i,c),isFallback:!0}};function Me(a,n){return a?"Consistency isn't built overnight. Track your habits daily, hold yourself accountable, and don't make excuses. Small actions compound over time - but only if you show up.":n?"Building habits takes time and patience. Start with one small habit and be gentle with yourself when you miss a day. What matters is that you keep coming back. You're doing great!":"The key to building strong habits is consistency. Start small - even 5 minutes a day makes a difference. Track your progress and celebrate small wins along the way."}function Se(a,n){return a?"You don't need motivation - you need discipline. Motivation fades, but habits and systems last. Stop waiting to feel ready and start taking action now.":n?"I know it can be tough sometimes. Remember why you started this journey. You have everything you need within you to succeed. Take a deep breath and tackle one small thing today.":"Every expert was once a beginner. Focus on progress, not perfection. Each step forward, no matter how small, is moving you closer to your goals."}function Ie(a,n){return a?"Stop overthinking and start doing. Plan your top 3 priorities and execute them. No distractions, no excuses. Your future self will thank you.":n?"Good morning! Today is a fresh start full of possibilities. Take a moment to set a clear intention for what you want to accomplish. You've got this!":"Start your day with clarity. Choose your top 3 priorities and tackle them first. Build momentum with small wins and maintain that energy throughout the day."}function Re(a,n){return a?"Be honest with yourself. What actually got done today versus what you planned? Learn from it and adjust tomorrow. No sugar-coating - just honest assessment leads to real growth.":n?"Take a moment to appreciate what you accomplished today. Even small victories count. What did you learn? What are you grateful for? Rest well - you earned it.":"Reflection is powerful. Think about what worked well today and what you'd do differently. Each day is a learning opportunity. What's one insight you can carry forward?"}function Te(a,n){return a?"Struggling means you're pushing your limits - that's good. The question is: will you push through or give up? Discomfort is where growth happens. Keep going.":n?"It's okay to struggle - it means you're challenging yourself. Be kind to yourself during difficult times. Break things down into smaller steps and ask for help when needed. You're stronger than you think.":"Challenges are part of growth. When things feel hard, break them into smaller, manageable steps. Focus on what you can control and take it one step at a time."}function Ee(a,n){return a?"Goals without action are just wishes. Break your goal into concrete steps and start executing today. Track your progress ruthlessly and adjust as needed.":n?"Your goals are within reach. Start by making them specific and achievable. Celebrate each milestone along the way. Remember - progress over perfection!":"Clear goals drive focused action. Make your goals specific, measurable, and break them into weekly milestones. Review regularly and adjust your approach based on what you learn."}function _e(a,n){return a?"I hear you. Remember - you're capable of more than you think. The path forward is action, not overthinking. What's one concrete step you can take right now?":n?"Thank you for sharing with me. You're on a meaningful journey of growth. Whatever you're facing, remember that small consistent steps lead to big changes. What feels most important to focus on right now?":"I understand. Progress comes from consistent effort in the right direction. Focus on what you can control, take one step at a time, and trust the process. What's your next move?"}const Le=a=>({content:"I'm having trouble connecting right now, but I'm here for you. While we work on restoring the connection, remember: you already have the strength and wisdom within you to move forward. Trust yourself and take action on what you know you need to do.",isFallback:!0}),Fe=({messageContent:a,onFeedbackSubmitted:n})=>{const{user:m}=U(),[t,i]=r.useState(!1),[c,l]=r.useState(!1),[w,k]=r.useState(null),h=async f=>{if(!(!m||c))try{const{error:g}=await M.from("mentor_chat_feedback").insert({user_id:m.id,message_content:a.slice(0,500),feedback_type:f});if(g){console.error("Failed to submit feedback:",g);return}l(!0),k(f),n?.(),setTimeout(()=>i(!1),1500)}catch(g){console.error("Error submitting feedback:",g)}};return c?e.jsxs("div",{className:"flex items-center gap-1 text-xs text-muted-foreground mt-2",children:[e.jsx("span",{children:"Thanks for the feedback!"}),w==="positive"&&e.jsx(H,{className:"h-3 w-3 text-green-500"}),w==="negative"&&e.jsx(K,{className:"h-3 w-3 text-red-500"})]}):e.jsxs("div",{className:"mt-2",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(u,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0 hover:bg-green-500/10",onClick:()=>h("positive"),"aria-label":"Good response",children:e.jsx(H,{className:"h-3 w-3 text-muted-foreground hover:text-green-500"})}),e.jsx(u,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0 hover:bg-red-500/10",onClick:()=>h("negative"),"aria-label":"Bad response",children:e.jsx(K,{className:"h-3 w-3 text-muted-foreground hover:text-red-500"})}),e.jsxs(u,{variant:"ghost",size:"sm",className:"h-6 px-1 text-xs text-muted-foreground hover:text-foreground",onClick:()=>i(!t),children:[e.jsx(ee,{className:"h-3 w-3 mr-1"}),"More",t?e.jsx(te,{className:"h-3 w-3 ml-1"}):e.jsx(se,{className:"h-3 w-3 ml-1"})]})]}),t&&e.jsxs("div",{className:"flex flex-wrap gap-1 mt-2 animate-in slide-in-from-top-2 duration-200",children:[e.jsx(u,{variant:"outline",size:"sm",className:"h-6 text-xs px-2",onClick:()=>h("too_long"),children:"Too long"}),e.jsx(u,{variant:"outline",size:"sm",className:"h-6 text-xs px-2",onClick:()=>h("too_short"),children:"Too short"}),e.jsx(u,{variant:"outline",size:"sm",className:"h-6 text-xs px-2",onClick:()=>h("too_formal"),children:"Too formal"}),e.jsx(u,{variant:"outline",size:"sm",className:"h-6 text-xs px-2",onClick:()=>h("too_casual"),children:"Too casual"}),e.jsx(u,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0",onClick:()=>i(!1),"aria-label":"Close feedback options",children:e.jsx(ae,{className:"h-3 w-3"})})]})]})},De=15,Pe=20,Ye=(a,n,m)=>{const t=new Date().getHours(),i=/tough|direct/i.test(a),c=/empathetic|supportive/i.test(a),l=[];return t>=5&&t<12?l.push("Help me start my day strong","What should I focus on today?"):t>=12&&t<17?l.push("I need an afternoon boost","Keep me on track"):l.push("Help me reflect on today","Prepare me for tomorrow"),i?l.push("Give me the hard truth"):c?l.push("I need some encouragement"):l.push("Give me a pep talk"),n||m?l.push(n?"Help me stay consistent":"Keep me motivated"):l.push("Help me build better habits"),l.sort(()=>Math.random()-.5).slice(0,3)},We=({mentorName:a,mentorTone:n,mentorId:m,hasActiveHabits:t=!1,hasActiveChallenges:i=!1,briefingContext:c,comprehensiveMode:l=!1})=>{const{user:w}=U(),k=V(),[h,f]=r.useState([]),[g,_]=r.useState(""),[N,L]=r.useState(!1),[j,F]=r.useState(!0),[W,p]=r.useState([]),[C,x]=r.useState(0),[S,D]=r.useState(navigator.onLine),[b,z]=r.useState(Pe),I=r.useRef(null),{toast:R}=me(),q=r.useRef(!1),B=r.useRef([]);B.current=h;const G=r.useCallback(async s=>{if(s&&typeof s=="object"&&"context"in s){const o=s.context;if(o instanceof Response){const T=o.status;let E;try{const v=await o.clone().json();if(v&&typeof v=="object"){const d=v;typeof d.message=="string"?E=d.message:typeof d.error=="string"&&(E=d.error)}}catch{}return{status:T,message:E}}}return s instanceof Error?{message:s.message}:{}},[]),P=r.useCallback(async s=>{const{data:{user:o},error:T}=await M.auth.getUser();if(T||!o){R({title:"Error",description:"You must be logged in",variant:"destructive"});return}if(C>=b){R({title:"Daily limit reached",description:`You've reached your daily limit of ${b} messages. It resets at 00:00 UTC.`,variant:"destructive"});return}const E={role:"user",content:s};f(v=>[...v,E]),L(!0);try{const v=B.current,{data:d,error:A}=await M.functions.invoke("mentor-chat",{body:{message:s,mentorName:a,mentorTone:n,conversationHistory:v.slice(-10),comprehensiveMode:l,briefingContext:c}});if(A)throw A;if(!d||!d.response)throw new Error("Invalid response from mentor");const O={role:"assistant",content:d.response};f(y=>[...y,O]),typeof d.dailyLimit=="number"&&Number.isFinite(d.dailyLimit)&&z(d.dailyLimit),d.messagesUsed!==void 0?x(d.messagesUsed):x(y=>y+1),m&&M.from("mentor_chats").insert([{user_id:o.id,mentor_id:m,role:"user",content:s},{user_id:o.id,mentor_id:m,role:"assistant",content:d.response}]).then(({error:y})=>{y&&console.error("Failed to save chat history:",y)})}catch(v){console.error("Mentor chat error:",v);const d=await G(v);if(d.status===429){R({title:"Daily limit reached",description:d.message||`You've reached your daily limit of ${b} messages. It resets at 00:00 UTC.`,variant:"destructive"}),f(y=>y.filter((ze,J)=>J!==y.length-1));return}const O={role:"assistant",content:(S?Ce(s,a,n):Le()).content,isFallback:!0};f(y=>[...y,O]),R({title:"Connection issue",description:"Live reply unavailable. Showing fallback guidance.",duration:3e3})}finally{L(!1)}},[C,b,R,a,n,m,S,l,c,G]);r.useEffect(()=>{(async()=>{if(!w)return;const o=new Date;o.setUTCHours(0,0,0,0);const{count:T}=await M.from("mentor_chats").select("*",{count:"exact",head:!0}).eq("user_id",w.id).eq("role","user").gte("created_at",o.toISOString());x(T||0)})()},[w]),r.useEffect(()=>{p(Ye(n,t,i))},[n,t,i]),r.useEffect(()=>{I.current?.scrollIntoView({behavior:"smooth"})},[h]),r.useEffect(()=>{const s=()=>D(!0),o=()=>D(!1);return window.addEventListener("online",s),window.addEventListener("offline",o),()=>{window.removeEventListener("online",s),window.removeEventListener("offline",o)}},[]),r.useEffect(()=>{const s=k.state?.initialMessage;s&&!q.current&&(q.current=!0,F(!1),P(s))},[k.state,P]);const X=async s=>{s.preventDefault();const o=g.trim();!o||N||(_(""),await P(o))},Z=s=>{F(!1),P(s)};return e.jsxs("div",{className:"flex flex-col h-full",children:[!S&&e.jsxs("div",{className:"bg-destructive text-destructive-foreground px-4 py-2 text-sm flex items-center justify-center gap-2",children:[e.jsx(ne,{className:"h-4 w-4"}),e.jsx("span",{children:"You're offline. Live mentor replies are unavailable; fallback guidance is shown."})]}),e.jsx("div",{className:"px-4 pt-3 pb-2 border-b border-border/50 bg-muted/30",children:e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsxs("span",{className:"text-muted-foreground",children:["Daily messages: ",C,"/",b]}),e.jsx("div",{className:"flex gap-1",children:Array.from({length:Math.min(b,De)}).map((s,o)=>e.jsx("div",{className:he("h-1 w-3 rounded-full transition-colors",o<C?"bg-primary":"bg-muted")},o))})]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[h.length===0&&j&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-muted-foreground text-center",children:"Choose a prompt or type your own message"}),e.jsx("div",{className:"grid gap-2",children:W.map((s,o)=>e.jsx(u,{variant:"outline",className:"justify-start text-left h-auto py-3 px-4 hover:bg-accent",onClick:()=>Z(s),children:s},o))})]}),h.map((s,o)=>e.jsxs(Q,{className:`p-4 ${s.role==="user"?"ml-8 bg-primary/10":"mr-8"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("div",{className:"font-semibold text-sm",children:s.role==="user"?"You":a}),s.isFallback&&e.jsxs("div",{className:"flex items-center gap-1 text-xs text-muted-foreground",children:[e.jsx(re,{className:"h-3 w-3"}),e.jsx("span",{children:"Offline mode"})]})]}),e.jsx("div",{className:"text-sm whitespace-pre-wrap",children:s.content}),s.role==="assistant"&&!s.isFallback&&e.jsx(Fe,{messageContent:s.content})]},o)),N&&e.jsx(Q,{className:"p-4 mr-8",children:e.jsx(Ne,{mentorName:a})}),e.jsx("div",{ref:I})]}),e.jsx("form",{onSubmit:X,className:"p-4 border-t",children:e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx(fe,{value:g,onChange:s=>_(s.target.value),placeholder:"Type your message...",disabled:N,className:"flex-1"}),e.jsx(u,{type:"submit",disabled:N||!g.trim(),size:"icon","aria-label":"Send message",children:e.jsx(oe,{className:"h-4 w-4"})})]})})]})};function Be(){const{user:a}=U(),{profile:n,loading:m,error:t,refetch:i}=ge(),c=ie(),l=le(),w=V(),[k,h]=r.useState(!1),[f,g]=r.useState(!1),_=pe(),{showModal:N,dismissModal:L}=ye("mentor"),j=xe(n),F=w.state?.briefingContext,W=w.state?.comprehensiveMode||!1,{data:p,isLoading:C,isFetching:x,error:S,refetch:D}=ce({queryKey:["mentor",j],queryFn:async()=>{if(!j)return null;const{data:z,error:I}=await M.from("mentors").select("*").eq("id",j).maybeSingle();if(I)throw I;return z},enabled:!!j}),b=async()=>{g(!0);try{await i(),await Promise.all([c.invalidateQueries({queryKey:["mentor"]}),c.invalidateQueries({queryKey:["selected-mentor"]})]),j&&await D()}finally{g(!1)}};return!a||m||C?e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center p-4",children:e.jsxs("div",{className:"text-center space-y-3",children:[e.jsx("div",{className:"w-16 h-16 border-4 border-primary border-t-transparent rounded-full animate-spin mx-auto"}),e.jsx("p",{className:"text-muted-foreground text-sm",children:"Loading your motivator..."})]})}):t&&!n?e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center p-4",children:e.jsxs("div",{className:"text-center space-y-4 max-w-md",children:[e.jsx("p",{className:"text-lg font-semibold",children:"We couldn't load your profile"}),e.jsx("p",{className:"text-muted-foreground",children:"Connection may have dropped while the app was in the background. Try again."}),e.jsx(u,{onClick:()=>{b()},disabled:f||x,children:f||x?"Retrying...":"Retry"})]})}):j?S&&!p?e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center p-4",children:e.jsxs("div",{className:"text-center space-y-4 max-w-md",children:[e.jsx("p",{className:"text-lg font-semibold",children:"We couldn't load your mentor"}),e.jsx("p",{className:"text-muted-foreground",children:"Connection may have dropped while the app was in the background. Try again."}),e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(u,{onClick:()=>{b()},disabled:f||x,children:f||x?"Retrying...":"Retry"}),e.jsx(u,{variant:"outline",onClick:()=>l("/mentor-selection"),children:"Choose Mentor"})]})]})}):p?e.jsxs(be,{children:[e.jsxs("div",{className:"min-h-screen bg-background pb-nav-safe pt-safe relative z-10",children:[e.jsxs("div",{className:"relative h-48 md:h-64 overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-primary/30 via-accent/20 to-background animate-gradient-shift"}),e.jsx("div",{className:"absolute inset-0 bg-[radial-gradient(circle_at_center,_var(--tw-gradient-stops))] from-primary/40 via-transparent to-transparent"}),e.jsxs("div",{className:"absolute inset-0",children:[e.jsx("div",{className:"absolute top-1/4 left-1/4 w-2 h-2 bg-primary/60 rounded-full animate-float-slow"}),e.jsx("div",{className:"absolute top-1/3 right-1/3 w-3 h-3 bg-accent/60 rounded-full animate-float-medium",style:{animationDelay:"0.5s"}}),e.jsx("div",{className:"absolute bottom-1/4 left-1/3 w-2 h-2 bg-primary/40 rounded-full animate-float-fast",style:{animationDelay:"1s"}}),e.jsx("div",{className:"absolute top-1/2 right-1/4 w-2 h-2 bg-accent/50 rounded-full animate-float-slow",style:{animationDelay:"1.5s"}})]}),p.avatar_url&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 bg-primary/30 blur-3xl rounded-full animate-pulse"}),e.jsx("img",{src:p.avatar_url,alt:p.name,className:"relative w-24 h-24 md:w-32 md:h-32 rounded-full border-4 border-background shadow-glow-lg object-cover",loading:"lazy",decoding:"async"})]})}),e.jsxs("div",{className:"absolute top-4 left-4 right-4 z-10 flex items-center justify-between safe-area-top",children:[e.jsx(u,{variant:"ghost",size:"icon",onClick:()=>l("/mentor"),className:"bg-background/80 backdrop-blur-sm hover:bg-background/90 rounded-full shadow-soft",children:e.jsx(de,{className:"w-5 h-5"})}),e.jsx(ve,{onClick:()=>{_.tap(),h(!0)}})]}),e.jsxs("div",{className:"absolute bottom-0 left-0 right-0 bg-gradient-to-t from-background via-background/95 to-transparent p-6 pb-4",children:[e.jsxs("h1",{className:"text-2xl md:text-3xl font-heading font-black text-foreground text-center",children:["Ask ",p.name]}),e.jsx("p",{className:"text-sm text-muted-foreground text-center",children:"Get guidance from your motivator"})]})]}),e.jsx("div",{className:"container max-w-4xl mx-auto p-4 md:p-6 space-y-6",children:e.jsx(We,{mentorName:p.name,mentorTone:p.tone_description,mentorId:p.id,briefingContext:F,comprehensiveMode:W})})]}),e.jsx(we,{}),e.jsx(je,{open:k,onClose:()=>h(!1),title:"About Your Mentor",icon:ue,description:"Your personal motivator is here to guide and support you on your journey.",features:["Ask questions and get personalized advice","Receive guidance tailored to your goals","Get encouragement when you need it most","Chat anytime for instant motivation"],tip:"Your mentor's tone and style match your preferences from onboarding."}),e.jsx(ke,{open:N,onClose:L})]}):e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center p-4",children:e.jsxs("div",{className:"text-center space-y-4 max-w-md",children:[e.jsx("p",{className:"text-lg font-semibold",children:"Mentor unavailable"}),e.jsx("p",{className:"text-muted-foreground",children:"We couldn't find your selected mentor right now."}),e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(u,{onClick:()=>{b()},disabled:f||x,children:f||x?"Retrying...":"Retry"}),e.jsx(u,{variant:"outline",onClick:()=>l("/mentor-selection"),children:"Choose Mentor"})]})]})}):e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center p-4",children:e.jsxs("div",{className:"text-center space-y-4 max-w-md",children:[e.jsx("p",{className:"text-lg font-semibold",children:"No mentor selected"}),e.jsx("p",{className:"text-muted-foreground",children:"Please select a mentor to continue."}),e.jsx(u,{onClick:()=>l("/mentor-selection"),children:"Choose Your Mentor"})]})})}export{Be as default};
