import{r,o as qe,ai as hs,aj as ps,j as e,K as X,am as Ee,aZ as fs,M as gs,cd as js,Z as Ie,c6 as bs,dd as Le,bd as Ns,be as Fe,aa as V,bC as le,al as oe,aA as T,cp as Ye,de as ys,df as vs,bN as je,aR as ws,bk as ze,L as Cs,bE as ks,v as xe,H as Oe,J as fe,Q as Ss,c5 as Ps,aV as Ce,aU as ke,bo as _s,b0 as ue,a_ as Ds,u as Se,dg as As,bp as Rs,ce as Ms,ak as Ts,cL as Pe,dh as qs,W as Es,U as Is,az as Ls}from"./vendor-CkzXtEGd.js";import{e as w,k as W,b as ne,u as G,m as Fs,n as Ue,L as C,o as Y,p as se,q as te,r as ae,t as re,v as A,w as $e,x as Ys,s as k,y as be,z as Ne,B as j,A as ye,D as zs,E as ve,F as me,G as ee,H as I,J as L,K as O,f as q,a as we,c as Os,N as Qe,O as Us,Q as Be,R as He,T as Ve,U as Xe,V as We,W as Ge,X as Ke,Y as $s,Z as Qs,_ as Bs,$ as Hs,a0 as Vs,a1 as Xs,a2 as Z,a3 as Ws,a4 as ge,a5 as _e,a6 as Gs,a7 as De,g as Ks,d as Ae,S as Re,a8 as Me,a9 as Zs,aa as Js,ab as et,ac as ce,ad as de,ae as st}from"./index-B9iotTKE.js";import{A as Ze,a as Je}from"./alert-R1BpSyQT.js";import{g as tt,C as at,L as rt}from"./CompanionPersonalization-DpRcD7Qb.js";import"./date-vendor-CuPqBTxb.js";import"./three-vendor-qI8GXUTd.js";const nt=({onLongPress:s,onPressStart:i,onPressEnd:a,threshold:t=500,moveThreshold:d=12})=>{const[n,h]=r.useState(!1),[x,l]=r.useState(!1),m=r.useRef(null),c=r.useRef(null),f=r.useRef(!1),p=r.useRef(!1),u=r.useRef(null),o=r.useRef(null),N=r.useRef(null),R=async()=>{if(qe.isNativePlatform())try{await hs.impact({style:ps.Medium})}catch{}},S=r.useCallback(()=>{if(o.current!==null&&N.current){try{N.current.releasePointerCapture?.(o.current)}catch{}o.current=null}},[]),P=r.useCallback(()=>{m.current&&(clearTimeout(m.current),m.current=null),c.current=null,u.current=null,N.current=null,o.current=null,h(!1),l(!1),a?.()},[a]),_=r.useCallback(()=>{p.current=!1,f.current=!1,S(),P()},[P,S]),U=r.useCallback(v=>{if(!(v.button!==0&&v.pointerType==="mouse")){p.current=!1,f.current=!1,h(!0),i?.(),o.current=v.pointerId,N.current=v.target;try{v.target.setPointerCapture?.(v.pointerId)}catch{}u.current=v,c.current={x:v.clientX,y:v.clientY},m.current=setTimeout(()=>{f.current=!0,p.current=!0,l(!0),S(),R(),u.current&&s(u.current)},t)}},[s,i,t,S]),$=r.useCallback(v=>{if(p.current||!c.current||!m.current)return;const D=Math.abs(v.clientY-c.current.y);!f.current&&D>d&&P()},[P,d]),Q=r.useCallback(v=>{if(p.current)return _(),!1;const D=f.current;return D&&(v.preventDefault(),v.stopPropagation()),_(),D},[_]),z=r.useCallback(()=>{p.current||(f.current=!1,P())},[P]);return{isPressed:n,isActivated:x,handlers:{onPointerDown:U,onPointerMove:$,onPointerUp:Q,onPointerCancel:()=>{p.current||z()}},reset:_}},it=[{icon:X,title:"Daily Pep Talk",message:"Your mentor has a new message: 'Remember, you're capable of more than you think.'",time:"8:00 AM",color:"text-purple-400"},{icon:Ee,title:"Daily Mission",message:"New challenge unlocked: Complete 3 habits today for bonus XP!",time:"9:00 AM",color:"text-blue-400"},{icon:fs,title:"Streak Milestone",message:"ðŸ”¥ You're on fire! 7 day streak achieved!",time:"6:00 PM",color:"text-orange-400"},{icon:gs,title:"Motivational Quote",message:"Success is not final, failure is not fatal: it is the courage to continue that counts.",time:"12:00 PM",color:"text-emerald-400"}],es=r.memo(()=>e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"text-lg font-heading font-bold text-foreground",children:"What You'll Receive"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Preview of notifications that will help keep you motivated and on track:"})]}),e.jsx("div",{className:"space-y-3",children:it.map((s,i)=>{const a=s.icon;return e.jsx(w,{className:"p-4 bg-card/50 border-border/50 hover:bg-card/80 transition-all duration-300",children:e.jsxs("div",{className:"flex gap-3 items-start",children:[e.jsx("div",{className:`p-2 rounded-full bg-background/50 ${s.color}`,children:e.jsx(a,{className:"h-4 w-4"})}),e.jsxs("div",{className:"flex-1 min-w-0 space-y-1",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("p",{className:"font-semibold text-sm text-foreground truncate",children:s.title}),e.jsx("span",{className:"text-xs text-muted-foreground whitespace-nowrap",children:s.time})]}),e.jsx("p",{className:"text-xs text-muted-foreground leading-relaxed",children:s.message})]})]})},i)})}),e.jsx("div",{className:"bg-primary/5 border border-primary/20 rounded-lg p-4",children:e.jsxs("p",{className:"text-xs text-muted-foreground leading-relaxed",children:[e.jsx("span",{className:"text-primary font-semibold",children:"ðŸ’¡ Tip:"})," Notifications are personalized to your mentor's style and your goals. You can adjust timing and frequency in settings anytime."]})})]}));es.displayName="NotificationPreview";const Te=[{value:"06:00",label:"6:00 AM"},{value:"07:00",label:"7:00 AM"},{value:"08:00",label:"8:00 AM"},{value:"09:00",label:"9:00 AM"},{value:"10:00",label:"10:00 AM"},{value:"12:00",label:"12:00 PM"},{value:"18:00",label:"6:00 PM"},{value:"19:00",label:"7:00 PM"},{value:"20:00",label:"8:00 PM"}],ss=r.memo(()=>{const{profile:s}=W(),{user:i}=ne(),{toast:a}=G(),[t,d]=r.useState(!1),[n,h]=r.useState(!1);r.useEffect(()=>{h(Fs())},[]),r.useEffect(()=>{i&&Ue(i.id).then(d)},[i]);const x=async u=>{if(i)try{u?(await $e(i.id),d(!0),a({title:"Notifications Enabled",description:"You'll receive daily notifications"})):(await Ys(i.id),d(!1),a({title:"Notifications Disabled",description:"You won't receive push notifications"}))}catch(o){console.error("Error toggling push notifications:",o),a({title:"Error",description:o instanceof Error?o.message:"Failed to toggle notifications",variant:"destructive"})}},l=async u=>{if(i){if(u&&!t){a({title:"Enable push notifications first",description:"Please enable browser notifications before activating daily pep talks",variant:"destructive"});return}try{const{error:o}=await k.from("profiles").update({daily_push_enabled:u}).eq("id",i.id);if(o)throw o;a({title:u?"Daily Push Enabled":"Daily Push Disabled",description:"Settings updated successfully"}),setTimeout(()=>window.location.reload(),1e3)}catch(o){console.error("Error toggling pep talk:",o),a({title:"Error",description:o instanceof Error?o.message:"Failed to toggle pep talk",variant:"destructive"})}}},m=async u=>{if(i){if(u&&!t){a({title:"Enable push notifications first",description:"Please enable browser notifications before activating daily quotes",variant:"destructive"});return}try{const{error:o}=await k.from("profiles").update({daily_quote_push_enabled:u}).eq("id",i.id);if(o)throw o;a({title:u?"Quote Push Enabled":"Quote Push Disabled",description:"Settings updated successfully"}),setTimeout(()=>window.location.reload(),1e3)}catch(o){console.error("Error toggling quote push:",o),a({title:"Error",description:o instanceof Error?o.message:"Failed to toggle quote push",variant:"destructive"})}}},c=async u=>{if(i){if(u&&!t){a({title:"Enable push notifications first",description:"Please enable browser notifications before activating habit reminders",variant:"destructive"});return}try{const{error:o}=await k.from("profiles").update({habit_reminders_enabled:u}).eq("id",i.id);if(o)throw o;a({title:u?"Habit Reminders Enabled":"Habit Reminders Disabled",description:"Settings updated successfully"}),setTimeout(()=>window.location.reload(),1e3)}catch(o){console.error("Error toggling habit reminders:",o),a({title:"Error",description:o instanceof Error?o.message:"Failed to toggle habit reminders",variant:"destructive"})}}},f=async u=>{if(i){if(u&&!t){a({title:"Enable push notifications first",description:"Please enable browser notifications before activating quest reminders",variant:"destructive"});return}try{const{error:o}=await k.from("profiles").update({task_reminders_enabled:u}).eq("id",i.id);if(o)throw o;a({title:u?"Quest Reminders Enabled":"Quest Reminders Disabled",description:"Settings updated successfully"}),setTimeout(()=>window.location.reload(),1e3)}catch(o){console.error("Error toggling task reminders:",o),a({title:"Error",description:o instanceof Error?o.message:"Failed to toggle task reminders",variant:"destructive"})}}},p=async(u,o)=>{if(i)try{const{error:N}=await k.from("profiles").update({[u]:o}).eq("id",i.id);if(N)throw N;a({title:"Time Updated",description:"Your push notification time has been updated"}),setTimeout(()=>window.location.reload(),1e3)}catch(N){console.error("Error updating time:",N),a({title:"Error",description:N instanceof Error?N.message:"Failed to update time",variant:"destructive"})}};return e.jsxs(w,{className:"p-6 bg-card border-border shadow-soft",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"bg-accent/20 p-2 rounded-xl",children:e.jsx(js,{className:"h-5 w-5 text-foreground"})}),e.jsx("h2",{className:"font-display text-2xl text-foreground",children:"Daily Notifications"})]}),e.jsx("p",{className:"text-muted-foreground text-sm mb-6",children:"Get personalized pep talks and quotes delivered daily."}),!n&&e.jsxs(Ze,{className:"mb-6",children:[e.jsx(Ie,{className:"h-4 w-4"}),e.jsx(Je,{children:"Push notifications are only available on iOS devices."})]}),e.jsxs("div",{className:"space-y-6",children:[n&&e.jsx("div",{className:"space-y-3 pb-4 border-b border-border",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(C,{className:"text-foreground font-medium",children:"Browser Notifications"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Allow this app to send you notifications"})]}),e.jsx(Y,{checked:t,onCheckedChange:x})]})}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(C,{className:"text-foreground font-medium",children:"Daily Pep Talk"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Personalized motivation from your mentor"})]}),e.jsx(Y,{checked:s?.daily_push_enabled??!1,onCheckedChange:l,disabled:!t})]}),s?.daily_push_enabled&&e.jsxs("div",{className:"ml-0 space-y-2",children:[e.jsx(C,{className:"text-sm text-muted-foreground",children:"Delivery Time"}),e.jsxs(se,{value:s.daily_push_time||"08:00",onValueChange:u=>p("daily_push_time",u),children:[e.jsx(te,{className:"w-full bg-background",children:e.jsx(ae,{})}),e.jsx(re,{className:"bg-card border-border",children:Te.map(u=>e.jsx(A,{value:u.value,children:u.label},u.value))})]})]})]}),s?.timezone&&e.jsxs("div",{className:"space-y-3 pt-4 border-t border-border",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(bs,{className:"h-4 w-4 text-muted-foreground"}),e.jsx(C,{className:"text-muted-foreground text-sm",children:"Timezone"})]}),e.jsx("span",{className:"text-sm text-foreground",children:s.timezone})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"All notification times are shown in your local timezone"})]}),e.jsxs("div",{className:"space-y-3 pt-4 border-t border-border",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(C,{className:"text-foreground font-medium",children:"Daily Quote"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Inspiring quotes to start your day"})]}),e.jsx(Y,{checked:s?.daily_quote_push_enabled??!1,onCheckedChange:m,disabled:!t})]}),s?.daily_quote_push_enabled&&e.jsxs("div",{className:"ml-0 space-y-2",children:[e.jsx(C,{className:"text-sm text-muted-foreground",children:"Delivery Time"}),e.jsxs(se,{value:s.daily_quote_push_time||"07:00",onValueChange:u=>p("daily_quote_push_time",u),children:[e.jsx(te,{className:"w-full bg-background",children:e.jsx(ae,{})}),e.jsx(re,{className:"bg-card border-border",children:Te.map(u=>e.jsx(A,{value:u.value,children:u.label},u.value))})]})]})]}),e.jsx("div",{className:"space-y-3 pt-4 border-t border-border",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(C,{className:"text-foreground font-medium",children:"Star Path Habit Reminders"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Get notified when your habits are due"})]}),e.jsx(Y,{checked:s?.habit_reminders_enabled??!0,onCheckedChange:c,disabled:!t})]})}),e.jsx("div",{className:"space-y-3 pt-4 border-t border-border",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(C,{className:"text-foreground font-medium",children:"Quest Reminders"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Get notified before scheduled quests"})]}),e.jsx(Y,{checked:s?.task_reminders_enabled??!0,onCheckedChange:f,disabled:!t})]})}),t&&(s?.daily_push_enabled||s?.daily_quote_push_enabled)&&e.jsx("div",{className:"pt-6 mt-6 border-t border-border",children:e.jsx(es,{})}),e.jsx(ts,{userId:i?.id})]})]})});ss.displayName="PushNotificationSettings";const ts=r.memo(({userId:s})=>{const[i,a]=r.useState(!1),[t,d]=r.useState(null),[n,h]=r.useState(!1),[x,l]=r.useState(!1),{toast:m}=G(),c=async()=>{h(!0);try{const p=await zs(s||""),u=s?await Ue(s):!1;d({...p,hasToken:u})}catch(p){console.error("Debug info error:",p)}finally{h(!1)}},f=async()=>{if(!s){m({title:"Error",description:"No user ID available",variant:"destructive"});return}l(!0);try{await $e(s),m({title:"Registration Initiated",description:"Check Xcode console for detailed logs"}),setTimeout(c,2e3)}catch(p){m({title:"Registration Failed",description:p instanceof Error?p.message:"Unknown error",variant:"destructive"})}finally{l(!1)}};return r.useEffect(()=>{i&&!t&&c()},[i]),e.jsxs(be,{open:i,onOpenChange:a,className:"pt-4 border-t border-border",children:[e.jsx(Ne,{asChild:!0,children:e.jsxs(j,{variant:"ghost",className:"w-full justify-between p-0 h-auto hover:bg-transparent",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Le,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"Debug Push Notifications"})]}),i?e.jsx(Ns,{className:"h-4 w-4 text-muted-foreground"}):e.jsx(Fe,{className:"h-4 w-4 text-muted-foreground"})]})}),e.jsx(ye,{className:"mt-4 space-y-4",children:n?e.jsx("div",{className:"flex items-center justify-center py-4",children:e.jsx(V,{className:"h-5 w-5 animate-spin text-muted-foreground"})}):t?e.jsxs("div",{className:"space-y-3 text-sm",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-muted-foreground",children:"Platform:"}),e.jsx("span",{className:"font-mono text-foreground",children:t.platform})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[t.isNative?e.jsx(le,{className:"h-4 w-4 text-green-500"}):e.jsx(oe,{className:"h-4 w-4 text-red-500"}),e.jsx("span",{className:"text-muted-foreground",children:"Native:"}),e.jsx("span",{className:"text-foreground",children:t.isNative?"Yes":"No"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[t.isSupported?e.jsx(le,{className:"h-4 w-4 text-green-500"}):e.jsx(oe,{className:"h-4 w-4 text-red-500"}),e.jsx("span",{className:"text-muted-foreground",children:"Supported:"}),e.jsx("span",{className:"text-foreground",children:t.isSupported?"Yes":"No"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[t.permissionStatus==="granted"?e.jsx(le,{className:"h-4 w-4 text-green-500"}):e.jsx(oe,{className:"h-4 w-4 text-yellow-500"}),e.jsx("span",{className:"text-muted-foreground",children:"Permission:"}),e.jsx("span",{className:"text-foreground",children:t.permissionStatus})]}),e.jsxs("div",{className:"flex items-center gap-2 col-span-2",children:[t.hasToken?e.jsx(le,{className:"h-4 w-4 text-green-500"}):e.jsx(oe,{className:"h-4 w-4 text-red-500"}),e.jsx("span",{className:"text-muted-foreground",children:"Token in DB:"}),e.jsx("span",{className:"text-foreground",children:t.hasToken?"Yes":"No"})]})]}),t.error&&e.jsxs(Ze,{variant:"destructive",className:"mt-2",children:[e.jsx(Ie,{className:"h-4 w-4"}),e.jsx(Je,{className:"text-xs",children:t.error})]}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsx(j,{variant:"outline",size:"sm",onClick:c,disabled:n,children:"Refresh"}),e.jsx(j,{variant:"default",size:"sm",onClick:f,disabled:x||!t.isSupported,children:x?e.jsxs(e.Fragment,{children:[e.jsx(V,{className:"h-4 w-4 mr-2 animate-spin"}),"Registering..."]}):"Test Registration"})]})]}):e.jsx("p",{className:"text-sm text-muted-foreground",children:"Failed to load debug info"})})]})});ts.displayName="PushDebugPanel";const as=r.memo(()=>{const{user:s}=ne(),{profile:i}=W(),[a,t]=r.useState(!1),d=async x=>{if(s){t(!0);try{const{error:l}=await k.from("profiles").update({daily_quote_push_enabled:x}).eq("id",s.id);if(l)throw l;T.success(x?"Daily quotes enabled":"Daily quotes disabled")}catch(l){T.error("Failed to update settings"),console.error(l)}finally{t(!1)}}},n=async x=>{if(s){t(!0);try{const{error:l}=await k.from("profiles").update({daily_quote_push_window:x}).eq("id",s.id);if(l)throw l;T.success("Delivery time updated")}catch(l){T.error("Failed to update settings"),console.error(l)}finally{t(!1)}}},h=async x=>{if(s){t(!0);try{const{error:l}=await k.from("profiles").update({daily_quote_push_time:x}).eq("id",s.id);if(l)throw l;T.success("Delivery time updated")}catch(l){T.error("Failed to update settings"),console.error(l)}finally{t(!1)}}};return e.jsx(w,{className:"p-6 bg-card/50 backdrop-blur-sm border-primary/20",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(X,{className:"h-5 w-5 text-primary"}),e.jsx("h3",{className:"text-lg font-semibold",children:"Daily Quote Notifications"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(C,{htmlFor:"quote-push-toggle",className:"text-base",children:"Enable Daily Quotes"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Receive an inspiring quote from your mentor each day"})]}),e.jsx(Y,{id:"quote-push-toggle",checked:i?.daily_quote_push_enabled??!0,onCheckedChange:d,disabled:a})]}),i?.daily_quote_push_enabled&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(C,{htmlFor:"quote-window",children:"Delivery Window"}),e.jsxs(se,{value:i?.daily_quote_push_window||"afternoon",onValueChange:n,disabled:a,children:[e.jsx(te,{id:"quote-window",children:e.jsx(ae,{placeholder:"Select time of day"})}),e.jsxs(re,{children:[e.jsx(A,{value:"morning",children:"Morning (6 AM - 12 PM)"}),e.jsx(A,{value:"afternoon",children:"Afternoon (12 PM - 6 PM)"}),e.jsx(A,{value:"evening",children:"Evening (6 PM - 10 PM)"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(C,{htmlFor:"quote-time",children:"Preferred Time"}),e.jsxs(se,{value:i?.daily_quote_push_time||"14:00:00",onValueChange:h,disabled:a,children:[e.jsx(te,{id:"quote-time",children:e.jsx(ae,{placeholder:"Select specific time"})}),e.jsxs(re,{children:[e.jsx(A,{value:"08:00:00",children:"8:00 AM"}),e.jsx(A,{value:"09:00:00",children:"9:00 AM"}),e.jsx(A,{value:"10:00:00",children:"10:00 AM"}),e.jsx(A,{value:"12:00:00",children:"12:00 PM"}),e.jsx(A,{value:"14:00:00",children:"2:00 PM"}),e.jsx(A,{value:"16:00:00",children:"4:00 PM"}),e.jsx(A,{value:"18:00:00",children:"6:00 PM"}),e.jsx(A,{value:"20:00:00",children:"8:00 PM"})]})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Quotes will be delivered around this time each day"})]})]})]})]})})});as.displayName="DailyQuoteSettings";const rs=r.memo(()=>{const{referralStats:s,availableSkins:i}=ve(),[a,t]=r.useState(!1),d=async()=>{if(!s?.referral_code)return;t(!0);const x=`Join me on Cosmiq and use my code: ${s.referral_code}`;try{if(qe.isNativePlatform())try{await ws.share({title:"Join Cosmiq",text:x,dialogTitle:"Share your referral code"})}catch(l){console.error("Share failed:",l);const m=l?.message?.toLowerCase()||l?.toString?.()?.toLowerCase()||"";m.includes("cancel")||m.includes("abort")||m.includes("dismissed")||l?.name==="AbortError"||await n()}else if(navigator.share)try{await navigator.share({title:"Join Cosmiq",text:x})}catch(l){console.error("Share failed:",l);const m=l?.message?.toLowerCase()||l?.toString?.()?.toLowerCase()||"";m.includes("cancel")||m.includes("abort")||m.includes("dismissed")||l?.name==="AbortError"||await n()}else await n()}finally{t(!1)}},n=async()=>{if(s?.referral_code)try{if(navigator.clipboard&&navigator.clipboard.writeText)await navigator.clipboard.writeText(s.referral_code),T.success("Referral code copied to clipboard!");else{const x=document.createElement("textarea");x.value=s.referral_code,x.style.position="fixed",x.style.opacity="0",document.body.appendChild(x),x.select(),document.execCommand("copy"),document.body.removeChild(x),T.success("Referral code copied to clipboard!")}}catch(x){console.error("Copy failed:",x),T.error(`Failed to copy. Your code: ${s.referral_code}`)}},h=i?.find(x=>(x.unlock_requirement||0)>(s?.referral_count||0));return e.jsxs(w,{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ye,{className:"h-6 w-6 text-primary"}),e.jsx("h3",{className:"text-xl font-bold",children:"Referral Rewards"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Your Referral Code"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("div",{className:"flex-1 bg-secondary rounded-lg p-3 text-center font-mono text-lg font-bold",children:s?.referral_code||"Loading..."}),e.jsx(j,{variant:"outline",size:"icon",onClick:n,disabled:!s?.referral_code,children:e.jsx(ys,{className:"h-4 w-4"})})]})]}),e.jsxs(j,{className:"w-full",onClick:d,disabled:!s?.referral_code||a,children:[e.jsx(vs,{className:"mr-2 h-4 w-4"}),a?"Sharing...":"Share Your Code"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 pt-4 border-t",children:[e.jsxs("div",{className:"text-center space-y-1",children:[e.jsx("p",{className:"text-2xl font-bold text-primary",children:s?.referral_count||0}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Friends Referred"})]}),e.jsxs("div",{className:"text-center space-y-1",children:[e.jsx("p",{className:"text-2xl font-bold text-primary",children:h?.unlock_requirement||0}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Next Milestone"})]})]}),h&&e.jsxs("div",{className:"bg-secondary/50 rounded-lg p-4 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm font-medium",children:[e.jsx(je,{className:"h-4 w-4 text-primary"}),e.jsx("span",{children:"Next Reward"})]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Refer ",(h.unlock_requirement||0)-(s?.referral_count||0)," more friend",(h.unlock_requirement||0)-(s?.referral_count||0)!==1?"s":""," to unlock:"]}),e.jsx("p",{className:"font-semibold",children:h.name})]})]})]})});rs.displayName="ReferralDashboard";const ns=r.memo(()=>{const{availableSkins:s,unlockedSkins:i,equipSkin:a,unequipSkin:t,referralStats:d}=ve(),[n,h]=r.useState(!1),x=c=>i?.some(f=>f.skin_id===c),l=c=>i?.some(f=>f.skin_id===c&&f.is_equipped),m=c=>{switch(c){case"legendary":return"text-yellow-500 border-yellow-500/50";case"epic":return"text-purple-500 border-purple-500/50";case"rare":return"text-blue-500 border-blue-500/50";default:return"text-gray-500 border-gray-500/50"}};return e.jsx(be,{open:n,onOpenChange:h,children:e.jsxs(w,{children:[e.jsx(Ne,{className:"w-full",children:e.jsxs("div",{className:"flex items-center justify-between p-4 hover:bg-accent/5 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(X,{className:"h-5 w-5 text-primary"}),e.jsx("h3",{className:"text-lg font-semibold",children:"Companion Skins"}),e.jsxs(me,{variant:"secondary",children:[i?.length||0," / ",s?.length||0]})]}),e.jsx(Fe,{className:ee("h-5 w-5 text-muted-foreground transition-transform",n&&"rotate-180")})]})}),e.jsx(ye,{children:e.jsx("div",{className:"p-4 pt-0 grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:s?.map(c=>{const f=x(c.id),p=l(c.id),u=d?.referral_count||0,o=Math.min(u,c.unlock_requirement||0);return e.jsxs(w,{className:ee("p-4 space-y-3 transition-all",f?"border-primary/50":"opacity-60",p&&"ring-2 ring-primary"),children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("h4",{className:"font-semibold",children:c.name}),e.jsx(me,{variant:"outline",className:m(c.rarity),children:c.rarity})]}),p&&e.jsx(ze,{className:"h-5 w-5 text-primary"})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:c.description}),f?e.jsx(j,{size:"sm",variant:p?"outline":"default",className:"w-full",onClick:()=>{p?t.mutate():a.mutate(c.id)},children:p?"Unequip":"Equip"}):e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(Cs,{className:"h-4 w-4"}),e.jsxs("span",{children:["Refer ",c.unlock_requirement??0," friend",(c.unlock_requirement??0)>1?"s":""]})]}),e.jsx("div",{className:"w-full bg-secondary rounded-full h-2",children:e.jsx("div",{className:"bg-primary h-full rounded-full transition-all",style:{width:`${o/(c.unlock_requirement||1)*100}%`}})}),e.jsxs("p",{className:"text-xs text-center text-muted-foreground",children:[o," / ",c.unlock_requirement]})]})]},c.id)})})})]})})});ns.displayName="CompanionSkins";const is=r.memo(()=>{const[s,i]=r.useState(""),[a,t]=r.useState(!1),{referralStats:d,applyReferralCode:n}=ve(),h=!!d?.referred_by,x=async l=>{l.preventDefault();const m=s.trim().toUpperCase();if(m){t(!0);try{await n.mutateAsync(m),i("")}catch{}finally{t(!1)}}};return e.jsxs(w,{children:[e.jsx(I,{children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(je,{className:"h-5 w-5 text-primary"}),e.jsxs("div",{children:[e.jsx(L,{children:"Enter a Referral Code"}),e.jsx(O,{children:"Entering a friend's code simply lets them earn cosmetic skins when you reach Stage 3."})]})]})}),e.jsx(q,{children:h?e.jsxs("div",{className:"flex items-start gap-3 rounded-xl border border-primary/20 bg-primary/5 p-4",children:[e.jsx(ks,{className:"h-5 w-5 text-primary mt-0.5"}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"font-medium text-foreground",children:"Referral code already applied"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Your friend will get their cosmetic reward once you hit Stage 3; nothing changes on your account."})]})]}):e.jsxs("form",{className:"space-y-3",onSubmit:x,children:[e.jsx(we,{placeholder:"REF-XXXXXXXX",value:s,onChange:l=>i(l.target.value.toUpperCase()),maxLength:12,className:"text-center text-lg tracking-wider"}),e.jsx(j,{type:"submit",className:"w-full",disabled:a||!s.trim(),children:a?"Applying...":"Apply Code"}),e.jsx("p",{className:"text-xs text-muted-foreground text-center",children:"Codes can be entered once per account. Weâ€™ll handle the rest automatically."})]})})]})});is.displayName="ReferralCodeRedeemCard";const ls=r.memo(({faction:s,variant:i="compact",className:a,showMotto:t=!0,showTraits:d=!0})=>{const n=tt(s);if(!n)return null;const h=n.icon;return i==="icon-only"?e.jsx("div",{className:ee("p-1.5 rounded-lg",a),style:{backgroundColor:`${n.color}30`},title:n.name,children:e.jsx(h,{className:"h-4 w-4",style:{color:n.color}})}):i==="compact"?e.jsxs("div",{className:ee("flex items-center gap-2 px-3 py-1.5 rounded-full",a),style:{backgroundColor:`${n.color}20`},children:[e.jsx(h,{className:"h-4 w-4",style:{color:n.color}}),e.jsx("span",{className:"text-sm font-medium",style:{color:n.color},children:n.name})]}):e.jsxs("div",{className:ee("rounded-xl overflow-hidden border",a),style:{borderColor:`${n.color}40`},children:[e.jsxs("div",{className:"relative h-32",children:[e.jsx("img",{src:n.image,alt:n.name,className:"w-full h-full object-cover"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-background via-background/60 to-transparent"}),e.jsxs("div",{className:"absolute bottom-3 left-4 flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg backdrop-blur-sm",style:{backgroundColor:`${n.color}30`},children:e.jsx(h,{className:"h-5 w-5",style:{color:n.color}})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold",style:n.nameStyle,children:n.name}),e.jsx("p",{className:"text-xs text-muted-foreground",children:n.subtitle})]})]})]}),e.jsxs("div",{className:"p-4 space-y-3 bg-card/50",children:[t&&e.jsx("div",{className:"p-3 rounded-lg border-l-2",style:{borderColor:n.color,backgroundColor:`${n.color}10`},children:e.jsxs("p",{className:"text-sm italic text-foreground/90",children:['"',n.motto,'"']})}),d&&e.jsx("div",{className:"flex flex-wrap gap-2",children:n.traits.map((x,l)=>e.jsx("span",{className:"px-2.5 py-1 rounded-full text-xs font-medium",style:{backgroundColor:`${n.color}20`,color:n.color},children:x},l))})]})]})});ls.displayName="FactionBadge";const os=r.memo(()=>{const[s,i]=r.useState(!1),[a,t]=r.useState(!1),[d,n]=r.useState(!1),h=xe(),{createCompanion:x}=Os(),l=async()=>{try{n(!0);const{data:c,error:f}=await k.functions.invoke("reset-companion");if(f)throw f;if(c?.success)await h.invalidateQueries({queryKey:["companion"]}),T.success("Companion reset! Create your new companion now."),i(!1),t(!0);else throw new Error(c?.error||"Failed to reset companion")}catch(c){console.error("Reset companion failed:",c),T.error(c.message||"Failed to reset companion")}finally{n(!1)}},m=async c=>{await x.mutateAsync(c),t(!1),T.success("Your new companion has been created!")};return e.jsxs(e.Fragment,{children:[e.jsxs(Qe,{open:s,onOpenChange:i,children:[e.jsx(Us,{asChild:!0,children:e.jsx(j,{variant:"outline",className:"w-full",disabled:d,children:d?"Resettingâ€¦":"Reset Companion"})}),e.jsxs(Be,{children:[e.jsxs(He,{children:[e.jsx(Ve,{children:"Reset your companion?"}),e.jsx(Xe,{children:"This will permanently delete your companion and its evolution history. You'll be able to create a new companion immediately after. This action cannot be undone."})]}),e.jsxs(We,{children:[e.jsx(Ge,{disabled:d,children:"Cancel"}),e.jsx(Ke,{onClick:l,disabled:d,children:d?"Resetting...":"Confirm Reset"})]})]})]}),e.jsx($s,{open:a,onOpenChange:t,children:e.jsxs(Qs,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsx(Bs,{children:e.jsx(Hs,{className:"text-2xl font-heading font-black",children:"Create Your New Companion"})}),e.jsx(at,{onComplete:m,isLoading:x.isPending})]})})]})});os.displayName="ResetCompanionButton";const lt=r.memo(function(){const i=Oe(),{toast:a}=G(),{subscription:t,isLoading:d,isActive:n,nextBillingDate:h,planPrice:x,plan:l,isCancelled:m}=Vs(),{handlePurchase:c,handleRestore:f,handleManageSubscriptions:p,loading:u,manageLoading:o,isAvailable:N,products:R,productsLoading:S,productError:P,hasLoadedProducts:_,reloadProducts:U}=Xs(),[$,Q]=r.useState("yearly"),[z,v]=r.useState(!1),D=r.useMemo(()=>R.reduce((g,H)=>(g[H.identifier]=H,g),{}),[R]),F=[{id:"monthly",label:"Monthly",productId:Z.MONTHLY,description:"Full access billed every month",hint:"Cancel anytime",fallbackPrice:"$9.99",billingPeriodLabel:"/month"},{id:"yearly",label:"Yearly",productId:Z.YEARLY,description:"Best value with 7-day trial",hint:"Equivalent to $4.99/month",fallbackPrice:"$59.99",billingPeriodLabel:"/year",badge:"Most popular"}],E=F.find(g=>g.id===$),he=E?D[E.productId]:void 0,ie=t?`You're on Cosmiq Premium (${l==="yearly"?"Yearly":"Monthly"})`:"You're on the free plan",b=t?t.status==="cancelled"?"Cancelling":t.status==="past_due"?"Past due":"Active":"Inactive",y=t?h?m?`Access until ${h.toLocaleDateString()}`:`Renews on ${h.toLocaleDateString()}`:"Renewal date not available yet":"Manage or restore to update your status",M=g=>{const H=D[g];return H?.price?H.price:g===Z.YEARLY?"$59.99":"$9.99"},B=g=>!N||u||S||P||!_?!1:!!D[g];return d?e.jsx(w,{children:e.jsx(q,{className:"pt-6 flex items-center justify-center",children:e.jsx(V,{className:"h-6 w-6 animate-spin text-muted-foreground"})})}):t?e.jsxs(w,{children:[e.jsxs(I,{children:[e.jsxs(L,{className:"flex items-center gap-2",children:[e.jsx(fe,{className:"h-5 w-5 text-primary"}),"Subscription Details"]}),e.jsx(O,{children:"Manage your Cosmiq Premium subscription"})]}),e.jsxs(q,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-1 rounded-lg border border-border/60 bg-muted/30 px-3 py-2",children:[e.jsx("p",{className:"font-semibold text-foreground",children:ie}),e.jsx("p",{className:"text-sm text-muted-foreground",children:y})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Status"}),e.jsx(me,{variant:n?"default":"secondary",children:b})]}),l&&e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Plan"}),e.jsx("span",{className:"font-medium capitalize",children:l})]}),x&&e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Price"}),e.jsx("span",{className:"font-medium",children:x})]}),h&&e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:m?"Access until":"Renews on"}),e.jsx("span",{className:"font-medium",children:h.toLocaleDateString()})]})]})]}),e.jsxs(Ws,{className:"flex flex-col gap-2",children:[e.jsxs(j,{onClick:p,variant:"outline",className:"w-full",disabled:o,children:[e.jsx(Ps,{className:"mr-2 h-4 w-4"}),o?"Opening subscriptions...":"Manage in iOS Settings"]}),e.jsx(j,{onClick:f,disabled:u,variant:"ghost",className:"w-full",children:u?e.jsxs(e.Fragment,{children:[e.jsx(V,{className:"mr-2 h-4 w-4 animate-spin"}),"Restoring..."]}):"Restore Purchases"})]})]}):e.jsxs(w,{children:[e.jsx(I,{children:e.jsxs(L,{className:"flex items-center gap-2",children:[e.jsx(fe,{className:"h-5 w-5 text-primary"}),"Go Premium"]})}),e.jsxs(q,{className:"space-y-5",children:[e.jsx(O,{className:"text-base",children:"Unlock all quests, mentor chat, Cosmiq Insights, and every future feature across iPhone and iPad."}),e.jsx("div",{className:"rounded-lg border border-border/60 bg-muted/30 px-3 py-2 text-sm text-foreground",children:ie}),S&&e.jsxs("div",{className:"flex items-center gap-2 rounded-lg border border-dashed border-muted-foreground/30 px-3 py-2 text-sm text-muted-foreground",children:[e.jsx(V,{className:"h-4 w-4 animate-spin"}),"Contacting the App Store..."]}),P&&e.jsxs("div",{className:"rounded-lg border border-destructive/40 bg-destructive/5 p-3 text-sm text-destructive flex flex-col gap-2",children:[e.jsx("span",{children:P}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx(j,{size:"sm",variant:"outline",onClick:()=>{U()},children:"Try Again"}),e.jsx(j,{size:"sm",variant:"ghost",onClick:()=>a({title:"Need help?",description:"Please ensure you're signed in to the App Store and try again."}),children:"Need help?"})]})]}),!N&&e.jsx("div",{className:"bg-muted/30 rounded-lg p-3 text-sm text-muted-foreground text-center",children:"In-App Purchases are only available on iOS devices"}),e.jsxs(be,{open:z,onOpenChange:v,children:[e.jsx(Ne,{asChild:!0,children:e.jsxs(j,{variant:"ghost",size:"sm",className:"w-full text-xs text-muted-foreground",children:[e.jsx(Le,{className:"h-3 w-3 mr-1"}),z?"Hide Debug Info":"Show Debug Info"]})}),e.jsx(ye,{children:e.jsxs("div",{className:"mt-2 p-3 rounded-lg bg-muted/50 border border-border/60 text-xs font-mono space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"IAP Available:"}),e.jsx("span",{className:N?"text-green-500":"text-red-500",children:N?"YES":"NO"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Products Loading:"}),e.jsx("span",{children:S?"YES":"NO"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Has Attempted Fetch:"}),e.jsx("span",{children:_?"YES":"NO"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Products Count:"}),e.jsx("span",{className:R.length>0?"text-green-500":"text-red-500",children:R.length})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Error:"}),e.jsx("span",{className:"text-red-500 truncate max-w-[60%]",children:P||"None"})]}),e.jsxs("div",{className:"border-t border-border/60 pt-2",children:[e.jsx("p",{className:"text-muted-foreground mb-1",children:"Expected Product IDs:"}),e.jsx("p",{className:"break-all",children:Z.MONTHLY}),e.jsx("p",{className:"break-all",children:Z.YEARLY})]}),e.jsxs("div",{className:"border-t border-border/60 pt-2",children:[e.jsx("p",{className:"text-muted-foreground mb-1",children:"Loaded Products:"}),R.length>0?R.map(g=>e.jsxs("div",{className:"text-green-500",children:["âœ“ ",g.identifier,": ",g.priceString]},g.identifier)):e.jsx("p",{className:"text-red-500",children:"No products loaded"})]}),e.jsxs("div",{className:"border-t border-border/60 pt-2",children:[e.jsx("p",{className:"text-muted-foreground mb-1",children:"ProductMap Keys:"}),e.jsx("p",{className:"break-all",children:Object.keys(D).length>0?Object.keys(D).join(", "):"Empty"})]}),e.jsxs(j,{size:"sm",variant:"outline",className:"w-full mt-2",onClick:()=>{U()},disabled:S,children:[e.jsx(Ss,{className:`h-3 w-3 mr-1 ${S?"animate-spin":""}`}),S?"Loading...":"Reload Products"]})]})})]}),e.jsx("div",{className:"grid gap-4 md:grid-cols-2",children:F.map(g=>{const H=M(g.productId),xs=$===g.id,pe=()=>Q(g.id);return e.jsx("div",{onClick:pe,onTouchEnd:K=>{K.preventDefault(),pe()},role:"button",tabIndex:0,onKeyDown:K=>{(K.key==="Enter"||K.key===" ")&&(K.preventDefault(),pe())},className:["rounded-2xl border p-4 flex flex-col gap-3 bg-card/60 backdrop-blur cursor-pointer transition-colors select-none",xs?"border-primary shadow-glow":"border-border/60 hover:border-primary/40"].join(" "),style:{WebkitTapHighlightColor:"transparent",touchAction:"manipulation"},children:e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"text-sm uppercase tracking-wide text-muted-foreground",children:g.label}),g.badge&&e.jsx(me,{variant:"secondary",className:"text-xs",children:g.badge})]}),e.jsxs("p",{className:"text-2xl font-semibold text-foreground mt-1",children:[H,e.jsx("span",{className:"text-sm font-normal text-muted-foreground",children:g.billingPeriodLabel})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:g.description}),e.jsx("p",{className:"text-xs text-muted-foreground",children:g.hint})]})},g.id)})}),e.jsx(j,{onClick:()=>E&&c(E.productId),disabled:!N||!E||!B(E.productId),className:"w-full",children:!N&&"Available on iOS only"||(u?e.jsxs(e.Fragment,{children:[e.jsx(V,{className:"mr-2 h-4 w-4 animate-spin"}),"Processing..."]}):`Subscribe ${E?.label??""} â€¢ ${he?.price??E?.fallbackPrice}${E?.billingPeriodLabel}`)}),!N&&e.jsx("p",{className:"text-xs text-muted-foreground text-center",children:"Purchases must be completed inside the Cosmiq iOS app. Open the iOS app to subscribe."}),e.jsx("div",{className:"space-y-2",children:["All 21 companion evolutions","Unlimited quests, epics, and mentor chat","Daily Cosmiq Insight across iPhone + iPad","Early access to new companions & stories"].map(g=>e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(fe,{className:"h-4 w-4 text-primary"}),e.jsx("span",{children:g})]},g))}),e.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:flex-wrap",children:[e.jsx(j,{variant:"outline",className:"w-full sm:flex-1",onClick:()=>i("/premium"),children:"View premium details"}),e.jsx(j,{variant:"outline",className:"w-full sm:flex-1",disabled:o,onClick:p,children:o?"Opening...":"Manage subscription"}),e.jsx(j,{variant:"ghost",className:"w-full sm:flex-1",disabled:u,onClick:f,children:u?"Restoring...":"Restore purchases"})]}),e.jsxs("p",{className:"text-xs text-center text-muted-foreground leading-relaxed",children:["Payment will be charged to your Apple ID account at confirmation of purchase. Subscription automatically renews unless canceled at least 24 hours before the end of the current period. Your account will be charged for renewal within 24 hours prior to the end of the current period. You can manage and cancel your subscriptions by going to Settings ",">"," [Your Name] ",">"," Subscriptions after purchase."]}),e.jsxs("div",{className:"flex justify-center gap-4 text-xs",children:[e.jsx("a",{href:"/privacy",className:"text-muted-foreground underline hover:text-foreground",children:"Privacy Policy"}),e.jsx("a",{href:"/terms",className:"text-muted-foreground underline hover:text-foreground",children:"Terms of Use"})]})]})]})}),cs=r.memo(()=>{const[s,i]=r.useState(.5),[a,t]=r.useState(!1),[d,n]=r.useState(ge.getMuted());r.useEffect(()=>{const m=_e.getItem("sound_volume"),c=_e.getItem("sound_muted");if(m){const p=parseFloat(m);!isNaN(p)&&p>=0&&p<=1&&i(p)}return c&&t(c==="true"),ge.subscribe(p=>{n(p)})},[]);const h=m=>{const c=m[0];i(c),De.setVolume(c)},x=()=>{const m=De.toggleMute();t(m)},l=()=>{const m=ge.toggleMute();n(m)};return e.jsxs(w,{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h3",{className:"text-lg font-semibold flex items-center gap-2",children:[e.jsx(Ce,{className:"w-5 h-5"}),"Sound Settings"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Customize your audio experience"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between py-3 px-4 rounded-lg bg-primary/5 border border-primary/20",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsxs(C,{htmlFor:"global-mute",className:"flex items-center gap-2 text-base font-medium",children:[d?e.jsx(ke,{className:"w-5 h-5 text-destructive"}):e.jsx(Ce,{className:"w-5 h-5 text-primary"}),"Mute All Audio"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Mutes everything: sound effects and pep talks"})]}),e.jsx(Y,{id:"global-mute",checked:d,onCheckedChange:l})]}),e.jsxs("div",{className:`space-y-3 transition-opacity ${d?"opacity-50 pointer-events-none":""}`,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(C,{className:"flex items-center gap-2",children:[a?e.jsx(ke,{className:"w-4 h-4"}):e.jsx(X,{className:"w-4 h-4"}),"Sound Effects Volume"]}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:[Math.round(s*100),"%"]})]}),e.jsx(Gs,{value:[s],onValueChange:h,max:1,step:.1,disabled:a||d,className:"w-full"})]}),e.jsxs("div",{className:`flex items-center justify-between py-2 transition-opacity ${d?"opacity-50 pointer-events-none":""}`,children:[e.jsx(C,{htmlFor:"mute",children:"Mute Sound Effects"}),e.jsx(Y,{id:"mute",checked:a,onCheckedChange:x,disabled:d})]})]})]})});cs.displayName="SoundSettings";const ds=r.memo(()=>{const{profile:s}=W();return e.jsxs(w,{children:[e.jsxs(I,{children:[e.jsxs(L,{className:"flex items-center gap-2",children:[e.jsx(X,{className:"h-5 w-5 text-accent-purple"}),"Zodiac Sign"]}),e.jsx(O,{children:"Your zodiac sign from onboarding"})]}),e.jsx(q,{children:e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-royal-purple/10 rounded-lg border border-royal-purple/30",children:[e.jsx(_s,{className:"w-6 h-6 text-accent-purple"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-pure-white capitalize",children:s?.zodiac_sign||"Not set"}),e.jsx("p",{className:"text-xs text-steel",children:"Your sun sign"})]})]})})]})});ds.displayName="AstrologySettings";const ot=()=>{const{user:s}=ne(),{profile:i}=W(),a=xe(),{toast:t}=G(),[d,n]=r.useState(!1),h=i?.completed_tasks_stay_in_place??!0,x=r.useCallback(async l=>{if(!(!s||d)){n(!0);try{const{error:m}=await k.from("profiles").update({completed_tasks_stay_in_place:l}).eq("id",s.id);if(m)throw m;a.invalidateQueries({queryKey:["profile",s.id]}),t({title:"Preference Updated",description:l?"Completed quests will stay in place":"Completed quests will move to the bottom"})}catch(m){console.error("Error updating preference:",m),t({title:"Error",description:"Failed to update preference",variant:"destructive"})}finally{n(!1)}}},[s,d,a,t]);return e.jsxs(w,{className:"border-border/50",children:[e.jsxs(I,{className:"pb-3",children:[e.jsxs(L,{className:"text-base flex items-center gap-2",children:[e.jsx(Ee,{className:"h-4 w-4 text-primary"}),"Quest Behavior"]}),e.jsx(O,{className:"text-xs",children:"Customize how completed quests are displayed"})]}),e.jsx(q,{children:e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(C,{htmlFor:"keep-in-place",className:"text-sm font-medium",children:"Keep completed quests in place"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"When off, completed quests move to the bottom of the list"})]}),e.jsx(Y,{id:"keep-in-place",checked:h,onCheckedChange:x,disabled:d})]})})]})},ct=s=>{if(!s)return"Anonymous";const a=s.onboarding_data?.userName;return a&&typeof a=="string"&&a.trim()?a.trim():s.email?s.email.split("@")[0]:"Anonymous"},us=r.memo(()=>{const{user:s}=ne(),{profile:i}=W(),{toast:a}=G(),t=xe(),d=ct(i),[n,h]=r.useState(""),[x,l]=r.useState(!1),[m,c]=r.useState(!1),f=async()=>{if(!(!s||!n.trim())){l(!0);try{const{data:o}=await k.from("profiles").select("onboarding_data").eq("id",s.id).maybeSingle(),R={...o?.onboarding_data||{},userName:n.trim()},{error:S}=await k.from("profiles").update({onboarding_data:R}).eq("id",s.id);if(S)throw S;await t.invalidateQueries({queryKey:["profile",s.id]}),a({title:"Display name updated",description:`You'll now be known as "${n.trim()}"`}),c(!1),h("")}catch(o){a({title:"Failed to update",description:o instanceof Error?o.message:"Something went wrong",variant:"destructive"})}finally{l(!1)}}},p=()=>{h(d==="Anonymous"?"":d),c(!0)},u=()=>{c(!1),h("")};return e.jsxs(w,{className:"border-border/50",children:[e.jsxs(I,{className:"pb-3",children:[e.jsxs(L,{className:"text-base flex items-center gap-2",children:[e.jsx(ue,{className:"h-4 w-4 text-primary"}),"Display Name"]}),e.jsx(O,{className:"text-xs",children:"How you appear across the app"})]}),e.jsx(q,{className:"space-y-3",children:m?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(C,{htmlFor:"displayName",className:"text-xs text-muted-foreground",children:"Enter your name"}),e.jsx(we,{id:"displayName",value:n,onChange:o=>h(o.target.value),placeholder:"Your display name",maxLength:50,className:"h-9",autoFocus:!0})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(j,{onClick:f,disabled:x||!n.trim(),size:"sm",className:"h-8 text-xs",children:[x?e.jsx(V,{className:"h-3 w-3 mr-1.5 animate-spin"}):e.jsx(ze,{className:"h-3 w-3 mr-1.5"}),"Save"]}),e.jsx(j,{onClick:u,variant:"outline",size:"sm",className:"h-8 text-xs",disabled:x,children:"Cancel"})]})]}):e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-9 h-9 rounded-full bg-primary/10 flex items-center justify-center",children:e.jsx("span",{className:"text-sm font-medium text-primary",children:d.charAt(0).toUpperCase()})}),e.jsx("span",{className:"font-medium",children:d})]}),e.jsx(j,{onClick:p,variant:"outline",size:"sm",className:"h-8 text-xs",children:"Edit"})]})})]})});us.displayName="DisplayNameSetting";const J=r.memo(({icon:s,label:i,description:a,onClick:t,variant:d="default"})=>e.jsxs("button",{onClick:t,className:`
      group flex items-center gap-3 p-4 rounded-2xl border transition-all duration-200 text-left w-full
      active:scale-[0.99]
      ${d==="accent"?"bg-gradient-to-br from-stardust-gold/10 to-amber-600/5 border-stardust-gold/25 sm:hover:border-stardust-gold/45":d==="info"?"bg-gradient-to-br from-celestial-blue/10 to-blue-600/5 border-celestial-blue/25 sm:hover:border-celestial-blue/45":"bg-card/75 border-border/55 sm:hover:border-primary/35 sm:hover:bg-card/90"}
    `,style:{WebkitTapHighlightColor:"transparent",touchAction:"manipulation"},children:[e.jsx("div",{className:`
      flex items-center justify-center w-10 h-10 rounded-lg shrink-0
      ${d==="accent"?"bg-stardust-gold/20 text-stardust-gold":d==="info"?"bg-celestial-blue/20 text-celestial-blue":"bg-primary/10 text-primary"}
    `,children:e.jsx(s,{className:"h-5 w-5"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("span",{className:"font-medium text-foreground block",children:i}),a&&e.jsx("span",{className:"text-xs text-muted-foreground block truncate",children:a})]}),e.jsx(Ls,{className:"h-4 w-4 text-muted-foreground/50 group-hover:text-muted-foreground transition-colors shrink-0"})]}));J.displayName="QuickActionCard";const ms=r.memo(({onNavigate:s})=>{const{handlers:i,isActivated:a}=nt({onLongPress:s,threshold:800});return e.jsxs("div",{...i,className:`cursor-pointer select-none transition-opacity ${a?"opacity-50":""}`,style:{WebkitTapHighlightColor:"transparent",touchAction:"manipulation"},children:[e.jsx("h1",{className:"text-2xl font-semibold tracking-tight",children:"Command Center"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Your account & settings"})]})});ms.displayName="DevTriggerHeader";const ft=()=>{const{user:s,signOut:i}=ne(),{profile:a}=W(),t=Oe(),d=Ds(),{toast:n}=G(),h=xe(),[x,l]=r.useState("account"),[m,c]=r.useState(!1),[f,p]=r.useState(!1),[u,o]=r.useState(null),[N,R]=r.useState(!1),[S,P]=r.useState(!1),[_,U]=r.useState(!1),[$,Q]=r.useState(""),z=$.trim().toLowerCase()==="delete";r.useEffect(()=>{d.state?.openTab&&l(d.state.openTab)},[d.state]),r.useEffect(()=>{d.state?.showDeleteDialog&&(l("account"),P(!0),t(d.pathname,{replace:!0,state:{}}))},[d.state?.showDeleteDialog,d.pathname,t]);const{data:v}=Se({queryKey:["mentors","active"],staleTime:600*1e3,queryFn:async()=>{const{data:b,error:y}=await k.from("mentors").select("id, name, slug, avatar_url, is_active").eq("is_active",!0).order("name");if(y)throw y;const M=new Map;for(const B of b||[]){const g=(B.slug||B.name||"").trim().toLowerCase();M.has(g)||M.set(g,B)}return Array.from(M.values()).sort((B,g)=>B.name.localeCompare(g.name))}}),D=Ks(a),{data:F}=Se({queryKey:["selected-mentor",D],staleTime:600*1e3,enabled:!!D,queryFn:async()=>{if(!D)throw new Error("No mentor selected");const{data:b,error:y}=await k.from("mentors").select("*").eq("id",D).maybeSingle();if(y)throw y;return b}}),E=r.useCallback(async b=>{if(!(!s||f)){p(!0);try{const y=a?.onboarding_data&&typeof a.onboarding_data=="object"&&!Array.isArray(a.onboarding_data)?a.onboarding_data:{},{error:M}=await k.from("profiles").update({selected_mentor_id:b,onboarding_data:{...y,mentorId:b},timezone:a?.timezone||Intl.DateTimeFormat().resolvedOptions().timeZone||"UTC"}).eq("id",s.id);if(M)throw M;n({title:"Mentor Updated",description:"Your mentor has been changed successfully"}),window.location.reload()}catch(y){const M=y instanceof Error?y.message:"Failed to change mentor";n({title:"Error",description:M,variant:"destructive"}),p(!1)}}},[s,f,a?.onboarding_data,a?.timezone,n]),he=r.useCallback(async()=>{if(!m){c(!0);try{await i(),t("/auth")}catch(b){const y=b instanceof Error?b.message:"Failed to sign out";n({title:"Error signing out",description:y,variant:"destructive"}),c(!1)}}},[m,i,t,n]),ie=r.useCallback(async()=>{if(!(!s||_||!z)){U(!0);try{const{data:{session:b},error:y}=await k.auth.getSession();if(y||!b?.access_token)throw new Error("Session expired. Please sign in again.");const{error:M}=await k.functions.invoke("delete-user",{headers:{Authorization:`Bearer ${b.access_token}`}});if(M)throw new Error(M.message||"Unable to delete account");h.clear(),P(!1),Q(""),n({title:"Account deleted",description:"Your account and saved progress have been permanently removed."}),await i(),t("/auth",{replace:!0,state:{message:"Your account has been deleted."}})}catch(b){const y=b instanceof Error?b.message:"Something went wrong deleting your account.";y.toLowerCase().includes("jwt")||y.toLowerCase().includes("token")?(n({title:"Session expired",description:"Please sign in again to continue.",variant:"destructive"}),await i(),t("/auth",{replace:!0})):n({title:"Account deletion failed",description:y,variant:"destructive"})}finally{U(!1)}}},[s,_,z,h,n,i,t]);return s?e.jsxs(Ae,{children:[e.jsx(Re,{}),e.jsxs("div",{className:"min-h-screen pb-nav-safe relative",children:[e.jsx("div",{className:"sticky top-0 z-40 cosmiq-glass-header safe-area-top",children:e.jsx("div",{className:"max-w-2xl mx-auto px-4 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(ms,{onNavigate:()=>t("/iap-test")}),e.jsx(Zs,{onClick:()=>R(!0)})]})})}),e.jsxs("div",{className:"max-w-2xl mx-auto px-4 py-6 space-y-6 relative z-10",children:[e.jsxs("section",{className:"space-y-3",children:[e.jsx("h2",{className:"text-sm font-semibold text-muted-foreground px-1",children:"Quick Access"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2",children:[e.jsx(J,{icon:As,label:"Library",description:"Favorites & downloads",onClick:()=>t("/library")}),e.jsx(J,{icon:X,label:"Weekly Recaps",description:"Past reflections",onClick:()=>t("/recaps"),variant:"accent"}),e.jsx(J,{icon:Rs,label:"Help Center",description:"Guides & tutorials",onClick:()=>t("/help"),variant:"info"}),e.jsx(J,{icon:Ye,label:"Contacts",description:"Manage your CRM",onClick:()=>t("/contacts")})]})]}),e.jsxs(Js,{value:x,onValueChange:l,className:"space-y-4",children:[e.jsxs(et,{className:"grid w-full grid-cols-4 h-auto p-1 bg-card/80 border border-border/60",children:[e.jsx(ce,{value:"account",className:"text-xs sm:text-sm py-2 font-medium",children:"Account"}),e.jsx(ce,{value:"rewards",className:"text-xs sm:text-sm py-2 font-medium",children:"Rewards"}),e.jsx(ce,{value:"notifications",className:"text-xs sm:text-sm py-2 font-medium",children:"Alerts"}),e.jsx(ce,{value:"preferences",className:"text-xs sm:text-sm py-2 font-medium",children:"Prefs"})]}),e.jsxs(de,{value:"account",className:"space-y-4",children:[a?.faction&&e.jsx(ls,{faction:a.faction,variant:"full",showMotto:!0,showTraits:!1}),e.jsxs(w,{className:"border-border/50",children:[e.jsx(I,{className:"pb-3",children:e.jsxs(L,{className:"text-base flex items-center gap-2",children:[e.jsx(ue,{className:"h-4 w-4 text-primary"}),"Account"]})}),e.jsx(q,{className:"space-y-3",children:e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Email"}),e.jsx("span",{className:"font-medium truncate ml-4",children:s.email})]})})]}),e.jsx(us,{}),e.jsx(lt,{}),e.jsxs(w,{className:"border-border/50",children:[e.jsxs(I,{className:"pb-3",children:[e.jsx(L,{className:"text-base",children:"Your Mentor"}),e.jsx(O,{className:"text-xs",children:"Change your AI mentor anytime"})]}),e.jsxs(q,{className:"space-y-3",children:[F&&e.jsxs("div",{className:"flex items-center gap-3 p-2.5 bg-muted/30 rounded-lg",children:[F.avatar_url&&e.jsx("img",{src:F.avatar_url,alt:F.name,className:"w-10 h-10 rounded-full object-cover",loading:"lazy",decoding:"async"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-sm",children:F.name}),e.jsx("p",{className:"text-xs text-muted-foreground truncate",children:F.tone_description})]})]}),e.jsxs(se,{value:a?.selected_mentor_id||"",onValueChange:E,disabled:f,children:[e.jsx(te,{disabled:f,className:"h-9",children:e.jsx(ae,{placeholder:f?"Changing...":"Select mentor"})}),e.jsx(re,{children:v?.map(b=>e.jsx(A,{value:b.id,children:b.name},b.id))})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs(j,{onClick:()=>t("/mentor-selection"),variant:"outline",size:"sm",className:"text-xs h-8",children:[e.jsx(ue,{className:"h-3 w-3 mr-1.5"}),"Browse All"]}),e.jsxs(j,{onClick:()=>t("/onboarding"),variant:"outline",size:"sm",className:"text-xs h-8",children:[e.jsx(Ms,{className:"h-3 w-3 mr-1.5"}),"Retake Quiz"]})]})]})]}),e.jsxs(w,{className:"border-border/50",children:[e.jsxs(I,{className:"pb-3",children:[e.jsx(L,{className:"text-base",children:"Companion"}),e.jsx(O,{className:"text-xs",children:"Reset to create a new companion"})]}),e.jsx(q,{children:e.jsx(os,{})})]}),e.jsxs(w,{className:"border-border/50",children:[e.jsx(I,{className:"pb-3",children:e.jsxs(L,{className:"text-base flex items-center gap-2",children:[e.jsx(Ts,{className:"h-4 w-4"}),"Legal"]})}),e.jsxs(q,{className:"space-y-2",children:[e.jsxs(j,{variant:"ghost",className:"w-full justify-start h-9 text-sm",onClick:()=>o("terms"),children:[e.jsx(Pe,{className:"h-4 w-4 mr-2 text-muted-foreground"}),"Terms of Service"]}),e.jsxs(j,{variant:"ghost",className:"w-full justify-start h-9 text-sm",onClick:()=>o("privacy"),children:[e.jsx(Pe,{className:"h-4 w-4 mr-2 text-muted-foreground"}),"Privacy Policy"]}),e.jsx(j,{variant:"ghost",className:"w-full justify-start h-9 text-sm",asChild:!0,children:e.jsxs("a",{href:"https://www.apple.com/legal/internet-services/itunes/dev/stdeula/",target:"_blank",rel:"noopener noreferrer",children:[e.jsx(qs,{className:"h-4 w-4 mr-2 text-muted-foreground"}),"Apple End User License Agreement"]})})]})]}),e.jsxs(w,{className:"border-destructive/30 bg-destructive/5",children:[e.jsx(I,{className:"pb-2",children:e.jsxs(L,{className:"text-base text-destructive flex items-center gap-2",children:[e.jsx(Es,{className:"h-4 w-4"}),"Danger Zone"]})}),e.jsxs(q,{className:"space-y-3",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Permanently delete your account, companion, and all progress."}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(j,{variant:"link",className:"px-0 text-xs text-muted-foreground h-auto",onClick:()=>t("/account-deletion"),children:"Learn more"}),e.jsx(j,{variant:"outline",size:"sm",className:"ml-auto border-destructive/40 text-destructive hover:bg-destructive/10 text-xs h-8",disabled:_,onClick:()=>P(!0),children:"Delete Account"})]})]})]})]}),e.jsxs(de,{value:"rewards",className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(je,{className:"h-5 w-5 text-primary"}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Referrals & Rewards"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Invite friends to unlock cosmetic companion skins"})]})]}),e.jsx(is,{}),e.jsx(rs,{}),e.jsx(ns,{})]}),e.jsxs(de,{value:"notifications",className:"space-y-4",children:[e.jsx(ss,{}),e.jsx(as,{})]}),e.jsxs(de,{value:"preferences",className:"space-y-4",children:[e.jsx(ot,{}),e.jsx(cs,{}),e.jsx(ds,{})]})]}),e.jsx("div",{className:"pt-4",children:e.jsxs(j,{onClick:he,variant:"ghost",className:"w-full text-muted-foreground hover:text-destructive",disabled:m,children:[e.jsx(Is,{className:"h-4 w-4 mr-2"}),m?"Signing out...":"Sign Out"]})})]})]}),e.jsx(Me,{}),e.jsx(Qe,{open:S,onOpenChange:b=>{_||(P(b),b||Q(""))},children:e.jsxs(Be,{children:[e.jsxs(He,{children:[e.jsx(Ve,{children:"Delete your account?"}),e.jsx(Xe,{children:"This will permanently delete your account, companion, and progress. This can't be undone."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(C,{htmlFor:"delete-confirmation-input",children:'Type "delete" to confirm'}),e.jsx(we,{id:"delete-confirmation-input",value:$,onChange:b=>Q(b.target.value),placeholder:'Type "delete"',autoComplete:"off",autoCapitalize:"none",autoCorrect:"off",spellCheck:!1,disabled:_})]}),e.jsxs(We,{children:[e.jsx(Ge,{disabled:_,children:"Cancel"}),e.jsx(Ke,{className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",onClick:ie,disabled:_||!z,children:_?"Deleting...":"Delete"})]})]})}),u&&e.jsx(rt,{open:u!==null,onOpenChange:b=>!b&&o(null),documentType:u}),e.jsx(st,{open:N,onClose:()=>R(!1),title:"About Command Center",icon:ue,description:"Manage your account settings, notifications, and preferences all in one place.",features:["Update your account information and subscription","Change your mentor anytime to match your needs","Manage push notifications and daily reminders","Share your referral code to unlock companion skins","Customize app preferences and sound settings"],tip:"Invite friends with your referral code to unlock exclusive companion skins!"})]}):e.jsxs(Ae,{children:[e.jsx(Re,{}),e.jsxs("div",{className:"min-h-screen pb-nav-safe flex items-center justify-center relative z-10",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-3xl font-bold mb-4",children:"Sign in to view your profile"}),e.jsx(j,{onClick:()=>t("/auth"),children:"Sign In"})]}),e.jsx(Me,{})]})]})};export{ft as default};
