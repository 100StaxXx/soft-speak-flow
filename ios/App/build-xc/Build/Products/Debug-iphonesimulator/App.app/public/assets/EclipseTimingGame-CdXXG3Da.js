import{j as e,m as fe,ar as $e,dy as qe,dz as Ye,ac as We,r,bo as Ve,n as Xe,aL as Ke,K as Ze}from"./vendor-CkzXtEGd.js";import{B as ge,b as Je,s as W,bt as Qe,bu as et,bv as tt,bs as Ne}from"./index-B9iotTKE.js";import{t as ue,u as st}from"./gameUtils-BnwM_CJ4.js";import"./date-vendor-CuPqBTxb.js";import"./three-vendor-qI8GXUTd.js";const rt=({trackName:l,onRate:f,onSkip:d,isSubmitting:a=!1,currentRating:n})=>{const i=b=>{ue("medium"),f(b)};return e.jsxs(fe.div,{className:"flex flex-col items-center gap-4 p-6 rounded-2xl",style:{background:"linear-gradient(135deg, hsl(var(--card)) 0%, hsl(var(--card) / 0.8) 100%)",border:"1px solid hsl(var(--border) / 0.5)",boxShadow:"0 8px 32px hsl(var(--primary) / 0.15)"},initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3},children:[e.jsxs("div",{className:"flex items-center gap-2 text-primary",children:[e.jsx($e,{className:"w-5 h-5"}),e.jsx("span",{className:"text-lg font-semibold",children:"Rate this track!"})]}),l&&e.jsx("p",{className:"text-sm text-muted-foreground text-center max-w-[200px] truncate",children:l}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(fe.div,{whileHover:{scale:1.05},whileTap:{scale:.95},children:e.jsxs(ge,{variant:n==="up"?"default":"outline",size:"lg",onClick:()=>i("up"),disabled:a,className:"flex items-center gap-2 min-w-[100px]",style:{background:n==="up"?"linear-gradient(135deg, hsl(142, 71%, 45%), hsl(142, 71%, 35%))":void 0,borderColor:"hsl(142, 71%, 45%)"},children:[e.jsx(qe,{className:`w-5 h-5 ${n==="up"?"fill-current":""}`}),e.jsx("span",{children:"Like"})]})}),e.jsx(fe.div,{whileHover:{scale:1.05},whileTap:{scale:.95},children:e.jsxs(ge,{variant:n==="down"?"default":"outline",size:"lg",onClick:()=>i("down"),disabled:a,className:"flex items-center gap-2 min-w-[100px]",style:{background:n==="down"?"linear-gradient(135deg, hsl(0, 84%, 60%), hsl(0, 84%, 50%))":void 0,borderColor:"hsl(0, 84%, 60%)"},children:[e.jsx(Ye,{className:`w-5 h-5 ${n==="down"?"fill-current":""}`}),e.jsx("span",{children:"Dislike"})]})})]}),e.jsxs(ge,{variant:"ghost",size:"sm",onClick:d,disabled:a,className:"text-muted-foreground hover:text-foreground",children:[e.jsx(We,{className:"w-4 h-4 mr-1"}),"Skip"]}),e.jsx("p",{className:"text-xs text-muted-foreground text-center",children:"Your feedback helps improve future tracks!"})]})},ot=()=>{const{user:l}=Je(),[f,d]=r.useState(null),[a,n]=r.useState(!1),[i,b]=r.useState(!1),[w,_]=r.useState(null),[c,g]=r.useState(null),x=r.useRef(!1),R=r.useCallback(async k=>{if(x.current)return null;x.current=!0,b(!0);try{console.log("Generating new rhythm track...");const{data:u,error:T}=await W.functions.invoke("generate-rhythm-track",{body:{genre:"stellar_beats",difficulty:k||"all"}});return T?(console.error("Error generating track:",T),null):u?.track?(console.log("Track generated successfully:",u.track),{...u.track,upvotes:0,downvotes:0,score:0,play_count:0}):null}catch(u){return console.error("Error generating track:",u),null}finally{b(!1),x.current=!1}},[]),de=r.useCallback(async k=>{n(!0),_(null),g(null);try{let u=W.from("rhythm_tracks").select("*").eq("is_active",!0);k&&k!=="all"&&(u=u.or(`difficulty_tier.eq.${k},difficulty_tier.eq.all`));const{data:T,error:B}=await u;if(B)return console.error("Error fetching rhythm tracks:",B),_("Failed to load tracks"),n(!1),null;if(!T||T.length===0){console.log("No rhythm tracks available, generating new track...");const m=await R(k);return m?(d(m),n(!1),m):(_("No tracks available"),n(!1),null)}const j=T.map(m=>m.id),{data:Z}=await W.from("rhythm_track_ratings").select("track_id, rating").in("track_id",j),J=T.map(m=>{const V=Z?.filter(I=>I.track_id===m.id)||[],E=V.filter(I=>I.rating==="up").length,X=V.filter(I=>I.rating==="down").length,Q=E-X;return{...m,upvotes:E,downvotes:X,score:Q}}),z=J.filter(m=>m.score>=-5);if(z.length===0){const m=J[Math.floor(Math.random()*J.length)];return d(m),await G(m.id),n(!1),m}const re=z.map(m=>Math.max(1,m.score+10)),me=re.reduce((m,V)=>m+V,0);let L=Math.random()*me,q=z[0];for(let m=0;m<z.length;m++)if(L-=re[m],L<=0){q=z[m];break}return d(q),await G(q.id),n(!1),q}catch(u){return console.error("Error in fetchRandomTrack:",u),_("Failed to load track"),n(!1),null}},[R]),G=async k=>{if(!l?.id)return;const{data:u}=await W.from("rhythm_track_ratings").select("rating").eq("track_id",k).eq("user_id",l.id).maybeSingle();u&&g(u.rating)},K=r.useCallback(async(k,u)=>{if(!l?.id)return console.error("User not authenticated"),!1;try{const{error:T}=await W.from("rhythm_track_ratings").upsert({track_id:k,user_id:l.id,rating:u},{onConflict:"track_id,user_id"});if(T)return console.error("Error rating track:",T),!1;if(g(u),f&&f.id===k){const B=u==="up"?1:-1;d(j=>j?{...j,upvotes:u==="up"?j.upvotes+1:j.upvotes,downvotes:u==="down"?j.downvotes+1:j.downvotes,score:j.score+B}:null)}return!0}catch(T){return console.error("Error rating track:",T),!1}},[l?.id,f]),se=r.useCallback(async k=>{try{const{data:u}=await W.from("rhythm_tracks").select("play_count").eq("id",k).maybeSingle();u&&await W.from("rhythm_tracks").update({play_count:(u.play_count||0)+1}).eq("id",k)}catch(u){console.error("Error incrementing play count:",u)}},[]);return{track:f,isLoading:a,isGenerating:i,error:w,userRating:c,fetchRandomTrack:de,rateTrack:K,incrementPlayCount:se}},Me={moon:0,star:1,sun:2},be=1500,nt={beginner:{notesPerBeat:.25,patterns:["single"]},easy:{notesPerBeat:.5,patterns:["single"]},medium:{notesPerBeat:1,patterns:["single","double"]},hard:{notesPerBeat:2,patterns:["single","double","triple"]},master:{notesPerBeat:3,patterns:["single","double","triple"]}},le={perfect:60,great:120,good:180},at=30,lt={beginner:12,easy:10,medium:8,hard:5,master:3},O=85,ct=16,Ee={perfect:{label:"PERFECT!",points:100,color:"hsl(45, 100%, 60%)"},great:{label:"GREAT!",points:75,color:"hsl(271, 91%, 65%)"},good:{label:"GOOD",points:50,color:"hsl(142, 71%, 45%)"},miss:{label:"MISS",points:0,color:"hsl(0, 84%, 60%)"}},F={moon:{icon:Ke,color:"hsl(271, 91%, 65%)",glowColor:"hsl(271, 91%, 75%)"},star:{icon:Xe,color:"hsl(45, 100%, 60%)",glowColor:"hsl(45, 100%, 70%)"},sun:{icon:Ve,color:"hsl(25, 95%, 55%)",glowColor:"hsl(25, 95%, 65%)"}},U=["moon","star","sun"],Se=1500,Te=500,je=l=>l>=50?4:l>=25?3:l>=10?2:1,ce={score:0,combo:0,maxCombo:0,notesHit:0,notesMissed:0},Ce=r.memo(({stars:l})=>e.jsxs("div",{className:"absolute inset-0 overflow-hidden pointer-events-none",children:[l.map((f,d)=>e.jsx("div",{className:"absolute rounded-full",style:{left:`${f.x}%`,top:`${f.y}%`,width:`${d%3===0?3:2}px`,height:`${d%3===0?3:2}px`,background:d%5===0?"hsl(45, 100%, 80%)":"hsl(210, 100%, 90%)",boxShadow:`0 0 ${2+d%3}px rgba(255,255,255,0.4)`,opacity:.4+d%4*.08}},f.id)),e.jsx("div",{className:"absolute inset-0 opacity-25",style:{background:"radial-gradient(ellipse at 20% 20%, hsl(271, 50%, 25%) 0%, transparent 50%), radial-gradient(ellipse at 80% 80%, hsl(45, 50%, 15%) 0%, transparent 50%)"}})]}));Ce.displayName="StaticStarBackground";const _e=r.memo(({note:l,laneIndex:f,gameTimeMs:d})=>{const a=F[l.lane],n=l.expectedHitTime-d,i=Math.max(0,Math.min(1,1-n/be)),b=.4+i*.6,w=30+i*50;return e.jsxs("div",{className:"absolute pointer-events-none",style:{left:`calc(${(f+.5)*33.33}% - 45px)`,top:`${l.y}%`,transform:"translateY(-50%) translateZ(0)",willChange:"transform",zIndex:15},children:[e.jsx("div",{className:"absolute left-1/2 -translate-x-1/2",style:{width:"60px",height:`${w}px`,bottom:"100%",background:`linear-gradient(to bottom, transparent 0%, ${a.color}40 50%, ${a.color}80 100%)`,filter:`blur(${4+i*4}px)`,opacity:b*.7}}),e.jsx("div",{style:{width:"90px",height:"18px",borderRadius:"9px",background:`linear-gradient(180deg, ${a.glowColor} 0%, ${a.color} 50%, ${a.color}cc 100%)`,boxShadow:`
            0 0 ${10+i*15}px ${a.color}${Math.round(b*99).toString(16).padStart(2,"0")},
            0 0 ${20+i*20}px ${a.color}60,
            inset 0 2px 4px rgba(255,255,255,0.4),
            inset 0 -2px 4px rgba(0,0,0,0.3)
          `,border:`2px solid ${a.glowColor}`,transform:`scaleY(${1+i*.2})`,transition:"transform 0.05s ease-out"},children:e.jsx("div",{className:"absolute top-1 left-2 right-2 h-1 rounded-full",style:{background:"rgba(255,255,255,0.5)"}})})]})});_e.displayName="NoteBar";const Re=r.memo(({lane:l,result:f})=>{const d=Me[l],a=Ee[f],n=F[l];return e.jsxs("div",{className:"absolute flex flex-col items-center justify-center pointer-events-none",style:{left:`calc(${(d+.5)*33.33}%)`,top:`${O}%`,transform:"translate(-50%, -50%)"},children:[e.jsx("div",{className:"absolute animate-ping",style:{width:"80px",height:"80px",borderRadius:"50%",border:`3px solid ${f==="perfect"?a.color:n.color}`,opacity:.6}}),e.jsx("span",{className:"text-xl font-black whitespace-nowrap animate-stellar-hit-text",style:{color:a.color,textShadow:`0 0 15px ${a.color}, 0 0 30px ${a.color}80`},children:a.label})]})});Re.displayName="HitEffect";const Ie=r.memo(({lane:l,laneIndex:f,onTap:d,isPressed:a,hasApproachingNote:n})=>{const i=F[l],b=i.icon,w=r.useRef(!1),_=r.useCallback(x=>{if(x.preventDefault(),x.stopPropagation(),w.current)return;w.current=!0;const R=performance.now();ue("light"),d(R)},[d]),c=r.useCallback(x=>{x.preventDefault(),w.current=!1},[]),g=r.useCallback(x=>{if(x.pointerType==="touch")return;x.preventDefault(),x.stopPropagation();const R=performance.now();ue("light"),d(R)},[d]);return e.jsx("button",{className:"flex-1 h-full flex items-center justify-center relative overflow-hidden select-none",onTouchStart:_,onTouchEnd:c,onTouchCancel:c,onPointerDown:g,onContextMenu:x=>x.preventDefault(),style:{background:a?`linear-gradient(to top, ${i.color}80, ${i.color}30)`:n?`linear-gradient(to top, ${i.color}40, transparent)`:"transparent",touchAction:"none",WebkitTapHighlightColor:"transparent",WebkitUserSelect:"none",userSelect:"none"},children:e.jsx("div",{className:"w-20 h-20 rounded-full flex items-center justify-center transition-all duration-50",style:{background:a?`radial-gradient(circle, ${i.color}, ${i.color}90)`:`radial-gradient(circle, ${i.color}50, ${i.color}20)`,border:`4px solid ${i.color}${a?"":"90"}`,boxShadow:a?`0 0 30px ${i.color}, 0 0 60px ${i.color}60`:n?`0 0 20px ${i.color}60`:`0 0 10px ${i.color}40`,transform:a?"scale(0.85)":"scale(1)"},children:e.jsx(b,{className:"w-8 h-8 pointer-events-none",style:{color:a?"white":i.color}})})})});Ie.displayName="LaneButton";const xe=(l,f,d)=>{const a=nt[d],i=6e4/l/a.notesPerBeat,b=[];let w=2e3;const _=(f-2)*1e3;for(;w<_;){const c=a.patterns[Math.floor(Math.random()*a.patterns.length)],g=w-be;if(c==="single"){const x=U[Math.floor(Math.random()*3)];b.push({id:b.length,lane:x,spawnTime:g,expectedHitTime:w,y:-10,hit:!1,missed:!1})}else c==="double"?[...U].sort(()=>Math.random()-.5).slice(0,2).forEach(R=>{b.push({id:b.length,lane:R,spawnTime:g,expectedHitTime:w,y:-10,hit:!1,missed:!1})}):c==="triple"&&U.forEach(x=>{b.push({id:b.length,lane:x,spawnTime:g,expectedHitTime:w,y:-10,hit:!1,missed:!1})});w+=i}return b},ie=l=>xe(120,30,l),Ae=r.memo(({isGenerating:l})=>e.jsxs("div",{className:"flex flex-col items-center justify-center h-full min-h-[300px] gap-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"animate-spin",children:e.jsx($e,{className:"w-12 h-12 text-primary"})}),e.jsx(Ze,{className:"absolute -top-1 -right-1 w-5 h-5 text-yellow-400 animate-pulse"})]}),e.jsx("p",{className:"text-base font-medium text-foreground",children:l?"Generating music...":"Loading music..."})]}));Ae.displayName="TrackLoadingScreen";const pt=({companionStats:l,onComplete:f,onDamage:d,tierAttackDamage:a=15,difficulty:n="medium",questIntervalScale:i=0,maxTimer:b,isPractice:w=!1,compact:_=!1})=>{const[c,g]=r.useState("loading"),[x,R]=r.useState(0),[de,G]=r.useState(ce),[K,se]=r.useState([]),[k,u]=r.useState([]),[T,B]=r.useState({moon:!1,star:!1,sun:!1}),[j,Z]=r.useState(null),[J,z]=r.useState(!1),[re,me]=r.useState(!1),[L,q]=r.useState(!1),[m,V]=r.useState(0),E=lt[n],X=r.useRef(0),Q=r.useRef(0),I=r.useRef(),H=r.useRef([]),A=r.useRef(ce),S=r.useRef(null),$=r.useRef(null),oe=r.useRef(0),Le=st(20),{isGenerating:He,userRating:De,fetchRandomTrack:ne,rateTrack:ye}=ot();r.useEffect(()=>((async()=>{oe.current=Date.now();const s=await ne(n),o=()=>{const N=Date.now()-oe.current,v=Math.max(0,Se-N);setTimeout(()=>g("countdown"),v+Te)};if(s){$.current=s,H.current=xe(s.bpm,s.duration_seconds,n);const N=new Audio(s.audio_url);N.preload="auto",S.current=N,N.addEventListener("canplaythrough",o,{once:!0}),N.addEventListener("error",()=>{H.current=ie(n),o()}),N.load()}else H.current=ie(n),o()})(),()=>{S.current&&(S.current.pause(),S.current=null)}),[n,ne]);const Fe=r.useCallback(()=>{g("playing"),X.current=performance.now(),Q.current=performance.now(),S.current&&(S.current.currentTime=0,S.current.play().catch(t=>{t.name!=="NotAllowedError"&&console.warn("Audio play failed:",t.message)}))},[]);r.useEffect(()=>{if(c!=="playing")return;const t=le.good+50,s=o=>{const N=o-X.current,v=H.current;let P=0;for(let h=0;h<v.length;h++){const p=v[h];if(p.hit||p.missed)continue;const y=1-(p.expectedHitTime-N)/be;p.y=-10+y*(O+10),N>p.expectedHitTime+t&&(p.missed=!0,P++)}if(P>0){const h=A.current,p=h.notesMissed+P;if(A.current={...h,notesMissed:p,combo:0},p>=E){S.current?.pause(),d?.({target:"player",amount:Ne.eclipse_timing.tooManyMisses,source:"too_many_misses"});const M=v.length,y=A.current,ae=M>0?Math.round(y.notesHit/M*100):0;Z({success:!1,accuracy:ae,result:"fail",highScoreValue:y.score,gameStats:{score:y.score,maxCombo:y.maxCombo,notesHit:y.notesHit,misses:y.notesMissed}}),G({...y}),g("complete");return}}if(o-Q.current>=ct){Q.current=o;const h=[];for(let M=0;M<v.length;M++){const y=v[M];!y.hit&&!y.missed&&y.y>=-15&&y.y<=100&&h.push({...y})}se(h),G({...A.current}),V(N);const p=A.current;z(p.notesMissed>=E-2&&p.notesMissed<E),me(p.combo>=10)}let D=!0;for(let h=0;h<v.length;h++)if(!v[h].hit&&!v[h].missed&&v[h].y<=100){D=!1;break}if(D&&v.length>0){S.current?.pause(),d?.({target:"adversary",amount:Ne.eclipse_timing.songComplete,source:"song_complete"});const h=v.length,p=A.current,M=h>0?Math.round(p.notesHit/h*100):0;Z({success:!0,accuracy:M,result:M>=90?"perfect":"good",highScoreValue:p.score,gameStats:{score:p.score,maxCombo:p.maxCombo,notesHit:p.notesHit,misses:p.notesMissed}}),G({...p}),$.current&&!w?g("rating"):g("complete");return}I.current=requestAnimationFrame(s)};return I.current=requestAnimationFrame(s),()=>{I.current&&cancelAnimationFrame(I.current)}},[c,w,d,E]);const ee=r.useCallback((t,s)=>{if(c!=="playing")return;B(C=>({...C,[t]:!0})),setTimeout(()=>B(C=>({...C,[t]:!1})),80);const o=s-X.current+at,N=H.current;let v=null,P=1/0;for(let C=0;C<N.length;C++){const Y=N[C];if(Y.lane!==t||Y.hit||Y.missed)continue;const pe=Math.abs(o-Y.expectedHitTime);pe<P&&pe<=le.good&&(P=pe,v=Y)}if(!v)return;let D;P<=le.perfect?D="perfect":P<=le.great?D="great":D="good",v.hit=!0;const h=A.current,p=je(h.combo),M=Ee[D].points*p,y=h.combo+1;A.current={score:h.score+M,combo:y,maxCombo:Math.max(h.maxCombo,y),notesHit:h.notesHit+1,notesMissed:h.notesMissed},G({...A.current});const ae=Date.now();u(C=>[...C.slice(-3),{id:ae,lane:t,result:D}]),setTimeout(()=>u(C=>C.filter(Y=>Y.id!==ae)),400),ue(D==="perfect"?"success":"light")},[c]);r.useEffect(()=>{const t=s=>{if(c!=="playing")return;const o=performance.now();s.key==="a"||s.key==="ArrowLeft"?ee("moon",o):s.key==="s"||s.key==="ArrowDown"?ee("star",o):(s.key==="d"||s.key==="ArrowRight")&&ee("sun",o)};return window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)},[c,ee]);const Ge=r.useCallback(async t=>{$.current&&await ye($.current.id,t)},[ye]),Be=r.useCallback(async()=>{S.current?.pause(),S.current=null,A.current=ce,G(ce),se([]),u([]),Z(null),R(o=>o+1),g("loading"),oe.current=Date.now();const t=()=>{const o=Date.now()-oe.current,N=Math.max(0,Se-o);setTimeout(()=>g("countdown"),N+Te)},s=await ne(n);if(s){$.current=s,H.current=xe(s.bpm,s.duration_seconds,n);const o=new Audio(s.audio_url);o.preload="auto",S.current=o,o.addEventListener("canplaythrough",t,{once:!0}),o.addEventListener("error",()=>{H.current=ie(n),t()}),o.load()}else H.current=ie(n),$.current=null,t()},[n,ne]),Pe=r.useCallback(()=>g("complete"),[]);r.useEffect(()=>{c==="complete"&&j&&setTimeout(()=>f(j),300)},[c,j,f]),r.useEffect(()=>{S.current&&(c==="paused"?S.current.pause():c==="playing"&&S.current.play().catch(t=>{t.name!=="NotAllowedError"&&console.warn("Audio play failed:",t.message)}))},[c]),r.useEffect(()=>{if(c!=="playing"||!$.current)return;const s=6e4/($.current.bpm||120),o=setInterval(()=>{q(!0),setTimeout(()=>q(!1),80)},s);return()=>clearInterval(o)},[c]);const he=r.useMemo(()=>{const t={moon:!1,star:!1,sun:!1};for(const s of K)s.y>O-20&&s.y<O+5&&(t[s.lane]=!0);return t},[K]),{score:we,combo:ve,notesHit:Oe,notesMissed:te}=de,Ue=je(ve),ke=H.current.length,ze=Oe+te;return c==="loading"?e.jsx("div",{className:"flex flex-col items-center relative w-full h-full min-h-[500px] overflow-hidden",style:{touchAction:"none"},children:e.jsx(Ae,{isGenerating:He})}):c==="rating"?e.jsxs("div",{className:"flex flex-col items-center justify-center relative w-full h-full min-h-[500px] gap-6 p-4 overflow-hidden",style:{touchAction:"none"},children:[e.jsxs("div",{className:"text-center mb-4",children:[e.jsx("h2",{className:"text-2xl font-bold text-foreground mb-2",children:"Song Complete!"}),e.jsxs("p",{className:"text-lg text-muted-foreground",children:["Score: ",e.jsx("span",{className:"text-primary font-bold",children:we})," ‚Ä¢ Accuracy: ",e.jsxs("span",{className:"text-primary font-bold",children:[j?.accuracy,"%"]})]})]}),$.current&&e.jsx(rt,{trackName:$.current.genre,onRate:Ge,onSkip:()=>{},currentRating:De}),e.jsxs("div",{className:"flex gap-4 mt-4",children:[e.jsx("button",{onClick:Be,className:"px-6 py-3 rounded-lg bg-primary text-primary-foreground font-semibold hover:bg-primary/90 transition-colors",children:"Next Song ‚Üí"}),e.jsx("button",{onClick:Pe,className:"px-6 py-3 rounded-lg bg-secondary text-secondary-foreground font-semibold hover:bg-secondary/90 transition-colors",children:"Finish"})]})]}):e.jsxs("div",{className:"flex flex-col items-center relative w-full h-full min-h-[500px] overflow-hidden",style:{touchAction:"none"},children:[c==="countdown"&&e.jsx(Qe,{count:3,onComplete:Fe}),c==="paused"&&e.jsx(et,{onResume:()=>g("playing")}),e.jsx(tt,{title:"Stellar Beats",subtitle:`${ze}/${ke} notes${$.current?` ‚Ä¢ ${$.current.bpm} BPM`:""}`,score:we,maxScore:ke*100*4,combo:ve,showCombo:!0,primaryStat:{value:te,label:`Misses (max ${E})`,color:te>=E-2?"hsl(0, 84%, 60%)":"hsl(45, 100%, 60%)"},isPaused:c==="paused",onPauseToggle:()=>g(c==="paused"?"playing":"paused"),compact:_}),J&&c==="playing"&&e.jsxs("div",{className:"absolute top-20 right-4 z-30 px-3 py-1 rounded-full text-sm font-bold animate-pulse",style:{background:"linear-gradient(135deg, hsl(0, 70%, 50%), hsl(0, 84%, 40%))",color:"white"},children:["‚ö†Ô∏è ",E-te," MISS",E-te>1?"ES":""," LEFT!"]}),re&&e.jsxs("div",{className:"absolute top-20 left-1/2 -translate-x-1/2 z-30 px-4 py-2 rounded-full text-base font-bold",style:{background:"linear-gradient(135deg, hsl(45, 100%, 50%), hsl(25, 95%, 50%))",color:"white",boxShadow:"0 0 15px hsl(45, 100%, 50% / 0.4)"},children:["üî• ",Ue,"x MULTIPLIER"]}),e.jsxs("div",{className:"relative w-full rounded-xl overflow-hidden",style:{background:"linear-gradient(to bottom, hsl(240, 35%, 5%), hsl(260, 40%, 8%), hsl(270, 45%, 10%))",height:"calc(100% - 100px)",minHeight:"350px",touchAction:"none",perspective:"800px",perspectiveOrigin:"center 30%"},children:[e.jsx(Ce,{stars:Le}),e.jsxs("div",{className:"absolute inset-0",style:{transformStyle:"preserve-3d",transform:"rotateX(35deg)",transformOrigin:"center bottom"},children:[e.jsx("div",{className:"absolute inset-0 flex pointer-events-none",children:U.map((t,s)=>e.jsx("div",{className:"flex-1 relative",style:{borderRight:s<2?"2px solid hsl(var(--border) / 0.4)":"none"},children:e.jsx("div",{className:"absolute left-1/2 top-0 bottom-0 w-0.5 -translate-x-1/2",style:{background:`linear-gradient(to bottom, ${F[t].color}10 0%, ${F[t].color}30 50%, ${F[t].color}50 100%)`}})},t))}),e.jsx("div",{className:"absolute inset-0 flex pointer-events-none",children:U.map(t=>{const s=F[t],o=he[t];return e.jsx("div",{className:"flex-1 transition-all duration-100",style:{background:`linear-gradient(to bottom, 
                      transparent 0%, 
                      ${s.color}${o?"18":"08"} 40%, 
                      ${s.color}${o?"40":"20"} 70%, 
                      ${s.color}${o?"60":"30"} 100%)`}},t)})})]}),e.jsx("div",{className:"absolute left-0 right-0 pointer-events-none z-8",style:{top:`${O-4}%`,height:"10%",background:`linear-gradient(to bottom, transparent, hsl(45, 100%, 60% / ${L?.3:.15}), transparent)`,transition:"background 0.08s ease-out"}}),e.jsx("div",{className:"absolute left-1/2 -translate-x-1/2 pointer-events-none z-6 transition-all duration-60",style:{top:`${O}%`,transform:"translate(-50%, -50%)",width:L?"180px":"120px",height:L?"180px":"120px",borderRadius:"50%",background:`radial-gradient(circle, hsl(45, 100%, 80% / ${L?.4:.1}), transparent 70%)`,boxShadow:L?"0 0 80px hsl(45, 100%, 60% / 0.6)":"none"}}),e.jsx("div",{className:"absolute left-0 right-0 pointer-events-none z-10",style:{top:`${O}%`,height:"6px",background:"linear-gradient(90deg, hsl(271, 91%, 65%), hsl(45, 100%, 60%), hsl(25, 95%, 55%))",boxShadow:`0 0 25px hsl(45, 100%, 60% / 0.8), 0 0 50px hsl(45, 100%, 60% / ${L?.6:.4})`,transition:"box-shadow 0.08s ease-out"}}),e.jsx("div",{className:"absolute left-0 right-0 flex justify-around pointer-events-none z-5",style:{top:`${O}%`,transform:"translateY(-50%)"},children:U.map(t=>{const s=F[t],o=he[t];return e.jsx("div",{className:"w-24 h-6 rounded-full transition-all duration-100",style:{background:o?`linear-gradient(180deg, ${s.color}60, ${s.color}30)`:`linear-gradient(180deg, ${s.color}30, ${s.color}10)`,border:`3px solid ${o?s.color:`${s.color}60`}`,boxShadow:o?`0 0 25px ${s.color}, inset 0 0 10px ${s.color}40`:`0 0 12px ${s.color}40`,transform:o?"scaleX(1.1)":"scaleX(1)"}},t)})}),e.jsx("div",{className:"absolute top-4 left-0 right-0 flex justify-around pointer-events-none z-20",children:U.map(t=>{const s=F[t],o=s.icon;return e.jsx("div",{className:"p-2 rounded-full",style:{background:`${s.color}25`},children:e.jsx(o,{className:"w-6 h-6",style:{color:s.color,opacity:.9}})},t)})}),K.map(t=>e.jsx(_e,{note:t,laneIndex:Me[t.lane],gameTimeMs:m},t.id)),k.map(t=>e.jsx(Re,{lane:t.lane,result:t.result},t.id)),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 flex",style:{height:"14%"},children:U.map((t,s)=>e.jsx(Ie,{lane:t,laneIndex:s,onTap:o=>ee(t,o),isPressed:T[t],hasApproachingNote:he[t]},t))})]}),c==="playing"&&e.jsx("div",{className:"text-center py-2 text-xs text-muted-foreground",children:"Tap lanes when bars reach the line ‚Ä¢ Keys: A/S/D or ‚Üê/‚Üì/‚Üí"})]})};export{pt as EclipseTimingGame};
