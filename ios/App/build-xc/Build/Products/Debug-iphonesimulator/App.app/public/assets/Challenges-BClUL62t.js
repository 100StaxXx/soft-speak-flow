import{H as D,r as A,u as h,j as e,cn as P,am as B,aZ as g,ae as f,aT as q,bE as S,cc as E,aA as p}from"./vendor-CkzXtEGd.js";import{b as F,d as L,S as K,B as b,aa as U,ab as M,ac as j,ad as y,au as z,e as x,F as i,P as H,a8 as I,s as o}from"./index-B9iotTKE.js";import"./date-vendor-CuPqBTxb.js";import"./three-vendor-qI8GXUTd.js";function Z(){const{user:l}=F(),v=D(),[N,d]=A.useState("active"),{data:m}=h({queryKey:["challenges"],queryFn:async()=>{const{data:a,error:s}=await o.from("challenges").select("*").order("created_at",{ascending:!1});if(s)throw s;return a||[]}}),{data:c,refetch:w}=h({queryKey:["user-challenges",l?.id],enabled:!!l,queryFn:async()=>{if(!l?.id)throw new Error("User not authenticated");const{data:a,error:s}=await o.from("user_challenges").select(`
          *,
          challenges (*)
        `).eq("user_id",l.id).order("created_at",{ascending:!1});if(s)throw s;return a||[]}}),{data:_}=h({queryKey:["challenge-progress",l?.id],enabled:!!l&&!!c,queryFn:async()=>{if(!c||c.length===0)return[];const a=c.map(t=>t.id),{data:s,error:r}=await o.from("challenge_progress").select("*").in("user_challenge_id",a);if(r)throw r;return s||[]}}),C=async(a,s)=>{if(l)try{const r=new Date,t=new Date(r);t.setDate(t.getDate()+s);const n=k=>k.toLocaleDateString("en-CA"),{error:u}=await o.from("user_challenges").insert({user_id:l.id,challenge_id:a,start_date:n(r),end_date:n(t),current_day:1,status:"active"});if(u)throw u;p.success("Challenge started!"),w(),d("active")}catch(r){const t=r instanceof Error?r.message:"Failed to start challenge";p.error(t),console.error("Challenge start failed:",r)}},T=(a,s)=>{const t=(_?.filter(n=>n.user_challenge_id===a)||[]).filter(n=>n.completed).length;return Math.round(t/s*100)};return e.jsxs(L,{children:[e.jsx(K,{}),e.jsx("div",{className:"min-h-screen pb-nav-safe pt-safe relative z-10",children:e.jsxs("div",{className:"max-w-4xl mx-auto px-4 py-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs(b,{variant:"ghost",onClick:()=>v("/"),className:"mb-4",children:[e.jsx(P,{className:"mr-2 h-4 w-4"}),"Back"]}),e.jsx("h1",{className:"text-3xl sm:text-4xl font-semibold tracking-tight bg-gradient-to-r from-primary via-accent to-primary bg-clip-text text-transparent",children:"Challenges"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"Transform your life with structured challenges"})]}),e.jsxs(U,{value:N,onValueChange:a=>d(a),className:"w-full",children:[e.jsxs(M,{className:"grid w-full grid-cols-2 mb-8 bg-card/80 border border-border/60",children:[e.jsxs(j,{value:"active",className:"font-medium",children:[e.jsx(B,{className:"h-4 w-4 mr-2"}),"Active"]}),e.jsxs(j,{value:"available",className:"font-medium",children:[e.jsx(g,{className:"h-4 w-4 mr-2"}),"Available"]})]}),e.jsx(y,{value:"active",className:"space-y-6",children:!c||c.length===0?e.jsx(z,{icon:f,title:"No active challenges",description:"Push yourself to grow with structured challenges. Browse available challenges and start your journey today.",actionLabel:"Browse Challenges",onAction:()=>d("available")}):c.map(a=>{const s=a.challenges;if(!s)return null;const r=T(a.id,s.total_days);return e.jsxs(x,{className:"p-6 bg-card/50 backdrop-blur-sm border-primary/20 hover:border-primary/40 transition-all",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-xl font-semibold mb-2",children:s.title}),e.jsx("p",{className:"text-muted-foreground text-sm mb-4",children:s.description}),e.jsxs("div",{className:"flex flex-wrap gap-2 mb-4",children:[e.jsxs(i,{variant:"outline",className:"border-primary/30",children:[e.jsx(q,{className:"h-3 w-3 mr-1"}),"Day ",a.current_day," of ",s.total_days]}),e.jsx(i,{variant:a.status==="active"?"default":"secondary",children:a.status})]})]}),e.jsx(f,{className:"h-8 w-8 text-accent"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Progress"}),e.jsxs("span",{className:"font-semibold",children:[r,"%"]})]}),e.jsx(H,{value:r,className:"h-2"})]})]},a.id)})}),e.jsx(y,{value:"available",className:"space-y-6",children:m&&m.length>0?e.jsx("div",{className:"grid gap-6",children:m.map(a=>{const s=c?.some(r=>r.challenge_id===a.id&&r.status==="active");return e.jsxs(x,{className:"p-6 bg-card/50 backdrop-blur-sm border-border/50 hover:border-primary/30 transition-all",children:[e.jsx("div",{className:"flex items-start justify-between mb-4",children:e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-xl font-semibold mb-2",children:a.title}),e.jsx("p",{className:"text-muted-foreground mb-4",children:a.description}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[a.category&&e.jsx(i,{variant:"outline",children:a.category}),e.jsxs(i,{variant:"outline",className:"border-accent/30",children:[a.total_days," Days"]})]})]})}),s?e.jsxs(i,{className:"w-full justify-center py-2",children:[e.jsx(S,{className:"h-4 w-4 mr-2"}),"Active Challenge"]}):e.jsx(b,{onClick:()=>C(a.id,a.total_days),className:"w-full bg-gradient-to-r from-primary to-accent",children:"Start Challenge"})]},a.id)})}):e.jsx(x,{className:"p-12 text-center bg-card/50 backdrop-blur-sm border-border/50",children:e.jsxs("div",{className:"max-w-md mx-auto space-y-4",children:[e.jsx("div",{className:"h-16 w-16 mx-auto rounded-full bg-primary/10 flex items-center justify-center",children:e.jsx(g,{className:"h-8 w-8 text-primary"})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"text-xl font-bold",children:"No challenges available yet"}),e.jsx("p",{className:"text-muted-foreground text-sm",children:"Challenges are special limited-time activities that help you grow faster. Check back regularly for new opportunities to earn bonus XP and exclusive rewards!"})]}),e.jsxs("div",{className:"pt-2 flex items-center gap-2 justify-center text-xs text-muted-foreground",children:[e.jsx(E,{className:"h-4 w-4"}),e.jsx("span",{children:"New challenges coming soon"})]})]})})})]})]})}),e.jsx(I,{})]})}export{Z as default};
