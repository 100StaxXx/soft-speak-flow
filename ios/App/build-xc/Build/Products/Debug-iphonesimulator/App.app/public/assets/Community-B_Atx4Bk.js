import{j as e,K as Le,af as je,ag as ye,ah as ve,r as n,bo as Xe,cV as Ve,bk as Ne,n as te,bE as we,am as We,az as le,c3 as K,cc as Z,cj as _e,X as Be,c_ as he,bz as Ge,bB as Fe,ad as Te,bd as Qe,be as Ke,aZ as Ze,Y as Je,b as et,dH as Ce,dI as ke,dJ as Me,dK as tt,an as st,u as rt,aA as at}from"./vendor-CkzXtEGd.js";import{G as m,B as W,Y as nt,Z as ot,a$ as lt,b0 as F,e as Se,af as it,b1 as xe,b as dt,s as ge,b2 as ct,b3 as ut,d as mt,S as ht,b4 as xt,b5 as gt,a8 as ft}from"./index-B9iotTKE.js";import{B as De,h as Pe,g as Q,o as H,G as ie,s as Ee,e as He,z as pt,J as bt,i as jt,w as yt,K as vt,j as Nt}from"./date-vendor-CuPqBTxb.js";import"./three-vendor-qI8GXUTd.js";function wt({selectedDate:t,onDateSelect:d,tasks:o=[]}){const c=De(t,{weekStartsOn:0}),g=Array.from({length:7},(u,h)=>Pe(c,h)),y=new Date,k=u=>{const h=H(u,"yyyy-MM-dd");return o.filter(w=>w.task_date===h)};return e.jsx("div",{className:"grid grid-cols-7 gap-1",children:g.map(u=>{const h=Q(u,t),w=Q(u,y),_=k(u),b=_.filter(v=>!v.completed).length,p=_.filter(v=>v.completed).length;return e.jsxs("button",{onClick:()=>d(u),className:m("flex flex-col items-center py-2 px-1 rounded-xl transition-all min-h-[70px]",h?"bg-coral-500 text-white":w?"bg-coral-500/15 text-coral-500":"text-muted-foreground hover:bg-muted/50"),children:[e.jsx("span",{className:"text-[10px] font-medium uppercase tracking-wide",children:H(u,"EEE")}),e.jsx("span",{className:m("text-xl font-bold mt-0.5",h&&"text-white"),children:H(u,"d")}),e.jsxs("div",{className:"flex items-center justify-center gap-0.5 mt-1.5 min-h-[6px]",children:[b>0&&e.jsx("div",{className:m("w-1.5 h-1.5 rounded-full",h?"bg-white/70":"bg-coral-500")}),p>0&&e.jsx("div",{className:m("w-1.5 h-1.5 rounded-full",h?"bg-white/50":"bg-celestial-blue")})]})]},u.toISOString())})})}const fe={mind:{icon:ve,bg:"bg-violet-500/20",iconColor:"text-violet-500"},body:{icon:ye,bg:"bg-coral-500/20",iconColor:"text-coral-500"},soul:{icon:je,bg:"bg-pink-400/20",iconColor:"text-pink-400"},default:{icon:Le,bg:"bg-coral-500/20",iconColor:"text-coral-500"}};function _t(t){const d=ie(t,"HH:mm",new Date),o=d.getHours(),c=H(d,"h:mm a");return o>=6&&o<12,c}function Tt(t){if(!t)return"";if(t===1440)return"All Day";if(t<60)return`${t} min`;const d=Math.floor(t/60),o=t%60;return o>0?`${d}h ${o}m`:`${d}h`}function Ct({task:t,onTaskClick:d,onTaskLongPress:o,isDragging:c,previewTime:g,onDragStart:y,onDragMove:k,onDragEnd:u}){const h=fe[t.category||"default"]||fe.default,w=h.icon,_=n.useRef(0),b=n.useRef(!1),p=()=>{b.current||d?.(t)},v=()=>{o?.(t.id)},D=n.useCallback(i=>{if(t.completed||!y)return;i.preventDefault(),_.current=i.clientY,b.current=!1,i.currentTarget.setPointerCapture(i.pointerId)},[t.completed,y]),I=n.useCallback(i=>{if(!_.current||!k)return;const P=i.clientY-_.current;!b.current&&Math.abs(P)>5&&(b.current=!0,y?.()),b.current&&k(P)},[y,k]),R=n.useCallback(i=>{i.currentTarget.releasePointerCapture(i.pointerId),b.current&&u?.(),_.current=0,setTimeout(()=>{b.current=!1},10)},[u]),C=g||t.scheduled_time,q=C?ie(C,"HH:mm",new Date).getHours()<12:!1;return e.jsxs("div",{onClick:p,onContextMenu:i=>{i.preventDefault(),v()},onPointerDown:D,onPointerMove:I,onPointerUp:R,onPointerCancel:R,className:m("flex items-center gap-4 py-3 cursor-pointer transition-all select-none touch-none",t.completed&&"opacity-50",c&&"scale-[1.02] z-10"),children:[e.jsx("div",{className:m("flex-shrink-0 w-14 h-14 rounded-full flex items-center justify-center",h.bg),children:e.jsx(w,{className:m("h-7 w-7",h.iconColor)})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground mb-0.5",children:[C&&e.jsxs("span",{className:m("flex items-center gap-1",c&&g&&"text-coral-500 font-medium"),children:[q&&e.jsx(Xe,{className:"h-3.5 w-3.5 text-amber-500"}),_t(C)]}),t.estimated_duration&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-muted-foreground/50",children:"â€¢"}),e.jsx("span",{children:Tt(t.estimated_duration)})]}),t.is_main_quest&&e.jsx(Ve,{className:"h-3.5 w-3.5 text-primary"})]}),e.jsx("p",{className:m("font-semibold text-lg text-foreground truncate",t.completed&&"line-through text-muted-foreground"),children:t.task_text})]}),e.jsx("button",{onClick:i=>{i.stopPropagation()},className:m("flex-shrink-0 w-8 h-8 rounded-full border-2 flex items-center justify-center transition-all",t.completed?"bg-coral-500 border-coral-500":"border-coral-500/50 hover:border-coral-500"),children:t.completed&&e.jsx(Ne,{className:"h-5 w-5 text-white"})})]})}const pe={mind:"bg-violet-500",body:"bg-coral-500",soul:"bg-pink-400",default:"bg-muted-foreground/40"};function kt({task:t,onClick:d}){const o=pe[t.category||"default"]||pe.default;return e.jsxs("button",{onClick:()=>d?.(t),className:m("flex items-center gap-3 w-full rounded-lg bg-muted/30 px-3 py-2.5 text-left transition-colors hover:bg-muted/50",t.completed&&"opacity-50"),children:[e.jsx("div",{className:m("w-1 h-5 rounded-full flex-shrink-0",o)}),e.jsx("span",{className:m("flex-1 text-sm font-medium text-foreground truncate",t.completed&&"line-through text-muted-foreground"),children:t.task_text}),e.jsx("span",{className:"text-xs text-muted-foreground flex-shrink-0",children:"All Day"}),e.jsx("div",{className:m("flex-shrink-0 w-5 h-5 rounded-full border-2 flex items-center justify-center transition-all",t.completed?"bg-coral-500 border-coral-500":"border-coral-500/50"),children:t.completed&&e.jsx(Ne,{className:"h-3 w-3 text-white"})})]})}function Ie({milestone:t,compact:d=!1,onClick:o}){const c=!!t.completed_at;return d?e.jsxs("div",{onClick:o,className:m("text-xs p-1 border-l-2 truncate transition-all hover:bg-amber-500/10 cursor-pointer","border-l-amber-500 bg-amber-500/5",c&&"opacity-50"),children:[e.jsx(te,{className:"h-2 w-2 inline mr-1 text-amber-500"}),t.title]}):e.jsxs("div",{onClick:o,className:m("flex items-start gap-3 p-3 rounded-lg border transition-all cursor-pointer","border-amber-500/30 bg-gradient-to-r from-amber-500/10 to-amber-500/5","hover:border-amber-500/50 hover:bg-amber-500/15",c&&"opacity-60"),children:[e.jsx("div",{className:m("flex-shrink-0 w-8 h-8 rounded-full flex items-center justify-center",c?"bg-emerald-500/20 text-emerald-500":"bg-amber-500/20 text-amber-500"),children:c?e.jsx(we,{className:"h-4 w-4"}):e.jsx(te,{className:"h-4 w-4"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs text-amber-500 font-medium",children:t.epic_title}),t.phase_name&&e.jsxs("span",{className:"text-xs text-muted-foreground",children:["â€¢ ",t.phase_name]})]}),e.jsx("h4",{className:m("font-medium text-sm truncate",c&&"line-through text-muted-foreground"),children:t.title}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(We,{className:"h-3 w-3 text-muted-foreground"}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:[t.milestone_percent,"% checkpoint"]})]})]})]})}function be(t,d){const c=Math.round(d*.75/15)*15,g=ie(t,"HH:mm",new Date),y=new Date(g.getTime()+c*6e4),k=Math.max(6,Math.min(23,y.getHours())),u=Math.min(45,Math.max(0,Math.floor(y.getMinutes()/15)*15));return`${k.toString().padStart(2,"0")}:${u.toString().padStart(2,"0")}`}function Mt({selectedDate:t,onDateSelect:d,tasks:o,milestones:c=[],onTaskClick:g,onTaskLongPress:y,onTimeSlotLongPress:k,onMilestoneClick:u,onAddClick:h,onTaskReschedule:w,onDateHeaderClick:_}){const b=H(t,"yyyy-MM-dd"),p=Q(t,new Date),[v,D]=n.useState(null),[I,R]=n.useState(0),C=n.useMemo(()=>o.filter(r=>r.task_date===b).sort((r,$)=>r.scheduled_time&&$.scheduled_time?r.scheduled_time.localeCompare($.scheduled_time):r.scheduled_time?-1:$.scheduled_time?1:0),[o,b]),q=C.filter(r=>r.estimated_duration===1440),i=C.filter(r=>r.scheduled_time&&r.estimated_duration!==1440),P=C.filter(r=>!r.scheduled_time&&r.estimated_duration!==1440),f=c.filter(r=>r.target_date===b),j=n.useCallback(r=>{D(r),R(0)},[]),M=n.useCallback(r=>{R(r)},[]),E=n.useCallback(()=>{if(v&&I!==0&&w){const r=i.find($=>$.id===v);if(r?.scheduled_time){const $=be(r.scheduled_time,I);$!==r.scheduled_time&&w(v,$)}}D(null),R(0)},[v,I,i,w]),A=r=>r.id===v&&r.scheduled_time&&I!==0?be(r.scheduled_time,I):null;return e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsxs("div",{className:"px-4 pt-4 pb-4 border-b border-border/30",children:[e.jsxs("button",{onClick:_,className:"flex items-center gap-1 mb-4 group",children:[e.jsx("span",{className:"text-3xl font-bold text-foreground",children:H(t,"MMMM d,")}),e.jsx("span",{className:"text-3xl font-bold text-primary",children:H(t,"yyyy")}),e.jsx(le,{className:"h-6 w-6 text-primary group-hover:translate-x-0.5 transition-transform"})]}),e.jsx(wt,{selectedDate:t,onDateSelect:d,tasks:o})]}),e.jsx("div",{className:"flex-1 overflow-y-auto overscroll-contain",children:e.jsxs("div",{className:"relative px-4",children:[(i.length>0||P.length>0)&&e.jsx("div",{className:"absolute left-11 top-4 bottom-4 w-px border-l-2 border-dashed border-border/40"}),f.length>0&&e.jsxs("div",{className:"py-4 border-b border-border/30",children:[e.jsx("h3",{className:"text-xs font-medium text-muted-foreground uppercase tracking-wide mb-3 pl-16",children:"Goals for Today"}),e.jsx("div",{className:"space-y-2 pl-16",children:f.map(r=>e.jsx(Ie,{milestone:r,onClick:()=>u?.(r)},r.id))})]}),q.length>0&&e.jsx("div",{className:"py-3 space-y-1.5",children:q.map(r=>e.jsx(kt,{task:r,onClick:g},r.id))}),i.length>0&&e.jsx("div",{className:"py-4",children:i.map(r=>e.jsx("div",{className:m("relative transition-transform duration-75",r.id===v&&"z-10"),style:{transform:r.id===v?`translateY(${I}px)`:void 0},children:e.jsx(Ct,{task:r,onTaskClick:g,onTaskLongPress:y,isDragging:r.id===v,previewTime:A(r),onDragStart:()=>j(r.id),onDragMove:M,onDragEnd:E})},r.id))}),h&&e.jsx("div",{className:"py-3",children:e.jsxs("button",{onClick:h,className:"flex items-center gap-3 w-full py-3 px-4 rounded-xl bg-coral-500/10 hover:bg-coral-500/20 transition-colors group",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-coral-500/20 flex items-center justify-center group-hover:bg-coral-500/30 transition-colors",children:e.jsx(K,{className:"h-5 w-5 text-coral-500"})}),e.jsx("span",{className:"font-medium text-coral-500",children:"Add Quest"})]})}),P.length>0&&e.jsxs("div",{className:"py-4 border-t border-dashed border-border/40",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs font-medium text-muted-foreground uppercase tracking-wide mb-3 pl-16",children:[e.jsx(Z,{className:"h-3.5 w-3.5"}),"Anytime"]}),e.jsx("div",{className:"space-y-1",children:P.map(r=>e.jsxs("div",{onClick:()=>g?.(r),className:"flex items-center gap-4 py-3 cursor-pointer",children:[e.jsx("div",{className:"w-14 h-14 rounded-full bg-muted/30 flex items-center justify-center",children:e.jsx(Z,{className:"h-6 w-6 text-muted-foreground"})}),e.jsx("span",{className:"font-semibold text-lg text-foreground flex-1 truncate",children:r.task_text}),e.jsx("div",{className:"w-8 h-8 rounded-full border-2 border-muted-foreground/30"})]},r.id))})]}),C.length===0&&e.jsxs("div",{className:"flex flex-col items-center justify-center py-20 text-center",children:[e.jsx("div",{className:"w-20 h-20 rounded-full bg-coral-500/10 flex items-center justify-center mb-4",children:e.jsx(K,{className:"h-10 w-10 text-coral-500"})}),e.jsx("h3",{className:"font-bold text-xl text-foreground mb-1",children:"No quests yet"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-6",children:p?"Start your day by adding a quest":"Add quests for this day"}),h&&e.jsxs(W,{onClick:h,className:"bg-coral-500 hover:bg-coral-600 text-white rounded-full px-6",children:[e.jsx(K,{className:"h-4 w-4 mr-2"}),"Add Quest"]})]}),e.jsx("div",{className:"h-8"})]})})]})}function St({open:t,onOpenChange:d,selectedDate:o,onDateSelect:c,tasks:g,milestones:y=[]}){const[k,u]=n.useState(!1),h=Ee(o),w=He(o),_=De(h,{weekStartsOn:0}),b=pt(w,{weekStartsOn:0}),p=bt({start:_,end:b}),v=()=>{c(vt(o))},D=f=>{c(f),d(!1)},I=()=>{u(!0)},R=f=>{c(f),u(!1)},C=f=>{c(yt(o,f))},q=()=>{u(!1),d(!1)},i=f=>{const j=H(f,"yyyy-MM-dd");return g.filter(M=>M.task_date===j)},P=f=>{const j=H(f,"yyyy-MM-dd");return y.filter(M=>M.target_date===j)};return e.jsx(nt,{open:t,onOpenChange:q,children:e.jsx(ot,{className:"fixed bottom-0 left-0 right-0 top-auto translate-y-0 translate-x-0 rounded-t-3xl max-h-[75vh] w-full max-w-full p-0 gap-0 border-t border-x border-border/50 bg-background",hideCloseButton:!0,children:k?e.jsx(lt,{selectedDate:o,onMonthSelect:R,onBack:()=>u(!1),onClose:q,onYearChange:C,tasks:g,milestones:y}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between px-5 py-4 border-b border-border/30",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(W,{variant:"ghost",size:"icon",onClick:v,className:"h-8 w-8",children:e.jsx(_e,{className:"h-5 w-5"})}),e.jsxs("button",{onClick:I,className:"text-2xl font-bold flex items-center gap-1",children:[e.jsx("span",{className:"text-foreground",children:H(o,"MMMM")}),e.jsx("span",{className:"text-primary",children:H(o,"yyyy")}),e.jsx(le,{className:"h-5 w-5 text-primary"})]})]}),e.jsx(W,{variant:"ghost",size:"icon",onClick:q,className:"h-9 w-9 rounded-full bg-muted",children:e.jsx(Be,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"p-4 overflow-y-auto",children:[e.jsx("div",{className:"grid grid-cols-7 mb-2",children:["S","M","T","W","T","F","S"].map((f,j)=>e.jsx("div",{className:"text-center text-sm font-medium text-muted-foreground py-2",children:f},`${f}-${j}`))}),e.jsx("div",{className:"grid grid-cols-7 gap-1",children:p.map(f=>{const j=i(f),M=P(f),E=Q(f,o),A=Q(f,new Date),r=j.filter(B=>!B.completed).length,$=j.filter(B=>B.completed).length,L=M.length>0;return e.jsxs("button",{onClick:()=>D(f),className:m("flex flex-col items-center py-2.5 rounded-xl transition-all min-h-[60px]",E?"bg-coral-500 text-white":A?"bg-coral-500/15 text-coral-500":jt(f,o)?"text-foreground hover:bg-muted/50":"text-muted-foreground/40"),children:[e.jsx("span",{className:m("text-base font-semibold",E&&"text-white"),children:H(f,"d")}),e.jsxs("div",{className:"flex items-center justify-center gap-0.5 mt-1 min-h-[6px]",children:[L&&e.jsx("div",{className:m("w-1.5 h-1.5 rounded-full",E?"bg-white/70":"bg-amber-500")}),r>0&&e.jsx("div",{className:m("w-1.5 h-1.5 rounded-full",E?"bg-white/70":"bg-coral-500")}),$>0&&e.jsx("div",{className:m("w-1.5 h-1.5 rounded-full",E?"bg-white/50":"bg-celestial-blue")})]})]},f.toISOString())})})]})]})})})}function Dt(t){return t==="mind"||t==="body"||t==="soul"}const Pt={mind:{icon:ve,label:"Mind",colors:"from-category-mind/20 to-purple-500/20 text-category-mind border-category-mind/30",glow:"shadow-[0_0_15px_hsl(var(--category-mind)/0.3)]"},body:{icon:ye,label:"Body",colors:"from-category-body/20 to-red-500/20 text-category-body border-category-body/30",glow:"shadow-[0_0_15px_hsl(var(--category-body)/0.3)]"},soul:{icon:je,label:"Soul",colors:"from-category-soul/20 to-cyan-500/20 text-category-soul border-category-soul/30",glow:"shadow-[0_0_15px_hsl(var(--category-soul)/0.3)]"}},Et={easy:{icon:Te,borderColor:"border-emerald-500/30",bgColor:"bg-emerald-500/5",textColor:"text-emerald-400",glow:"shadow-[0_0_20px_hsl(142,76%,50%/0.2)]"},medium:{icon:Fe,borderColor:"border-amber-500/30",bgColor:"bg-amber-500/5",textColor:"text-amber-400",glow:"shadow-[0_0_20px_hsl(45,90%,55%/0.2)]"},hard:{icon:Ge,borderColor:"border-rose-500/30",bgColor:"bg-rose-500/5",textColor:"text-rose-400",glow:"shadow-[0_0_20px_hsl(350,90%,60%/0.2)]"}},ne=he.memo(({task:t,isDragging:d,onDragStart:o,onLongPress:c,compact:g=!1,showTime:y=!0})=>{const[k,u]=n.useState(!1),[h,w]=n.useState(!1),_=n.useRef(null),b=n.useRef(!1),p=n.useRef(null),v=n.useCallback(j=>{c&&(p.current={x:j.touches[0].clientX,y:j.touches[0].clientY},b.current=!1,w(!0),_.current=setTimeout(()=>{b.current=!0,F("pop"),c(),w(!1)},500))},[c]),D=n.useCallback(()=>{w(!1),_.current&&(clearTimeout(_.current),_.current=null)},[]),I=n.useCallback(j=>{if(p.current){const M=Math.abs(j.touches[0].clientX-p.current.x),E=Math.abs(j.touches[0].clientY-p.current.y);(M>10||E>10)&&D()}},[D]),R=t.difficulty?.toLowerCase(),C=R?Et[R]:null,q=Dt(t.category)?t.category:void 0,i=q?Pt[q]:null,P=j=>{const[M,E]=j.split(":"),A=parseInt(M),r=A>=12?"PM":"AM";return`${A%12||12}:${E} ${r}`},f=j=>{if(j<60)return`${j}m`;const M=Math.floor(j/60),E=j%60;return E>0?`${M}h ${E}m`:`${M}h`};return e.jsx("div",{className:"flex items-stretch gap-2",children:e.jsxs(Se,{draggable:!0,onDragStart:o,className:m("cursor-grab active:cursor-grabbing overflow-hidden group relative touch-manipulation","transform-gpu transition-all duration-200 ease-out",d&&"opacity-50 scale-95",!d&&"hover:scale-[1.02] active:scale-[0.98]",h&&!d&&"scale-[0.97] opacity-90",t.completed&&"opacity-60",t.is_main_quest&&"border-2 border-[hsl(45,100%,60%)] shadow-[0_0_20px_hsl(45,100%,60%/0.3)]",!t.is_main_quest&&i&&`border-l-4 ${i.colors.split(" ").find(j=>j.includes("border"))}`,!t.is_main_quest&&C?.borderColor,!t.is_main_quest&&k&&C?.glow,!t.is_main_quest&&k&&i?.glow),style:{willChange:d?"transform, opacity":"auto",WebkitTapHighlightColor:"transparent"},onMouseEnter:()=>u(!0),onMouseLeave:()=>u(!1),onTouchStart:v,onTouchEnd:D,onTouchMove:I,onTouchCancel:D,children:[t.is_main_quest&&!t.completed&&e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-[hsl(45,100%,60%)]/10 to-transparent animate-pulse"}),e.jsxs("div",{className:m("relative flex items-start gap-3",g?"p-2":"p-3"),children:[C&&!t.is_main_quest&&!g&&e.jsx("div",{className:m("flex-shrink-0 mt-0.5",C.textColor),children:he.createElement(C.icon,{className:"h-4 w-4"})}),e.jsxs("div",{className:"flex-1 space-y-1",children:[e.jsxs("div",{className:"flex items-start gap-2",children:[t.is_main_quest&&e.jsx(te,{className:"h-4 w-4 text-[hsl(45,100%,60%)] flex-shrink-0 mt-0.5 animate-pulse"}),e.jsx("p",{className:m("font-medium leading-relaxed",g?"text-xs":"text-sm",t.completed&&"line-through text-muted-foreground",t.is_main_quest&&"text-base font-semibold"),children:t.task_text})]}),i&&!t.is_main_quest&&!g&&e.jsx("div",{className:"flex items-center gap-1",children:e.jsxs("div",{className:m("inline-flex items-center gap-1 px-2 py-0.5 rounded-full text-xs font-medium bg-gradient-to-r border",i.colors),children:[e.jsx(i.icon,{className:"h-3 w-3"}),e.jsx("span",{children:i.label})]})}),!g&&e.jsxs("div",{className:"flex items-center gap-3 text-xs flex-wrap",children:[y&&t.scheduled_time&&e.jsxs("div",{className:"flex items-center gap-1 text-muted-foreground",children:[e.jsx(Z,{className:"w-3 h-3"}),P(t.scheduled_time)]}),t.estimated_duration&&e.jsxs("div",{className:"flex items-center gap-1 text-muted-foreground",children:[e.jsx(Z,{className:"w-3 h-3"}),f(t.estimated_duration)]}),e.jsxs("div",{className:m("font-semibold",t.is_main_quest?"text-[hsl(45,100%,60%)]":"text-muted-foreground"),children:["+",t.xp_reward," XP"]})]})]})]}),k&&!t.completed&&e.jsx("div",{className:"absolute bottom-1 right-1 text-[10px] text-muted-foreground/50 opacity-0 group-hover:opacity-100 transition-opacity",children:"Drag to reorder"})]})})}),Ht=({selectedDate:t,onDateSelect:d,tasks:o,milestones:c=[],onTaskDrop:g,onTimeSlotLongPress:y,onTaskLongPress:k,onMilestoneClick:u,fullDayMode:h=!1,hideHeader:w=!1})=>{const[_,b]=n.useState(null),p=n.useRef(null),v=n.useRef(null),[D,I]=n.useState(!1),[R,C]=n.useState(!1),q=H(t,"yyyy-MM-dd"),i=o.filter(s=>s.task_date===q),P=()=>{if(h)return{start:0,end:23};const s=i.filter(S=>S.scheduled_time);if(s.length===0)return{start:6,end:23};let l=6,N=23;return s.forEach(S=>{const[T,U]=S.scheduled_time.split(":"),x=parseInt(T),z=S.estimated_duration||30,Ue=Math.ceil((x*60+parseInt(U)+z)/60);l=Math.min(l,x),N=Math.max(N,Ue)}),l=Math.max(0,l-1),N=Math.min(23,N+1),{start:l,end:N}},{start:f,end:j}=n.useMemo(()=>P(),[i,h]),M=n.useMemo(()=>{const s=[];for(let l=f;l<=j;l++)s.push({hour:l,minute:0}),s.push({hour:l,minute:30});return s},[f,j]),E=(s,l)=>H(new Date().setHours(s,l,0),"h:mm a"),A=(s,l)=>`${s.toString().padStart(2,"0")}:${l.toString().padStart(2,"0")}`,r=(s,l)=>i.filter(N=>{if(!N.scheduled_time)return!1;const[S,T]=N.scheduled_time.split(":").map(Number);return S===s&&T===l}),$=()=>i.filter(s=>!s.scheduled_time&&!s.completed),L=()=>i.filter(s=>s.completed),B=()=>c.filter(s=>s.target_date===q),a=s=>s?Math.max(60,s/30*60):60,O=n.useCallback((s,l,N)=>{v.current={x:N.touches[0].clientX,y:N.touches[0].clientY},p.current=setTimeout(()=>{F("pop");const S=A(s,l);y?.(t,S)},600)},[t,y]),G=n.useCallback(s=>{if(v.current){const l=Math.abs(s.touches[0].clientX-v.current.x),N=Math.abs(s.touches[0].clientY-v.current.y);(l>10||N>10)&&p.current&&(clearTimeout(p.current),p.current=null)}},[]),J=n.useCallback(()=>{p.current&&(clearTimeout(p.current),p.current=null),v.current=null},[]),Y=$(),se=B(),Ae=i.length-Y.length,de=3,ce=R?Y:Y.slice(0,de),ue=Math.max(Y.length-ce.length,0),re=Y.length>de,me=Q(t,new Date),Oe=i.filter(s=>s.completed).length,ee=i.length,ae=i.reduce((s,l)=>s+(l.completed?l.xp_reward:0),0),Ye=()=>{const s=i.filter(N=>N.scheduled_time&&N.estimated_duration);let l=0;for(let N=0;N<s.length;N++)for(let S=N+1;S<s.length;S++){const T=new Date(`2000-01-01T${s[N].scheduled_time}:00`),U=new Date(T.getTime()+s[N].estimated_duration*6e4),x=new Date(`2000-01-01T${s[S].scheduled_time}:00`),z=new Date(x.getTime()+s[S].estimated_duration*6e4);T<z&&x<U&&l++}return l},ze=()=>{const s=i.filter(T=>T.scheduled_time&&T.estimated_duration&&!T.completed);let l=0;[...s].sort((T,U)=>T.scheduled_time.localeCompare(U.scheduled_time));const N=s.filter(T=>parseInt(T.scheduled_time.split(":")[0])<9);l+=N.length*xe.MORNING_WARRIOR;const S=s.filter(T=>T.estimated_duration>=90);return l+=S.length*xe.DEEP_WORK,l},X=Ye(),V=ze();return n.useEffect(()=>{(X>0||V>0)&&!D&&I(!0)},[X,V,D]),n.useEffect(()=>{!re&&R&&C(!1)},[re,R]),e.jsxs("div",{className:m("space-y-3",h&&"h-full flex flex-col"),children:[!w&&e.jsxs("div",{className:"flex flex-col gap-3 px-1 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(W,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:()=>d(Nt(t,1)),children:e.jsx(_e,{className:"h-4 w-4"})}),e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:m("text-lg font-bold",me&&"text-primary"),children:me?"Today":H(t,"EEEE")}),e.jsx("p",{className:"text-xs text-muted-foreground",children:H(t,"MMMM d, yyyy")})]}),e.jsx(W,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:()=>d(Pe(t,1)),children:e.jsx(le,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"flex flex-wrap items-center justify-end gap-2 text-xs",children:[e.jsxs("span",{className:"rounded-full bg-muted px-3 py-1 font-medium text-foreground",children:[Oe,"/",ee||0," done"]}),e.jsxs("span",{className:"rounded-full bg-stardust-gold/15 px-3 py-1 font-medium text-stardust-gold",children:["+",ae," XP"]}),V>0&&e.jsxs("span",{className:"rounded-full bg-amber-500/10 px-3 py-1 font-semibold text-amber-600",children:["+",V," bonus XP"]}),X>0&&e.jsxs("span",{className:"rounded-full bg-destructive/10 px-3 py-1 font-semibold text-destructive",children:["Resolve ",X," conflict",X>1?"s":""]}),e.jsxs(W,{variant:"ghost",size:"sm",onClick:()=>I(!D),className:"h-7 gap-1 px-2 text-xs",children:[D?"Hide details":"Day details",D?e.jsx(Qe,{className:"h-3 w-3"}):e.jsx(Ke,{className:"h-3 w-3"})]})]})]}),D&&(ee>0||X>0||V>0)&&e.jsxs(Se,{className:"space-y-3 border-dashed border-border/60 bg-background/80 p-3",children:[ee>0&&e.jsxs("div",{className:"text-sm text-muted-foreground",children:[e.jsx("span",{className:"font-medium text-foreground",children:Ae})," of"," ",e.jsx("span",{className:"font-medium text-foreground",children:ee})," quests scheduled â€¢"," ",e.jsx("span",{className:"font-medium text-foreground",children:Y.length})," waiting to place"]}),X>0&&e.jsxs("div",{className:"flex items-center gap-2 rounded-lg border border-destructive/40 bg-destructive/5 p-2 text-sm text-destructive",children:[e.jsx(Je,{className:"h-4 w-4 flex-shrink-0"}),"Clear ",X," overlapping quest",X>1?"s":""," to unlock bonus XP."]}),V>0&&e.jsxs("div",{className:"flex items-center gap-2 rounded-lg border border-primary/30 bg-primary/5 p-2 text-sm text-primary",children:[e.jsx(Te,{className:"h-4 w-4 flex-shrink-0"}),V," bonus XP available from power hours, mornings, or deep work."]}),(ae>0||V>0)&&e.jsxs("div",{className:"flex items-center justify-between border-t border-dashed border-border pt-2 text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Potential total today"}),e.jsxs("span",{className:"flex items-center gap-1 font-semibold text-primary",children:[e.jsx(Ze,{className:"h-3 w-3"}),ae+V," XP"]})]})]}),se.length>0&&e.jsx("div",{className:"sticky top-0 z-10 -mx-4 px-4 pb-3 pt-1 bg-background/95 backdrop-blur-sm",children:e.jsxs("div",{className:"rounded-lg border border-stardust-gold/30 bg-gradient-to-r from-stardust-gold/10 to-stardust-gold/5 p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm font-medium text-stardust-gold mb-3",children:[e.jsx(te,{className:"h-4 w-4"}),"Goals for Today (",se.length,")"]}),e.jsx("div",{className:"space-y-2",children:se.map(s=>e.jsx(Ie,{milestone:s,onClick:()=>u?.(s)},s.id))})]})}),!h&&Y.length>0&&e.jsxs("div",{className:"rounded-lg border border-dashed border-border/70 bg-muted/20 p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm font-medium text-muted-foreground",children:[e.jsx(Z,{className:"h-4 w-4 text-muted-foreground"}),"Unscheduled (",Y.length,")"]}),e.jsxs("div",{className:"mt-3 flex flex-wrap gap-2",children:[ce.map(s=>e.jsx("div",{draggable:!0,onDragStart:l=>{l.dataTransfer.setData("taskId",s.id),b(s.id),F("pop")},className:"cursor-move",children:e.jsx(ne,{task:s,isDragging:_===s.id,compact:!0})},s.id)),!R&&ue>0&&e.jsxs(W,{variant:"outline",size:"sm",className:"h-8 border-dashed text-xs",onClick:()=>C(!0),children:["+",ue," more"]})]}),R&&re&&e.jsx(W,{variant:"ghost",size:"sm",className:"mt-2 h-7 text-xs",onClick:()=>C(!1),children:"Show less"})]}),h&&Y.length>0&&e.jsx("div",{className:"flex justify-center",children:e.jsxs("div",{className:"rounded-full bg-muted/90 backdrop-blur-sm px-4 py-1.5 text-xs font-medium text-muted-foreground shadow-sm border border-border/50",children:["You have ",Y.length," unscheduled quest",Y.length!==1?"s":""]})}),i.filter(s=>s.scheduled_time).length===0&&Y.length>0&&e.jsxs("div",{className:"rounded-lg border border-dashed border-border/60 bg-background/70 p-3 text-center text-sm text-muted-foreground",children:["You have ",Y.length," unscheduled quest",Y.length>1?"s":"",". Drag a chip into the timeline or long press any slot to place it."]}),h?e.jsx("div",{className:"rounded-lg border border-border",children:e.jsx("div",{className:"relative",children:M.map(({hour:s,minute:l},N)=>{const S=r(s,l),T=l===0,U=A(s,l);return e.jsxs("div",{"data-hour":T?s:void 0,className:m("flex border-b border-border/50 hover:bg-accent/30 transition-colors group touch-manipulation select-none",T&&"border-t border-border"),style:{minHeight:"60px",WebkitTapHighlightColor:"transparent",WebkitTouchCallout:"none",WebkitUserSelect:"none",userSelect:"none"},onDragOver:x=>x.preventDefault(),onDrop:x=>{x.preventDefault();const z=x.dataTransfer.getData("taskId");F("complete"),g(z,t,U),b(null)},onTouchStart:x=>O(s,l,x),onTouchMove:G,onTouchEnd:J,onTouchCancel:J,children:[e.jsx("div",{className:m("flex-shrink-0 w-20 p-2 text-xs font-medium",T?"text-foreground":"text-muted-foreground/60"),children:T&&E(s,l)}),e.jsx("div",{className:"flex-1 p-2 relative",children:S.length===0?e.jsxs("div",{className:"opacity-0 group-hover:opacity-100 transition-opacity flex items-center gap-2 text-xs text-muted-foreground",children:[e.jsx(K,{className:"h-3 w-3"}),e.jsx("span",{children:"Long press to add quest"})]}):e.jsx("div",{className:"space-y-2",children:S.map(x=>e.jsx("div",{style:{height:`${a(x.estimated_duration)}px`,minHeight:"60px"},children:e.jsx(ne,{task:x,isDragging:_===x.id,onDragStart:z=>{z.dataTransfer.setData("taskId",x.id),b(x.id),F("pop")},onLongPress:()=>k?.(x.id),showTime:!0})},x.id))})})]},`${s}-${l}`)})})}):e.jsx(it,{className:"rounded-lg border border-border max-h-[520px] min-h-[320px]",children:e.jsx("div",{className:"relative",children:M.map(({hour:s,minute:l},N)=>{const S=r(s,l),T=l===0,U=A(s,l);return e.jsxs("div",{className:m("flex border-b border-border/50 hover:bg-accent/30 transition-colors group touch-manipulation select-none",T&&"border-t border-border"),style:{minHeight:"60px",WebkitTapHighlightColor:"transparent",WebkitTouchCallout:"none",WebkitUserSelect:"none",userSelect:"none"},onDragOver:x=>x.preventDefault(),onDrop:x=>{x.preventDefault();const z=x.dataTransfer.getData("taskId");F("complete"),g(z,t,U),b(null)},onTouchStart:x=>O(s,l,x),onTouchMove:G,onTouchEnd:J,onTouchCancel:J,children:[e.jsx("div",{className:m("flex-shrink-0 w-20 p-2 text-xs font-medium",T?"text-foreground":"text-muted-foreground/60"),children:T&&E(s,l)}),e.jsx("div",{className:"flex-1 p-2 relative",children:S.length===0?e.jsxs("div",{className:"opacity-0 group-hover:opacity-100 transition-opacity flex items-center gap-2 text-xs text-muted-foreground",children:[e.jsx(K,{className:"h-3 w-3"}),e.jsx("span",{children:"Long press to add quest"})]}):e.jsx("div",{className:"space-y-2",children:S.map(x=>e.jsx("div",{style:{height:`${a(x.estimated_duration)}px`,minHeight:"60px"},children:e.jsx(ne,{task:x,isDragging:_===x.id,onDragStart:z=>{z.dataTransfer.setData("taskId",x.id),b(x.id),F("pop")},showTime:!0})},x.id))})})]},`${s}-${l}`)})})}),L().length>0&&e.jsxs("div",{className:"rounded-lg border border-primary/20 bg-primary/5 p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm font-medium text-primary",children:[e.jsx(we,{className:"h-4 w-4"}),"Completed Today (",L().length,")"]}),e.jsxs("div",{className:"mt-2 flex flex-wrap gap-2",children:[L().slice(0,5).map(s=>e.jsx("div",{className:"rounded-full bg-primary/10 px-3 py-1 text-xs font-medium text-primary line-through opacity-70",children:s.task_text},s.id)),L().length>5&&e.jsxs("span",{className:"rounded-full bg-primary/10 px-3 py-1 text-xs font-medium text-primary",children:["+",L().length-5," more"]})]})]}),i.length>0&&e.jsx("div",{className:"text-center text-xs text-muted-foreground",children:"ðŸ’¡ Drag unscheduled quests or long press on a time to add a new quest"})]})},Re=et("inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground",{variants:{variant:{default:"bg-transparent",outline:"border border-input bg-transparent hover:bg-accent hover:text-accent-foreground"},size:{default:"h-10 px-3",sm:"h-9 px-2.5",lg:"h-11 px-5"}},defaultVariants:{variant:"default",size:"default"}}),It=n.forwardRef(({className:t,variant:d,size:o,...c},g)=>e.jsx(Ce,{ref:g,className:m(Re({variant:d,size:o,className:t})),...c}));It.displayName=Ce.displayName;const qe=n.createContext({size:"default",variant:"default"}),$e=n.forwardRef(({className:t,variant:d,size:o,children:c,...g},y)=>e.jsx(ke,{ref:y,className:m("flex items-center justify-center gap-1",t),...g,children:e.jsx(qe.Provider,{value:{variant:d,size:o},children:c})}));$e.displayName=ke.displayName;const oe=n.forwardRef(({className:t,children:d,variant:o,size:c,...g},y)=>{const k=n.useContext(qe);return e.jsx(Me,{ref:y,className:m(Re({variant:k.variant||o,size:k.size||c}),t),...g,children:d})});oe.displayName=Me.displayName;const Rt=({view:t,onChange:d})=>e.jsxs($e,{type:"single",value:t,onValueChange:o=>o&&d(o),className:"bg-muted/50 rounded-lg p-0.5",children:[e.jsx(oe,{value:"timeline","aria-label":"Timeline view",className:"h-7 w-7 data-[state=on]:bg-background data-[state=on]:shadow-sm",children:e.jsx(tt,{className:"h-4 w-4"})}),e.jsx(oe,{value:"grid","aria-label":"Grid view",className:"h-7 w-7 data-[state=on]:bg-background data-[state=on]:shadow-sm",children:e.jsx(st,{className:"h-4 w-4"})})]});function qt(t){const{user:d}=dt(),o=H(Ee(t),"yyyy-MM-dd"),c=H(He(t),"yyyy-MM-dd"),{data:g=[],isLoading:y}=rt({queryKey:["calendar-milestones",d?.id,o,c],queryFn:async()=>{if(!d?.id)return[];const{data:u,error:h}=await ge.from("epic_milestones").select(`
          id,
          title,
          target_date,
          milestone_percent,
          completed_at,
          epic_id,
          phase_name
        `).eq("user_id",d.id).not("target_date","is",null).gte("target_date",o).lte("target_date",c).order("target_date");if(h)return console.error("Error fetching milestones:",h),[];if(!u||u.length===0)return[];const w=[...new Set(u.map(p=>p.epic_id))],{data:_}=await ge.from("epics").select("id, title").in("id",w),b=new Map(_?.map(p=>[p.id,p.title])||[]);return u.map(p=>({...p,target_date:p.target_date,epic_title:b.get(p.epic_id)||"Campaign"}))},enabled:!!d?.id,staleTime:1e3*60*5});return{milestones:g,isLoading:y,getMilestonesForDate:u=>{const h=H(u,"yyyy-MM-dd");return g.filter(w=>w.target_date===h)}}}const zt=()=>{const[t,d]=n.useState(new Date),[o,c]=n.useState("timeline"),[g,y]=n.useState(!1),[k,u]=n.useState(!1),[h,w]=n.useState(null),[_,b]=n.useState(null),{tasks:p}=ct(t,"month"),{milestones:v}=qt(t),{addTask:D,updateTask:I,deleteTask:R,isAdding:C,isUpdating:q,isDeleting:i}=ut(t),P=n.useMemo(()=>p.map(a=>({id:a.id,task_text:a.task_text,completed:a.completed||!1,scheduled_time:a.scheduled_time,estimated_duration:a.estimated_duration,task_date:a.task_date,difficulty:a.difficulty,xp_reward:a.xp_reward,is_main_quest:a.is_main_quest||!1,category:a.category})),[p]),f=n.useCallback(a=>{d(a)},[]),j=n.useCallback((a,O)=>{d(a),w(O),u(!0)},[]),M=n.useCallback(a=>{b({id:a.id,task_text:a.task_text,task_date:a.task_date,difficulty:a.difficulty,scheduled_time:a.scheduled_time,estimated_duration:a.estimated_duration})},[]),E=n.useCallback(a=>{const O=P.find(G=>G.id===a);O&&M(O)},[P,M]),A=n.useCallback(async(a,O)=>{await I({taskId:a,updates:{scheduled_time:O}})},[I]),r=n.useCallback((a,O,G)=>{G&&A(a,G)},[A]),$=async a=>{const O=a.sendToInbox?null:a.taskDate??H(t,"yyyy-MM-dd");await D({taskText:a.text,difficulty:a.difficulty,taskDate:O,isMainQuest:!1,scheduledTime:a.scheduledTime,estimatedDuration:a.estimatedDuration,recurrencePattern:a.recurrencePattern,recurrenceDays:a.recurrenceDays,reminderEnabled:a.reminderEnabled,reminderMinutesBefore:a.reminderMinutesBefore,notes:a.moreInformation,location:a.location,contactId:a.contactId,autoLogInteraction:a.autoLogInteraction,subtasks:a.subtasks}),u(!1),w(null)},L=async(a,O)=>{await I({taskId:a,updates:O}),b(null)},B=async a=>{await R(a),at.success("Quest deleted"),b(null)};return e.jsx(mt,{children:e.jsxs("div",{className:"min-h-screen bg-background pb-nav-safe relative overflow-hidden flex flex-col",children:[e.jsx(ht,{}),e.jsx("div",{className:"pt-[env(safe-area-inset-top)]"}),e.jsx("div",{className:"max-w-2xl mx-auto w-full px-4 pt-3 pb-2 relative z-10 flex justify-end",children:e.jsx(Rt,{view:o,onChange:c})}),e.jsx("div",{className:"flex-1 max-w-2xl mx-auto w-full relative z-10 overflow-hidden",children:o==="timeline"?e.jsx(Mt,{selectedDate:t,onDateSelect:f,tasks:P,milestones:v,onTaskClick:M,onTaskLongPress:E,onTimeSlotLongPress:j,onMilestoneClick:()=>{},onAddClick:()=>u(!0),onTaskReschedule:A,onDateHeaderClick:()=>y(!0)}):e.jsx(Ht,{selectedDate:t,onDateSelect:f,tasks:P,milestones:v,onTaskDrop:r,onTimeSlotLongPress:j,onTaskLongPress:E,onMilestoneClick:()=>{}})}),e.jsx(St,{open:g,onOpenChange:y,selectedDate:t,onDateSelect:f,tasks:P,milestones:v}),e.jsx(xt,{open:k,onOpenChange:a=>{u(a),a||w(null)},selectedDate:t,onAdd:$,isAdding:C,prefilledTime:h}),e.jsx(gt,{task:_,open:!!_,onOpenChange:a=>!a&&b(null),onSave:L,isSaving:q,onDelete:B,isDeleting:i}),e.jsx(ft,{})]})})};export{zt as default};
